# Note å¤åˆ¶åŠŸèƒ½ - é›†æˆæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åç«¯é›†æˆ

å¤åˆ¶åŠŸèƒ½å·²åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­å®ç°ï¼š

1. **æ–°å»ºæ–‡ä»¶**
   - `WordloomBackend/api/app/services/file_service.py` â€” æ–‡ä»¶æ“ä½œå·¥å…·
   - `WordloomBackend/api/app/services/note_service.py` â€” Note ä¸šåŠ¡é€»è¾‘

2. **ä¿®æ”¹çš„æ–‡ä»¶**
   - `WordloomBackend/api/app/routers/orbit/notes.py` â€” æ·»åŠ  `/duplicate` ç«¯ç‚¹

### å‰ç«¯é›†æˆ

1. **ä¿®æ”¹çš„æ–‡ä»¶**
   - `WordloomFrontend/next/src/modules/orbit/domain/api.ts` â€” æ·»åŠ  `duplicateNote()` API
   - `WordloomFrontend/next/app/orbit/page.tsx` â€” æ·»åŠ  UI å’Œäº¤äº’é€»è¾‘

---

## âœ… éªŒè¯æ­¥éª¤

### 1. å¯åŠ¨åç«¯æœåŠ¡

```powershell
cd D:\Project\Wordloom\WordloomBackend\api
.\.venv\Scripts\Activate.ps1
python -m uvicorn app.main_orbit:app --host 127.0.0.1 --port 8000 --reload
```

### 2. è¿è¡Œæµ‹è¯•è„šæœ¬

```powershell
cd D:\Project\Wordloom\WordloomBackend\api
python test_duplicate_note.py
```

**é¢„æœŸè¾“å‡º**:
```
============================================================
  ğŸ§ª Note å¤åˆ¶åŠŸèƒ½æµ‹è¯•
============================================================

============================================================
  æµ‹è¯• 1: åˆ›å»ºåŸå§‹ Note
============================================================

ğŸ“ åˆ›å»ºæµ‹è¯• Note...
âœ… åˆ›å»ºæˆåŠŸï¼
   ID: 12345678-...
   æ ‡é¢˜: Test Note for Duplication
   æ ‡ç­¾: ['test', 'demo']

============================================================
  æµ‹è¯• 2: å¤åˆ¶ Note
============================================================

ğŸ“‹ å¤åˆ¶ Note: 12345678-......
âœ… å¤åˆ¶æˆåŠŸï¼
   æ–° ID: 87654321-...
   æ–°æ ‡é¢˜: Test Note for Duplication (å‰¯æœ¬)
   ä½¿ç”¨æ¬¡æ•°: 0 (åº”ä¸º 0)
   æ ‡ç­¾: ['test', 'demo']

============================================================
  æµ‹è¯• 3: éªŒè¯å¤åˆ¶ç»“æœ
============================================================

âœ“ éªŒè¯é¡¹:
  âœ… ID ä¸åŒ
  âœ… ä½¿ç”¨æ¬¡æ•°é‡ç½®
  âœ… æ ‡é¢˜åŒ…å«åç¼€
  âœ… ä¿ç•™æ ‡ç­¾
  âœ… ä¿ç•™ä¼˜å…ˆçº§
  âœ… ä¿ç•™ç´§æ€¥ç¨‹åº¦
  âœ… ä¿ç•™å†…å®¹

============================================================
  æµ‹è¯• 4: åˆ—å‡ºæ‰€æœ‰ Note
============================================================

âœ… å…± N ä¸ª Note

============================================================
  æ¸…ç†
============================================================

ğŸ—‘ï¸  åˆ é™¤æµ‹è¯•æ•°æ®...
âœ… æ¸…ç†å®Œæˆ

============================================================
  æµ‹è¯•ç»“æœ
============================================================

âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### 3. å¯åŠ¨å‰ç«¯æœåŠ¡

```powershell
cd D:\Project\Wordloom\WordloomFrontend\next
npm run dev
# æˆ–
pnpm dev
```

### 4. åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

1. æ‰“å¼€ `http://localhost:3000/orbit`
2. åˆ›å»ºä¸€ä¸ªæµ‹è¯• Noteï¼ˆæˆ–ä½¿ç”¨ç°æœ‰çš„ï¼‰
3. Hover åœ¨ Note å¡ç‰‡ä¸Š
4. ç‚¹å‡» **ğŸ“‹** æŒ‰é’®ï¼ˆæ–°å¢çš„å¤åˆ¶æŒ‰é’®ï¼‰
5. çœ‹åˆ°æˆåŠŸæç¤º
6. éªŒè¯æ–° Note å‡ºç°åœ¨åˆ—è¡¨ä¸­

---

## ğŸ” API æ–‡æ¡£

### ç«¯ç‚¹

```
POST /api/orbit/notes/{note_id}/duplicate
```

### è¯·æ±‚

```json
{
  "title_suffix": "(å‰¯æœ¬)"
}
```

### å“åº” (200 OK)

```json
{
  "id": "new-uuid-string",
  "title": "åŸæ ‡é¢˜ (å‰¯æœ¬)",
  "content_md": "åŸå†…å®¹",
  "status": "open",
  "priority": 3,
  "urgency": 3,
  "usage_level": 3,
  "usage_count": 0,
  "tags": ["tag1", "tag2"],
  "tags_rel": [
    {
      "id": "tag-uuid",
      "name": "tag1",
      "color": "#3B82F6",
      "icon": null,
      "description": null,
      "count": 1
    }
  ],
  "due_at": null,
  "created_at": "2025-10-31T12:34:56.789Z",
  "updated_at": "2025-10-31T12:34:56.789Z"
}
```

### é”™è¯¯å“åº”

```json
// 404 Not Found
{
  "detail": "note not found"
}

// 500 Internal Server Error
{
  "detail": "Failed to duplicate note: error message"
}
```

---

## ğŸ§­ ä»£ç æµç¨‹

### åç«¯æµç¨‹

```
POST /notes/{id}/duplicate
    â†“
notes.py: duplicate_note()
    â†“
NoteService.duplicate_note()
    â”œâ”€ æŸ¥è¯¢åŸ Note
    â”œâ”€ åˆ›å»ºæ–° Noteï¼ˆDBï¼‰
    â”œâ”€ å¤åˆ¶æ ‡ç­¾å…³è”ï¼ˆDBï¼‰
    â”œâ”€ å¤åˆ¶æ–‡ä»¶å¤¹ï¼ˆFSï¼‰
    â””â”€ å¼‚å¸¸å¤„ç† & å›æ»š
    â†“
è¿”å›æ–° Note
```

### å‰ç«¯æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» ğŸ“‹ æŒ‰é’®
    â†“
onDuplicate(noteId)
    â†“
duplicateNote(noteId, "(å‰¯æœ¬)")
    â†“
apiFetch("POST /notes/{id}/duplicate", {...})
    â†“
åˆ·æ–° Note åˆ—è¡¨
    â†“
æ˜¾ç¤ºæˆåŠŸæç¤º
```

---

## ğŸ“¦ ä¾èµ–

### åç«¯
- `shutil` â€” æ–‡ä»¶æ“ä½œï¼ˆPython å†…ç½®ï¼‰
- `pathlib.Path` â€” è·¯å¾„å¤„ç†ï¼ˆPython å†…ç½®ï¼‰
- `FastAPI` â€” å·²æœ‰
- `SQLAlchemy` â€” å·²æœ‰
- `PostgreSQL` â€” å·²æœ‰

### å‰ç«¯
- `axios` / `fetch` â€” API è°ƒç”¨ï¼ˆå·²æœ‰ï¼‰
- React hooks â€” å·²æœ‰
- TanStack Query â€” å·²æœ‰

**æ— éœ€æ–°å¢ä¾èµ–** âœ…

---

## ğŸ¯ å·²å®ç°çš„åŠŸèƒ½

- âœ… åç«¯å¤åˆ¶ API ç«¯ç‚¹
- âœ… æ•°æ®åº“è®°å½•åˆ›å»º
- âœ… æ ‡ç­¾å…³è”å¤åˆ¶
- âœ… æ–‡ä»¶å¤¹å®Œæ•´å¤åˆ¶
- âœ… ä½¿ç”¨æ¬¡æ•°é‡ç½®
- âœ… é”™è¯¯å¤„ç†å’Œå›æ»š
- âœ… å‰ç«¯ API é›†æˆ
- âœ… UI æŒ‰é’®å’Œäº¤äº’
- âœ… ä¸¤ç§è§†å›¾æ”¯æŒï¼ˆGrid + Listï¼‰

---

## ğŸš§ å·²çŸ¥é™åˆ¶

1. **æ–‡ä»¶å¤§å°** â€” æå¤§æ–‡ä»¶å¯èƒ½å¯¼è‡´è¶…æ—¶ï¼ˆå»ºè®® < 500MBï¼‰
2. **æƒé™** â€” æš‚æœªæ·»åŠ æƒé™æ£€æŸ¥ï¼ˆåæœŸå¯åŠ ï¼‰
3. **è¿›åº¦æç¤º** â€” å¤§æ–‡ä»¶å¤åˆ¶æ—¶æ— è¿›åº¦æ¡ï¼ˆå¯åç»­ä¼˜åŒ–ï¼‰

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“äº‹åŠ¡** â€” æ–‡ä»¶å¤åˆ¶å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š DB
2. **å¹¶å‘å®‰å…¨** â€” SQLAlchemy é»˜è®¤å¤„ç†
3. **å­˜å‚¨ç©ºé—´** â€” å¤åˆ¶ä¼šç¿»å€å ç”¨ç©ºé—´
4. **æ–‡ä»¶æƒé™** â€” å¤åˆ¶ä¿æŒåŸå§‹æ–‡ä»¶æƒé™

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å®ç°æ–‡æ¡£](./NOTE_DUPLICATE_IMPLEMENTATION.md)
- API ç«¯ç‚¹: `/api/orbit/notes/{id}/duplicate`
- å‰ç«¯ç»„ä»¶: `WordloomFrontend/next/app/orbit/page.tsx`

---

## ğŸ“ æ”¯æŒ

æœ‰é—®é¢˜ï¼Ÿæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. âœ“ åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆ`http://localhost:8000/docs`ï¼‰
2. âœ“ æ•°æ®åº“è¿æ¥æ­£å¸¸
3. âœ“ æ–‡ä»¶ç³»ç»Ÿå¯å†™ï¼ˆ`storage/orbit_uploads/`ï¼‰
4. âœ“ å‰ç«¯ä¸åç«¯è¿æ¥ï¼ˆæ£€æŸ¥æµè§ˆå™¨ DevToolsï¼‰

**æµ‹è¯•å‘½ä»¤**:
```bash
# éªŒè¯åç«¯å¥åº·
curl http://localhost:8000/docs

# éªŒè¯æ•°æ®åº“
curl http://localhost:8000/api/orbit/notes

# è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
python test_duplicate_note.py
```
