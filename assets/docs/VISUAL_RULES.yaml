# ============================================
# Wordloom v3 VISUAL_RULES - å‰ç«¯å¯è§†åŒ–è§„åˆ™åº“
# ============================================
# å‰ç«¯å¼€å‘æŒ‡å—ï¼ˆUI/äº¤äº’/çŠ¶æ€ç®¡ç†ï¼‰
# ä¸åç«¯ DDD_RULES.yaml + HEXAGONAL_RULES.yaml å¯¹é½
# æœ€åæ›´æ–°ï¼š2025-11-28
# ç‰ˆæœ¬ï¼š1.0

metadata:
  version: "2.9"
  frontend_framework: "Next.js 14 App Router + TypeScript + TanStack Query + FSD Architecture"
  sync_status: "âœ… Book Preview Cards + Horizontal Scrolling + Bookshelf Integration Complete (Nov 20, 2025) | âœ… Backend Tag user_id type alignment fixed (Nov 23, 2025) | âœ… Library overview list layout V3 delivered (Nov 24, 2025) | âœ… Library tag tooltip + admin catalog polish shipped (Dec 6, 2025) | âœ… Library cover title rails + list badge tooltips aligned (Dec 7, 2025) | âœ… Library cards/forms full i18n hookup (Dec 7, 2025)"
  frontend_startup_status: "âœ… RUNNING ON http://localhost:30002 (Nov 20, 2025)"
  last_updated: "2025-12-07"
  backend_tag_user_id_fix_status: "âœ… Tag user_id type corrected to UUID (aligned with Migration 003) - ORM & Repository synchronized (Nov 23, 2025)"
  block_editor_phase_status: "ğŸŸ¡ Phase 0 Scaffolding (ADR-080 accepted Nov 21, 2025)"
  block_editor_phase2_status: "âœ… Phase 2 Active - Default Inline Editing (no overlay) + Delete/Restore + Reorder + Styling Upgrade (Nov 21, 2025)"
  block_editor_phase3_status: "â¸ Skipped (Performance/Optimistic & concurrency deferred)"
  block_editor_phase4_status: "âœ… Search Integration + Preview Rendering (Nov 21, 2025)"
  block_editor_plan77_phase_status: "ğŸŸ¢ Plan77 v1 Delivered - Paragraph-only BlockRenderer/Display/Editor stack (Nov 27, 2025)"
  block_renderer_component_status: "ğŸŸ¢ BlockRenderer orchestrator online; v1.5+ BlockKind hooks scaffolded (Nov 27, 2025)"
  block_rich_types_status: "ğŸŸ¢ Plan83 Phase delivered â€“ paragraph/todo/callout/quote/divider/image/gallery inline editorsä¸Šçº¿ (Nov 27, 2025)"
  block_editor_plan83_status: "ğŸŸ¢ Rich block insert/renderer stack ready â€“ todo promotion + gallery strip (Nov 27, 2025)"
  block_media_integration_status: "â³ Pending Media association (no inline binary)"
  block_editor_plan132_status: "ğŸŸ¢ Plan132 Slash/+ quick insert & heavy block shells shipped (Dec 2, 2025)"
  block_editor_plan134_status: "ğŸŸ¡ Plan134 UndoManager keyboard contract ready (Dec 2, 2025)"
  block_editor_plan160_status: "ğŸŸ¢ Plan160 slash anchor & QuickInsert split shipped (Dec 4, 2025)"
  media_anonymous_upload_status: "âœ… Backend supports anonymous media upload (user_id optional) - UI integration pending (Nov 22, 2025)"
  library_listing_mode_status: "âœ… Single-user mode (unfiltered) active - future multi-user will reintroduce filter (ADR-082)"
  library_overview_plan20_status: "âœ… Plan20 Library overview åˆ·æ–°å®Œæ¯•ï¼šlast_activity æ’åº + pinned æ®µè½ + archive toggle + å³æ—¶è§†å›¾è®¡æ•° (Nov 22, 2025)"
  library_creation_dialog_v2_status: "âœ… Library Creation Dialog V2 å±…ä¸­å¼¹çª— + ç¼–è¾‘å…±ç”¨ + é«˜äº®åé¦ˆ (Nov 22, 2025)"
  library_card_poster_strategy_status: "âœ… Active - Bookshelf Poster Cards + hover controls shipped (Nov 23, 2025)"
  library_list_layout_strategy_status: "âœ… Active - Library overview listè§†å›¾ V3ï¼ˆ96px é¢„è§ˆ + è¯´æ˜åˆ— + æ ‡ç­¾æŒ‡æ ‡åˆ— + åˆ›å»º/æ›´æ–°æ—¶é—´ï¼‰(Nov 24, 2025)"
  library_bookshelf_dashboard_status: "âœ… Adopted - Bookshelf Dashboard Layout V2 + Actions Column + Tag Dialog (ADR-096, Nov 25, 2025)"
  library_bookshelf_inline_creation_status: "âœ… Inline create uses shared LibraryForm with tag picker + toast guard (Nov 26, 2025)"
  bookshelf_tag_edit_dialog_status: "âœ… Live - Inline modal supports rename + description + tag chips + quick update (Nov 26, 2025)"

bookshelf_compact_list_view:
  adr_reference: "ADR-095-bookshelf-compact-list-view-upgrade.md"
  decision: "ä»…ä¿ç•™ç´§å‡‘è§†å›¾ï¼›ç§»é™¤èˆ’é€‚è§†å›¾åˆ‡æ¢ã€‚"
  rationale:
    - "å·¥ä½œè§†å›¾ä»¥ä¿¡æ¯å¯†åº¦å’Œå¯æ‰«è¯»ä¸ºå…ˆï¼Œé¿å…åŒè§†å›¾ç»´æŠ¤æˆæœ¬ã€‚"
    - "é¢œè‰²ç»§æ‰¿å±äºè§†è§‰å±‚è§„åˆ™ï¼Œä¸è¿›å…¥é¢†åŸŸé€»è¾‘ã€‚"
  layout:
    left_thumbnail:
      size: "96x96ï¼ˆå…è®¸ 88x88 ä½œä¸ºæœ€å°å…¼å®¹ï¼‰"
      content: "é€æ˜ä¹¦æŸœ PNG å åŠ åœ¨ç”± Library ä¸»é¢˜è‰²ç”Ÿæˆçš„å¢™é¢æ¸å˜ä¸Š"
      color_source_priority: "coverâ†’library_themeï¼ˆå«é¢„è®¾ silk-blueï¼‰â†’hash"
    middle_info:
      rows:
        - "æ ‡é¢˜ï¼ˆåŠ ç²—ï¼‰ + çŠ¶æ€ Chipï¼ˆACTIVE/FROZEN/ARCHIVEDï¼‰"
        - "Tagsï¼ˆæœ€å¤š 3 ä¸ªï¼‰æˆ– 'æ— æ ‡ç­¾'"
        - "æˆç†Ÿåº¦æ±‡æ€»ï¼šğŸŒ±Seed Â· ğŸŒ¿Growing Â· ğŸ“˜Stable Â· ğŸ“¦Legacy"
    right_stats:
      lines:
        - "å…³é”®æ•°å­—ï¼šæ€»ä¹¦æ•°ã€è¿‘7å¤©æ´»è·ƒã€ä»Šæ—¥æ¬¡æ•°"
        - "Chronicle æ‘˜è¦ï¼šæœ€è¿‘ä¸€æ¬¡äº‹ä»¶ï¼ˆç›¸å¯¹æ—¶é—´ + ç±»å‹ï¼‰"
  visual_language:
    maturity_icons:
      seed: { icon: "Sprout", color: "#8BC34A" }
      growing: { icon: "TreeDeciduous", color: "#26A69A" }
      stable: { icon: "BookOpen|ShieldCheck", color: "#2196F3" }
      legacy: { icon: "Archive", color: "#FFB74D" }
  theme_inheritance:
    rule: "çˆ¶ Library çš„ä¸»é¢˜è‰²ä»¥ CSS å˜é‡æ³¨å…¥ï¼ˆ--library-theme-colorï¼‰ï¼Œå­ Bookshelf å¡ç‰‡èƒŒæ™¯æ¸å˜ä»…åœ¨å‰ç«¯è®¡ç®—ã€‚"
    domain_boundary: "ç¦æ­¢åœ¨åç«¯æŒä¹…åŒ– wall_colorï¼›æ­¤ä¸ºå±•ç¤ºå±æ€§ã€‚"
  accessibility:
    - "æˆç†Ÿåº¦å›¾æ ‡éœ€ aria-labelï¼ˆä¾‹å¦‚ 'Seed 3 æœ¬'ï¼‰ã€‚"
    - "Chronicle åˆ—è¡¨é‡‡ç”¨ aria-live=politeã€‚"
  performance:
    - "ä»…åœ¨é¦–å±æ¸²æŸ“æ—¶è®¡ç®—æ¸å˜è‰²ï¼›é¢œè‰²ç¼“å­˜ localStorage('wl_library_theme_*')ã€‚"
  testing:
    - "Snapshotï¼šç©ºæ€/æœ‰æ•°æ®ï¼ˆå«æˆç†Ÿåº¦/ç»Ÿè®¡/æ—¶é—´çº¿ï¼‰"
    - "Interactionï¼šåˆ†é¡µåŠ è½½ä¸€æ¬¡ï¼›åˆ‡æ¢æ’åºä¸å½±å“ä¸»é¢˜è‰²"
  status: "Adopted Nov 24, 2025"

bookshelf_dashboard_layout_v2:
  adr_reference: "ADR-096-bookshelf-dashboard-layout-v2-and-action-column.md"
  goal: "å°† Bookshelf Dashboard æ¨ªæ’è§†å›¾ä¸ Library åˆ—è¡¨ç»Ÿä¸€ï¼Œæå‡ä¿¡æ¯å¯†åº¦ä¸æ“ä½œæ•ˆç‡ã€‚"
  grid_layout:
    columns: ["cellCover", "cellName", "cellTags", "cellStatus", "cellMetrics", "cellActions"]
    column_notes:
      cellCover: "å°é¢å¤´åƒï¼›ä¸ LibraryCoverAvatar å…±äº«å®ç°"
      cellName: "æ ‡é¢˜ + Pinned/Archived å¾½ç« "
      cellTags: "æ ‡ç­¾ pillï¼Œæœ€å¤šå±•ç¤º 3 ä¸ªï¼Œç©ºæ€æ–‡æ¡ˆ 'æ— æ ‡ç­¾'"
      cellStatus: "çº¯æ–‡æœ¬çŠ¶æ€æ ‡ç­¾ï¼ˆSeed/Growing/Stable/Legacy/Archivedï¼‰+ æœ€è¿‘æ´»åŠ¨"
      cellMetrics: "æ€»ä¹¦ xã€æœ¬å‘¨ç¼–è¾‘/æµè§ˆæ¬¡æ•°"
      cellActions: "Lucide å›¾æ ‡æŒ‰é’®ç»„ï¼ˆç¼–è¾‘/ç½®é¡¶/å½’æ¡£/åˆ é™¤ï¼‰"
    template: "var(--library-avatar-size) 200px 180px 190px 150px auto"
    responsive:
      - "â‰¤1200px: cellName æ”¶ç¼©è‡³ 180pxï¼Œactions è‡ªåŠ¨æŠ˜è¡Œ"
      - "â‰¤960px: æŠ˜å ä¸ºä¸¤åˆ—å¡ç‰‡ï¼Œactions å‚ç›´å †å å¹¶è´´è¿‘è¡Œå°¾"
  visual_language:
    pinned_badge: "ä¸ç»¸è“ä¸»é¢˜ï¼Œä½¿ç”¨ --wl-pinned-accent-bg ä¸ --wl-pinned-accent-text token"
    pinned_action_button: "æ“ä½œåˆ—é¦–ä¸ªæŒ‰é’®å¤ç”¨ pinned tokenï¼›hover æ˜åº¦ -12%"
    archived_badge: "ç°é˜¶æ ‡ç­¾ï¼Œä¸ Library åˆ—è¡¨ä¸€è‡´"
    status_text: "çŠ¶æ€åˆ—å¿…é¡»ä½¿ç”¨çº¯æ–‡æœ¬ï¼ˆACTIVE/ARCHIVEDï¼‰ï¼Œä¾èµ– --wl-status-* tokens æ§åˆ¶é¢œè‰²ï¼Œä¸æ¸²æŸ“é¢å¤–å¾½ç« "
    status_pulse: "æœ€è¿‘æ´»åŠ¨è„‰å†²ç‚¹ä½¿ç”¨ --wl-status-pulse-bg ä¸ --wl-status-pulse-border tokenï¼Œæ”¯æŒæš—/äº®åŒæ¨¡å¼"
    tags_pill: "å¤šè¡Œ pillï¼Œæœ€å¤šæ˜¾ç¤º 3 ä¸ªå¹¶ä¿ç•™ hover æç¤º"
  status_summary_bar:
    description: "Plan55 é¡¶éƒ¨æ¸©åº¦çŠ¶æ€æ¡å±•ç¤º health åˆ†å¸ƒï¼ˆActive / Slowing / Cooling / Archivedï¼‰ï¼Œä¸åˆ—è¡¨è§†å›¾ä¿æŒä¸€è‡´ã€‚"
    computation:
      - "UI ç›´æ¥æ¶ˆè´¹ DTO.health ä¸ days_since_last_activityï¼ŒæŒ‰ health æšä¸¾ç»Ÿè®¡æ•°é‡ï¼›å½’æ¡£ä¹¦æ©±æ— è®ºæœ€è¿‘æ´»åŠ¨æ—¶é—´éƒ½å½’å…¥ archivedã€‚"
      - "é˜ˆå€¼ï¼šactiveï¼ˆ0-7 å¤©å†…æœ‰æ´»åŠ¨ï¼‰ã€slowingï¼ˆ8-21 å¤©æ— æ´»åŠ¨ï¼‰ã€coolingï¼ˆ22-60 å¤©æ— æ´»åŠ¨ï¼‰ã€archivedï¼ˆ>60 å¤©æ— æ´»åŠ¨æˆ– status=ARCHIVEDï¼‰ã€‚"
    visuals:
      - "è¿›åº¦æ¡åˆ’åˆ†å››æ®µï¼Œé¡ºåºå›ºå®š Activeâ†’Slowingâ†’Coolingâ†’Archivedï¼›èƒŒæ™¯è‰²ä¾æ¬¡ä½¿ç”¨ #22C55Eï¼ˆactiveï¼‰ã€#F59E0Bï¼ˆslowingï¼‰ã€#38BDF8ï¼ˆcoolingï¼‰ã€#94A3B8ï¼ˆarchivedï¼‰ï¼Œæ–‡å­—é¢œè‰²æ²¿ç”¨ --wl-status-active-text / --wl-text-secondary / --wl-text-secondary / --wl-status-archived-textã€‚"
      - "æ¯ä¸ªæ®µè½ hover/tooltip æ˜¾ç¤ºä¸­è‹±åŒè¯­æ–‡æ¡ˆï¼ˆç¤ºä¾‹ï¼š'Coolingï½œ22-60 å¤©æ— æ´»åŠ¨'ï¼‰ã€‚"
    layout: "æ¡Œé¢ç«¯å·¦ä¾§æ˜¾ç¤º 100% å®½åº¦çš„æ°´å¹³åˆ†æ®µæ¡ï¼Œå³ä¾§åˆ—å‡ºå››ä¸ªçŠ¶æ€è®¡æ•° + ç™¾åˆ†æ¯”ï¼›â‰¤960px æ—¶åˆ†ä¸¤è¡Œå±•ç¤ºï¼ˆç¬¬ä¸€è¡Œæ¡å½¢ã€ç¬¬äºŒè¡Œæ ‡ç­¾ç»Ÿè®¡ï¼‰ã€‚"
  interactions:
    - "è¡Œ hover ä»…æ”¹å˜èƒŒæ™¯ï¼Œä¸å‡ºç°è·³åŠ¨é˜´å½±"
    - "æ“ä½œåˆ—å›ºå®šé¡ºåºï¼šç¼–è¾‘(Edit3) â†’ ç½®é¡¶/å–æ¶ˆç½®é¡¶(Pin) â†’ å½’æ¡£/æ¢å¤(Box Archive) â†’ åˆ é™¤(Trash)"
    - "Pinned/Archived badge è‡ªåŠ¨ä¸æ ‡é¢˜åŒè¡Œï¼›ACTIVE æ–‡æ¡ˆåªåœ¨çŠ¶æ€åˆ—å‡ºç°ä¸€æ¬¡"
    - "æˆç†Ÿåº¦/æŒ‡æ ‡å›¾æ ‡ hover å¿…é¡»å‡ºç°ä¸­è‹±åŒè¯­ tooltipï¼ˆç¤ºä¾‹ï¼š'æˆç†Ÿåº¦ Seedï½œSeed stage readiness'ï¼‰"
    - "çŠ¶æ€æ–‡æœ¬åˆ—æ ¹æ® bookshelf.status æšä¸¾è¾“å‡º ACTIVE/ARCHIVEDï¼Œä¸æœ€è¿‘æ´»åŠ¨æ—¶é—´åŒè¡Œ"
    - "åˆ é™¤æŒ‰é’®è§¦å‘äºŒæ¬¡ç¡®è®¤å¯¹è¯æ¡† + aria-describedby éšè—æè¿°"
    - "è¡Œ/çŠ¶æ€ pill ç‚¹å‡»éƒ½èµ°ç»Ÿä¸€ handleOpen(item)ï¼›Enter/Space ä¸é¼ æ ‡è¡Œä¸ºä¸€è‡´"
    - "ç¼–è¾‘æŒ‰é’®æ‰“å¼€ BookshelfTagEditDialogï¼Œä¿å­˜æˆåŠŸåä»¥ toast + inline skeleton æ˜¾ç¤ºæäº¤çŠ¶æ€"
    - "Mutation ä½¿ç”¨ React Query useMutationï¼›æˆåŠŸå invalidateQueries(['bookshelves_dashboard', libraryId])"
    - "Pin/Unpin æŒ‰é’® aria-pressed åæ˜ çŠ¶æ€ï¼Œhover ä½¿ç”¨ --wl-pinned-action-hover tokenï¼›å½’æ¡£æŒ‰é’®åˆ‡æ¢ä¸º Restore æ–‡æ¡ˆæ—¶åŒæ­¥ aria-label"
  accessibility:
    - "ç½®é¡¶æŒ‰é’®ä½¿ç”¨ aria-pressed æš´éœ²å½“å‰çŠ¶æ€"
    - "æˆç†Ÿåº¦è®¡æ•°ä¸æŒ‡æ ‡å›¾æ ‡æ·»åŠ  aria-labelï¼ˆç¤ºä¾‹ï¼š'Seed 3 æœ¬'ï¼‰å¹¶åŒæ­¥ tooltip å†…å®¹"
    - "çŠ¶æ€åˆ—æ–‡æœ¬å¿…é¡»å…·å¤‡ aria-labelï¼ˆç¤ºä¾‹ï¼š'ACTIVEï¼Œæœ€è¿‘æ›´æ–° 3 å¤©å‰'ï¼‰"
    - "æ‰€æœ‰æ“ä½œæŒ‰é’®æä¾› title ä¸ aria-labelï¼Œæš—è‰²æ¨¡å¼å¯¹æ¯”åº¦ â‰¥4.5"
    - "åˆ é™¤æŒ‰é’®äºŒæ¬¡ç¡®è®¤éœ€ç»‘å®š aria-describedby æŒ‡å‘éšè—æè¿°"
  performance:
    - "å°é¢ç¼©ç•¥å›¾ä½¿ç”¨ cover_media_id â†’ buildMediaFileUrl(mediaId, updated_at) åš cache bust"
    - "ä»…åˆæ¬¡æŒ‚è½½è®¡ç®—å°é¢ URLï¼›ä¸åœ¨æ¸²æŸ“æœŸé—´å†™å…¥ LocalStorage"
    - "ä¿ç•™æ—§ tins åˆ—ç»“æ„ archived/ ç›®å½•ä»¥ä¾¿ rollback (ADR-096)"
  theme_mapping:
    tokens:
      light:
        pinned_bg: "var(--wl-pinned-accent-bg, rgba(59,130,246,0.12))"
        pinned_text: "var(--wl-pinned-accent-text, #1d4ed8)"
        status_active_text: "var(--wl-status-active-text, #0f1c36)"
        status_archived_text: "var(--wl-status-archived-text, #677294)"
        status_pulse_bg: "var(--wl-status-pulse-bg, rgba(27,136,255,0.16))"
        status_pulse_border: "var(--wl-status-pulse-border, rgba(27,136,255,0.4))"
      dark:
        pinned_bg: "var(--wl-pinned-accent-bg-dark, rgba(96,165,250,0.18))"
        pinned_text: "var(--wl-pinned-accent-text-dark, #bfdbfe)"
        status_active_text: "var(--wl-status-active-text-dark, #f2f5ff)"
        status_archived_text: "var(--wl-status-archived-text-dark, #929fcc)"
        status_pulse_bg: "var(--wl-status-pulse-bg-dark, rgba(135,206,255,0.26))"
        status_pulse_border: "var(--wl-status-pulse-border-dark, rgba(135,206,255,0.5))"
    guardrail: "ç¦æ­¢åœ¨é¢†åŸŸæ¨¡å‹å†™å…¥ä¸ä¸»é¢˜ç›¸å…³å­—æ®µï¼›æ‰€æœ‰é¢œè‰²ç”±å‰ç«¯ token è®¡ç®—"
  testing:
    - "Snapshotï¼šç©ºåˆ—è¡¨ / Pinned+Others / æ ‡ç­¾æ¢è¡Œ / æš—è‰²æ¨¡å¼"
    - "Interactionï¼špinâ†’unpin çŠ¶æ€åˆ‡æ¢ï¼›å½’æ¡£åè‡ªåŠ¨å–æ¶ˆ pinnedï¼›åˆ é™¤æˆåŠŸåˆ·æ–°åˆ—è¡¨"
    - "è®¿é—®æ€§ï¼šæ£€æŸ¥ aria-label ä¸ aria-pressed çŠ¶æ€åˆ‡æ¢"
    - "Dialogï¼šç¼–è¾‘â†’ä¿å­˜â†’åˆ—è¡¨åˆ·æ–° â†’ å†æ¬¡æ‰“å¼€æ—¶å­—æ®µé¢„å¡«"
  status: "Adopted Nov 24, 2025"

bookshelf_audit_tag_edit_dialog:
  summary: "Bookshelf å®¡è®¡åˆ—è¡¨çš„è½»é‡ Tag ç¼–è¾‘å¯¹è¯æ¡†ï¼ˆPlan50, Nov 25, 2025ï¼‰ã€‚"
  layout:
    - "Modal å®½ 480pxï¼Œæ ‡é¢˜æ˜¾ç¤ºä¹¦æ©±åç§° + çŠ¶æ€ pillï¼›å‰¯æ ‡é¢˜æç¤ºâ€œåç§°ä¸æ ‡ç­¾å³æ—¶ä¿å­˜â€ã€‚"
    - "ç¬¬ 1 è¡Œï¼šåç§°è¾“å…¥ï¼ˆInput size='lg'ï¼‰ï¼Œå¤±ç„¦æ ¡éªŒå¿…å¡«ï¼Œé”™è¯¯æ¶ˆæ¯ç½®äºè¾“å…¥ä¸‹æ–¹ã€‚"
    - "ç¬¬ 1.5 è¡Œï¼šç®€ä»‹ï¼ˆTextarea rows=3ï¼‰ç´§è´´åç§°è¾“å…¥ï¼Œå…è®¸å³æ—¶ä¿®æ”¹ descriptionï¼Œhelper text æç¤ºç”¨é€”ã€‚"
    - "ç¬¬ 2 è¡Œï¼šTag é€‰æ‹©å™¨ï¼Œé‡‡ç”¨ç»„åˆè¾“å…¥ï¼ˆTagInput + æ¨èå—ï¼‰ï¼Œå•è¡Œæ˜¾ç¤ºå·²é€‰æ ‡ç­¾ pillï¼Œè¶…å‡ºæ—¶æ¢è¡Œã€‚"
    - "Footerï¼šä»…ä¿ç•™ä¿å­˜ï¼ˆprimaryï¼‰æŒ‰é’®ï¼›å–æ¶ˆ/é€€å‡ºç”±å³ä¸Šè§’ close icon è´Ÿè´£ï¼Œloading æ€ç¦ç”¨å…³é—­ã€‚"
  interactions:
    - "æ‰“å¼€æ—¶ç«‹å³è§¦å‘ useQuery(['tags','bookshelf',query]) é¢„å–æ¨èåˆ—è¡¨ï¼Œå¹¶å±•ç¤º Loading skeletonã€‚"
    - "è¾“å…¥æ¡†å…è®¸æ›´åï¼›ä¿å­˜æ—¶å°† name/description/tags ä¸€å¹¶æäº¤ PATCH /api/v1/bookshelves/{id}ï¼ŒæˆåŠŸå toast 'å·²æ›´æ–°ä¹¦æ©±' å¹¶å…³é—­å¯¹è¯æ¡†ã€‚"
    - "Tag é€‰æ‹©æ”¯æŒé”®å…¥æœç´¢ + Enter é€‰æ‹©ï¼›Tab åœ¨è¾“å…¥/æ¨èä¹‹é—´å¾ªç¯ã€‚"
    - "ä¿å­˜è¿›è¡Œä¸­æŒ‰é’®è¿›å…¥ loading çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤æäº¤ï¼›å¤±è´¥æ—¶ä¿ç•™å¯¹è¯æ¡†å¹¶å°†é”™è¯¯æç¤ºæ˜ å°„åˆ° toast + inline bannerã€‚"
    - "Dialog å…³é—­ååˆ·æ–° Dashboardï¼šinvalidateQueries(['bookshelves_dashboard', libraryId]) + å±€éƒ¨ä¹è§‚æ›´æ–°ã€‚"
  tag_chip_rules:
    - "Chip ä¸ Library åˆ—è¡¨ä¸€è‡´é«˜åº¦ 24pxã€åœ†è§’ 999pxã€è¾¹æ¡†è‰² rgba(var(--wl-text-primary),0.08)ã€‚"
    - "ç©ºæ€æ–‡æœ¬æ˜¾ç¤º 'æ— æ ‡ç­¾'ï¼Œé¢œè‰²ä½¿ç”¨ --wl-text-tertiaryã€‚"
    - "æ›´å¤šæ ‡ç­¾æŠ˜å ä¸º 'ï¼‹N' chipï¼Œhover å±•ç¤ºå®Œæ•´åˆ—è¡¨ tooltipã€‚"
  accessibility:
    - "Modal role='dialog' aria-modal='true'ï¼›header id é€šè¿‡ aria-labelledby å…³è”ã€‚"
    - "åç§°è¾“å…¥è‡ªåŠ¨èšç„¦ï¼›Esc/é®ç½©å…³é—­ã€‚"
    - "å·²é€‰æ ‡ç­¾æ”¯æŒé”®ç›˜ Backspace åˆ é™¤ï¼Œè¯»å±è¯»ä½œ 'æ ‡ç­¾åç§°ï¼Œå·²é€‰ï¼ŒæŒ‰ Delete ç§»é™¤'ã€‚"
  testing:
    - "Unitï¼šTagInput å¤„ç†ç²˜è´´å¤šä¸ªæ ‡ç­¾ã€åˆ é™¤ chipã€æœç´¢ fallbackã€‚"
    - "Storybookï¼šç©ºä¹¦æ¶ / å¤šæ ‡ç­¾ / API åŠ è½½å¤±è´¥ã€‚"
    - "E2Eï¼šæ‰“å¼€å¯¹è¯æ¡†â†’ç¼–è¾‘åç§°â†’æ·»åŠ æ ‡ç­¾â†’ä¿å­˜â†’Toastâ†’åˆ—è¡¨æ›´æ–°ã€‚"
  status: "Adopted Nov 25, 2025"

bookshelf_dashboard_inline_creation_modal:
  summary: "Library è¯¦æƒ…é¡µ +NEW BOOKSHELF ä½¿ç”¨å…±äº« LibraryFormï¼Œæä¾›åç§°/ç®€ä»‹/æ ‡ç­¾ä¸€æ¬¡å½•å…¥ï¼ˆPlan55, Nov 26, 2025ï¼‰ã€‚"
  layout:
    - "è§¦å‘è¡Œï¼šDashboard Header å³ä¸Šè§’æŒ‰é’®ï¼ˆvariant='primary'ï¼‰ã€‚"
    - "Modal å®½ 520pxï¼Œæ ‡é¢˜ 'æ–°å»ºä¹¦æ©±'ï¼Œå‰¯æ ‡é¢˜æç¤ºå¯ç¨åä¿®æ”¹ã€‚"
    - "å­—æ®µé¡ºåºï¼šåç§°ï¼ˆå¿…å¡«ï¼‰â†’ ç®€ä»‹ Textareaï¼ˆå¯é€‰ï¼‰â†’ æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆæœ€å¤š 3 ä¸ªï¼‰ã€‚"
    - "Footer ä»…ä¿ç•™ primary æäº¤æŒ‰é’®ï¼Œå³ä¸Šè§’ close icon å–ä»£ Cancelï¼›loading æ€ç¦ç”¨å…³é—­ã€‚"
  interactions:
    - "Button type='button' é˜²æ­¢çˆ¶çº§è¡¨å•æäº¤ï¼›å·²è¾¾ 100 ä¸ªæ—¶å¼¹å‡º toast ç¦æ­¢æ‰“å¼€ã€‚"
    - "æäº¤è°ƒç”¨ POST /api/v1/bookshelvesï¼Œæ³¨å…¥ library_id + tag_idsï¼›æˆåŠŸåå…³é—­ Modal å¹¶è§¦å‘åˆ—è¡¨ refetchã€‚"
    - "TagInput ä¸ Library Form å…±ç”¨ create/search é€»è¾‘ï¼Œä¿è¯æ ‡ç­¾å†²çªå›é€€ã€‚"
    - "é”™è¯¯ä¿¡æ¯é€šè¿‡ toast æ˜¾ç¤ºï¼ŒModal ä¿æŒæ‰“å¼€ä»¥ä¾¿çº æ­£ã€‚"
  accessibility:
    - "Modal role='dialog'ï¼Œåˆå§‹èšç„¦åç§°è¾“å…¥ï¼›Esc/é®ç½©å…³é—­ä»…åœ¨é loading æ€å¯ç”¨ã€‚"
    - "æŒ‰é’® aria-disabled éš loading çŠ¶æ€æ›´æ–°ï¼›TagInput æ”¯æŒé”®ç›˜å¯¼èˆªã€‚"
  testing:
    - "React Testing Libraryï¼šæäº¤æˆåŠŸåè°ƒç”¨ invalidateQueries(['bookshelves'])."
    - "Manualï¼šé˜ˆå€¼ 80/100 éªŒè¯è¿›åº¦æ¡æç¤ºä¸ç¦ç”¨é€»è¾‘ã€‚"
    - "Storybookï¼šé»˜è®¤ã€Tag å†²çªã€API é”™è¯¯ä¸‰æ€ã€‚"
  status: "Adopted Nov 26, 2025"

library_overview_list_v3:
  adr_reference: "ADR-096-bookshelf-dashboard-layout-v2-and-action-column.md"
  summary: "Libraries /admin/libraries åˆ—è¡¨æ¨¡å¼é‡‡ç”¨ 5 åˆ—å¸ƒå±€ï¼Œå°é¢æ”¾å¤§ 3x å¹¶ä¸ Bookshelf Dashboard è§†è§‰è¯­è¨€ä¿æŒä¸€è‡´ã€‚"
  layout:
    columns:
      - name: "å°é¢ / åç§°"
        spec: "LibraryCoverAvatar 96Ã—96ï¼ˆvar(--library-avatar-size) * 3ï¼‰ï¼Œä¸‹æ–¹å±•ç¤ºåç§° + pinned/archived å¾½ç« "
      - name: "è¯´æ˜"
        spec: "å±•ç¤º descriptionï¼Œæœ€å¤š 3 è¡Œï¼›ç©ºå€¼æ˜¾ç¤º 'â€” æš‚æ— è¯´æ˜'"
      - name: "æ ‡ç­¾ / æŒ‡æ ‡"
        spec: "ä¸Šæ–¹ä¸º LibraryTagsRowï¼ˆæœ€å¤š 3 ä¸ªæ ‡ç­¾ï¼‰ï¼Œä¸‹æ–¹ä¸ºä¹¦æ¶æ•° / ä¹¦æœ¬æ•° / æœ€è¿‘æ´»åŠ¨ / æµè§ˆæ¬¡æ•°"
      - name: "åˆ›å»º / æ›´æ–°"
        spec: "ä¸¤è¡Œï¼šåˆ›å»ºæ—¥æœŸï¼ˆtoLocaleDateStringï¼‰+ æ›´æ–°æ—¶é—´ï¼ˆæ—¥æœŸ + formatRelative(updated_at)ï¼‰"
      - name: "æ“ä½œ"
        spec: "ç¼–è¾‘ / åˆ é™¤ / ç½®é¡¶ / å½’æ¡£ æŒ‰é’®ç»„ï¼Œä¿æŒä¸ Bookshelf Dashboard åŒæ ·çš„ Lucide å›¾æ ‡è¯­ä¹‰"
  cover_preview:
    size: "96x96 (desktop)"
    fallback: "æ— å°é¢æ—¶å¼ºåˆ¶ä½¿ç”¨ DEFAULT_LIBRARY_SILVER_GRADIENTï¼ˆé“¶è‰²ä¸ç»¸æ¸å˜ï¼‰+ é¦–å­—æ¯ï¼Œå½»åº•ç§»é™¤â€œLIBRARY COVERâ€ç­‰è¾…åŠ©æ–‡æ¡ˆï¼Œä¿è¯æ¡Œé¢/ç§»åŠ¨ç«¯ä¸€è‡´çš„é‡‘å±é«˜å…‰è´¨æ„Ÿ"
    accessibility: "img é™„å¸¦ alt='LibraryName cover'ï¼›æè¿°åˆ— aria-label è¡¥å…… 'æš‚æ— è¯´æ˜'"
  loading_state:
    - "LibraryCardSkeletonï¼ˆgrid/listï¼‰æˆä¸ºå”¯ä¸€åˆæ³•çš„ loading å¤–å£³ï¼šå°é¢å—ç”¨é“¶è‰²æ¸å˜åº•è‰² + shimmer åŠ¨ç”»æ¥å›æ‰«å…‰ï¼Œæ­£æ–‡/æŒ‡æ ‡ç”¨èƒ¶å›Šæ¡æ¨¡æ‹Ÿï¼Œç¦æ­¢å†æ¸²æŸ“é€æ˜ç›’å­ã€‚"
    - "Skeleton shimmer ä½¿ç”¨ linear-gradient 120deg overlayï¼Œå‘¨æœŸ 1.6s ease-in-outï¼›é¢œè‰²æ²¿ç”¨é“¶è‰²åŸºè°ƒï¼Œç¡®ä¿ loadingâ†’çœŸå®å°é¢è¿‡æ¸¡ä¸ä¼šå‡ºç°è‰²å¸¦è·³å˜ã€‚"
  interactions:
    - "æ•´è¡Œç‚¹å‡»è·³è½¬ library detailï¼Œæ“ä½œæŒ‰é’® stopPropagation"
    - "Pinned badge é¢œè‰²æ²¿ç”¨ --wl-pinned-accent ç³»åˆ— token"
    - "è¡Œ hover ä»…å˜æ›´èƒŒæ™¯ï¼Œé¿å…é˜´å½±è§†è§‰æŠ–åŠ¨"
    - "åç§°åˆ—æ–‡å­—é¢œè‰²å›ºå®šä½¿ç”¨ `var(--color-text-secondary)`ï¼Œç¡®ä¿å³ä¾¿åœ¨ PINNED/ARCHIVED åŒå¾½ç« ä¹‹ä¸‹ä¹Ÿä¿æŒæŸ”å’Œå±‚çº§ã€‚"
    - "Pinned / Archived å¾½ç« åœ¨åˆ—è¡¨æ¨¡å¼ä¸­åŒæ ·é™„å¸¦ `data-tooltip` + `aria-label`ï¼Œå¤ç”¨ `tooltipAnchor` ä¼ªå…ƒç´ æ³¡æ³¡ï¼Œhover ä¸é”®ç›˜ focus æ—¶è¾“å‡ºâ€œå·²ç½®é¡¶ä¹¦åº“ / å·²å½’æ¡£ä¹¦åº“â€ã€‚"
  status: "Adopted Nov 24, 2025"

library_cover_title_band_rules:
  summary: "Plan177ï¼ˆDec 7, 2025ï¼‰å°† LibraryCard å°é¢æ ‡é¢˜æ”¹ä¸ºéšæ–‡æœ¬å®½åº¦ç¼©æ”¾çš„åŒçº¿èƒ¶å›Šï¼Œå¹¶åŠ å¼ºäº®è‰²å°é¢ä¸‹çš„å¯è¯»æ€§ã€‚"
  rules:
    - "å°é¢æ ‡é¢˜ä½¿ç”¨ inline-block + å·¦å¯¹é½å®šä½ï¼Œä»…ä¿ç•™å·¦å¤–è¾¹è·ï¼ˆvar(--spacing-md)ï¼‰ï¼Œå®½åº¦ç”±æ–‡æœ¬ä¸ 10px å†…è¾¹è·å†³å®šï¼Œæœ€å¤šå ç”¨ cover å®½åº¦ - 2Ã—spacingã€‚"
    - "`:before` ä¸ `:after` åœ¨æ ‡é¢˜å®¹å™¨é¡¶éƒ¨/åº•éƒ¨ç»˜åˆ¶ 1px çº¯ç™½ï¼ˆ90% ä¸é€æ˜ï¼‰å¯¼è½¨ï¼Œè·Ÿéš inline-block å®½åº¦ä¸€åŒä¼¸ç¼©ï¼Œç¦æ­¢æ’‘æ»¡æ•´å¼ å°é¢ã€‚"
    - "æ ‡é¢˜è¡Œå†…ä¸Šä¸‹å„ 6px paddingï¼Œå­—é‡ 700ï¼›åœ¨äº®/ä½å¯¹æ¯”å°é¢ä¸Šè¿½åŠ  `text-shadow: 0 1px 6px rgba(0,0,0,0.35)`ï¼Œç¡®ä¿åç§°ä¸è¢«é«˜å…‰åæ²¡ã€‚"
  accessibility:
    - "å¡ç‰‡æ ‡é¢˜ä»ç”± `<h3>` è¾“å‡ºå¹¶æ˜ å°„åˆ°å¡ç‰‡ `aria-label`ï¼Œæ–°å¢çš„è£…é¥°çº¿æ¡ä¸åŒ…å«é¢å¤–æ–‡æœ¬ï¼Œä»¥å…è¯»å±é‡å¤ã€‚"
  status: "Adopted Dec 7, 2025"

library_tag_tooltip_rules:
  summary: "Plan175ï¼ˆDec 6, 2025ï¼‰ç»Ÿä¸€ LibraryTagsRow çš„æ ‡ç­¾æè¿° tooltipï¼Œå¹¶è®© Library å¡ç‰‡/åˆ—è¡¨å…±äº«å¯è®¿é—®çš„è¯´æ˜ä½“éªŒã€‚"
  data_contract:
    - "LibraryTagSummaryDto è¿”å› id/name/color/descriptionï¼Œdescription ä¸ºç©ºæ—¶çœç•¥å­—æ®µï¼›tag_total_count ä»é©±åŠ¨ '+N' æº¢å‡º chipã€‚"
    - "åç«¯ description å­—æ®µå…è®¸å¤šè¯­è¨€æ–‡æ¡ˆï¼Œä½†å‰ç«¯æ¸²æŸ“å‰ä¼š trimï¼Œç©ºå­—ç¬¦ä¸²ä¸€å¾‹è§†ä¸ºæ— æè¿°ã€‚"
    - "Plan181Aï¼šTooltip copy ç”± `tagTooltipHelper` ç»Ÿä¸€ç”Ÿæˆï¼ˆlabel-only / label+descriptionï¼‰ï¼Œæ–‡å­—å®Œå…¨å–è‡ª Tag ç®¡ç†ç«¯æä¾›çš„åŸå§‹æè¿°ï¼ŒUI ä¸å†è¿½åŠ ç¡¬ç¼–ç ç¿»è¯‘ã€‚"
  chip_layout:
    - "åˆ—è¡¨/å¡ç‰‡æœ€å¤šæ¸²æŸ“ 3 ä¸ªæ ‡ç­¾ï¼›å‰©ä½™æ•°é‡æ˜¾ç¤º '+N' è™šçº¿ chipï¼Œç©ºæ€å±•ç¤º 'â€” æ— æ ‡ç­¾'ã€‚"
    - "æ ‡ç­¾ pill ä¿æŒ inline-flex + 999px åœ†è§’çš„æµ…ç°é…è‰²ï¼Œswatch é¢œè‰²è·ŸéšæœåŠ¡ç«¯å£°æ˜æˆ– DEFAULT_TAG_COLORã€‚"
  tooltip_behavior:
    - "å¸¦ description çš„ chip ä½¿ç”¨ data-tooltip è§¦å‘è‡ªå®šä¹‰ä¼ªå…ƒç´ æ°”æ³¡ï¼šèƒŒæ™¯ rgba(17,24,39,0.92)ã€padding 6Ã—10pxã€åœ†è§’ 8pxã€æŠ•å½± 0 8px 24px rgba(15,23,42,0.25)ã€‚"
    - "Tooltip æœ€å¤§å®½åº¦ 360pxï¼Œå•è¡Œ nowrap + ellipsisï¼Œpointer/focus-visible è§¦å‘åä» 6px translate è¿‡æ¸¡åˆ°å¯¹é½çŠ¶æ€ï¼›`prefers-reduced-motion` æ—¶å…³é—­åŠ¨ç”»ã€‚"
    - "æ—  description çš„ chip ä»…ä¿ç•™åŸç”Ÿ titleï¼Œç¦æ­¢ç”Ÿæˆç©ºæ°”æ³¡ï¼Œé¿å…ç©ºç™½ tooltipã€‚"
  accessibility:
    - "å¸¦æè¿°çš„ chip è‡ªåŠ¨è·å¾— `tabIndex=0` ä¸ `aria-label='{name}ï¼š{description}'`ï¼Œå¹¶é™„åŠ  visually hidden æ–‡æ¡ˆï¼Œç¡®ä¿è¯»å±ç”¨æˆ·æ— éœ€æ‚¬åœå³å¯è·å–å†…å®¹ã€‚"
    - "è¡Œå®¹å™¨ role='list' + chip role='listitem'ï¼Œä¸ Library åˆ—è¡¨/å¡ç‰‡çš„ aria-label ååŒå·¥ä½œã€‚"
  guardrails:
    - "LibraryCard/åˆ—è¡¨è¡Œæœ¬èº«ä¸å¾—å†è®¾ç½® titleï¼›tooltip æ‰€æœ‰æƒå½’ LibraryTagsRowï¼Œé˜²æ­¢æµè§ˆå™¨åŸç”Ÿ tooltip ä¸è‡ªå®šä¹‰ DOM é‡å ã€‚"
    - "Chip ç¦æ­¢æ·»åŠ  translate/scale hover æ•ˆæœï¼Œä»¥å… tooltip ç²¾å‡†å®šä½å‡ºç°æŠ–åŠ¨ï¼›ä»…å…è®¸é¢œè‰²ä¸é˜´å½±åœ¨ token èŒƒå›´å†…å˜åŒ–ã€‚"
    - "è·å–æè¿°çš„å”¯ä¸€å…¥å£æ˜¯ `useLibraryTagCatalog(libraryId)`ï¼šLibrary/Bookshelf/Book é¡µé¢åœ¨é¡¶å±‚å‡†å¤‡å¥½ `tagDescriptionsMap`ï¼Œä¸‹æ¸¸ç»„ä»¶åªèƒ½æ¶ˆè´¹ç°æœ‰ mapï¼Œä¸å¾—ç›´æ¥å‘½ä¸­ /tagsã€‚"
  status: "Adopted Dec 6, 2025"

library_i18n_refresh:
  summary: "Plan176Aï¼ˆDec 7, 2025ï¼‰å®Œæˆ /admin/libraries é¡µé¢æ‰€æœ‰å›ºå®šæ–‡æ¡ˆçš„ä¸­è‹±æ–‡åˆ‡æ¢ï¼šåˆ—è¡¨ã€å¡ç‰‡ã€è¡¨å•ã€æ ‡ç­¾è¡Œä¸ toast å‡æ”¹ç”¨ useI18nï¼Œæ—¥æœŸ/æç¤º/aria æ–‡æ¡ˆå¤ç”¨ locale keyã€‚"
  coverage:
    - "LibraryMainWidget hero/search/sort/è§†å›¾åˆ‡æ¢"
    - "LibraryList section ç©ºæ€ã€metrics tooltipã€cache notice"
    - "LibraryCard / LibraryCardHorizontal æ“ä½œæŒ‰é’®ã€cover å¯¹è¯æ¡†ã€usage footer"
    - "LibraryForm å­—æ®µ/æ ‡ç­¾é€‰æ‹©/ä¸»é¢˜è‰²æ ¡éªŒ"
    - "LibraryTagsRow å ä½ã€aria æè¿°ã€+N tooltip"
  notes:
    - "formatRelative/formatAbsoluteDateTime æ¥å— lang å‚æ•°ï¼Œé¿å…ä¸­æ–‡/è‹±æ–‡ç¯å¢ƒæ··ç”¨æ–‡æ¡ˆ"
    - "TagMultiSelect ç©ºæç¤ºä¸ loading çŠ¶æ€ä¸è¡¨å•æ–‡æ¡ˆä¸€è‡´ï¼Œä¿®å¤ tagEmptyHint å¼•ç”¨é¡ºåºå¯¼è‡´çš„ runtime error"
  status: "Adopted Dec 7, 2025"

bookshelf_i18n_refresh:
  summary: "Plan177Aï¼ˆDec 7, 2025ï¼‰è®© Library è¯¦æƒ…é¡µä¸ Bookshelf Dashboardï¼ˆ/admin/libraries/[id] + /admin/bookshelvesï¼‰å®Œå…¨æ¥å…¥ bookshelves.* å­—å…¸ï¼Œç»Ÿè®¡å¡ã€æœç´¢ã€æ“ä½œæŒ‰é’®ã€å·¥å…·æç¤ºä¸ç©ºæ€å…¨éƒ¨æ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢ã€‚"
  coverage:
    - "BookshelfDashboardBoardï¼šæ’åº/ç­›é€‰æ§ä»¶ã€æœç´¢æ¡†ã€section æ ‡é¢˜ã€è¡¨æ ¼åˆ—å¤´ã€ç©ºæ€ã€é”™è¯¯ä¸ loading copy"
    - "BookshelfDashboardCardï¼šPinned/Active/Archived å¾½ç« ã€æ ‡ç­¾å ä½ã€æˆç†Ÿåº¦æç¤ºã€metrics tooltipã€æ“ä½œæŒ‰é’®ã€aria-label"
    - "LibraryDetailPage hero ä¸ snapshot summaryã€è¿›åº¦æç¤ºã€Breadcrumb/CTA æŒ‰é’®ã€Create Bookshelf å¯¹è¯æ¡† copy"
    - "BookshelfHeader cover alt/æŒ‰é’®æ ‡é¢˜ï¼Œä¿æŒå’Œ LanguageSwitcher åŒæ­¥"
  notes:
    - "æ–°å¢ bookshelves.* keysetï¼Œå¹¶åœ¨ useI18n hook ä¸­æ³¨å…¥ lang ç»™ relative time è®¡ç®—ï¼Œç¡®ä¿ Last Active æè¿°éµå¾ª locale æ ¼å¼"
    - "æ‰€æœ‰ toast/confirm dialog ç»Ÿä¸€èµ°å­—å…¸ï¼Œé˜²æ­¢é‡æ–°å¼•å…¥ä¸­æ–‡ç¡¬ç¼–ç "
  status: "Adopted Dec 7, 2025"

book_i18n_refresh:
  summary: "Plan178Aï¼ˆDec 7, 2025ï¼‰ä¸º BookMainWidget åŠæˆç†Ÿåº¦åˆ†å±‚ã€æœç´¢/è¿‡æ»¤ã€é™ˆåˆ—åŒºä¸å¡ç‰‡æ“ä½œæ¥å…¥ books.* å­—å…¸ï¼Œå®ç° Book è§†å›¾çš„å®Œæ•´ä¸­è‹±æ–‡åˆ‡æ¢ã€‚"
  coverage:
    - "BookMainWidgetï¼ˆHeaderã€ErrorBoundaryã€Create Dialog CTAã€Basement ç§»åŠ¨ toast ä¸ toasts/confirm flowsï¼‰"
    - "BookMaturityView + BookshelfBooksSectionï¼šSummary barã€Seed/Sprout/Grow/Mature section æ ‡é¢˜ã€ç©ºæ€ã€aria-label"
    - "BookMaturityFilterBar / SearchBarï¼šç­›é€‰å™¨ã€æ¨¡å¼åˆ‡æ¢ã€æœç´¢å ä½ã€ç»“æœç»Ÿè®¡ copy"
    - "BookFlatCard / BookRowCard / BookShowcaseItemï¼šmenu/tooltipã€Pinned/Archived æ ‡è¯†ã€ç›¸å¯¹æ—¶é—´/Block è®¡æ•°ã€tag tooltip"
    - "bookVisuals.ts helperï¼šæˆç†Ÿåº¦æè¿°ã€relative timeã€block count ä¸ aria copy éš locale æ›´æ–°"
  notes:
    - "æ–°å¢ books.* namespaceï¼Œå¹¶ç»Ÿä¸€é€šè¿‡ useI18n() + t(key, params) è¾“å‡º ariaã€tooltip ä¸ toast æ–‡æ¡ˆ"
    - "formatRelative/formatBlockCount helper é‡‡ç”¨ lang-aware cacheï¼Œç¡®ä¿ 'X åˆ†é’Ÿå‰'ã€'X blocks' ç­‰æè¿°ä¸è¯­è¨€åŒæ­¥"
    - "Search empty/error statesä¸ Combined view heading æ”¯æŒåŠ¨æ€æ’å€¼ï¼Œé˜²æ­¢å…³é”®å­—/è®¡æ•°å‡ºç°ç¡¬ç¼–ç "
  status: "Adopted Dec 7, 2025"

library_basement_entry_guards:
  summary: "Plan175A/Bï¼ˆDec 7, 2025ï¼‰è¦æ±‚æ‰€æœ‰ Library è§†å›¾æŠŠ Basement ä¹¦æ¶è§†ä¸ºç«‹å³å¯ç”¨èµ„æºï¼ŒUI ä¸å†å…è®¸â€œç¼º basementId æ—¶éšè—å…¥å£â€çš„æƒå®œç­–ç•¥ã€‚"
  creation_flow:
    - "useCreateLibraryMutation æœŸå¾…å“åº”ä¸­å‡ºç° non-empty basement_bookshelf_idï¼›ç¼ºå¤±æ—¶ç«‹å³è§¦å‘ invariant toast + Sentry æŠ¥è­¦ï¼Œè€Œä¸æ˜¯ç»§ç»­æ¸²æŸ“ã€‚"
    - "LibraryStore/React Query Cache å°† basement_bookshelf_id ä¸ library.id ä¸€èµ·å†™å…¥å®ä½“ç¼“å­˜ï¼Œåç»­é¡µé¢åˆ‡æ¢ä¸å¾—é‡æ–°çŒœæµ‹æˆ– fetchã€‚"
    - "åˆ›å»ºæˆåŠŸçš„ Toast/å¯¼èˆªè„šæœ¬é¡»æŠŠ basementId ä½œä¸º query param æ³¨å…¥ `/admin/libraries/[id]/basement` CTAï¼Œç¡®ä¿ç”¨æˆ·å¯ä»¥ä¸€è·³å³è¾¾ã€‚"
  navigation_contract:
    - "Library detail headerã€LibraryActionsSheetã€Basement CTA éƒ½ä»åŒä¸€ä¸ª selector è¯»å– basement_bookshelf_idï¼Œå¹¶åœ¨ç¼ºå¤±æ—¶æ˜¾ç¤ºé˜»æ–­æ€ 'Basement æœªåˆ›å»ºï¼Œè¯·è”ç³»ç®¡ç†å‘˜'ã€‚"
    - "Basement é¡µé¢è¯·æ±‚å‚æ•°å›ºå®šä¸º {libraryId, basementBookshelfId}ï¼›UI ç¦æ­¢åœ¨ç¼ºå¤± id æ—¶ fallback åˆ°ä»»æ„ bookshelf listã€‚"
    - "æ‰€æœ‰ 'Move to Basement' èœå•å…±äº«ä¸€ä¸ª hookï¼ˆuseBasementCommandsï¼‰ï¼Œhook åœ¨åˆå§‹åŒ–æ—¶æ ¡éªŒ library.basement_bookshelf_id å¹¶æŠŠé”™è¯¯çŠ¶æ€æš´éœ²ç»™æŒ‰é’® tooltipã€‚"
  guardrails:
    - "å‰ç«¯ä¸å¾—è‡ªè¡Œåˆ›å»º/å‡å®š Basement ä¹¦æ¶ï¼›å”¯ä¸€åˆæ³•æ¥æºæ˜¯ CreateLibraryUseCase å“åº”æˆ–å·²æœ‰åº“çš„ detail APIã€‚"
    - "ä»»ä½•ç»„ä»¶å¦‚æœä¸ºäº†å…¼å®¹ legacy åœºæ™¯æƒ³éšè— Basement UIï¼Œå¿…é¡»å¼•ç”¨æœ¬ç­–ç•¥è¯´æ˜è¯¥è¡Œä¸ºå·²è¢« Plan175 ä½œåºŸã€‚"
    - "E2E è¦†ç›–åº“åˆ›å»ºâ†’è·³è½¬ Basement é¡µé¢çš„ happy pathï¼Œä»¥åŠ legacy åº“ï¼ˆé€šè¿‡ mockï¼‰å¤ç”¨å·²æœ‰ basementId çš„æµç¨‹ã€‚"
  status: "Adopted Dec 7, 2025"

book_tag_tooltip_rules:
  summary: "Plan176ï¼ˆDec 7, 2025ï¼‰æŠŠ Library æ ‡ç­¾ tooltip è§„èŒƒå»¶ä¼¸åˆ° Book å±•ç¤ºå¡ä¸åˆ—è¡¨è¡Œï¼Œä¿®å¤è£å‰ªé—®é¢˜å¹¶ç»Ÿä¸€æè¿°æ•°æ®æ¥æºã€‚"
  surfaces:
    - "BookFlatCard badgeï¼ˆShowcase/Grid stripï¼‰"
    - "BookRowCard tag chipsï¼ˆRow/List viewï¼‰"
  data_flow:
    - "BookMainWidget èšåˆ library.tagsï¼ˆSSR/è¯¦æƒ… API è¿”å›çš„é¢„è®¾ï¼‰ä¸ GET /libraries/{id}/tags?limit=200 æŸ¥è¯¢ç»“æœï¼Œç”Ÿæˆ `tagDescriptionsMap`ï¼›ä»…å½“ books å­˜åœ¨æ ‡ç­¾ä¸” map ç¼ºå°‘æè¿°æ—¶æ‰è§¦å‘è¯·æ±‚ã€‚"
    - "æè¿° map key ä¸º tag åç§°çš„å°å†™ç‰ˆæœ¬ï¼Œvalue ä¸º trimmed descriptionï¼›ç¦æ­¢å†™å…¥ BookDto æˆ– localStorageï¼Œå…¨éƒ¨ç•™åœ¨ç»„ä»¶çº§ memoã€‚"
    - "æ— æè¿°æ—¶ tooltip é™çº§ä¸º `æ ‡ç­¾ï¼š{name}`ï¼Œä½† `aria-label` ä»éœ€å­˜åœ¨ä»¥ä¿è¯è¯»å±ä¸€è‡´ã€‚"
    - "Plan181A follow-upï¼šè‹¥ LibraryTagSummary ç¼ºé¡¹ï¼Œhook å¯è°ƒç”¨å…¨å±€ `searchTags(keyword)` å…œåº•ï¼Œä½† Book ç»„ä»¶åªæ¥æ”¶åˆå¹¶åçš„ mapï¼›tooltip æ°¸è¿œå±•ç¤ºçœŸå®æè¿°ï¼Œä¸å†é™„åŠ è‡ªåŠ¨ç¿»è¯‘ã€‚"
  showcase_badge_rules:
    - "Badge tooltip ç”± BookFlatCard ä½¿ç”¨ `createPortal` æ¸²æŸ“åˆ° `document.body`ï¼Œviewport scroll/resize ä¼šé‡æ–°è®¡ç®—ä½ç½®ï¼Œç¡®ä¿æº¢å‡ºè¢«è£å‰ªçš„å¡ç‰‡ä»å¯è§ã€‚"
    - "Tooltip æ°”æ³¡æ²¿ç”¨ Library è§„èŒƒï¼ˆèƒŒæ™¯ rgba(17,24,39,0.92)ã€padding 6Ã—10pxã€åœ†è§’ 8pxã€shadow 0 8px 24pxã€max-width 360pxï¼‰ï¼Œz-index 1600ï¼Œä½äº QuickMenu ä¹‹ä¸Šä½†ä½äºå…¨å±€ Modalã€‚"
    - "Badge copyï¼šä¼˜å…ˆæ˜¾ç¤º `æ ‡ç­¾ï¼š{name}ï½œ{description}`ï¼›å½“ ribbon æ¥æºäºæˆç†Ÿåº¦æ—¶æ”¹ä¸º `æˆç†Ÿåº¦ï¼š{label}`ã€‚"
    - "å¡ç‰‡å£³å±‚ä¿æŒ `overflow: visible`ï¼Œç¦æ­¢åœ¨ Showcase strip/section ä¸Šé‡æ–°å¼€å¯ `overflow: hidden`ï¼Œå¦åˆ™ portal ä»ä¼šåœ¨è§†è§‰ä¸Šè¢«è£å‰ªã€‚"
  row_chip_rules:
    - "BookRowCard çš„ tag chips å¤ç”¨ LibraryTagsRow çš„ data-tooltip ä¼ªå…ƒç´ æ ·å¼ä¸åŠ¨ç”»ï¼Œåœ¨ `prefers-reduced-motion` æ—¶å…³é—­ translateã€‚"
    - "`+N` æº¢å‡º chip å§‹ç»ˆæ˜¾ç¤º `è¿˜æœ‰ N ä¸ªæ ‡ç­¾` çš„ tooltip ä¸ aria-labelï¼Œè¾¹æ¡†ä½¿ç”¨è™šçº¿å¹¶ç»§æ‰¿åˆ—è¡¨ tokenã€‚"
    - "Row chips ä¿æŒ focusableï¼Œå½“å­˜åœ¨æè¿°æ—¶è‡ªåŠ¨æ·»åŠ  `tabIndex=0` ä¸ `aria-label`ï¼Œé”®ç›˜è§¦å‘éœ€ä¸ hover æ•ˆæœä¸€è‡´ã€‚"
  guardrails:
    - "Badge tooltip ä¸å¾—è¢«ç”¨äº status/menu ç­‰éæ ‡ç­¾å†…å®¹ï¼›é tag åœºæ™¯ç»§ç»­ä½¿ç”¨åŸæœ‰æˆç†Ÿåº¦æç¤ºã€‚"
    - "Portal tooltip ç›‘å¬ scroll/resizeï¼Œç»„ä»¶å¸è½½æ—¶å¿…é¡»æ¸…é™¤ç›‘å¬å™¨ï¼Œé˜²æ­¢ç²˜é™„åˆ°ä¸‹ä¸€ä¸ª cardã€‚"
  testing:
    - "Storybook æ·»åŠ  Showcase ä¸ Row åœºæ™¯ï¼ŒChromatic å¯¹æ¯” tooltip çŠ¶æ€ï¼›Playwright è¦†ç›– hover + é”®ç›˜ focus æƒ…å†µã€‚"
    - "Vitestï¼šBookMainWidget hook éªŒè¯ 'ç¼ºæè¿° + å­˜åœ¨æ ‡ç­¾' æ—¶æ‰ä¼šè§¦å‘ getLibraryTagsï¼›BookFlatCard/RowCard snapshot æ–­è¨€ aria-label ä¸ data-tooltipã€‚"
  status: "Adopted Dec 7, 2025"

bookshelf_cover_inheritance_v1:
  source_plan: "Plan_48_BookshelfThumb.md"
  decision: "Bookshelf cover ç¼©ç•¥å›¾ç»Ÿä¸€ç»§æ‰¿è‡ªæ‰€å± Library çš„å°é¢ï¼›å‰ç«¯ç¦æ­¢æ‰‹åŠ¨ patch propsã€‚"
  rationale:
    - "Library å®šä¹‰ç©ºé—´/ä¸»é¢˜ï¼ŒBookshelf åªæ˜¯è¯¥ä¸»é¢˜çš„å­è§†å›¾ï¼Œå°é¢ä¿æŒä¸€è‡´å¯é¿å…çŠ¶æ€æ¼‚ç§»ã€‚"
    - "åˆ·æ–°åå›æ»šçš„æ ¹å› åœ¨äºåˆ—è¡¨è¯»å– bookshelf.cover_urlï¼Œè€Œè¯¦æƒ…é¡µè¯»å– library.cover_urlï¼Œå¯¼è‡´åŒæ•°æ®æºã€‚"
  backend_contract:
    - "Bookshelf åˆ—è¡¨/ä»ªè¡¨ç›˜ DTO å¿…é¡»è¿”å› cover_url/effective_cover_url å­—æ®µï¼Œç”±æŸ¥è¯¢å±‚é€šè¿‡ JOIN libraries è®¡ç®—ï¼š`COALESCE(b.cover_url_override, l.cover_url)`ã€‚"
    - "çŸ­æœŸä¸å¼€æ”¾ Bookshelf è‡ªå®šä¹‰å°é¢ï¼›è‹¥æœªæ¥éœ€è¦ overrideï¼Œä»…å…è®¸é€šè¿‡ cover_url_override å­—æ®µæ˜¾å¼ opt-inã€‚"
  frontend_rules:
    - "æ‰€æœ‰ Bookshelf å¡ç‰‡ï¼ˆåˆ—è¡¨ã€Dashboardã€Posterï¼‰ä»…æ¸²æŸ“ DTO.cover_urlï¼›è‹¥å­—æ®µä¸ºç©ºå†é€€å› LibraryCoverAvatar çš„ deterministic æ¸å˜ã€‚"
    - "ç¦æ­¢åœ¨ç»„ä»¶ props é‡Œä¼  libraryCoverUrl/libraryCoverMediaId ä»¥ä¼ªé€ ç¼©ç•¥å›¾ï¼Œæ›´ä¸èƒ½ setState ä¸´æ—¶è¦†ç›–ã€‚"
    - "Library detail é¡µé¢åˆ·æ–°ååº”å±•ç¤ºä¸åˆ—è¡¨å®Œå…¨ä¸€è‡´çš„ coverï¼ŒéªŒè¯æ–¹å¼ï¼šæ¸…ç©ºç¼“å­˜â†’åˆ·æ–°â†’å°é¢ä¿æŒã€‚"
  testing:
    - "Contract Testï¼šMock API payload ä¸­ cover_url ç¼ºå¤±â†’å‰ç«¯ fallback æ¸å˜ï¼›API æä¾› URLâ†’æ‰€æœ‰è§†å›¾ä¸€è‡´æ¸²æŸ“ã€‚"
    - "Regressionï¼šæ›´æ–° Library å°é¢åï¼Œä¸éœ€è¦æ›´æ–° Bookshelfï¼Œå³å¯åœ¨åˆ—è¡¨/è¯¦æƒ…åŒæ—¶æ˜¾ç¤ºæ–°å›¾ã€‚"
  status: "Adopted Nov 24, 2025"

tag_catalog_admin_view:
  summary: "æ ‡ç­¾ç®¡ç†é¡µï¼ˆ/admin/tagsï¼‰åœ¨ Dec 6, 2025 å›åˆå®ŒæˆåŸºçº¿å¯¹é½ + hover ç¨³å®šæ€§ä¿®å¤ï¼Œç¡®ä¿æ§åˆ¶åŒºä¸ç›®å½•å¡ç‰‡ä¸ä¼šå†å› ä¸º transform æŠ–åŠ¨ã€‚"
  controls_layout:
    - "æœç´¢è¾“å…¥æœ€å°å®½åº¦ 320pxï¼Œtoggle ç»„ä¸æ’åºä¸‹æ‹‰å…±äº« 16px gap å¹¶æ²¿åŒä¸€åŸºçº¿æ’åˆ—ï¼Œcheckbox ä¸ label ç»„åˆå¿…éœ€å¯ç‚¹å‡»æ•´è¡Œã€‚"
    - "æ’åˆ—é€‰é¡¹ select ä½¿ç”¨ shared radius/tokenï¼Œlabel='æ’åºæ–¹å¼'ï¼Œç¡®ä¿ keyboard focus æ¸…æ™°ï¼›ç§»åŠ¨ç«¯ â‰¤960px æ—¶æ§åˆ¶åŒºå †å ä¸ºä¸¤åˆ—ã€‚"
  catalog_shell:
    - "Catalog Card ä¸å†å‡ºç° `translateY(-2px)` hoverï¼Œæ‚¬åœä»…æå‡ box-shadowï¼Œä¿è¯å½“ tanstack refetch å¯¼è‡´ table rerender æ—¶å¡ç‰‡ä¸ä¼šç§»ä½ã€‚"
    - "CardHeader é‡‡ç”¨ 20px/24px padding + border-bottomï¼ŒCardContent overflow-x:autoï¼Œé˜²æ­¢å®½è¡¨æ ¼æ’‘ç ´é¡µé¢ã€‚"
  table_rules:
    - "åç§°åˆ—=è‰²å— + åŒè¡Œæ–‡æœ¬ï¼ˆåç§° + æè¿°ï¼‰ï¼Œæè¿°å®½åº¦ä¸Šé™ 360px å¹¶ç»§æ‰¿ muted å­—è‰²ï¼›å±‚çº§/çŠ¶æ€ badge å¤ç”¨ 999px åœ†è§’ã€‚"
    - "æ“ä½œåˆ—è¡¨å®½åº¦ 140pxï¼ŒæŒ‰é’®ç»„å…è®¸æ¢è¡Œï¼Œæ¯ä¸ªæŒ‰é’®ä¸ºçº¯æ–‡æœ¬ link-styleï¼Œhover åªè°ƒæ•´æ–‡å­—é¢œè‰²ä»¥ä¿è¯å¯è¯»æ€§ã€‚"
  accessibility:
    - "æœç´¢ Input è®¾ç½® aria-labelï¼›å¤é€‰æ¡† label æ–‡æ¡ˆå³å¯è¯»è¯´æ˜ï¼›é”™è¯¯/ç©ºæ€å—ä½¿ç”¨ heading + text ç»„åˆå¹¶é™„åŠ  Button CTAã€‚"
    - "è¡¨æ ¼æ ‡é¢˜è¡Œç»´æŒ uppercase + 0.04em letter-spacingï¼Œå±å¹•é˜…è¯»å™¨å¯é€šè¿‡ `<th scope="col">` æ­£ç¡®è¯†åˆ«ã€‚"
  status: "Adopted Dec 6, 2025"

media_upload_ui_strategy:
  adr_reference: "ADR-085-media-anonymous-upload-nullable-user-id-migration.md"
  phase:
    current: "Phase 0 placeholder upload form (no owner attribution)"
    next: "Phase 1 integrate real upload mutations; show anonymous badge when user_id absent"
  ui_rules:
    - "Do NOT fabricate a client-side UUID when user_id is absent."
    - "Render 'åŒ¿å' ownership label for media without user_id."
    - "Filter components must treat undefined userId distinctly from concrete IDs."
    - "When multi-user mode returns, hide anonymous badge for rows backfilled with ownership."
  error_handling:
    - "HTTP 500 due to NOT NULL no longer expected; treat failures as network or validation errors."
    - "Cover ä¸Šä¼ å¤±è´¥ä½†åˆ·æ–°åæˆåŠŸçš„å…¸å‹åŸå› æ˜¯æµè§ˆå™¨ç›´è¿ 30xxx ç«¯å£å¯¼è‡´ CORSï¼›å‰ç«¯ APIClient å·²æ”¹ä¸ºç›¸å¯¹è·¯å¾„ + Next é‡å†™ï¼Œè‹¥å†æ¬¡å‡ºç°éœ€æ£€æŸ¥ API_PROXY_TARGET æ˜¯å¦æŒ‡å‘çœŸå®åç«¯ã€‚"
  status: "Planned - implementation begins after Block rich types Phase 5 scheduling"

  # ===== æœ€æ–°è¿›åº¦ (Nov 20 - Phase 2 Complete) =====
  book_preview_cards_status: "âœ… BookPreviewCard component (200Ã—280px) with color hash cover (Nov 20, 2025)"
  book_horizontal_scrolling_status: "âœ… BookPreviewList with CSS native scroll + hover menu (Nov 20, 2025)"
  book_main_widget_status: "âœ… BookMainWidget integrated in bookshelf detail page (Nov 20, 2025)"
  book_dto_migration: "âœ… BookDto updated with title, summary, status, block_count fields (Nov 20, 2025)"

book_maturity_visual_rules:
  summary: "Book é¡µé¢æˆç†Ÿåº¦åˆ†å±‚ UIï¼ˆPlan39 Stage 2ï¼‰"
  data_contract:
    required_fields:
      - "BookDto å¿…é¡»åŒæ—¶åŒ…å« maturityï¼ˆseed/growing/stable/legacyï¼‰ã€maturity_score:intã€legacy_flag:boolã€manual_maturity_override:boolã€‚"
      - "UI ä½¿ç”¨ maturity å­—æ®µå†³å®šå¡ç‰‡åˆ†åŒºï¼›legacy_flag åªå½±å“æ˜¯å¦è¿›å…¥ Legacy åŒºã€‚"
      - "score breakdown tooltip æ¶ˆè´¹ score.components[] æ•°ç»„ï¼Œä¸å¾—åœ¨å‰ç«¯é‡æ–°è®¡ç®—åˆ†æ•°ã€‚"
  maturity_badge:
    score_ranges:
      seed: "score < 30"
      growing: "30 â‰¤ score < 70"
      stable: "score â‰¥ 70"
    badge_language:
      seed: "ğŸŒ± Seed"
      growing: "ğŸŒ¿ Growing"
      stable: "ğŸ“˜ Stable"
      legacy: "ğŸ“¦ Legacy"
    override_indicator: "å½“ç”¨æˆ·æ‰‹åŠ¨è¦†ç›–çŠ¶æ€æ—¶åœ¨ badge æ—æ¸²æŸ“ info å›¾æ ‡ + tooltip 'å·²è¦†ç›–è‡ªåŠ¨è§„åˆ™'"
  scoring_breakdown:
    structure:
      range: "0-30 åˆ†"
      rules:
        - "+5ï¼šå·²å¡«å†™æ ‡é¢˜ã€‚"
        - "+5ï¼šæ‘˜è¦ â‰¥ 40 å­—ã€‚"
        - "+5ï¼šè‡³å°‘ 1 ä¸ªæ ‡ç­¾ã€‚"
        - "+5ï¼šé…ç½®å°é¢å›¾æ ‡ã€‚"
        - "+5 / +10ï¼šBlock æ•° â‰¥ 3 / â‰¥ 10ã€‚"
      ui: "Tooltip ä¸­æ–‡æ¡ˆç»Ÿä¸€ä»¥ 'ç»“æ„ï¼š' å¼€å¤´ï¼Œä¿è¯ä¸ Plan111 ç»„ä»¶ detail å¯¹é½ã€‚"
    activity:
      range: "0-30 åˆ†"
      rules:
        - "æœ€è¿‘ 30 å¤©ç¼–è¾‘ +10ï¼Œ30-60 å¤© +5ï¼Œè¶…è¿‡ 60 å¤© +0ã€‚"
        - "90 å¤©è®¿é—® 10+ æ¬¡ +10ï¼Œ3-9 æ¬¡ +6ï¼Œ1-2 æ¬¡ +3ï¼Œ0 æ¬¡ +0ã€‚"
        - "TODO æ¸…é›¶ +10ï¼Œ<=3 ä¸ª +6ï¼Œ<=5 ä¸ª +3ï¼Œå…¶ä½™ +0ã€‚"
      hint: "Tooltip å‰ç¼€ç»Ÿä¸€ä¸º 'æ´»åŠ¨ï¼š'ï¼Œå¹¶å±•ç¤ºå‰©ä½™ TODO æ•°æˆ–è®¿é—®åŒºé—´ã€‚"
    quality:
      range: "0-20 åˆ†"
      rules:
        - "Block ç±»å‹ 4+ = +10ï¼Œ3 ç§ = +6ï¼Œ2 ç§ = +3ã€‚"
        - "Block â‰¥ 18 ä¸”æ‘˜è¦ â‰¥ 160 å­— = +10ï¼›12/120 = +6ï¼›8/80 = +3ã€‚"
      ui: "æåŠ 'è´¨é‡ï¼š' å¼€å¤´ï¼Œå¼ºè°ƒç»“æ„ä¸æ‘˜è¦æ·±åº¦ç»„åˆã€‚"
    structure_tasks:
      range: "0-20 åˆ†"
      tasks:
        - "long_summaryï¼šæ‘˜è¦ â‰¥ 120 å­—ã€‚"
        - "tag_landscapeï¼šæ ‡ç­¾ â‰¥ 3 ä¸ªã€‚"
        - "outline_depthï¼šBlock â‰¥ 15 ä¸”ç±»å‹ â‰¥ 4 ç§ã€‚"
        - "todo_zeroï¼šå…³é”® TODO æ¸…é›¶ã€‚"
      rendering:
        - "ä»»åŠ¡å®Œæˆåº¦ä»¥ component factor=task_* å½¢å¼å±•ç¤ºï¼Œdetail å‰ç¼€ 'ç»“æ„ä»»åŠ¡ï¼š'ã€‚"
        - "è‹¥ä»»åŠ¡æœªå®Œæˆåˆ™ä¸åœ¨ components[] ä¸­æ¸²æŸ“ï¼Œé¿å…è¯¯å¯¼ã€‚"
    manual_adjustment:
      rule: "äººå·¥åŠ æˆ/æ‰£åˆ†èŒƒå›´ -5ï½+5ï¼Œcomponent factor å›ºå®šä¸º manual_adjustmentã€‚"
      visibility: "å½“ points=0 æ—¶ä¸æ¸²æŸ“è¯¥é¡¹ï¼›å±•ç¤ºæ—¶ detail ä¸º 'äººå·¥åŠ æˆ X åˆ†' æˆ– 'äººå·¥æ‰£åˆ† X åˆ†'ã€‚"
    ordering:
      - "ç»„ä»¶é¡ºåºéµå¾ª API æä¾›çš„ç»“æ„â†’æ´»åŠ¨â†’è´¨é‡â†’ä»»åŠ¡â†’äººå·¥ï¼Œç¦æ­¢åœ¨å‰ç«¯é‡æ’ã€‚"
      - "æ€»åˆ†æ ‡ç­¾ä½¿ç”¨ score.valueï¼Œç¡®ä¿ clamp(0-100) åæ¸²æŸ“ã€‚"
    formatting:
      - "Score breakdown æ‰€æœ‰åˆ†å€¼æ¸²æŸ“ä¸ºç™¾åˆ†æ¯”å­—ç¬¦ä¸²ï¼ˆ`{points}%`ï¼‰ï¼Œå­—ä½“/é¢œè‰²æ²¿ç”¨ Chronicle æ—¶é—´çº¿ secondary tokenï¼Œä»»ä½• '+/-' å·å‡ç”± UI è‡ªè¡Œæ‹¼æ¥ï¼Œç¦æ­¢è¯·æ±‚é¢å¤– DTO å­—æ®µã€‚"
      - "Group header ä¸å±•å¼€æŒ‰é’®ç»§æ‰¿æ—¶é—´çº¿æ ·å¼ï¼šheader 0.85rem uppercaseã€item detail 0.75remï¼Œletter-spacing â‰¥0.12emï¼Œä¿è¯ Insights å¡åµŒå…¥ Overview åˆ—æ—¶ä¸ä¼šå‡ºç°ä¸¤å¥—è§†è§‰è¯­è¨€ã€‚"
  warnings:
    stable_guard: "å½“ maturity_score â‰¥ 70 ä½† open_todos > 0 æ—¶ï¼ŒStability badge ä¸‹æ–¹æ˜¾ç¤º amber æç¤º 'å®Œæˆå…¨éƒ¨å¾…åŠåå¯ä¿æŒ Stable çŠ¶æ€'"
    feature_flag: "å¯é€‰å¼€å¯å¼ºæ ¡éªŒæ—¶ï¼Œå°† Stable é˜¶æ®µæŒ‰é’® disabled å¹¶æç¤º 'éœ€å…ˆå®Œæˆå…¨éƒ¨å¾…åŠ'"
  overview_card_v3:
    adr_reference: "ADR-121-plan112-book-maturity-card-v2.md"
    plan_reference: "Plan_112_MaturityCard.md"
    layout:
      - "ä¸»æŒ‡æ ‡å¡ = MATURITY æ ‡ç­¾ + è¿›åº¦æ¡ + Stage chipï¼ˆæ²¿ç”¨ä¸»é¢˜ primary tokenï¼Œå³ä¸ç»¸è“ #2e5e92ï¼‰+ é˜¶æ®µæè¿°æ–‡æ¡ˆï¼ˆSeed/Growing/Stable/Legacy å››æ®µäººæ ¼åŒ– copyï¼‰ã€‚"
      - "è¿›åº¦æ¡ä¸‹æ–¹å±•ç¤ºé˜¶æ®µæè¿°ï¼ˆä¾‹å¦‚ Stable Â· å†…å®¹ç»“æ„å·²æˆå‹ï¼Œé€‚åˆé•¿æœŸç»´æŠ¤ï¼‰ï¼Œå½“ manualOverride=true æ—¶é™„åŠ  'æ‰‹åŠ¨é”å®šï¼š{reason}'ã€‚"
      - "å³ä¸Šè§’ä»…ä¿ç•™ä¸€ä¸ªè¡ŒåŠ¨ï¼šè¦†ç›– >=40 åˆ†æ—¶æ˜¾ç¤ºäººå·¥è¯„ä¼°æŒ‰é’®ï¼ˆprimaryï¼‰ï¼Œåˆ·æ–°è¡Œä¸ºç”±åå°è‡ªåŠ¨è§¦å‘ä¸”ä¸å†æš´éœ²æŒ‰é’®ã€‚"
    core_cards:
      - "Score å¡ï¼šå¤§å·åˆ†å€¼ + ç»†åˆ†çº¿ + 'SCORE Â· è‡ªåŠ¨è¯„åˆ†' æ ‡ç­¾ï¼Œåº•éƒ¨ä½¿ç”¨ score.components[] èšåˆåçš„ summaryï¼ˆç»“æ„/æ´»è·ƒ/è´¨é‡/ç»“æ„ä»»åŠ¡/äººå·¥ï¼Œä»¥åŠ å‡å·è¡¨ç¤ºè´¡çŒ®ï¼‰ã€‚"
      - "Usage å¡ï¼šä»…ä¿ç•™ä¸¤è¡Œæ•°å­—ï¼ˆblocks / eventsï¼‰è¡Œå†…å±•ç¤ºï¼Œç§»é™¤å¤šä½™çš„ 'ä½¿ç”¨æƒ…å†µ' æ ‡é¢˜ï¼›è¡Œå°¾ suffix ä½¿ç”¨å°å†™å•è¯ï¼ˆblocks/eventsï¼‰ä»¥ä¿æŒä¿¡æ¯å¯†åº¦ï¼ŒåŒæ—¶ aria-label ç»§ç»­æä¾›è¯­ä¹‰ã€‚"
      - "Activity å¡ï¼šæ ‡é¢˜ 'æœ€è¿‘æ´»åŠ¨' + ç›¸å¯¹æ—¶é—´ï¼ˆformatRelative(chronicle.latest)ï¼‰+ 'snapshot {relative}' æç¤ºï¼Œé¼ æ ‡ hover æä¾›ç»å¯¹æ—¶é—´ titleã€‚"
    insights_card:
      summary: "Plan114ï¼ˆDec 3, 2025ï¼‰æŠŠè¯„åˆ†æ‹†è§£/ç»“æ„ä»»åŠ¡/TODO æ”¶æ‹¢ä¸ºå•ä¸ª 'Maturity insights' å¡ç‰‡ + å†…è” segmented controlï¼Œå°ä¸€å· pills ç½®äºæ ‡é¢˜è¡Œå³ä¾§ã€‚"
      layout:
        - "å¡ç‰‡å¤´ï¼šå·¦ä¾§æ˜¾ç¤º 'è¯„ä¼° Â· Maturity insights' ä¸ snapshot ç›¸å¯¹æ—¶é—´ï¼›å³ä¾§ä¸º segmented controlï¼ˆScore/Tasks/TODOï¼‰+ æ¬¡è¦é“¾æ¥ 'æŸ¥çœ‹å®Œæ•´æ—¶é—´çº¿'ã€‚"
        - "Pills é‡‡ç”¨è½»é‡æ ·å¼ï¼ˆborder=1pxã€æµ…ç°åº•ã€åœ†è§’ 999pxï¼‰ï¼Œæ¿€æ´»é¡¹å¡«å……çº¯ç™½ + ä¸ç»¸è“æ–‡æœ¬ï¼Œæ— æŠ•å½±ï¼Œå¼ºè°ƒå®ƒåªæ˜¯å±€éƒ¨è¿‡æ»¤ã€‚"
        - "Score è§†å›¾ç›´æ¥æ¸²æŸ“ `MaturityScoreBreakdown` åˆ—è¡¨ï¼›Tasks è§†å›¾ä¸Šæ–¹æ˜¾ç¤º stage/å®Œæˆåº¦æ–‡æ¡ˆå¹¶å¤ç”¨ `NextStepsChecklist(hideSummary)`ï¼›TODO è§†å›¾æ¸²æŸ“ promoted todo åˆ—è¡¨ + checkboxï¼Œç©ºæ€æç¤ºæ²¿ç”¨ 'æš‚æ— æå‡çš„ Todo...'ã€‚"
    formatting_hotfix_2025_11_30:
      - "MATURITY çœ‰æ ‡é¢˜ä¸ MATURITY INSIGHTS æ ‡é¢˜å­—å·æå‡è‡³ 1remã€letter-spacing â‰¥0.12emï¼Œä¿æŒå…¨å¤§å†™ + æ¬¡è¦æ–‡æœ¬é¢œè‰²ï¼Œä½¿ hero åŒº headline/Stage chip å¯¹é½ã€‚"
      - "MaturityScoreBreakdown Headerã€Group æ€»åˆ†ä¸ Item points ç»Ÿä¸€ä½¿ç”¨ Chronicle timeline çš„ secondary å­—è‰² (#5a6672) ä¸ 0.85rem/0.75rem å­—å·ï¼›æ‰€æœ‰åˆ†å€¼æ ¼å¼ä¸º `{points}%`ï¼Œç»„ä»¶è‡ªè¡Œå†³å®šæ˜¯å¦æ·»åŠ æ­£è´Ÿå·ã€‚"
      - "Usage å¡ä¿ç•™ aria-label 'ä½¿ç”¨æƒ…å†µ' æ–¹ä¾¿è¯»å±ï¼Œä½†ç•Œé¢å±‚ä¸é‡å¤è¯¥æ ‡é¢˜ï¼›blocks/events è¡Œå°¾ suffix å›ºå®šå°å†™ï¼Œå¹¶ä¸ Score breakdown çš„è¡Œè·ä¿æŒ 10-12pxã€‚"
      - "ChronicleTimelineList `.timelineCard` èƒŒæ™¯ä¸ Overview sectionCard å…±ç”¨ `var(--color-surface-shell,#fafbfc)`ï¼Œéœ€è¦å¤ç”¨ tokens.css è€Œéç›´æ¥å¡«æ•°å­—å€¼ã€‚"
      behavior:
        - "æ§ä»¶ä»…å½±å“å¡ç‰‡å†…éƒ¨ DOMï¼Œä¸è§¦å‘é¢å¤– fetchï¼›aria-label='Maturity insights åˆ‡æ¢'ï¼ŒæŒ‰é’® role='tab' + aria-selectedã€‚"
        - "æ—¶é—´çº¿ä»å¡ç‰‡ç§»é™¤ï¼ŒCTA åªè´Ÿè´£åˆ‡æ¢é¡µé¢é¡¶éƒ¨ Tabs åˆ° 'æ—¶é—´çº¿' è§†å›¾ï¼Œé¿å…é¡µé¢å‡ºç°ä¸¤æ¡ä¸€çº§å¯¼èˆªã€‚"
    spacing:
      - "ä¸‰ä¸ªæ ¸å¿ƒå¡ä½¿ç”¨ grid(auto-fit, minmax(220px,1fr))ï¼Œæ¡Œé¢ç«¯æ¨ªæ’ï¼Œâ‰¤768px è‡ªåŠ¨å †å æˆå•åˆ—ã€‚"
      - "å¡ç‰‡å†… padding 16-20pxï¼Œåœ†è§’ 16pxï¼Œè¾¹æ¡†ä½¿ç”¨ --color-border-subtleï¼ŒèƒŒæ™¯çº¯ç™½ã€‚"
    typography:
      - "ä¸»è¿›åº¦æ¡æ—çš„ç™¾åˆ†æ¯” 1.4remï¼Œæ ¸å¿ƒå¡æ•°å­— 2remï¼Œæ ‡ç­¾ 0.85remï¼ˆå¤§å†™å­—æ¯ï¼‰ï¼Œè¯´æ˜æ–‡å­— 0.9remã€‚"
    accessibility:
      - "è¿›åº¦æ¡ä¿ç•™ aria-hidden trackï¼Œä½†ç™¾åˆ†æ¯”éœ€ç”±æ–‡æœ¬è¯»å‡ºï¼›Score è¯¦æƒ…æŒ‰é’®å¿…é¡»æ ‡æ³¨ aria-expanded å¹¶å¯é€šè¿‡é”®ç›˜è§¦å‘ã€‚"
  legacy_prompt:
    trigger: "æ»¡è¶³ Stable ä¸” lastEdited > 180 å¤©ã€æœ€è¿‘ 90 å¤©æ— è®¿é—®ä¸”æœªç½®é¡¶æ—¶è§¦å‘"
    ui: "åœ¨ Overview Tab InfoPanel ç½®å…¥æ°”æ³¡å¡ç‰‡ï¼ŒCTA='è®¾ä¸º Legacy'"
    dismissal: "æ°”æ³¡æ”¯æŒä¸€æ¬¡æ€§å…³é—­ï¼Œå…³é—­çŠ¶æ€å­˜äº localStorage('wordloom.book.legacy_prompt.dismissed:{bookId}')"

book_workspace_shell_parity:
  plan_reference: "Plan116-book-workspace-shell-parity.md"
  summary: "æ¦‚è§ˆã€ç»“æ„ä»»åŠ¡ä¸å—ç¼–è¾‘é¡µå¤ç”¨ sectionCard å£³å±‚ï¼Œç»Ÿä¸€ 16px åœ†è§’ã€1px subtle borderã€24px paddingï¼Œå¹¶åŒæ­¥åˆ—è¡¨èŠ‚å¥ä¸æ ‡ç­¾å­—ä½“ã€‚"
  layout:
    - "Blocks Tab ä¸»ä½“ç”±å•ä¸ª sectionCard åŒ…è£¹ BlockList + åˆ†é¡µå™¨ï¼ŒèƒŒæ™¯ #fffï¼Œborder 1px rgba(15,23,42,0.08)ï¼Œradius 16pxï¼Œä¸æ¦‚è§ˆ hero/insights å¡ä¿æŒä¸€è‡´ã€‚"
    - "ç»“æ„ä»»åŠ¡ï¼ˆNextStepsChecklistï¼‰ä¸Šæ–¹å¢åŠ  2px ä¸ç»¸è“åˆ†éš”çº¿ï¼ŒsectionGroup ä¸ Score Breakdown group ç­‰è·ï¼ˆ16px gapï¼‰ï¼Œç§»é™¤å¤šä½™çš„æµ…ç°åŒçº¿ã€‚"
    - "åˆ—è¡¨ header/pills ä¹‹é—´çš„ç•™ç™½å¤ç”¨ Score Breakdown çš„ spacing tokenï¼ˆvar(--spacing-md,16px)ï¼‰ï¼Œç¡®ä¿æˆªå›¾ 1 ä¸æ¦‚è§ˆå¡ä¸€è‡´ã€‚"
  typography:
    - "å¾…å®Œæˆ/å·²å®Œæˆ/å¾…è§£é”è®¡æ•°æ ‡ç­¾æå‡è‡³ 0.92remã€font-weight 600ï¼Œé¢œè‰²æ²¿ç”¨ text-secondaryï¼Œä¿è¯ä¸ hero å‰¯æ ‡é¢˜ä¸€è‡´ã€‚"
    - "ç»“æ„ä»»åŠ¡åˆ—è¡¨çš„ section label ç»´æŒ 0.85rem uppercaseï¼Œä¸‹åˆ’çº¿ä½¿ç”¨ primary tokenï¼›Tabs/segmented pills é‡‡ç”¨è½»é‡å­—é‡ï¼ˆ350/400/450ï¼‰ã€‚"
  accessibility:
    - "Blocks Tab sectionCard ä½¿ç”¨ aria-labelledby å…³è” 'å—ç¼–è¾‘' Tabï¼Œæœ¬ä½“ä¸æ–°å¢é¢å¤– landmarkï¼Œé˜²æ­¢é‡å¤ announceã€‚"
    - "ç»“æ„ä»»åŠ¡åˆ—è¡¨ç»§ç»­ role='list' + role='listitem'ï¼Œè®¡æ•°æ ‡ç­¾é€šè¿‡ aria-live='off' é¿å…æ¯æ¬¡åˆ·æ–°éƒ½è§¦å‘è¯»å±ã€‚"
  dependencies:
    - "ä¾èµ– `frontend/src/app/admin/books/[bookId]/page.tsx` å†… `styles.sectionCard` ä¸ `NextStepsChecklist.module.css` æ–° spacing tokenã€‚"
  status: "Adopted Dec 1, 2025"

book_maturity_view_v2:
  summary: "Bookshelf Detail â†’ BookMainWidgetï¼ˆfrontend/src/widgets/book/BookMainWidget.tsxï¼‰è´Ÿè´£æˆç†Ÿåº¦åˆ†åŒºè§†å›¾ + SummaryBar + +NEW BOOK å¯¹è¯æ¡†å…¥å£ (Plan72 Stage 5 + Plan67)ã€‚"
  data_flow:
    - "useInfiniteBooks Hook å¿…é¡»è¿”å› maturity/maturityScore/legacyFlag/manualOverride å­—æ®µï¼Œä¾› SummaryBar å’Œ tooltip ä½¿ç”¨ã€‚"
    - "buildBookMaturitySnapshot åŸºäº maturity å­—æ®µåˆ†ç»„ï¼›legacyFlag=true çš„ä¹¦ç±ç›´æ¥è¿›å…¥ Legacy åŒºï¼Œå¹¶ä»è¦†ç›–ç‡åˆ†æ¯ç§»é™¤ã€‚"
  components:
    - "å®¹å™¨ï¼šBookMainWidgetï¼ˆæŒ‚è½½ TanStack Queryã€æ§åˆ¶ viewMode/create/edit çŠ¶æ€ï¼‰ã€‚"
    - "å±•ç¤ºï¼šBookMaturityViewï¼ˆæŒ‰ MATURITY_SECTIONS æ„å»º Seed/Growing/Stable/Legacy å››æ®µï¼‰ã€‚"
    - "å­é¡¹ï¼šBookShowcaseItemï¼ˆå±•æŸœæ¨¡å¼å¡ç‰‡ï¼‰ã€BookRowCardï¼ˆæ¡ç›®æ¨¡å¼è¡Œå¡ï¼‰ã€‚"
  header_bar:
    title: "å·¦ä¾§å›ºå®šæ–‡æ¡ˆ 'è¯¥ä¹¦æ¶çš„ä¹¦ç±'ï¼Œå³ä¾§æ”¾è§†å›¾åˆ‡æ¢ + æ–°å»ºæŒ‰é’®ã€‚"
    heading_portal:
      rule: "BookMainWidgetHeader å…è®¸æŠŠæ ‡é¢˜/æ§ä»¶ portal åˆ°ä¸Šå±‚ Bookshelf shellï¼›å½“ portal æ¿€æ´»æ—¶å†…éƒ¨ heading è‡ªåŠ¨éšè—ä»¥é¿å…é‡å¤æ–‡æ¡ˆï¼Œfallback åªåœ¨ widget ç‹¬ç«‹æ¸²æŸ“æ—¶å¯ç”¨ã€‚"
    summary_bar:
      layout: "SummaryBar ä½äº header ä¸‹æ–¹ï¼Œç”± COVERAGE è¿›åº¦æ¡ + seed/growing/stable/legacy + total pill ç»„æˆã€‚"
      formula: "è¦†ç›–ç‡ = stable_count / max(1, total - legacy_count)ï¼›ç©ºåˆ—è¡¨æˆ–å…¨ Legacy æ—¶æ˜¾ç¤º 0% å¹¶æ¸²æŸ“ç©ºæ€ã€‚"
      counts_render: "æ¯ä¸ª maturity pill æ˜¾ç¤ºä¸­æ–‡æ ‡é¢˜ + æ•°å­—ï¼ˆSeed 2 æœ¬ï¼‰ï¼›é¢œè‰²æ²¿ç”¨ tokensï¼šSeed=#A5B4FCï¼ŒGrowing=#34D399ï¼ŒStable=#2563EBï¼ŒLegacy=#94A3B8ã€‚"
      empty_layout: "counts.total=0 æˆ– active=0 æ—¶ä»ä¿æŒä¸æœ‰æ•°æ®æ—¶ä¸€è‡´çš„æ¨ªå‘ flex æ’åˆ—ï¼Œåªåœ¨æœ«å°¾æ·»åŠ ä¸€è¡Œ hintï¼ˆflex-basis:100%ï¼‰æç¤ºâ€œæ·»åŠ ç¬¬ä¸€æœ¬ä¹¦å³å¯å¼€å§‹è¿½è¸ªæˆç†Ÿåº¦â€ï¼Œç¦æ­¢å†å‡ºç° Screenshot#1 é‚£ç§æ¢è¡Œ/é”™ä½ã€‚"
    view_toggles:
      behavior: "ä¸¤ä¸ª pill æŒ‰é’®ï¼ˆ'å±•æŸœæ¨¡å¼'/'æ¡ç›®æ¨¡å¼'ï¼‰äº’æ–¥ï¼›aria-pressed åæ˜ çŠ¶æ€ï¼Œç‚¹å‡»åä¸è§¦å‘ refetchï¼Œä»…æ›´æ–°æœ¬åœ° stateã€‚"
      persistence: "åå¥½åªåœ¨ç»„ä»¶å†…éƒ¨ä¿å­˜ï¼Œä¸å†™å…¥ localStorageï¼›åˆ·æ–°åé»˜è®¤æ¢å¤å±•æŸœæ¨¡å¼ã€‚"
    create_button:
      text: "+NEW BOOKï¼ˆå±•å¼€æ—¶åˆ‡æ¢ä¸º 'å–æ¶ˆ'ï¼‰"
      disabled_state: "å½“ BookEditDialogï¼ˆmode='create'ï¼‰isSaving=true æ—¶æŒ‰é’® disabled å¹¶æ˜¾ç¤º loading dotsã€‚"
      action: "ç‚¹å‡»æ‰“å¼€å…±äº« BookEditDialogï¼Œä¼ å…¥ bookshelfId/libraryIdï¼›Dialog å…³é—­æˆ–ä¿å­˜åæŒ‰é’®æ¢å¤ã€‚"
  sections:
    showcase_mode: "Seed/Growing/Stable/Legacy å››æ®µ stacked sectionï¼Œæ ‡é¢˜ + æ•°é‡ + BookshelfBooksSectionï¼Œå¡ç‰‡ hover å‡ºç°æ“ä½œæµ®å±‚ã€‚
      ç©ºæ€ï¼šSeed æ˜¾ç¤º 'è‰åˆ›åŒºæ¬¢è¿çµæ„Ÿ'ï¼›Growing æ˜¾ç¤º 'æˆé•¿åŒºæš‚æœªå¼€å§‹'ï¼›Stable æ˜¾ç¤º 'å®Œæˆä¹¦ç±å°†å‡ºç°åœ¨è¿™é‡Œ'ï¼›Legacy æç¤º 'æ²‰æ·€ä¹¦ç±åªè¯»'ã€‚"
    row_mode: "åŒä¸€æ•°æ®ä»¥ BookRowCard åˆ—è¡¨å‘ˆç°ï¼Œå·¦åˆ—å°é¢ + iconï¼Œå³åˆ—æ ‡é¢˜/æ ‡ç­¾/ç»Ÿè®¡/æ“ä½œåˆ—ï¼›section header ä»æ˜¾ç¤º maturity + æ•°é‡ã€‚"
    pin_sorting: "å„ section å†…æ’åº = pinned ä¼˜å…ˆ â†’ updated_at desc â†’ created_at descï¼›Pinned å¡ç‰‡å·¦ä¸Šè§’å±•ç¤º bookmark ribbonã€‚"
    spacing_rules:
      - "Row æ¨¡å¼ `.rowList` ä¸ç©ºæ€ `.sectionEmpty` ç»Ÿä¸€ä½¿ç”¨ var(--spacing-lg) çš„ margin-topï¼Œä¸å› æ˜¯å¦æœ‰ä¹¦ç±è€Œæ”¹å˜ï¼Œè®© 'SEED' æ ‡ç­¾ä¸å†…å®¹çš„é—´è·åœ¨ Screenshot#2ã€ç©ºæ€æˆªå›¾ä¸­ä¿æŒä¸€è‡´ã€‚"
      - "Combined View çš„ empty stateï¼ˆ'æš‚æ— ä¹¦ç±'ï¼‰æ²¿ç”¨åŒä¸€ç•™ç™½ï¼Œé¿å… progress summary å’Œåˆ—è¡¨ä¹‹é—´å‡ºç°å½©è‰² spacer æˆ–é¢å¤– paddingã€‚"
  cards_details:
    theme_color_source: "BookShowcaseItem / BookRowCard / BookFlatCard å¿…é¡»ç»Ÿä¸€è°ƒç”¨ shared/theme/theme-pure.ts â†’ getBookTheme({ coverColor: dto.library_theme_color, libraryColorSeed: dto.library_id ?? dto.bookshelf_id ?? dto.id })ï¼ŒaccentColor æ³¨å…¥ --book-card-accent / cover èƒŒæ™¯ï¼›ä¸¥ç¦åœ¨ç»„ä»¶å†…æ‰‹å†™ hashã€‚"
    pin_ribbon_dynamic: "BookFlatCard.pinRibbon ä½¿ç”¨ --book-flat-pin-start / --book-flat-pin-end ä¸¤ä¸ª CSS å˜é‡ï¼Œé¢œè‰²ç”± theme accent è®¡ç®—å¾—åˆ°ï¼ˆ+45 / -10 äº®åº¦ï¼‰ï¼Œç¡®ä¿ç½®é¡¶æ¡çº¹ä¸ Library ä¸»é¢˜ä¸€è‡´ã€‚"
    pin_badge_palette: "Pin æ˜Ÿå½¢å¾½ç« ä¸å†ä½¿ç”¨åŒè‰²ç³»äº®/æš—åç§»ï¼Œè€Œæ˜¯å°† Library accent è‰²ç›¸æ—‹è½¬ ~170Â° å¹¶é™ä½é¥±å’Œåº¦ï¼ŒèƒŒæ™¯è½åœ¨ Lâ‰ˆ60% çš„æŸ”å’Œäº’è¡¥è‰²ï¼Œæ˜Ÿå½¢æœ¬ä½“ä½¿ç”¨åŒä¸€è‰²ç›¸æäº® 18%ï¼›ç¡®ä¿å¯¹æ¯”åº¦â‰¥3:1 ä¸”ä»éšä¸»é¢˜åˆ‡æ¢ã€‚"
    pin_badge_palette: "ç½®é¡¶åœ†å½¢å¾½ç« é€šè¿‡ --book-pin-badge-bg / --book-pin-badge-fg å˜é‡è¯»å– theme accent çš„äº®/æš—åç§»ï¼ˆ+60 / -50ï¼‰ï¼Œé¿å…ä¸å°é¢æ’è‰²ã€‚"
    cover_icon: "å°é¢ä¸­å¤®æ¸²æŸ“ `coverIconId` å¯¹åº” Lucideï¼ˆç™½è‰²ï¼‰ï¼Œæ—  icon fallback é¦–å­—æ¯/`book-open`ï¼›ç¦æ­¢ä»¥ icon é¢œè‰²è¡¨è¾¾ maturityã€‚"
    tag_badge: "å·¦ä¸Šè§’æ ‡ç­¾å¾½æ ‡ä¼˜å…ˆæ˜¾ç¤º tags_summary[0]ï¼Œä¸ºç©ºæ—¶å›é€€ maturity æ–‡æ¡ˆï¼›Badge é™é•¿ 7 å­—ç¬¦ï¼Œè¶…å‡ºçœç•¥ã€‚"
    maturity_pill: "å³ä¸Šè§’ maturity pillï¼ˆSeed/Growing/Stable/Legacyï¼‰éš section ä¿æŒä¸€è‡´ï¼Œé¢œè‰²ä¸ SummaryBar å¯¹åº”ã€‚"
    score_tooltip: "Hover å¡ç‰‡ footer æ—¶å‡ºç° tooltipï¼Œå±•ç¤º maturity_score ä¸ score.components[]ï¼›manual_maturity_override=true æ—¶åœ¨ tooltip é¡¶éƒ¨æ˜¾ç¤ºé—ªç”µ icon + 'æ‰‹åŠ¨è¦†ç›–' æ–‡æ¡ˆã€‚"
    actions:
      - "Hover overlay æä¾› Viewï¼ˆOpenï¼‰ã€Editï¼ˆBookEditDialogï¼‰ã€Pinã€Delete å››ä¸ª iconï¼›Legacy/Basement çŠ¶æ€è‡ªåŠ¨ç¦ç”¨ Edit/Deleteã€‚"
      - "Delete icon å…ˆè¯»å– library.basement_bookshelf_idï¼ˆæ¥è‡ª Bookshelf detail APIï¼‰ï¼›ç¼ºå¤±æ—¶å¼¹ toast 'å½“å‰ Library æœªé…ç½® Basementâ€¦' å¹¶æ‹’ç»ç»§ç»­ã€‚"
      - "ç¡®è®¤æ–‡æ¡ˆå›ºå®šä¸º 'ç¡®å®šè¦å°†è¿™æœ¬ä¹¦ç§»åŠ¨åˆ° Basement å—ï¼Ÿ'ï¼Œç¡®è®¤åè°ƒç”¨ useMoveBookToBasement â†’ `/admin/books/{id}/move-to-basement`ï¼ŒæˆåŠŸ toast 'ä¹¦ç±å·²ç§»åŠ¨â€¦' å¹¶åˆ·æ–° BookMainWidget + Basement queriesã€‚"
      - "Mutation å¤±è´¥æ—¶è¯»å– Error.messageï¼Œfallback æ–‡æ¡ˆ 'ç§»åŠ¨åˆ° Basement å¤±è´¥'ï¼Œä¿æŒ toast + overlay åé¦ˆï¼Œä¸å¯é™é»˜å¤±è´¥ã€‚"
  cache_rules:
    - "UpdateBookMaturity mutation æˆåŠŸåï¼Œå…ˆç”¨ queryClient.setQueryData è°ƒæ•´æœ¬åœ°ç¼“å­˜ï¼ˆç§»åŠ¨å¡ç‰‡ï¼‰ï¼Œå†è°ƒç”¨ invalidateQueries(['books',{bookshelfId}]) è·å–æƒå¨æ•°æ®ã€‚"
    - "å¡ç‰‡ç§»åŠ¨åªä¾èµ–åç«¯è¿”å›çš„ maturity/legacyFlagï¼Œä¸å…è®¸æ ¹æ® score çŒœæµ‹åˆ†åŒºã€‚"
  empty_states:
    overall: "è‹¥ counts.total=0ï¼ŒSummaryBar åªæ˜¾ç¤º 0% + å¼•å¯¼æ–‡æ¡ˆ 'æ·»åŠ ç¬¬ä¸€æœ¬ä¹¦å³å¯çœ‹åˆ°æˆç†Ÿåº¦'ï¼ŒShowcase åŒºåŸŸæ¸²æŸ“ Illustration + CTAã€‚"
    legacy_only: "å½“ä»…å‰© Legacy ä¹¦ç±æ—¶ï¼ŒSeed/Growing/Stable åˆ†åŒºæ˜¾ç¤ºâ€œæš‚æ— â€æç¤ºï¼ŒLegacy åŒºåŸŸå±•ç¤ºå…¨éƒ¨å¡ç‰‡ã€‚"
  accessibility:
    - "SummaryBar è¿›åº¦æ¡ä½¿ç”¨ <div role='progressbar'>ï¼Œaria-valuenow/aria-valuemax è¡¨ç¤ºç™¾åˆ†æ¯”ã€‚"
    - "åˆ†åŒºæ ‡é¢˜ `<h3>` åŒ…å«æ•°é‡ï¼ˆç¤ºä¾‹ï¼š'SEED Â· 2 æœ¬'ï¼‰ï¼Œå¡ç‰‡åˆ—è¡¨ä½¿ç”¨ role='list' + listitemã€‚"
    - "+NEW BOOK æŒ‰é’®æä¾› aria-expanded åé¦ˆ create Dialog çŠ¶æ€ã€‚"
  resilient_shell:
    layout: "Headerï¼ˆè§†å›¾åˆ‡æ¢ + æ–°å»ºï¼‰ä¸ Filter/Search å·¥å…·æ¡å›ºå®šæ¸²æŸ“åœ¨ BookMaturityView å¤–éƒ¨ï¼Œå³ä¾¿ maturity ç»„ä»¶é™çº§ä¹Ÿä¿æŒå¯äº¤äº’ã€‚"
    fallback: "BookMaturityView å¿…é¡»åŒ…è£¹ shared/ui/ErrorBoundaryï¼›fallback å¡ç‰‡æ²¿ç”¨ widget èƒŒæ™¯ï¼Œæ–‡æ¡ˆæç¤º 'æˆç†Ÿåº¦è§†å›¾åŠ è½½å¤±è´¥ï¼Œä½†ç­›é€‰/æœç´¢ä»å¯ç»§ç»­' å¹¶æä¾› 'é‡è¯•æ¸²æŸ“' CTAã€‚"
    recovery: "ErrorBoundary.resetKeys åŒ…å« bookshelfIdã€booksTotalã€orderPresetã€searchTextï¼›å½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ¸…é™¤é”™è¯¯çŠ¶æ€ï¼Œæ— éœ€æ•´é¡µåˆ·æ–°ã€‚"
    logging: "æ•è·å¼‚å¸¸æ—¶ console.error('[ErrorBoundary] ...')ï¼Œä¾¿äº DevTools è°ƒè¯•ï¼›åç»­å¯æ¥å…¥ Sentry/Chronicle UI eventã€‚"
  testing:
    - "Snapshotï¼šå±•æŸœ/æ¡ç›®æ¨¡å¼ + ç©ºæ€ + Legacy-onlyã€‚"
    - "Interactionï¼šviewMode åˆ‡æ¢ä»…æ”¹å˜ DOMï¼Œä¸è§¦å‘é¢å¤– fetchï¼›New Book æŒ‰é’® -> Dialog -> æˆåŠŸå…³é—­ -> åˆ—è¡¨åˆ·æ–°ã€‚"
    - "Manualï¼šè¿è¡Œ `npx tsx --tsconfig frontend/tsconfig.json frontend/manual-checks/libraryThemeManualCheck.ts` éªŒè¯ getBookTheme åœ¨ coverColor â†’ library_theme_color â†’ libraryColorSeed çš„ä¼˜å…ˆçº§ä¸ glyph è¾“å‡ºï¼Œç¡®ä¿ä¹¦ç±å¡ç‰‡ç»§æ‰¿ Library ä¸»é¢˜è‰²ã€‚"
    - "Pin Optimisticï¼šç‚¹å‡»ç½®é¡¶/å–æ¶ˆç½®é¡¶æ—¶ç«‹å³åœ¨ UI ä¸­ç§»åŠ¨ä¹¦å¡ä¸” ribbon/badge éš theme æ›´æ–°ï¼Œè¿›å…¥åå°åå†ç›‘å¬ TanStack Query æˆåŠŸå›å†™ï¼›å‡ºç°å›æ»šéœ€è§¦å‘ toast å¹¶æ¢å¤åŸæ’åºã€‚"


book_maturity_combined_filter_bar:
  summary: "Bookshelf â†’ BookMainWidget é¡¶éƒ¨å·¥å…·æ¡å‡çº§ç‰ˆï¼Œå¤ç”¨ Library Dashboard æ …æ ¼ + æ–°å¢ç­›é€‰/æ’åº/å…¨å±€æœç´¢ã€‚å‚è§ ADR-117 (Nov 30, 2025)ã€‚"
  components:
    - "SectionFilterChipsï¼šå››ä¸ª pillï¼ˆSeed/Growing/Stable/Legacyï¼‰å„è‡ªå¯åˆ‡æ¢ï¼Œé»˜è®¤å…¨å¼€ï¼›å…³é—­å section header ä»æ˜¾ç¤ºå¹¶é™„æ–‡æ¡ˆ 'å·²éšè—'ã€‚"
    - "OrderDropdownï¼šä¸‹æ‹‰åˆ—å‡ºé¢„è®¾é¡ºåºï¼ˆStable ä¼˜å…ˆã€Seed ä¼˜å…ˆã€Legacy æœ«å°¾ç­‰ï¼‰ï¼Œç‚¹å‡»å³åˆ»é‡æ’ section é¡ºåº + å±•æŸœæ ‡é¢˜ã€‚"
    - "PinnedToggleï¼šå›¾æ ‡æŒ‰é’® + aria-pressed çŠ¶æ€ï¼›å¼€å¯æ—¶å„ section å†…èµ° pinnedâ†’unpinnedï¼Œå†æŒ‰ maturityOrder æ’åºã€‚"
    - "GlobalSearchï¼šç»§æ‰¿ Library ç•Œé¢çš„è¾“å…¥æ¡†æ ·å¼ï¼Œå³ä¾§åµŒå¥— scope pillsï¼ˆLocal/Globalï¼‰ä¸å¸®åŠ© tooltipï¼›è¾“å…¥æ¡† placeholder='æœç´¢æ ‡é¢˜/ç®€ä»‹/æ ‡ç­¾â€¦'ã€‚"
  interactions:
    - "æ‰€æœ‰æ§ä»¶åªå½±å“å‰ç«¯çŠ¶æ€ï¼›è‹¥ç”¨æˆ·ç‚¹å‡»å·¥å…·æ¡å³ä¾§ 'åˆ·æ–°åˆ—è¡¨' é“¾æ¥æ‰ä¼š invalidate ['books',bookshelfId]ã€‚"
    - "Local æœç´¢ 300ms é˜²æŠ–ï¼Œå¯¹å½“å‰ Query cache çš„ title/summary/description/tags_summary/maturity badge æ–‡æ¡ˆæ‰§è¡Œä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ï¼Œå¹¶åœ¨åŒ¹é…å­—æ®µå‘¨å›´åŒ…è£¹ <mark>ã€‚"
    - "Global æœç´¢æŒ‰é’®åœ¨ scope=Global ä¸”è¾“å…¥â‰¥3 å­—ç¬¦æ—¶å¯ç”¨ï¼Œç‚¹å‡»åæ˜¾ç¤º result sheetï¼ˆä¸Šæµ®å¡ç‰‡ï¼Œæœ€å¤§ 5 æ¡ï¼‰ï¼Œå¹¶è°ƒç”¨ Search æ¨¡ç»„ APIï¼›ç»“æœç‚¹å‡»è·³è‡³ Book è¯¦æƒ…æˆ–æ»šåŠ¨ç°æœ‰å¡ç‰‡ã€‚"
    - "è‹¥å…¨éƒ¨é˜¶æ®µè¢«å…³é—­ï¼Œæ˜¾ç¤º inline æç¤º 'ç­›é€‰ç»“æœä¸ºç©ºï¼Œå·²é»˜è®¤æ¢å¤ Stable åŒº'ï¼Œå¹¶è‡ªåŠ¨é‡æ–°å¯ç”¨ Stableã€‚"
  layout:
    desktop: "å·¥å…·æ¡ç”¨ 12 åˆ— Gridï¼šchips å  6 åˆ—ã€Order 2 åˆ—ã€Pinned 1 åˆ—ã€Search 3 åˆ—ï¼›â‰¤1024px æŠ˜æˆä¸¤è¡Œï¼ˆç¬¬ä¸€è¡Œ chipsï¼Œç¬¬äºŒè¡Œå…¶ä½™æ§ä»¶ï¼‰ã€‚"
    responsive: "å°å± Search Input å æ»¡æ•´è¡Œï¼Œscope åˆ‡æ¢æ”¹ä¸ºç´§æŒ¨è¾“å…¥æ¡†çš„ä¸¤ä¸ªç­‰å®½æŒ‰é’®ã€‚"
  accessibility:
    - "Chips ä½¿ç”¨ role='switch' + aria-pressedï¼›å…³é—­æ—¶è¯»å±æç¤º 'Seed å·²éšè—ï¼ŒæŒ‰ Enter æ¢å¤'ã€‚"
    - "OrderDropdown label='å±•ç¤ºé¡ºåº'ï¼Œèœå•é¡¹æ–‡æ¡ˆå«åŒè¯­è¯´æ˜ï¼ˆä¾‹ï¼š'Stable ä¼˜å…ˆï½œStable first'ï¼‰ã€‚"
    - "Search è¾“å…¥ aria-describedby æ´å¼•æç¤ºï¼š'Local ä»…è¿‡æ»¤å·²åŠ è½½æ•°æ®ï¼›Global è°ƒç”¨æœç´¢æ¨¡ç»„æŸ¥è¯¢å…¨é‡å›¾ä¹¦'ã€‚"
    - "Global result sheet role='listbox'ï¼Œä¸Šä¸‹é”®ç§»åŠ¨ï¼ŒEnter è§¦å‘è·³è½¬ï¼ŒEsc å…³é—­ã€‚"
  persistence:
    - "ç­›é€‰åå¥½å†™å…¥ localStorage('wl.bookList.filters')ï¼›é¦–æ¬¡æ¸²æŸ“è¯»å–ååŒæ­¥åˆ° Zustand storeã€‚"
    - "Search scope é»˜è®¤ Localï¼Œä¸æŒä¹…åŒ–å…³é”®å­—ã€‚"
  empty_states:
    - "Local æœç´¢æ— åŒ¹é… â†’ SummaryBar ä¸‹æ–¹æ˜¾ç¤ºæ–‡æ¡ˆ 'æ²¡æœ‰ä¸â€œ{keyword}â€åŒ¹é…çš„ä¹¦ç±' + CTA 'æ¸…é™¤æœç´¢'ã€‚"
    - "Global æœç´¢æ— åŒ¹é… â†’ result sheet å±•ç¤ºæ’ç”» + æ–‡æ¡ˆ 'å…¨å±€ç´¢å¼•æš‚æ— ç»“æœï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•'ã€‚"
  testing:
    - "Vitestï¼šfilter reducer/selector åœ¨åˆ‡æ¢é˜¶æ®µã€æ’åºã€Pinned æ—¶è¿”å›ç¨³å®šç»“æœï¼›Search hook åœ¨ scope åˆ‡æ¢åè°ƒç”¨æ­£ç¡® APIã€‚"
    - "RTLï¼šæ¨¡æ‹Ÿè¾“å…¥å…³é”®å­—â†’æœ¬åœ°å¡ç‰‡é«˜äº®â†’åˆ‡æ¢ globalâ†’mock fetchâ†’æ¸²æŸ“ result sheetâ†’ç‚¹å‡»è·³è½¬ã€‚"
    - "Playwrightï¼šåˆ·æ–°åè®°å¿†ç­›é€‰ï¼ŒGlobal æœç´¢ loading/é”™è¯¯æ€æç¤ºï¼Œå…¨éšè—æ¢å¤é€»è¾‘ã€‚"
  resilience:
    - "FilterBar ä¸ SearchResultSheet æ°¸è¿œæ¸²æŸ“åœ¨ ErrorBoundary å¤–ï¼Œç¡®ä¿ maturity view æŠ¥é”™æ—¶ä»å¯åˆ‡æ¢ç­›é€‰/æœç´¢ã€‚"
    - "Fallback æ–‡æ¡ˆéœ€å¼ºè°ƒå¯ç»§ç»­æ“ä½œï¼Œå¹¶æä¾›è¾…åŠ© CTAï¼ˆä¾‹å¦‚ 'é‡è¯•æ¸²æŸ“' æˆ– 'å¯¼å‡ºåˆ—è¡¨'ï¼‰ã€‚"
    - "Global result sheet ç»„ä»¶å¯¹ maturity fallback æ— ä¾èµ–ï¼Œç‚¹å‡»è·³è½¬æ—¶è‹¥å½“å‰åˆ—è¡¨ç¼ºå¤±ç›®æ ‡å¡ç‰‡ç›´æ¥å¯¼èˆªåˆ° /admin/books/{bookId}ã€‚"


book_workspace_todo_visual_rules:
  summary: "Book çº§ Todo æ±‡æ€»è§†å›¾ï¼ˆPlan76 Stage 1ï¼‰"
  hero_badge:
    design: "Hero å¡ç‰‡å³ä¾§è¿½åŠ åœ†è§’èƒ¶å›Š 'Open TODOs Â· {count}' ä¸ 'Done Â· {count}'"
    visibility: "open_count=0 æ—¶éšè— Open èƒ¶å›Šï¼Œä»…æ˜¾ç¤º Doneï¼›ä¸¤è€…å‡ä¸º 0 æ—¶æ•´ç»„éšè—"
    a11y: "aria-label='Open todo {count}' ä¸è§†è§‰é¢œè‰²éµå¾ª --wl-status-warning ç³»åˆ—"
  overview_panel:
    layout: "æ¦‚è§ˆ Tab å·¦åˆ—æ–°å¢ Todo å¡ç‰‡ï¼Œå±•ç¤ºæœ€å¤š 3 æ¡å·²å‡çº§ï¼ˆis_promotedï¼‰å¾…åŠï¼Œå«æ‰€å± Block åç§°"
    interactions:
      - "ç‚¹å‡»å¾…åŠâ†’åˆ‡æ¢åˆ° Blocks Tab å¹¶æ»šåŠ¨å®šä½åˆ°å¯¹åº” Block"
      - "Hover æ—¶å±•ç¤ºæˆªæ­¢æ—¥æœŸ/ä¼˜å…ˆçº§ï¼ˆè‹¥å­˜åœ¨ï¼‰"
      - "Basement / Legacy ä¹¦ç±ä»…æ˜¾ç¤ºåˆ—è¡¨ï¼Œä¸æä¾›äº¤äº’"
    empty_state: "å±•ç¤ºæ–‡æ¡ˆ 'æš‚æ— å‡çº§å¾…åŠï¼Œä½ å¯ä»¥åœ¨å—ç¼–è¾‘ä¸­æ·»åŠ  Todo å¹¶å‡çº§ä¸º Book ä»»åŠ¡'"
  blocks_tab_panel:
    derive_strategy: "Blocks Tab ä½¿ç”¨ deriveBookTodosFromBlocks(pages) å°† list_todo é¡¹èšåˆæˆ UI æŠ•å½±"
    promotion:
      promote_action: "æ˜Ÿæ ‡æŒ‰é’®è§¦å‘ is_promoted toggleï¼Œå¤ç”¨ UpdateBlockUseCaseï¼Œå®Œæˆå invalidateQueries(['blocks',bookId])"
      demote_action: "å–æ¶ˆæ˜Ÿæ ‡ä»…å½±å“ UI æ±‡æ€»ï¼ŒBlock å†…å®¹ä»ä¿ç•™è¯¥ Todo"
    checkbox_behavior:
      write_port: "å‹¾é€‰/å–æ¶ˆç›´æ¥ PATCH åŸ Block å†…å®¹ï¼Œç¦æ­¢ç”Ÿæˆ /todo/{id} å†™ç«¯ç‚¹"
      readonly_guard: "Basement/Legacy æˆ–ä¸´æ—¶åªè¯»æ€ç¦ç”¨ checkboxï¼Œå¹¶å±•ç¤º tooltip 'ä»…æ‰€æœ‰è€…å¯ç¼–è¾‘'"
    filters: "Blocks Tab é¡¶éƒ¨æä¾› filter pillï¼šAll / Promoted / Done / Overdue"
  timeline_link:
    event_labels:
      created: "ç»¿è‰² dot + æ–‡æ¡ˆ 'å‡çº§ Todoï¼š{text}'"
      completed: "è“è‰² dot + æ–‡æ¡ˆ 'å®Œæˆ Todoï¼š{text}'"
      reopened: "æ©™è‰² dot + æ–‡æ¡ˆ 'é‡æ–°æ‰“å¼€ Todoï¼š{text}'"
      deleted: "ç°è‰² dot + æ–‡æ¡ˆ 'ç§»é™¤ Todoï¼š{text}'"
    default_filters: "Timeline Tab çš„ chips é»˜è®¤ä¸é€‰ä¸­ todo_* äº‹ä»¶ï¼Œç”¨æˆ·æ‰‹åŠ¨å¯ç”¨åè®°å¿†åœ¨ localStorage('wordloom.book.timeline.todo_filter')"
  hooks:
    derive_hook: "frontend/src/features/todo/model/derive.ts â†’ deriveBookTodosFromBlocks(pages)"
    query_hook: "useBookWorkspaceTodos(bookId, { promotedOnly }) åŒ…è£… TanStack Query å¹¶ç¼“å­˜ 5 åˆ†é’Ÿ"
  testing:
    snapshot: "Promoted å¾…åŠå­˜åœ¨/ä¸ºç©º/åªè¯»ä¸‰ç§å¿«ç…§"
    interaction: "æ˜Ÿæ ‡ â†’ invalidate â†’ å¾…åŠè®¡æ•°åˆ·æ–°"
    a11y: "æ£€æŸ¥ checkbox aria-checkedã€æ˜Ÿæ ‡ aria-pressed"

block_todo_visual_rules:
  summary: "è¡Œå†… Todo Block ç¼–è¾‘è§„åˆ™ï¼ˆPlan42 + Plan76ï¼‰"
  block_kind: "list_todo"
  layout:
    checkbox: "ä½¿ç”¨åŸç”Ÿ checkbox + è‡ªå®šä¹‰å¤–è§‚ï¼Œé€‰ä¸­æ€å¡«å…… --wl-status-success-bg"
    text_field: "å†…è”å¯ç¼–è¾‘åŒºåŸŸï¼ˆcontentEditable æˆ– textareaï¼‰ï¼ŒEnter æ·»åŠ æ–°é¡¹ï¼ŒShift+Enter æ¢è¡Œ"
    drag_handle: "å·¦ä¾§ä¿ç•™ 16px æ‹–æ‹½ç‚¹ç”¨äºæ’åº"
  interactions:
    add_item: "å°¾éƒ¨æ˜¾ç¤º Ghost è¡Œ '+ æ–°å¾…åŠ'ï¼Œç‚¹å‡»åç”Ÿæˆ {id, text:'', status:'open'}"
    toggle: "ç‚¹å‡»å¤é€‰æ¡†è°ƒç”¨ updateBlockMutation({ blockId, content })ï¼ŒOptimistic UI åœ¨å®Œæˆå‰å±•ç¤º loading spinner"
    promote_chip: "å³ä¾§æ˜Ÿæ ‡æŒ‰é’®æ§åˆ¶ is_promotedï¼Œäº¤äº’æ–‡æ¡ˆ 'å‡çº§åˆ°ä¹¦ç±å¾…åŠ'"
    delete: "Backspace åœ¨æ–‡æœ¬ä¸ºç©ºæ—¶åˆ é™¤è¯¥é¡¹ï¼›æä¾›å¯æ’¤é”€ toast"
  accessibility:
    checkbox: "aria-checked åŒæ­¥çŠ¶æ€ï¼›status=done æ—¶è¿½åŠ  aria-describedBy æŒ‡å‘ 'å·²å®Œæˆ' æ–‡æ¡ˆ"
    keyboard: "Alt+ArrowUp/Down è°ƒæ•´é¡ºåºï¼›Ctrl+Enter æ ‡è®°å®Œæˆ"
  readonly_mode: "åªè¯»çŠ¶æ€ä¸‹æ‰€æœ‰è¾“å…¥æ§ä»¶ç¦ç”¨ï¼Œæ˜¾ç¤ºç°è‰²å‹¾é€‰æ¡†ä¸ tooltip 'åªè¯»ä¹¦ç±æ— æ³•ç¼–è¾‘ Todo'"
  analytics: "åŸ‹ç‚¹äº‹ä»¶ block_todo.checked / .promoted / .demoted / .deletedï¼Œç”¨äºæˆç†Ÿåº¦ä¸ Chronicle æ•°æ®æ ¡å‡†"

block_list_visual_rules:
  summary: "Plan137ï¼ˆDec 6, 2025ï¼‰æŠŠæ— åº/æœ‰åºåˆ—è¡¨æ¥å…¥ä¸ Todo ç›¸åŒçš„ inline row å£³å±‚ï¼Œç»Ÿä¸€åŸºçº¿ä¸é”®ç›˜ä½“éªŒã€‚"
  layout:
    row_shell: "`.inlineRow` æ˜¯ä¸¤åˆ— flex è¡Œï¼ˆæ ‡è®°åˆ— + æ–‡æœ¬åˆ—ï¼‰ï¼Œä¸Šä¸‹ padding 6pxï¼Œä¸ `.todoRow` ä¿æŒä¸€è‡´ï¼Œä½¿æ®µè½/åˆ—è¡¨/å¾…åŠå¯¹é½ã€‚"
    marker_column: "`.inlineMarker` å›ºå®š 18px å®½åº¦ï¼Œ`.inlineMarkerBullet` ä½¿ç”¨ 18px å­—å·çš„ `â€¢`ï¼Œ`.inlineMarkerOrdered` å¯ç”¨ tabular-numsï¼Œæ•°å­—åˆ—ä¸ä¼šéšä½æ•°è·³åŠ¨ã€‚"
    text_column: "`.inlineEditorText` æ‰¿è½½ ParagraphEditorï¼Œplaceholder/æ–‡æœ¬ç»§æ‰¿æ®µè½å­—ä½“ï¼ŒReadOnly æ€åªåˆ‡æ¢ data-readonlyï¼Œä¸æ›¿æ¢ DOMã€‚"
  placeholder_rules:
    - "å•è¡Œä¸ºç©ºæ—¶ä»æ¸²æŸ“ markerï¼Œå¹¶æ˜¾ç¤ºå…±äº« placeholderâ€œå†™ç‚¹ä»€ä¹ˆâ€¦â€ï¼Œé¿å…ç©ºè¡Œå¡Œé™·ã€‚"
    - "æ‰€æœ‰è¡Œéƒ½ä¸ºç©ºæ—¶æ˜¾ç¤º `.todoList` ç©ºæ€æ–‡æ¡ˆâ€œæš‚æ— åˆ—è¡¨å†…å®¹ï¼Œç‚¹å‡»ç¼–è¾‘æ·»åŠ â€ï¼Œä¸ Todo block ç©ºæ€ä¸€è‡´ã€‚"
  interactions:
    - "Enter åœ¨å½“å‰è¡Œä¸‹æ–¹æ’å…¥æ–°è¡Œï¼›å†…å®¹ä»¥ string æ•°ç»„å†™å› Block.contentï¼Œæ— éœ€é¢å¤– schemaã€‚"
    - "Shift+Enter åœ¨å½“å‰ ParagraphEditor å†…æ’å…¥è½¯æ¢è¡Œï¼Œè¡Œå†…æ–‡æœ¬ä¿æŒåŒä¸€å®½åº¦ã€‚"
    - "Backspace åˆ é™¤ç©ºè¡Œï¼›ä»…å‰©æœ€åä¸€è¡Œä¸”ä¸ºç©ºæ—¶å›è°ƒ DeleteBlockUseCaseï¼Œè¡Œä¸ºä¸ Todo block å¯¹é½ã€‚"
    - "Arrow ä¸Š/ä¸‹åœ¨è¡Œé—´ç§»åŠ¨ç„¦ç‚¹ï¼Œè¶Šç•Œæ—¶é€šè¿‡ `onFocusPrev/onFocusNext` äº¤è¿˜ç»™ BlockListã€‚"
  accessibility:
    - "Display wrapper ç»´æŒ role='group' + aria-labelï¼ˆ'æ— åºåˆ—è¡¨' / 'æœ‰åºåˆ—è¡¨'ï¼‰ï¼Œmarkers åªæ˜¯æ–‡æœ¬ï¼Œé¿å…åµŒå¥— list roleã€‚"
    - "æœ‰åºåˆ—è¡¨ marker ä½¿ç”¨ tabular æ•°å­—ï¼Œè¯»å±è®¾å¤‡å¯ç›´æ¥æœ—è¯»åºå·ä¸”ä¸å—å¯¹é½å½±å“ã€‚"
  sharing_rules:
    - "åˆ—è¡¨ä¸ Todo block å…±äº« `.todoList` å®¹å™¨ä¸ spacing tokenï¼Œéµå®ˆ Plan120/126 è®¾å®šçš„åŸºçº¿ï¼Œä¸å†éœ€è¦ç‹¬ç«‹ `.listEditor*` æ ·å¼ã€‚"
  status: "Adopted Dec 6, 2025"

block_editor_plan163c_focus_affordance:
  summary: "Plan163Cï¼ˆDec 8, 2025ï¼‰ç»Ÿä¸€è§†è§‰ç„¦ç‚¹/æ’å…¥ç‚¹å‘ˆç°ï¼šBlockEditorCore è´Ÿè´£ caretï¼ŒBlockItem ä»…æš´éœ²æ•°æ®å±æ€§ä¸ CSS å˜é‡ä¾›è£…é¥°ï¼Œä»»ä½•æµ®å±‚/å·¥å…·æ¡éƒ½ä¸å¾—é‡æ–°æµ‹é‡ Selectionã€‚"
  caret_overlay:
    - "`.blockItem` å®¿ä¸»åœ¨ `useScopedCaretTracker` å›è°ƒä¸­å†™å…¥ `--wl-inline-caret-top/left`ï¼Œç¼ºå¤±æ—¶ä¼šæ¸…ç©ºå˜é‡ï¼›æ‰€æœ‰æµ®åŠ¨å·¥å…·æ¡/ghost caret (å« Slash/QuickInsert/Toolbar) å¿…é¡»æ¶ˆè´¹è¯¥å˜é‡ï¼Œè€Œä¸æ˜¯å†è®¿é—® `window.getSelection()`ã€‚"
    - "å½“ block éç¼–è¾‘æ€æˆ– caret ä¸¢å¤±æ—¶ï¼Œä¾èµ– `--wl-inline-caret-*` çš„ç»„ä»¶éœ€è‡ªåŠ¨éšè—æˆ–é€€å› centerï¼Œå¯¹é½ BlockEditorCore `selectionStore` ä»…å¹¿æ’­ snapshot çš„äº‹å®ã€‚"
  pointer_keyboard_states:
    - "`.blockItem[data-editing='true']` æ˜¯å”¯ä¸€é«˜äº®ä¿¡å·ï¼Œborder-bottom ä¸ actions å¯è§æ€§å‡ç”±è¯¥å±æ€§é©±åŠ¨ï¼›List/Todo/Paragraph ä¸å¾—å†å†™è‡ªå®šä¹‰ focus classã€‚"
    - "Plan163C è¦æ±‚ pointer intent é€šè¿‡ `announceFocusIntent('pointer', blockId)` è§¦å‘ï¼Œè§†è§‰ä¾§åªåœ¨ pointer è§¦å‘æ—¶ç¦æ­¢é»˜è®¤ `mousedown` caretï¼ˆè§ `onMouseDown` preventDefaultï¼‰ï¼Œé¿å…åŒ caret é—ªçƒã€‚"
    - "é”®ç›˜è¶Šç•Œç„¦ç‚¹ä»…ä¾èµ– `announceFocusIntent('keyboard', blockId, {edge})`ï¼Œè§†è§‰ç„¦ç‚¹æ¢å¤å®Œå…¨ç”± BlockEditorCore è°ƒåº¦ï¼›ä»»ä½•ç»„ä»¶ä¸å¾—ä½¿ç”¨ `scrollIntoView` ä»£æ›¿ã€‚"
  readonly_and_placeholders:
    - "`.textBlockContent[data-readonly='true']` ä¿æŒ caret-color transparentï¼›åªè¯»å£³å±‚ä»å±•ç¤º placeholderï¼ˆ`data-empty` + `::before`ï¼‰ï¼Œé¿å…è§†è§‰è·³å˜ã€‚"
    - "Paragraph/List/Todo çš„ placeholder æ–‡æ¡ˆä»é€šè¿‡ `data-placeholder` æ³¨å…¥ï¼ŒPlan163C ç¦æ­¢å›  caret æ‰€å±å˜åŒ–è€Œåˆ‡æ¢ placeholder DOMã€‚"
  instrumentation:
    - "Hover å·¥å…·æ¡å‡†å…¥ï¼š`.blockItem[data-show-actions='true']` æ§åˆ¶ `BlockToolbar` æ˜¾ç¤ºï¼Œsource ä»…æ¥è‡ª hover + editing stateï¼›ç„¦ç‚¹/intent å˜åŒ–ä¸å…è®¸ç›´æ¥æ”¹å†™ toolbar DOMï¼Œæ‰€æœ‰çŠ¶æ€è¿‡æ¸¡é¡»èµ° data attributeã€‚"
  status: "Adopted Dec 8, 2025"

block_editor_plan164c_pointer_precision:
  summary: "Plan164Cï¼ˆDec 8, 2025ï¼‰æŠŠ pointerâ†’caret æµç¨‹å‡çº§ä¸ºâ€œç‚¹å‡»åæ ‡ â†’ offset â†’ intent â†’ caret controllerâ€ï¼šUI å£³å±‚å¿…é¡»å–‚ç»™ BlockEditorCore çœŸå® offsetï¼Œè§†è§‰å±‚ä¸å¾—å†æŠŠ pointer intent ç®€åŒ–æˆè¡Œé¦–ã€‚"
  behavior:
    - "List/Todo/Paragraph inline shell åœ¨ `onMouseDownCapture` ä¸­å…ˆè®¡ç®— offsetï¼ˆè°ƒç”¨ `caretDomUtils.getOffsetFromPoint`ï¼‰ï¼Œå†è§¦å‘ `announceFocusIntent('pointer', {blockId, offset, source})`ï¼›ç¦æ­¢ç»§ç»­ `preventDefault` åæ‰‹åŠ¨ setSelectionã€‚"
    - "BlockEditorCore çš„æ ·å¼æ•°æ®å±æ€§ï¼ˆ`data-empty`, `data-pointer-source` ç­‰ï¼‰åªåæ˜  controller stateï¼Œä¸ç›´æ¥ç»‘æµè§ˆå™¨ selectionï¼›è§†è§‰ç»„ä»¶å¦‚ BlockToolbar éœ€è®¢é˜… selection snapshotï¼Œè€Œéè‡ªå·±æµ‹é‡ Rangeã€‚"
    - "å½“ pointer offset è¶…å‡ºæ–‡æœ¬é•¿åº¦æ—¶ï¼ŒUI å¿…é¡»æ¸²æŸ“ fallback indicatorï¼ˆå¦‚è½»å¾®é—ªçƒï¼‰å¹¶åœ¨ QuickLog æ ‡æ³¨ `PLAN164C_POINTER_FALLBACK`ï¼Œå¸®åŠ© QA å®šä½å¼‚å¸¸ã€‚"
  instrumentation:
    - "`announceFocusIntent` ç°è¦æ±‚æ‰€æœ‰ pointer intent é™„å¸¦ `source` å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨ `selectionStore` å†…åŒæ­¥è§¦å‘ `BlockEditorCaretIntent` QuickLog äº‹ä»¶ï¼Œä¿éšœ UI åŠ¨ä½œå¯å›æº¯ã€‚"
    - "QuickLog å®¢æˆ·ç«¯ç»Ÿä¸€é€šè¿‡ `/api/quicklog` å‘é€äº‹ä»¶ï¼Œæœªå‡ºç°åœ¨ telemetry çš„ pointer äº¤äº’ä¸€å¾‹è§†ä¸ºå›å½’ã€‚"
  testing:
    - "è§†è§‰éªŒæ”¶è„šæœ¬è¦†ç›– Paragraphâ†’Listâ†’Paragraphã€Listâ†’Todoâ†’Paragraph ä¸‰æ¡è·¯å¾„ï¼Œè¦æ±‚ç‚¹å‡»ä»»æ„å­—ç¬¦ caret éƒ½è½åœ¨è¯¥å­—ç¬¦å‰ï¼›è‹¥å‘ç°è·³åˆ°é¦–å­—æ¯ï¼Œç›´æ¥å¼•ç”¨æœ¬è§„åˆ™é©³å›ã€‚"
    - "Slash èœå• / Hover å·¥å…·æ¡çš„å®šä½ä¾æ—§åŸºäº selection snapshotï¼Œä¸å¾—å› ä¸º pointer intent æ”¹æˆè‡ªå»º selectionã€‚"
  status: "Adopted Dec 8, 2025"

block_editor_plan165a_base_paragraph_guard:
  summary: "Plan165Aï¼ˆDec 10, 2025ï¼‰è§„å®šâ€œæ–‡æ¡£å¿…é¡»è‡³å°‘ä¿ç•™ä¸€ä¸ªåŸºç¡€æ®µè½ blockâ€ï¼Œæ‰€æœ‰åˆ é™¤å…¥å£ç»Ÿä¸€èµ° deleteBlockWithGuardï¼Œç‰¹æ®Šå—åˆ é™¤ä¼˜å…ˆé™çº§ä¸º paragraphã€‚"
  base_vs_special:
    base_kind: "paragraph æ˜¯å”¯ä¸€åŸºç¡€å—ï¼Œheading/list/todo/quote/callout/panel ç­‰éƒ½è§†ä¸ºé™„åŠ è¯­ä¹‰çš®è‚¤ã€‚"
    special_set: "{bulleted_list, numbered_list, todo_list, quote, callout, panel} é»˜è®¤èµ°ç‰¹æ®Šå—é™çº§è§„åˆ™ï¼Œæ–°å¢å¯Œå—å¦‚æœä¸èƒ½ç›´æ¥åˆ é™¤å¿…é¡»çº³å…¥è¯¥é›†åˆã€‚"
  deletion_contract:
    guard: "BlockItem/Slash/Menu å¿…é¡»è°ƒç”¨ useBlockCommands.deleteBlockWithGuard(blockId)ï¼šä»»ä½•ç»•è¿‡è¯¥å‘½ä»¤çš„åˆ é™¤ä¸€å¾‹è§†ä¸ºè¿è§„ã€‚"
    single_block: "å½“æ–‡æ¡£åªå‰© 1 ä¸ª block æ—¶ï¼šè‹¥å·²æ˜¯ paragraph åˆ™æ¸…ç©ºæ–‡æœ¬è€Œä¸æ˜¯åˆ é™¤ï¼›è‹¥æ˜¯ç‰¹æ®Š/heading ç­‰éåŸºç¡€å—ï¼Œåˆ™è‡ªåŠ¨æ’å…¥ paragraph æ›¿æ¢ï¼ˆé™çº§ï¼‰ã€‚"
    multi_block_special: "ç‰¹æ®Šå—ä»…åœ¨â€œå†…å®¹ä¸ºç©ºä¸”åæ–¹ä»æœ‰å…¶å®ƒ blockâ€æ—¶å…è®¸çœŸæ­£åˆ é™¤ï¼›å…¶å®ƒæƒ…å†µå…¨éƒ¨é™çº§ä¸º paragraph å¹¶æŠŠæ–‡æœ¬ï¼ˆåˆ—è¡¨/å¾…åŠè¡Œã€å¼•ç”¨æ­£æ–‡ã€callout æ–‡æ¡ˆã€panel title/bodyï¼‰æ‹¼æ¥æˆæ®µè½æ–‡æœ¬ã€‚"
    multi_block_normal: "æ™®é€šæ®µè½/heading å¯ä»¥åˆ é™¤ï¼Œä½† Guard ä¼šè‡ªåŠ¨è®¡ç®— fallback ç„¦ç‚¹ï¼šä¼˜å…ˆèšç„¦å‰ä¸€å—æœ«å°¾ï¼Œå¦åˆ™ä¸‹ä¸€å—å¼€å¤´ï¼Œç¦æ­¢ UI è‡ªè¡Œæ“ä½œ selectionã€‚"
  downgrade_flow:
    replacement: "é™çº§é€šè¿‡ createBlock(kind='paragraph') + deleteBlock(oldId) å®Œæˆï¼Œä½ç½®ä½¿ç”¨å‰å fractional_index è®¡ç®—ï¼›Guard ä¼šåœ¨ selectionStore å‘å‡º `source:'block-commands.guard.downgrade'`ï¼Œç¡®ä¿ caret ç•™åœ¨æ›¿æ¢æ®µè½ã€‚"
    content_rules:
      - "åˆ—è¡¨/Todo å°†å„è¡Œæ–‡æœ¬ä»¥ `\n` æ‹¼æ¥æˆæ®µè½ã€‚"
      - "Callout/Quote å–æ­£æ–‡ textï¼›Panel æ‹¼æ¥ title + ç©ºè¡Œ + bodyã€‚"
    telemetry: "QuickLog äº‹ä»¶ä»ç”± selectionStore ç»Ÿä¸€ä¸ŠæŠ¥ï¼Œé™çº§ä¸æ–°å¢é¢å¤–åŸ‹ç‚¹ã€‚"
  tooling:
    command: "frontend/src/modules/book-editor/model/blockCommands.ts å¯¼å‡º deleteBlockWithGuardï¼Œå¹¶åœ¨ BlockItem.tsx ç»Ÿä¸€æ¶ˆè´¹ã€‚"
    helpers: "blockKindRules.ts å®šä¹‰ BASE_BLOCK_KIND / isSpecialBlockKind / deriveParagraphContentFromRenderable ä¾› Guard ä¸ UI å…±äº«ã€‚"
    editors: "Paragraph/List/Todo editor çš„ onDeleteEmptyBlock ä¸å†è‡ªå·±åˆ¤æ–­ fallbackï¼Œåªè¦è°ƒç”¨ guard å³å¯ã€‚"
  status: "Adopted Dec 10, 2025"

block_editor_plan165c_transform_contract:
  summary: "Plan165Cï¼ˆDec 10, 2025ï¼‰æŠŠ Slash/Markdown è½¬æ¢ä¸ deleteBlockWithGuard æ”¶æ‹¢æˆåŒä¸€å¥—å‘½ä»¤ï¼šåªæœ‰â€œç©º paragraphâ€å¯ä»¥æ¢çš®ï¼Œå˜æ¢åœ¨åŸ block ä¸Šå®Œæˆï¼Œcaret intent ä»ç”± selectionStore ç»Ÿä¸€å¹¿æ’­ã€‚"
  empty_paragraph_rule:
    - "Slash / QuickInsert transform åªåœ¨ BlockItem åˆ¤å®š draft ä¸ºç©ºæ—¶å¯ç”¨ï¼›æ®µè½é‡Œä¸€æ—¦å­˜åœ¨å¯è§å­—ç¬¦å°±æ‹’ç» transformï¼Œé¿å…è¯¯åˆ æ­£æ–‡ã€‚"
    - "Markdown patternsï¼ˆ- ç©ºæ ¼ / 1. ç©ºæ ¼ / - [ ]ï¼‰è¢«è§†ä½œç©ºæ€ï¼šè¯†åˆ«å BlockItem ç«‹å³æ¸…ç©ºè¾“å…¥å¹¶è°ƒç”¨ transformBlockï¼Œè½¬æ¢åçš„åˆ—è¡¨/å¾…åŠé¦–è¡Œä¸å†æ®‹ç•™ '-'ã€‚"
  transform_command:
    - "frontend/src/modules/book-editor/model/blockCommands.ts æš´éœ² transformBlock â€”â€” ç›´æ¥ mutate block.kind + block.contentï¼Œå†è°ƒç”¨ updateBlock APIï¼Œä¸å†èµ°â€œæ’å…¥æ®µè½ â†’ åˆ é™¤æ—§å—â€çš„ä¸´æ—¶æ€ã€‚"
    - "transformBlock é»˜è®¤æ³¨å…¥å„æ’ä»¶çš„ç©º payloadï¼ˆList = ['']ï¼ŒTodo = 1 æ¡ç©º itemï¼ŒCallout/Quote = ç©ºæ­£æ–‡ï¼‰ï¼Œç„¦ç‚¹é€šè¿‡ announceFocusIntent(source='block-commands.transform.*') è½åœ¨æ–°å—ä¸Šã€‚"
  delete_guard_alignment:
    - "Paragraph/List/Todo editor çš„ onDeleteEmptyBlock ç°æ— æ¡ä»¶è§¦å‘ deleteBlockWithGuardï¼Œè®© Guard è´Ÿè´£æ¸…ç©º/é™çº§/ç„¦ç‚¹ï¼›UI ä¸å¾—å†è®¡ç®— selection fallbackã€‚"
    - "ç‰¹æ®Šå— Backspace æ—¶ï¼ˆå°¤å…¶æ–‡æ¡£åªå‰© 1 ä¸ª blockï¼‰æ”¹ä¸ºåœ¨åŸä½é™çº§ä¸º paragraphï¼ŒBlockItem ä¸å†å‡­ç©ºæ’å…¥é¢å¤–æ®µè½ï¼Œå› æ­¤ä¸ä¼šå†å‡ºç°â€œç©ºæ®µè½å¥—å¨ƒâ€ã€‚"
  references:
    - "DDD_RULES.POLICY-BLOCK-PLAN165C-TRANSFORM-GUARD"
    - "HEXAGONAL_RULES.block_editor_plan165c_transform_guard"
  status: "Adopted Dec 10, 2025"

block_editor_vertical_rhythm:
  adr_reference: "ADR-138-plan149-spacing-token-reset.md"
  summary: "Plan149A/B + Plan152A/Bï¼ˆDec 3, 2025ï¼‰æŠŠ VERTICAL-01~06 å‡çº§ä¸ºâ€œUI-only + token-onlyâ€ä½“ç³»ï¼š.blockItem æ˜¯å”¯ä¸€ spacing å±‚ï¼Œæ‰€æœ‰ HTML é»˜è®¤ margin è¢«æ¸…ç©ºï¼Œå†ç”±ç»Ÿä¸€ token æ§åˆ¶æ®µè½/åˆ—è¡¨/å¾…åŠ/BlockList å£³å±‚çš„èŠ‚å¥ã€‚"
  dom_structure:
    - ".blockList â†’ .blockItemï¼ˆå”¯ä¸€ spacing å±‚ï¼‰â†’ .blockItemMain â†’ .textBlockShell â†’ contentEditable"
    - "åˆ—è¡¨/å¾…åŠä¾æ—§åœ¨ .blockItem å†…æ¸²æŸ“ ul/ol/li/inputï¼Œä½† margin/padding å…¨ç”±è¡Œå®¹å™¨ä¸ token è´Ÿè´£"
  plan152_token_matrix:
    primitives:
      - "--wl-space-0 â†’ --wl-space-6ï¼š2px åŸºå‡†æ¢¯åº¦ï¼Œä»»ä½• spacing token å¿…é¡»æ¥è‡ªè¯¥æ¢¯åº¦ï¼Œç¦æ­¢é­”æ³•æ•°å­—ã€‚"
      - "--wl-space-2-5 / -3-5 / -4-5ï¼šBlockList/Inline popover åŠåˆ»åº¦ï¼Œä»…èƒ½åœ¨ Figma éªŒæ”¶åä½¿ç”¨ã€‚"
    semantics_editor:
      section_gap: "--wl-space-block-sectionï¼ˆ= --wl-space-3 aliasï¼‰= é»˜è®¤ blockâ†”block è·ç¦»ï¼Œæš‚ä»¥ alias æ–¹å¼å…¼å®¹ legacy --wl-space-sectionã€‚"
      tight_gap: "--wl-space-block-tightï¼ˆ= --wl-space-2 aliasï¼‰= paragraph/heading/list/todo ç´§å‡‘ç»„åˆï¼Œalias æœŸå†…ç¦æ­¢ç›´æ¥åˆ é™¤æ—§åã€‚"
      inline_gap: "--wl-space-inlineï¼ˆ= --wl-space-2ï¼‰= `.inlineRow`ã€todo rowsã€list rows è¡Œå†…é—´è·ã€‚"
      block_padding: "--wl-block-padding-y / --wl-block-padding-y-dense æ§åˆ¶ block å£³å±‚å†…éƒ¨ä¸Šä¸‹å‘¼å¸ã€‚"
      list_indent: "--wl-block-padding-left + --wl-list-indent å†³å®šå·¦ä¾§æ‰‹æŸ„/æ ‡è®°ä¸æ–‡æœ¬ gutterï¼Œåˆ—è¡¨ padding-inline-start ä¸€å¾‹ç»‘å®šè¯¥ tokenã€‚"
      list_item_gap: "--wl-list-item-gapï¼ˆ= --wl-space-2ï¼‰= li + li é—´è·ï¼Œä¹Ÿæ˜¯ todo è¡Œé—´è·çš„å•ä¸€æ§åˆ¶æºï¼›--wl-todo-item-gap ä»…ä¿ç•™ä¸º aliasã€‚"
      bridge_tokens: "--wl-space-list-before/afterã€--wl-space-todo-before/afterã€--wl-space-quote-before/after åŒºåˆ†æ®µè½â†”åˆ—è¡¨/å¾…åŠ/å¼•ç”¨è¿‡æ¸¡ï¼Œä¸å¾—å†å†™è£¸ marginã€‚"
    semantics_blocklist:
      shell_gap: "--wl-blocklist-shell-gap / --wl-blocklist-shell-padding-{x|y} æ§åˆ¶ BlockList å¤–å±‚ 24Ã—40px å‘¼å¸ï¼ŒSpacing Sandbox å¡ç‰‡å·²å¤åˆ»ã€‚"
      inline_offset: "--wl-blocklist-inline-offsetï¼ˆ= 30pxï¼‰æä¾› handle + actions gutterï¼Œä¸ editor shell å…±ç”¨æ¢¯åº¦ã€‚"
      card_gap: "--wl-blocklist-card-gapï¼ˆ18pxï¼‰= `.blockItem + .blockItem` é—´è·åœ¨ BlockList é‡Œçš„è¯­ä¹‰åˆ«åã€‚"
      panel_padding: "--wl-blocklist-panel-paddingï¼ˆ20pxï¼‰ç”¨äº inline æ’å…¥å™¨ã€DeletedBlocksPanel ç­‰äºŒçº§å®¹å™¨ï¼Œç¦æ­¢å†™æ­» 20pxã€‚"
      pill_padding: "--wl-blocklist-pill-padding-x/y` + --wl-space-2-5 è´Ÿè´£ tab/pill/button çš„ç´§å‡‘å¡«å……ã€‚"
  plan153_shell_tokens:
    summary: "Plan153ï¼ˆDec 6, 2025ï¼‰åœ¨ Plan152 ä¸Šè¿½åŠ â€œBlock Shell = å†…éƒ¨é«˜åº¦ã€Space Token = èŠ‚å¥â€çš„ç¡¬çº¦æŸï¼Œæ‰€æœ‰å£³å±‚ padding å‡æ”¹ç”¨è¯­ä¹‰ tokenã€‚"
    naming:
      - "å‘½åæ ¼å¼ï¼š`--wl-{domain}-{shell}-{element}-{property}`ã€‚Shell token ä»…æè¿°å•ä¸ª block å†…éƒ¨ padding/inline ç¼©è¿›ï¼Œä¸å¾—æ”¹å˜ block â†” block èŠ‚å¥ã€‚"
      - "Paragraph/Heading shell padding-y å›ºå®šä¸º 0pxï¼›å¦‚éœ€â€œæ®µè½å¡ç‰‡â€å¦èµ· data-kind + ä¸“ç”¨ shell tokenã€‚"
    tokens:
      block:
        - "--wl-block-shell-paragraph-padding-yï¼ˆé»˜è®¤ 0ï¼‰"
        - "--wl-block-shell-heading-padding-top / --wl-block-shell-heading-padding-bottomï¼ˆç« èŠ‚å¼€åˆç¼“å†²ï¼‰"
      list:
        - "--wl-list-shell-padding-y + --wl-list-shell-padding-inlineï¼šåˆ—è¡¨å£³å†…éƒ¨å‘¼å¸ & marker gutterï¼Œé…åˆ --wl-space-list-before/after æ„æˆæ¡¥æ¥ã€‚"
      todo:
        - "--wl-todo-shell-padding-yï¼šå¾…åŠå£³å†…éƒ¨ paddingï¼Œrow gap å¼•ç”¨ --wl-list-item-gapï¼ˆé€šè¿‡ --wl-todo-item-gap aliasï¼‰ã€‚"
      quote:
        - "--wl-quote-shell-padding-yï¼šå¼•ç”¨å£³å†…éƒ¨ paddingï¼Œè¿›å…¥/ç¦»å¼€å¼•ç”¨ä¾æ—§ç”¨ quote-before/afterã€‚"
      inline:
        - "--wl-inline-insert-shell-padding-x/y + --wl-inline-list-shell-gap-yï¼šInlineCreateBarã€Slash èœå•ã€quick todo row çš„å£³å±‚è§„èŒƒã€‚"
    guardrails:
      - "`.bookEditor_shell` æ˜¯å”¯ä¸€ row-gap ownerï¼ˆ= --wl-space-block-tightï¼‰ï¼›`.bookEditor_blockItem` margin/padding å‡æ¸…é›¶ã€‚"
      - "List/Todo/Quote çš„é¢å¤–è·ç¦»åªèƒ½é€šè¿‡ `data-kind` + `margin-top: var(--wl-space-*-before/after)` å®ç°ï¼Œä¸å…è®¸ shell token å åŠ é¢å¤– marginã€‚"
      - "æ—§ token `--wl-block-padding-y`ã€`--wl-block-padding-y-dense` æš‚æ—¶ alias åˆ°æ–° tokenï¼›æ£€æµ‹ä¸åˆ°æ—§ååï¼Œåœ¨ä¸‹ä¸€æ¬¡ç‰ˆæœ¬ bump ç§»é™¤ã€‚"
    sandbox:
      - "`/dev/spacing-test` æ–°å¢â€œShell Ã— Rhythm Matrixâ€å¡ç‰‡ï¼Œä¾æ¬¡å±•ç¤º Paragraph â†’ List â†’ Todo â†’ Quote â†’ Inline ç»„åˆï¼ŒQA åªéœ€ DevTools å³å¯éªŒè¯ shell padding ä¸ before/after æ˜¯å¦å»åˆã€‚"
      - "Spacing PR å¿…é¡»é™„ä¸¤å¼ æˆªå›¾ï¼ˆParagraphâ†’Listâ†’Paragraphã€Paragraphâ†’Quoteâ†’Paragraphï¼‰å¹¶è®°å½• token å€¼ä½œä¸ºå›å½’åŸºçº¿ã€‚"
  tokens:
    - "ä»»ä½• CSS è‹¥å¼•ç”¨ --wl-space-section/--wl-space-tightï¼Œå¿…é¡»é€šè¿‡ :root alias æŒ‡å‘æ–°ç‰ˆ --wl-space-block-*ï¼Œå¾… Block Editor å…¨é‡è¿ç§»åæ–¹å¯åˆ å»æ—§åã€‚"
    - "BlockList/DeletedBlocksPanel çš„å±€éƒ¨ ladder å…è®¸å°±åœ°å£°æ˜ fallbackï¼ˆé¿å…ç‹¬ç«‹é¡µé¢ç¼ºå¤± root tokenï¼‰ï¼Œä½†æ•°å€¼å¿…é¡»æ¥è‡ªä¸Šè¿°çŸ©é˜µã€‚"
  rules:
    - "VERTICAL-01ï¼šåªæœ‰ .blockItem + .blockItem { margin-top: var(--wl-space-section|tight) } å¯ä»¥æ§åˆ¶ block è¡Œè·ï¼Œåˆ«çš„ DOM å±‚ç¦æ­¢å†å åŠ  margin/padding/border æ‹‰é«˜åº¦ã€‚"
    - "VERTICAL-02ï¼š.blockItem å†…çš„ p / h1~h6 / ul / ol / li / blockquote / .textBlockShell / .textBlockContent ä¸€å¾‹ margin-block:0ã€padding:0ï¼Œå½»åº•é˜»æ–­ UA é»˜è®¤è¡Œè·ã€‚"
    - "VERTICAL-03ï¼šåˆ†å‰²çº¿/å¼•ç”¨ padding åªå…è®¸è½åœ¨ .blockItem[data-kind] è‡ªå·±çš„ padding ä¸Šï¼›å†…éƒ¨å­èŠ‚ç‚¹ä¸å¾—å·å·æ–°å¢ border/marginã€‚"
    - "VERTICAL-04ï¼šåˆ—è¡¨ç¼©è¿›åªç”¨ padding-left å†™åœ¨ .blockItem ul|ol ä¸Šï¼Œå¹¶ç»‘å®š --wl-list-indentï¼Œli æœ¬èº« margin:0ï¼Œlist-row å¯¹é½ todo-rowã€‚"
    - "VERTICAL-05ï¼šåˆ—è¡¨/å¾…åŠå†…éƒ¨èŠ‚å¥ä¸“ç”± li + li / .todoRow + .todoRow { margin-top: var(--wl-list-item-gap æˆ– --wl-space-inline) } å†³å®šï¼Œç¦æ­¢ block çº§ margin æ¨¡æ‹Ÿâ€œè¡Œé—´è·â€ã€‚"
    - "VERTICAL-06ï¼šParagraph/List/Heading/Todo çš„ç›¸é‚»ç‰¹ä¾‹å…¨éƒ¨é€šè¿‡ data-kind + é‚»æ¥é€‰æ‹©å™¨å£°æ˜ï¼Œåç»­ block æ’ä»¶ä¹Ÿå¿…é¡»åœ¨åŒä¸€å±‚æ–°å¢ caseã€‚"
  debugging_sop:
    steps:
      - "è®¿é—® /dev/spacing-testï¼ˆSpacing Sandboxï¼‰ï¼Œä»å¡ç‰‡ä¸­æŒ‘é€‰å¯¹åº”ç»„åˆï¼Œé¿å…åœ¨çœŸå®ä¹¦ç±é‡Œç›²è°ƒã€‚"
      - "BlockList & DeletedBlocksPanel åœºæ™¯ä¹Ÿåœ¨ sandboxï¼šæ£€æŸ¥ shell gapã€inline gutterã€trash è¡Œå¯†åº¦æ˜¯å¦ä¾èµ– BlockList tokenã€‚"
      - "ç”¨ DevTools é€‰ä¸­è§†è§‰ä¸Šå‡ºç°çš„å¤§ç©ºéš™ï¼ŒæŸ¥çœ‹ Computed â†’ Box Modelï¼Œå¹¶è®°å½•è´¡çŒ®é«˜åº¦çš„ margin/padding/border å±äºå“ªä¸€å±‚ã€‚"
      - "è‹¥é«˜åº¦æ¥æºä¸æ˜¯ .blockItem/.blockItemMain/.todoList/.inlineRowï¼Œåˆ™è§†ä¸ºè¿è§„ï¼Œç«‹å³æŠŠ selector å›æ»šåˆ° token ç³»ç»Ÿã€‚"
      - "å¯¹åˆ—è¡¨/æ ‡é¢˜å¤æŸ¥é»˜è®¤ UA æ ·å¼æ˜¯å¦è¢«è¦†å†™ï¼›è‹¥æµè§ˆå™¨é»˜è®¤ margin ä»åœ¨ç”Ÿæ•ˆï¼Œæ‰©å±• VERTICAL-02 ç™½åå•åå†åœ¨ QuickLog è®°å½•ã€‚"
  implementation_notes:
    - "legacy BlockRenderer ä¸ modules/book-editor å…±ç”¨ bookEditor.module.css tokenï¼ŒSpacing Sandbox ä¹Ÿæ˜¯åŒä¸€ CSSï¼ŒBlockList/Trash é¢„è§ˆç”¨çœŸå®æ¨¡å—ï¼ŒéªŒè¯æˆæœ¬æä½ã€‚"
    - "æ‰€æœ‰ spacing token æ³¨å…¥ editorRoot ä¸Šï¼Œä»»æ„é¡µé¢ï¼ˆåŒ…å« /dev/spacing-testï¼‰éƒ½å¯ä»¥è¯»å–å®æ—¶å€¼ã€‚"
    - "ä»»ä½• block æ’ä»¶æ–°å¢ DOM æ—¶ï¼Œå¿…é¡»åœ¨åŒä¸€æ¬¡ PR é‡Œæ›´æ–° VERTICAL-02 ç™½åå•ã€Spacing Sandbox åœºæ™¯ï¼Œä»¥åŠ QuickLogã€‚"
  status: "Adopted Dec 3, 2025"
  plan154_guardrails:
    summary: "Plan154ï¼ˆDec 6, 2025ï¼‰æŠŠâ€œèŠ‚å¥ owner + å‘½åè¯­æ³• + QA æµç¨‹â€å†™æ­»åœ¨è§†è§„ï¼š"
    owner:
      - "ç»“æ„ä¸‰æ®µï¼šbookEditorShell åªè´Ÿè´£ `--wl-editor-padding-y`ï¼›blockList æ˜¯å”¯ä¸€ row-gap ownerï¼ˆ`row-gap: var(--wl-space-block-tight)` = 2pxï¼‰ï¼›`.blockItem` margin/padding å›ºå®š 0ï¼ŒParagraph/Heading stack ä¸å¾—æ–°åŠ  marginã€‚"
    naming:
      - "æ‰€æœ‰å—é—´è· token ä»¥ `--wl-space-block-*` å‘½åï¼ˆtight/section/list-before/list-after/todo-before/todo-after/quote-before/quote-afterï¼‰ï¼ŒList/Todo before=0pxã€after=2pxï¼ˆ`var(--wl-space-1)`ï¼‰ï¼ŒQuote ä»ä¸º 8pxã€‚Half-step/Primitive åªèƒ½å½“åˆ»åº¦ï¼Œç¦æ­¢ç›´æ¥è½åœ¨ selectorã€‚"
      - "Shell token ç»Ÿä¸€å‰ç¼€ `--wl-*-shell-*`ï¼Œåªèƒ½ç»‘å®š `.blockItemMain` æˆ–æ’ä»¶å†…éƒ¨ padding/indentï¼Œç¦æ­¢å½“æˆ marginã€‚Legacy åç§° `--wl-block-padding-y(-dense)` ä¿æŒ aliasï¼Œä½†åˆ—å…¥é»‘åå•ï¼ŒLint/PR å®¡æŸ¥ç¦æ­¢æ–°ç”¨ã€‚"
    qa_flow:
      - "Spacing PR é™„å¸¦ `/dev/spacing-test` ShellÃ—Rhythm å¡ç‰‡çš„ â€œRhythm: â€¦ / Shell: â€¦â€ readoutï¼Œå¹¶ä¸Šä¼  Paragraphâ†’Listâ†’Paragraphï¼‹Paragraphâ†’Quoteâ†’Paragraph æˆªå›¾ï¼›ç¼ºå°‘ä»»æ„ä¸€æ­¥ reviewer å¯ç›´æ¥é€€å›ã€‚"
      - "QuickLog & ADR-141 è®°å½• before=0/after=2 çš„å›ºå®šæ•°å€¼ä»¥åŠ lint é»‘åå•ï¼Œé˜²æ­¢ spacing éœ€æ±‚ç»•é“ Domain/UseCaseã€‚"
  plan155a_guardrails:
    summary: "Plan155Aï¼ˆDec 3, 2025ï¼‰æŠŠåˆ—è¡¨/å¾…åŠæŠ–åŠ¨æ ¹å› ï¼ˆrow-gap ä¸ before/after å åŠ  + è¡Œé«˜ä¸ä¸€è‡´ï¼‰å†™æˆè§†è§‰å±‚æ’ç­‰å¼ï¼Œå¹¶æä¾› /dev/spacing-test Jitter Guard å¡ç‰‡åšå®æ—¶éªŒè¯ã€‚"
    invariants:
      - "LIST-ENTRY â‰¥ 0ï¼šBlockList row-gap ä»ç”± `--wl-space-block-tight` æ§åˆ¶ï¼Œåˆ—è¡¨è¿›å…¥ token åªèƒ½ä½¿ç”¨ `--wl-space-block-list-before`ã€‚æ–°å¢çš„ `--wl-space-block-list-before-safe-min` æ’ç­‰äº `-1 * --wl-space-block-tight`ï¼Œæ‰€æœ‰ before/after è®¡ç®—å¿…é¡»å¼•ç”¨è¿™ä¸¤ä¸ª tokenï¼Œç¦æ­¢åœ¨ç»„ä»¶é‡Œæ‰‹å†™ `calc(-2px + 2px)`ã€‚"
      - "LIST-EXIT â‰¥ 0ï¼šç¦»å¼€åˆ—è¡¨çš„ `--wl-space-block-list-after` ä¸å¾—è¢«è¦†ç›–ä¸ºè£¸æ•°å­—ï¼›Todo/åˆ—è¡¨å‡ºå£ç»Ÿä¸€ 2pxï¼ˆ`var(--wl-space-1)`ï¼‰ï¼Œä¸”å¿…é¡»ç¡®ä¿ row-gap + after â‰¥ 0ï¼Œå¦åˆ™ Guard å¡ç‰‡ä¼šç«‹åˆ»å˜çº¢ã€‚"
      - "LINE-HEIGHT PARITYï¼š`.inlineEditorText`ã€`.todoRow`ã€`.todoInput` ç»Ÿä¸€ç»‘å®š `--wl-line-height-list`ï¼ŒDisplay/Editor ä¸¤ä¾§éƒ½è¯»è¿™ä¸€ä¸ª tokenï¼›ä»»ä½•ä¸€æ–¹å›é€€åˆ° `--wl-line-height-tight` éƒ½ä¼šåœ¨ Guard å¡ç‰‡ä¸Šæ˜¾ç¤º â€œNeeds attentionâ€ã€‚"
    implementation:
      - "Token å®šä¹‰æ”¾åœ¨ `frontend/src/modules/book-editor/ui/bookEditor.module.css` é¡¶éƒ¨ï¼šsafe-min = negative tightï¼Œbefore/after = 0/2px åˆ«åï¼Œline-height alias æŒ‡å‘ `--wl-line-height-tight`ã€‚åœ¨ä»»ä½• PR é‡Œä¿®æ”¹ token æ—¶å¿…é¡»å…ˆæ›´æ–°æ­¤æ–‡ä»¶ã€‚"
      - "`.inlineEditorText`ã€`.todoList .todoRow`ã€`.todoList .todoInput` ç»Ÿä¸€æ”¹ç”¨ `line-height: var(--wl-line-height-list)`ï¼›`.blockItem[data-kind='list_*|todo_list']` çš„ before/after ä»…å¼•ç”¨ block-space tokenï¼Œä¸å¾—å†æºæ‚ marginã€‚"
      - "Spacing Sandboxï¼š`frontend/src/app/dev/spacing-test/page.tsx` å¢åŠ  Plan155A Guardrails å¡ç‰‡ï¼Œç›´æ¥ä» stylesheet è¯»å– token å¹¶è®¡ç®— row-gap + before/afterã€Display vs Edit è¡Œé«˜å·®ï¼›ä¿®æ”¹ token æ—¶è‹¥æœªæ›´æ–°å¡ç‰‡æ–‡æ¡ˆæˆ–æ¸²æŸ“é€»è¾‘ï¼Œreviewer å¯ä»¥ç›´æ¥é©³å›ã€‚"
    qa_flow:
      - "Spacing ç›¸å…³ PR é™„ä¸‰å¼ æˆªå›¾ï¼šShellÃ—Rhythm Matrixã€Paragraphâ†’Listâ†’Paragraphã€Jitter Guard å¡ç‰‡ï¼ˆSafe çŠ¶æ€ï¼‰ã€‚å¡ç‰‡æˆªå›¾å¿…é¡»éœ²å‡º row-gap + before/after æ•°å€¼ï¼Œæ–¹ä¾¿åç»­ diffã€‚"
      - "å†’çƒŸï¼šåœ¨çœŸå®ä¹¦é¡µé¢æ’å…¥ Paragraphâ†’Listâ†’Paragraphã€Paragraphâ†’Todoâ†’Paragraphï¼Œåˆ‡æ¢ç¼–è¾‘/é˜…è¯»æ¨¡å¼ç¡®è®¤é«˜åº¦ä¸è·³ï¼›è‹¥ Guard å¡ç‰‡æ˜¾ç¤º Safe ä½†ç°åœºä»æŠ–åŠ¨ï¼Œå¿…é¡»å›åˆ° token / selectors æŸ¥æ‰¾å¦ä¸€ä¸ª margin sourceã€‚"
      - "å›å½’ï¼šä»»ä½•å‘½ä¸­ Guard å¡ç‰‡â€œNeeds attentionâ€çš„ PR ä¸€å¾‹ç¦æ­¢åˆå¹¶ï¼›ä¿®å¤å®Œæˆååœ¨ QuickLog è®°å½• token æ”¹åŠ¨ä¸æˆªå›¾ã€‚"
    artifacts:
      - "VISUAL_RULES + HEXAGONAL_RULES + ADR-142 éœ€åŒæ­¥æè¿°â€œrow-gap + before/after â‰¥ 0â€ä¸â€œåˆ—è¡¨ display/edit è¡Œé«˜ä¸€è‡´â€ä¸¤ä¸ªæ’ç­‰å¼ï¼›QuickLog Plan155A æ¡ç›®è®°å½•æ¯æ¬¡ token æˆ– QA å˜æ›´ã€‚"
      - "Spacing Sandbox å¯¼èˆªæ·»åŠ â€œPlan155A Guardrailsâ€é”šç‚¹ï¼Œæ–¹ä¾¿ QA ç›´æ¥å®šä½å¡ç‰‡ã€‚"
    status: "Adopted Dec 3, 2025"

  plan156a_list_bridge:
    summary: "Plan156Aï¼ˆDec 3, 2025ï¼‰åœ¨ jitter Guard ä¹‹ä¸Šï¼ŒæŠŠåˆ—è¡¨è¡Œè·/æ¡¥æ¥ä¸ Todo å®Œå…¨è§£ç»‘ï¼Œå¹¶è§„èŒƒâ€œç©ºè¡Œ Enter é€€å‡ºåˆ—è¡¨â€è§†è§‰æµç¨‹ã€‚"
    tokens:
      - "æ¡¥æ¥ï¼š`--wl-space-block-list-before=0px`ã€`--wl-space-block-list-after=var(--wl-space-2)`ã€‚ä»»ä½•â€œåˆ—è¡¨æ›´è´´è¿‘æ®µè½â€çš„éœ€æ±‚éƒ½å¿…é¡»ä¿®æ”¹ token å¹¶æ›´æ–° Guard å¡ç‰‡ï¼Œç»ä¸åœ¨ selector é‡Œå†™è£¸æ•°ã€‚"
      - "è¡Œè·ï¼š`--wl-list-item-gap = var(--wl-space-2)` ç°åœ¨åŒæ—¶é©±åŠ¨ `.listBlock` ä¸ todo è¡Œï¼›`--wl-todo-item-gap` å›ºå®š alias æŒ‡å‘è¯¥ tokenï¼Œè‹¥æœªæ¥éœ€è¦è„±é’©å¿…é¡»åœ¨ QuickLog è¯´æ˜åŸå›  + æˆªå›¾ã€‚"
      - "å£³å±‚ï¼šListDisplay/ListEditor ç»§ç»­å¥—ç”¨ `.todoList`ï¼ˆç»§æ‰¿ shell paddingï¼‰+ `.listBlock`ï¼ˆè¦†ç›– gapï¼‰ï¼Œå› æ­¤è¡Œè·å˜åŒ–åªéœ€è§¦ç¢°å•ä¸ª tokenã€‚"
    layout_rules:
      - "åˆ—è¡¨ display ä¸ inline row å…±äº« `.inlineRow + .inlineMarker + .inlineEditorText` ç»„åˆï¼Œç¡®ä¿ marker å¯¹é½ã€è¡Œé«˜/row gap ä¸ Todo è¡Œä¿æŒ parityã€‚"
      - "Paragraph â†’ List â†’ Paragraph ä¸ Paragraph â†’ Ordered List â†’ Paragraph åœºæ™¯ï¼Œå‰åæ¡¥æ¥éƒ½ç­‰äºä¸Šè¿° before/after tokenï¼ŒSpacing Sandbox éœ€è¿½åŠ æˆªå›¾ã€‚"
      - "ListDisplay ç©ºæ€åªæ¸²æŸ“ placeholder æ–‡æ¡ˆï¼Œä¸å…è®¸å†å †é¢å¤– paddingï¼›ç‚¹å‡»ä»»æ„ä½ç½®è¿›å…¥ç¼–è¾‘ä»¥é¿å…â€œç©ºåˆ—è¡¨é«˜åº¦â€ä¸æ®µè½ä¸åŒã€‚"
    interactions:
      - "`Enter` åœ¨ç©ºåˆ—è¡¨æœ€åä¸€è¡Œæ—¶é€€å‡ºç¼–è¾‘ï¼Œåˆ›å»ºæ ‡å‡† paragraph blockï¼ˆç»§æ‰¿ Paragraph shell + row-gapï¼‰ï¼Œå¹¶åˆ é™¤ç©ºåˆ—è¡¨ï¼›åŠ¨æ•ˆä¸Šè¡¨ç°ä¸ºè¡Œè·å›åˆ°æ®µè½èŠ‚å¥ï¼Œæ²¡æœ‰é¢å¤–è·³è·ƒã€‚"
      - "Markdownï¼š`1.`/`1)` + ç©ºæ ¼åˆ‡æ¢ä¸º numbered listï¼›`- [ ]`/`- [x]` + ç©ºæ ¼åˆ‡æ¢ä¸º todoã€‚è§¦å‘åç«‹å³æ¸…ç©ºé”®å…¥å†…å®¹å¹¶ä»¥ inline shell æ’‘å¼€æ–°åˆ—è¡¨ï¼Œé˜²æ­¢ caret æŠ–åŠ¨ã€‚"
    qa_flow:
      - "Spacing PR å¿…é¡»åŒæ—¶é™„ Paragraphâ†’Ordered Listâ†’Paragraph ä¸ Paragraphâ†’Bulleted Listâ†’Paragraph æˆªå›¾ï¼Œå¹¶åœ¨å¡ç‰‡ä¸­å±•ç¤º `--wl-list-item-gap` + before/after æ•°å€¼ã€‚"
      - "å‡ºåˆ—è¡¨åŠ¨æ•ˆéœ€å½•å±ï¼ˆæˆ–è‡³å°‘ GIFï¼‰è¯æ˜ç©ºè¡Œ Enter ä¼šç¬é—´è½åœ¨æ–°æ®µè½è€Œæ— åŒå€ gapï¼›QA è‹¥è§‚å¯Ÿåˆ°é¢å¤– 4px ä»¥ä¸Šè·³è·ƒï¼Œå¯ç›´æ¥å¼•ç”¨æœ¬ç­–ç•¥é€€å›ã€‚"
    status: "Adopted Dec 3, 2025"

block_editor_cursor_stability:
  adr_reference: "ADR-135-block-editor-cursor-stability.md"
  summary: "Plan142A/Bï¼ˆDec 2, 2025ï¼‰ä¸º paragraph/heading inline ç¼–è¾‘è½åœ° BlockEditorCore + selectionStoreï¼šè¾“å…¥é˜¶æ®µ DOM æ‰¿æ‹…çœŸç›¸ï¼Œç»“æ„æ“ä½œé€šè¿‡ command intent æ¢å¤å…‰æ ‡ã€‚"
  components:
    block_editor_core: "frontend/src/modules/book-editor/ui/BlockEditorCore.tsxï¼šå”¯ä¸€ contentEditable å†…æ ¸ï¼Œkey=blockIdï¼Œè´Ÿè´£è‡ªåŠ¨èšç„¦/placeholder/data-readonlyã€‚"
    selection_store: "frontend/src/modules/book-editor/model/selectionStore.tsï¼šä»…æ¥å— source='command' çš„ caret intentï¼ŒSelectionManager åœ¨ BookEditorRoot é‡Œç›‘å¬å¹¶è°ƒç”¨ registry handleã€‚"
  rules:
    - "CURSOR-01ï¼šParagraph/Heading/Todo inline shell å¿…é¡»æ¸²æŸ“å•ä¸ª BlockEditorCoreï¼Œview/edit é€šè¿‡ data-readonly åˆ‡æ¢ï¼›ç¦æ­¢åœ¨ editing çŠ¶æ€ä¸‹å¸è½½/é‡å»º DOMã€‚"
    - "CURSOR-02ï¼šè¾“å…¥é˜¶æ®µ BlockEditorCore åªæ›´æ–°è‡ªèº« innerTextï¼ŒReact ä¾§é€šè¿‡ onImmediateChange + 300ms flush ä¿å­˜ï¼›ä»»ä½• onChangeâ†’setState ä¸å¾—åœ¨ keydown ä¸­å›å†™ DOMã€‚"
    - "CURSOR-03ï¼šInline æ¨¡å¼çš„ä¿å­˜/é€€å‡ºåªèƒ½åˆ‡æ¢ readOnly/data-stateï¼Œä¸å¾—åˆ‡æ¢ç»„ä»¶ keyï¼›Plan121/Plan130 çš„â€œåŒ DOM æ˜¾ç¤º/ç¼–è¾‘â€è¦æ±‚ä¿æŒç”Ÿæ•ˆã€‚"
    - "CURSOR-04ï¼šBackspace åˆ é™¤ç©º blockã€Enter æ–°å»º blockã€Inline ä¿å­˜åâ€œç»§ç»­å†™â€éƒ½éœ€åœ¨ command å‰è°ƒç”¨ requestSelectionEdgeï¼Œç­‰å¾… SelectionManager æ¢å¤ caretã€‚"
    - "CURSOR-05ï¼šselectionStore åªèƒ½æ¥å— source='command'ï¼›ç”¨æˆ·ç‚¹å‡»/é€‰ä¸­ä¸ä¼šå†™å…¥ storeï¼Œé¿å… effect æŠ¹æ‰äººå·¥ selectionã€‚"
    - "CURSOR-06ï¼šAutosave æˆåŠŸåä»…é€šè¿‡ BlockEditorContext åˆå¹¶å½“å‰ blockï¼Œç¦æ­¢è°ƒç”¨ invalidateQueries é‡åˆ·æ•´ä¸ªåˆ—è¡¨ï¼Œä»¥å…é‡æ–°æŒ‚è½½é€ æˆå…‰æ ‡å¼¹è·³ã€‚"
    - "CURSOR-07ï¼šSelectionManager åœ¨æ‰§è¡Œå‘½ä»¤ intent å‰å¿…é¡»è¯» BlockEditorCore.getCaretOffset()ï¼Œè‹¥ DOM caret å·²ç­‰äºç›®æ ‡ offsetï¼ˆå« edgeâ†’0/lengthï¼‰ï¼Œç›´æ¥ consume tokenï¼Œæœç»é‡å¤ setSelection é€ æˆäººçœ¼å¯è§çš„æ‰«åŠ¨ã€‚"
    - "CURSOR-08ï¼šBlockEditorCore.placeCaretAtOffset éœ€è¦éå†çœŸå® text node å¹¶åœ¨ç©º block æ—¶æ’å…¥ä¸´æ—¶ text nodeï¼Œç„¶åä¸€æ¬¡ range.setStart(node,offset)+range.collapse(true) å®Œæˆå®šä½ï¼›ç¦æ­¢ä½¿ç”¨â€œå…ˆé€‰ 0â†’offset å† collapseâ€ä¸¤æ®µå¼èŒƒå›´ã€‚"
    - "CURSOR-09ï¼šBlockItem/onMouseDown åªæœ‰åœ¨ç‚¹å‡»å£³å±‚æˆ– toolbar ç©ºç™½åŒºåŸŸæ—¶æ‰è°ƒç”¨ focusCaretFromPointï¼ˆcaretRangeFromPoint/caretPositionFromPoint polyfillï¼‰ï¼Œæ™®é€šç‚¹å‡»å¿…é¡»äº¤ç»™æµè§ˆå™¨æœ¬èº«ï¼›ä»»ä½• preventDefault+æ‰‹åŠ¨ focusAtEdge çš„æ—§é€»è¾‘ä¸€å¾‹åˆ é™¤ã€‚"
    - "CURSOR-10ï¼šPlan157A å¼•å…¥ focusIntentStoreï¼ˆpointer/keyboard/command/autoï¼‰ï¼›pointer intent åªèƒ½ç”± BlockItem/BlockEditorCore åœ¨ onMouseDownCapture è®¾ç½®ï¼Œä¸”ä¸€æ—¦æ£€æµ‹åˆ° pointer intentï¼ŒBlockEditorCore/ParagraphEditor ä¸å¾—è¿è¡Œä»»ä½• placeCaret/focusPosition é€»è¾‘ï¼Œselection å®Œå…¨äº¤ç»™æµè§ˆå™¨ã€‚"
    - "CURSOR-11ï¼šé”®ç›˜/auto intent å¿…é¡»åœ¨ BlockList/BookEditorRoot/åˆ—è¡¨å†…éƒ¨å¯¼èˆªæ—¶è®¾ç½®ï¼Œå¹¶é€šè¿‡ BlockEditorCore çš„ effect æ¶ˆè´¹ï¼›ListBlock/TodoListBlock åªæ’é˜Ÿ pending focusï¼Œä¸å¾—å†è°ƒç”¨ requestAnimationFrame + setSelection è¿™ç±» DOM æ“ä½œã€‚"
    - "CURSOR-12ï¼šblockCommands åœ¨ create/delete/transform æ—¶åŒæ­¥å†™å…¥ announceFocusIntent('command',targetId) + requestSelectionEdge(...)ï¼›é™¤è¯¥é“¾è·¯å¤–ï¼Œä»»ä½•ç»„ä»¶å¼•ç”¨ selectionStore/intent helper éƒ½è§†ä¸ºè¿è§„ï¼ŒESLint `selection-command-scope` ä¼šé˜»æ­¢å¯¼å…¥ã€‚"
    - "2025-10-29ï¼šBlockEditorCore.tsx å¼•å…¥ blockVersionRef å®ˆå«ï¼ˆä»…åœ¨ blockId å˜åŒ–æ—¶é‡å†™ DOMï¼‰+ ESLint selection-command-scope è§„åˆ™ï¼Œå½¢æˆâ€œè¾“å…¥â†’DOMã€å‘½ä»¤â†’selectionã€ä¿å­˜â†’æ•°æ®â€ä¸‰è·¯ç¡¬éš”ç¦»ã€‚"
  debugging_sop:
    - "æ£€æŸ¥ contentEditable æ˜¯å¦ä»…å‡ºç°ä¸€æ¬¡ï¼šDevTools Elements æœç´¢ blockIdï¼Œç¡®è®¤ .textBlockContent æ²¡æœ‰å¤šå®ä¾‹ã€‚"
    - "æ‰§è¡Œâ€œè¿ç»­è¾“å…¥ + blurâ€éªŒè¯ï¼šDOM innerText æ”¹å˜å `draftRef` 300ms å†…å†™å›ï¼ŒAutosave è®¢å•åªè§¦å‘ä¸€æ¬¡ã€‚"
    - "è§¦å‘ Backspace åˆ é™¤ç©ºæ®µï¼šè§‚å¯Ÿ SelectionManager æ˜¯å¦æœ€ç»ˆæŠŠ caret æ”¾åˆ°ä¸Šä¸€æ®µæœ«å°¾ï¼›è‹¥å¤±è´¥ï¼Œæ£€æŸ¥ registry æ˜¯å¦ç¼ºå¤± blockIdã€‚"
  implementation_notes:
    - "BlockItem.tsx è´Ÿè´£åœ¨ onDeleteEmptyBlock å‰å†™å…¥ requestSelectionEdgeï¼Œå¹¶ä¿æŒä¸ legacy BlockRenderer è¡Œä¸ºä¸€è‡´ã€‚"
    - "BlockEditorCore æ³¨å†Œ handle æ—¶åŠ¡å¿…è°ƒç”¨ registerBlockEditorHandle(blockId)ï¼Œå¦åˆ™ selectionStore æ— æ³•æ¢å¤ caretã€‚"
  status: "Adopted Dec 2, 2025"

block_renderer_plan77_v1:
  summary: "Plan77 Phase v1ï¼šBlockRenderer/Display/Editor ä»¥ paragraph kind ä¸ºå”¯ä¸€å®ç°ï¼Œä½†ç»“æ„åŒ–æ‰€æœ‰ BlockKind æµç¨‹ã€‚"
  scope:
    - "Book Detail â†’ Blocks Tabï¼ˆ/admin/books/{bookId}#blocksï¼‰"
    - "InlineCreateBar + BlockList + BlockRenderer ç»„åˆ"
  references:
    plan: "assets/docs/QuickLog/D39-45- WordloomDev/archived/Plan_77_BlockTypes+++.md"
    adr: "ADR-080-block-editor-integration-rich-block-types-media-plugin-architecture.md"
  renderer_stack:

block_editor_plan120_refinement:
  summary: "Plan120ï¼ˆDec 1, 2025ï¼‰å®Œæˆ BlockList inline ç¼–è¾‘ä½“éªŒæ”¶å°¾ï¼šçº¸å¼ å®¹å™¨ã€æ ‡é¢˜/æ®µè½é—´è·ã€Inline + è¡Œé—´æŒ‰é’®å¼±åŒ–ã€Slash èœå•æè¿°ã€Heading Enter æ’å…¥éµå¾ªæ–‡æ¡£ä¹ æƒ¯ã€‚"
  layout_rules:
    - "BlockList å¤–å±‚ä¿æŒ 24px Ã— 40px padding + ä¸ç»¸çº¸å¼ é˜´å½±ï¼›å—é—´è·ç»Ÿä¸€ 6pxï¼Œç¬¬ä¸€ä¸ª block å»æ‰é¢å¤– marginã€‚"
    - "Hover/Editing æ‰æ˜¾ç¤ºæµ…è‰²èƒŒæ™¯å’Œåº•çº¿ï¼Œå¸¸é©»åˆ†éš”çº¿è¢«ç§»é™¤ï¼›Inline æ’å…¥æŒ‰é’®ä»…åœ¨ hover/focus æ—¶æ˜¾ç°ã€‚"
    - "æ®µè½ textarea ä¸å†æœ‰é»˜è®¤ä¸‹åˆ’çº¿ï¼Œç„¦ç‚¹æç¤ºç”± block èƒŒæ™¯è´Ÿè´£ï¼Œé¿å…æˆªå›¾ä¸­çš„æ¨ªçº¿ã€‚"
    - "H1/H2/H3 line-height ä¸ margin ä¾æ–‡æ¡£ï¼š1.5/1.5/1.6 ä¸ 12px/10px/8pxï¼›æ ‡é¢˜ä¸ä¸‹ä¸€æ®µè·ç¦»å°äºä¸Šä¸€æ®µã€‚"
  interaction_rules:
    - "Slash èœå•æ¡ç›®æ¢å¤åŒè¡Œå¸ƒå±€ï¼ˆlabel + descriptionï¼‰ï¼Œç©ºæ€æç¤ºç»Ÿä¸€ä¸ºç°è‰²æ–‡æ¡ˆã€‚"
    - "Enter åœ¨ heading å°¾éƒ¨ä»åˆ›å»º paragraphï¼Œç¬¦åˆâ€œç« èŠ‚æ ‡é¢˜åé»˜è®¤æ­£æ–‡â€è¦æ±‚ã€‚"
    - "Inline â€œ+ æ·»åŠ ä¸€æ®µæ–‡å­—â€ ä»ä½œä¸ºä¸»è¦ CTAï¼Œä½† slash/inline æ’å…¥éƒ½æ˜¯å¢å¼ºè€Œéå”¯ä¸€è·¯å¾„ã€‚"
  status: "Adopted Dec 1, 2025"
    - "BlockRendererï¼šå†³å®šå±•ç¤ºæ€è¿˜æ˜¯ç¼–è¾‘æ€ï¼Œè·¯ç”±åˆ° BlockDisplay æˆ– BlockEditorã€‚"
    - "BlockDisplayï¼šæ¸²æŸ“é˜…è¯»æ€æ®µè½ï¼Œhover ä¸ focus æ˜¾ç¤ºå·¥å…·æ¡ã€‚"
    - "BlockEditorï¼šæ¸²æŸ“ textarea ç¼–è¾‘å™¨ï¼Œå¤ç”¨ Plan80/82 ä¿å­˜/å–æ¶ˆäº¤äº’ã€‚"
    - "Paragraph å­ç»„ä»¶ï¼šå”¯ä¸€è½åœ°å®ç°ï¼Œæœªæ¥ v1.5 é€šè¿‡åŒä¸€å…¥å£æ‰©å±• heading/list ç­‰ã€‚"
  paragraph_display_rules:
    - "è§†è§‰è¯­è¨€æ”¹ä¸º Word é£æ ¼çš„é€æ˜çº¸å¼ ï¼Œæ¯è¡ŒåŒ…è£¹åœ¨ <p>ï¼Œç©ºè¡Œç”¨ `\u00A0` å ä½ã€‚"
    - "ç‚¹å‡»æ•´æ®µæˆ–æŒ‰ Enter/Space åˆ‡æ¢åˆ°ç¼–è¾‘æ€ï¼›TabFocus=0 ä¿éšœå¯è®¿é—®æ€§ã€‚"
    - "é˜…è¯»æ€é»˜è®¤éšè—å·¥å…·æ¡ï¼›hover æˆ–ç¼–è¾‘æ€å°† toolbar opacity è®¾ä¸º 1ã€‚"
  paragraph_editor_rules:
    - "ç¼–è¾‘åŒºä¸º textareaï¼ŒautoFocusï¼Œä¿ç•™ Ctrl/Cmd+S ä¿å­˜ã€Esc å–æ¶ˆã€blur è‡ªåŠ¨ä¿å­˜ã€‚"
    - "å–æ¶ˆç¼–è¾‘æ—¶å›æ»šåˆ° lastSavedRefï¼Œå¹¶ä¿æŒé˜…è¯»æ€å€¼ä¸ textarea å€¼ä¸€è‡´ã€‚"
    - "ä¿å­˜æˆåŠŸåé€€å‡ºç¼–è¾‘æ€ï¼ˆsetEditingBlockId(null)ï¼‰ã€‚"
  toolbar_and_timestamps:
    - "Clock3 + 'æ›´æ–° Â· ç›¸å¯¹æ—¶é—´' æ–‡æ¡ˆå›ºå®šåœ¨å³ä¸Šè§’ï¼Œtooltip å±•ç¤º created/updated ç²¾ç¡®æ—¶é—´ã€‚"
    - "Trash2 ä»…åœ¨å…è®¸åˆ é™¤æ—¶æ¸²æŸ“ï¼›ç‚¹å‡»åæ²¿ç”¨ confirm æç¤ºã€‚"
  creation_and_layout:
    - "åˆ—è¡¨ç©ºæ€æä¾› CTAï¼š+ æ·»åŠ ä¸€æ®µæ–‡å­— â†’ CreateBlock(kind='paragraph') â†’ setEditingBlockId(newId)ã€‚"
    - "åˆ—è¡¨åº•éƒ¨ä¿ç•™æ·¡è‰²è¿½åŠ æŒ‰é’®ï¼›ä»…å½“å­˜åœ¨ blocks æ—¶æ˜¾ç¤ºã€‚"
  future_hooks:
    - "BlockRenderer/BlockDisplay/BlockEditor é¢„ç•™ switch casesï¼ˆheading/list/todo/code/quote/...ï¼‰ï¼Œv1 ä»…å®ç° paragraphã€‚"
    - "BlockRenderer Prop `block` å§‹ç»ˆä¸º BlockDtoï¼ˆcontent å·²è§£æä¸º JSONï¼‰ï¼Œé¿å… UI è‡ªè¡Œè§£æå­—ç¬¦ä¸²ã€‚"
  status: "Adopted Nov 27, 2025"

block_editor_plan126_keyboard_visuals:
  summary: "Plan126ï¼ˆDec 4, 2025ï¼‰çº¦æŸ Enter/Backspace ç‰ˆå¼ä¸ inline actions å‘ˆç°æ–¹å¼ï¼Œç¡®ä¿â€œé”®ç›˜ä¼˜å…ˆâ€ä½“éªŒä¸å¼•å…¥é¢å¤–è§†è§‰å™ªéŸ³ã€‚"
  spacing_rules:
    - "Paragraph/Heading Enter åçš„æ–°æ®µè½ä¸ä¸Šä¸€æ®µçš„é—´è·å›ºå®š 8pxï¼Œç¦æ­¢å‡ºç°åŒå€è¡Œè·ï¼›æ¸²æŸ“æ—¶ç«‹å³æ’å…¥é»˜è®¤å ä½ç¬¦æ–‡æ¡ˆ \u00A0 ä»¥é¿å… cursor æŠ˜è¡Œã€‚"
    - "Shift+Enter åœ¨ block å†…æ¸²æŸ“è½¯æ¢è¡Œï¼Œä½¿ç”¨ line-height ç»§æ‰¿å€¼ï¼Œä¸é¢å¤–æ·»åŠ  marginï¼›å¯è§†ç»“æœä¸è¿æ‰“ç©ºæ ¼ä¿æŒä¸€è‡´ã€‚"
  deletion_rules:
    - "Backspace åˆ é™¤ç©º block æ—¶é‡‡ç”¨ä¸æ»‘æ·¡å‡ºï¼ˆ120ms opacityï¼‰å¹¶ç«‹åˆ»èšç„¦ä¸Šä¸€æ®µï¼Œé˜²æ­¢ cursor è¿·å¤±ï¼›å¤šæ®µåˆå¹¶å¿…é¡»ä¿ç•™å•ä¸€ caret indicatorã€‚"
    - "å½“æ®µè½åˆå¹¶å¯¼è‡´æ–‡æœ¬è¿‡é•¿æ—¶ï¼ŒAutoSizeTextarea æœ€å¤§é«˜åº¦ä»ä¸º 3 è¡Œï¼Œæº¢å‡ºäº¤ç»™æ»šåŠ¨æ¡ï¼›ç¦æ­¢å› ä¸º Backspace åˆå¹¶å°±æ‹“å®½ç”»å¸ƒã€‚"
  inline_actions:
    - "Inline toolbar ä»…éœ²å‡º comment / promote / convert ä¸‰ä¸ªæŒ‰é’®ï¼Œicon ç»Ÿä¸€ 16px + æŸ”å’Œæè¾¹ï¼›å…¶å®ƒæ“ä½œæ²‰å…¥ block menuï¼Œé¿å…æ¨ªå‘ä½ç§»ã€‚"
    - "Toolbar è§¦å‘æ¡ä»¶ï¼šhover æˆ–ç¼–è¾‘æ€ 150ms å»¶è¿Ÿæ·¡å…¥ï¼Œå¤±ç„¦ 200ms æ·¡å‡ºï¼›é”®ç›˜ç”¨æˆ·å¯é€šè¿‡ Alt+/ å”¤èµ·èœå•ï¼Œæ— éœ€è§†è§‰å¸¸é©»ã€‚"
    - "è‹¥ block å¤„äº readonly/legacy çŠ¶æ€ï¼ŒToolbar ç›´æ¥éšè—å¹¶æ˜¾ç¤º tooltip 'ä»…æ‰€æœ‰è€…å¯ç¼–è¾‘'ï¼Œé˜²æ­¢ç©ºæŒ‰é’®è¯¯å¯¼ã€‚"
  qa_notes:
    - "æˆªå›¾æ¯”å¯¹éœ€è¦†ç›– Enterâ†’æ–°æ®µè½ã€Shift+Enterâ†’è½¯æ¢è¡Œã€Backspaceâ†’åˆ é™¤æ®µè½ä¸‰æ¡è·¯å¾„ï¼›å·®å¼‚å³å›å½’ã€‚"
    - "é”®ç›˜å½•å±éœ€éªŒè¯ inline toolbar ä¸é®æŒ¡å½“å‰è¡Œï¼Œå¿…è¦æ—¶è‡ªåŠ¨é¿è®©è‡³æ®µè½å³ä¸Šè§’ã€‚"
  status: "Adopted Dec 4, 2025"

block_editor_plan161a_soft_break_visuals:
  summary: "Plan161Aï¼ˆDec 4, 2025ï¼‰ç»Ÿä¸€ Paragraph/List/Todo çš„è½¯æ¢è¡Œå‘ˆç°ï¼šShift+Enter åœ¨ç¼–è¾‘æ€å†™å…¥ `<br>`ï¼Œä¿å­˜åä»¥å­—ç¬¦ä¸²ä¸­çš„ `\n` æ¸²æŸ“ï¼Œé˜…è¯»æ€ä¾èµ– `white-space: pre-wrap` ä¿æŒè§†è§‰ä¸€è‡´ã€‚"
  rendering_rules:
    - "`.textBlockContent`ã€`.todoText`ã€`.blockDisplay[data-kind='heading|paragraph|list_*|todo_list']` å…¨éƒ¨æ·»åŠ  `white-space: pre-wrap`ï¼Œå¤šç©ºæ ¼ä»ç„¶å‹ç¼©ä½† `\n` è¢«è§†ä¸ºè½¯æ¢è¡Œï¼›ä¸¥ç¦åœ¨é˜…è¯»æ€æ‰‹åŠ¨æ’å…¥ `<br>`ã€‚"
    - "List/Todo è¡Œå†…å£³å±‚æ²¿ç”¨ Plan137/Plan155A tokenï¼Œè½¯æ¢è¡Œåªèƒ½æ”¹å˜è¡Œå†…æ–‡æœ¬å¸ƒå±€ï¼Œä¸å¾—æ’‘å¼€ `.inlineRow` é«˜åº¦æˆ–ç ´å baselineï¼›è‹¥éœ€è¦é¢å¤–æ®µé—´è·å¿…é¡»å›åˆ° spacing tokenã€‚"
  editor_rules:
    - "BlockEditorCore ç›´æ¥æ¸²æŸ“å­—ç¬¦ä¸² childrenï¼ˆä¸æ‹¼ HTMLï¼‰ï¼ŒShift+Enter ç•™ç»™æµè§ˆå™¨æ’å…¥ `<br>`ï¼›è¾“å…¥äº‹ä»¶äº¤ç”± `extractInlineTextFromEditable` å°† `<br>` â†’ `\n` å¹¶ `trimEnd()`ï¼Œç¦æ­¢è‡ªå®šä¹‰ `innerHTML` æ‹¼æ¥ã€‚"
    - "`keyboard.ts` ä¸­çš„ Shift+Enter handler ä»…è´Ÿè´£ `onSoftBreak?.()` å›è°ƒï¼Œé»˜è®¤å…è®¸æµè§ˆå™¨æ’å…¥ `<br>`ï¼›BlockItem çš„è½¯æ¢è¡Œé’©å­ä¿æŒ no-opï¼Œé¿å…äºŒæ¬¡æ’å…¥æ–‡æœ¬èŠ‚ç‚¹ã€‚"
  qa_notes:
    - "Regression checklistï¼šParagraph/List/Todo è¾“å…¥ â€œè¡Œ1 + Shift+Enter + è¡Œ2â€ï¼Œä¿å­˜ + åˆ·æ–°/é‡æ–°è¿›å…¥ç¼–è¾‘éƒ½å¿…é¡»çœ‹åˆ°ä¸¤è¡Œä¸” caret ä¿ç•™ï¼›è‹¥å‘ç°æ¢è¡Œä¸¢å¤±ï¼Œéœ€å›æŸ¥ helper ä¸ CSS æ˜¯å¦ä»æ»¡è¶³æ­¤ç­–ç•¥ã€‚"
    - "Storybook/Chromatic éœ€è®°å½•åŒè¡Œæ®µè½æˆªå›¾ï¼Œå¹¶åœ¨ diff å®¡æŸ¥ä¸­ç¡®è®¤ `white-space: pre-wrap` æœªè¢«å›é€€ï¼›Playwright åœºæ™¯åŒ…å« Shift+Enter å½•å±ã€‚"
  status: "Adopted Dec 4, 2025"

block_editor_plan171a_inline_soft_break:
  summary: "Plan171Aï¼ˆDec 5, 2025ï¼‰æŠŠ Shift+Enter é‡æ–°é”å®šåœ¨ inline å‘½ä»¤ç®¡çº¿ï¼šParagraph/List/Todo åªåœ¨å½“å‰å—æ–‡æœ¬é‡Œå†™å…¥ `\n`ï¼Œä¸è§¦å‘ä»»ä½• block çº§å‘½ä»¤ã€‚"
  keyboard_rules:
    - "ParagraphEditor/List/Todo inline shell å¿…é¡»åœ¨ `onKeyDown` é¡¶éƒ¨æ‹¦æˆª `Shift+Enter`ï¼Œ`preventDefault()` åè°ƒç”¨ `insertSoftBreakAt(offset)` å¹¶ç«‹å³ returnï¼Œç¦æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡è‡³ keyboardDecider/deleteGuardã€‚"
    - "è½¯æ¢è¡Œ handler åªæ›´æ–°å½“å‰æ–‡æœ¬ä¸ caretï¼ˆoffset+1ï¼‰ï¼Œä¸å¾—è°ƒç”¨ create/delete/exit å‘½ä»¤æˆ–è§¦å‘ list_family intentï¼Œtelemetry åªéœ€è®°å½•ä¸€æ¬¡ `onSoftBreak`ã€‚"
  text_rules:
    - "è½¯æ¢è¡Œåœ¨æ¨¡å‹ä¸­ä»¥ `\n` å­˜å‚¨ï¼Œæ¸²æŸ“ç»§ç»­ä¾èµ– `white-space: pre-wrap`ï¼›ä»»ä½• `<br>`â†’`\n` æ˜ å°„å¿…é¡»é€šè¿‡ inline helperï¼Œè€Œééå¸ƒ DOM æ“ä½œã€‚"
    - "isEmpty/allItemsEmpty/deleteGuard åˆ¤ç©ºéœ€æŠŠåŒ…å«ç©ºæ ¼ã€Tabã€`\n` çš„æ–‡æœ¬è§†ä¸ºâ€œç©ºâ€ï¼Œé¿å…è½¯æ¢è¡Œè¢«è¯¯åˆ¤ä¸ºæœ‰æ•ˆå†…å®¹å¹¶é˜»å¡åˆ—è¡¨/å¾…åŠé€€å‡ºã€‚"
  qa_notes:
    - "æ‰‹åŠ¨éªŒè¯ï¼šParagraph/List/Todo ä¸­ Shift+Enter ä¸æ–°å¢å—ã€ä¸é€€å‡ºåˆ—è¡¨ï¼Œåªåœ¨å•ä¸ª item å†…å‡ºç°å¤šè¡Œæ–‡æœ¬ï¼›åˆ·æ–°åä»ä¿ç•™ `\n`ã€‚"
    - "Vitest `inlineText`ã€ListBlockã€TodoListBlock å¥—ä»¶éœ€è¦†ç›–â€œåªå« `\n` ä¾æ—§è§†ä¸ºç©ºâ€çš„åœºæ™¯ï¼Œç¡®ä¿ keyboardDecider è·¯å¾„æœªè¢«è§¦å‘ã€‚"
  status: "Adopted Dec 5, 2025"

block_editor_plan128_shell_visuals:
  summary: "Plan128ï¼ˆDec 5, 2025ï¼‰å°† BlockList é‡æ„ä¸º `modules/book-editor`ï¼Œç»Ÿä¸€ inline create barã€BlockToolbar ä»¥åŠè‡ªåŠ¨ä¿å­˜æŒ‡ç¤ºï¼Œå¼ºè°ƒâ€œè½»è„šæ‰‹æ¶ + æ’ä»¶æ¸²æŸ“â€ã€‚"
  layout_rules:
    - "BookEditorRoot å¤–å±‚ `bookEditor.module.css` è§„å®šæœ€å¤§å®½åº¦ + å±…ä¸­åˆ—ï¼ŒBlocks Tab ä¸å†å¤ç”¨æ—§ `.BlockList` æ ·å¼ï¼Œé¿å… margin å†²çªã€‚"
    - "`BlockItem` ä½¿ç”¨ data-editing attribute æ§åˆ¶å£³å±‚é«˜äº®ï¼šidle=é€æ˜æè¾¹ï¼Œediting=ä¸»è‰²æè¾¹ + toolbar å±•å¼€ï¼Œhover æ—¶å·¥å…·æ¡æµ®åœ¨å³ä¸‹è§’ã€‚"
    - "Inline toolbarï¼ˆPlus/Clock/Trashï¼‰å›ºå®šè´´åœ¨å—å³ä¸‹è§’ï¼Œhover/ç¼–è¾‘æ€æ·¡å…¥ï¼›æœªæ¿€æ´»å— toolbar opacity=0 ä¸”ä¸å ä½ï¼Œç¡®ä¿å±å¹•åªå‡ºç°ä¸€ä¸ªå·¥å…·æ¡ã€‚"
  creation_rules:
    - "InlineCreateBar å¸¸é©»åˆ—è¡¨åº•éƒ¨ï¼Œæ–‡å­—â€œå†™ç‚¹ä»€ä¹ˆâ€¦â€ä½¿ç”¨ secondary tokenï¼Œç‚¹å‡»/ç©ºæ ¼å‡è§¦å‘ï¼›ç©ºåˆ—è¡¨æ—¶æ”¹ä¸ºæ•´å¡ CTA å¹¶é™„æç¤ºæ–‡æ¡ˆã€‚"
    - "Enter åˆ›å»ºçš„æ–°å—ç»§æ‰¿ç›¸åŒé—´è·å¹¶ç«‹å³å±•ç¤º SaveStatusBadge=\"saving\"ï¼Œé¿å…ç”¨æˆ·è¯¯ä»¥ä¸ºæ²¡æœ‰å“åº”ã€‚"
  status_badge_rules:
    - "SaveStatusBadge é¢œè‰²ï¼šidle=é€æ˜ã€saving=amber ç‚¹ã€saved=ç»¿è‰²å‹¾ã€error=çº¢ç‚¹ï¼Œä½ç½®å›ºå®šåœ¨å—å³ä¸Šè§’ä¸”ä¸ toolbar ä¸é‡å ã€‚"
    - "Badge æ–‡æ¡ˆçœç•¥ï¼Œä»…é  icon + tooltipï¼ˆSaved/Syncing/Errorï¼‰è¡¨è¾¾ï¼›é¼ æ ‡ hover æ‰æ˜¾ç¤ºæ–‡å­—æè¿°ã€‚"
  integration_notes:
    - "Blocks Tab header çš„ Primary Button æ”¹æ–‡æ¡ˆä¸ºâ€œAUTO SAVEâ€ï¼Œå¼ºè°ƒæ— éœ€æ‰‹åŠ¨ä¿å­˜ï¼›æŒ‰é’®åœ¨ blocks hook loading æ—¶ç¦ç”¨ã€‚"
    - "æ—§åˆ†é¡µæ¡å®Œå…¨ä¸‹çº¿ï¼ŒBlocks åŒºåŸŸåªä¿ç•™æ»šåŠ¨å®¹å™¨ + åº•éƒ¨ inline barã€‚"
    - "æ’ä»¶æ³¨å†Œè¡¨ä¸ UI åŒæ­¥ï¼šParagraph/Heading ä¹‹å¤–çš„ todo/callout/quote/divider/image/image_gallery/code/custom å‡ç”± modules/book-editor æ’ä»¶æ¸²æŸ“ï¼ŒLegacy BlockRenderer ä»…ä½œä¸ºè°ƒè¯•å…¥å£ã€‚"
    - "Plan130 inline flowï¼šBlockItem åªæ¸²æŸ“ä¸€ä¸ª `.blockItemMain` å®¹å™¨ï¼ŒDisplay/Editor å…±ç”¨ `.textBlockShell`ï¼ˆé€æ˜èƒŒæ™¯ã€æ— è¾¹æ¡†ï¼‰ï¼Œåˆ‡æ¢ç¼–è¾‘æ—¶ DOM ä¸é‡æ’ã€‚"
  status: "Adopted Dec 5, 2025"

block_editor_plan121_micro_editor:
  summary: "Plan121ï¼ˆDec 1, 2025ï¼‰èšç„¦å¾®ç¼–è¾‘å™¨çš„â€œæ— å¼¹è·³â€ä½“éªŒï¼šview/edit å¤ç”¨åŒä¸€æ’ç‰ˆï¼Œæ ‡é¢˜åƒæµåŠ¨æ–‡æ¡£ä¸€æ ·å¹³æ»‘è¿‡æ¸¡ã€‚"
  layout_rules:
    - "paragraph/heading å…±ç”¨ `.textBlockShell` å£³å±‚ï¼Œpadding ä¸ border å®½åº¦å›ºå®šï¼Œé»˜è®¤ border:transparentï¼›hover æˆ–ç¼–è¾‘æ‰æµ…è‰²é«˜äº®ã€‚"
    - "`.textBlockShellHeading` æ ¹æ® level æ§åˆ¶ marginï¼Œä½†é¦–ä¸ª block å¼ºåˆ¶ margin-top=0ï¼›`.textBlockShellParagraph` ç›´æ¥å®šä¹‰ 14px/1.7 è¡Œè·ï¼Œè®© textarea ç»§æ‰¿åŒä¸€å­—ä½“ã€‚"
    - "é¦–ä¸ª block é¡¶éƒ¨ä¸å†ç»˜åˆ¶ inline `+` handleï¼Œè¡Œé—´æŒ‰é’®ä»…åœ¨å—ä¹‹é—´å‡ºç°ï¼Œé¿å…é¡µé¢ä¸€å¼€å¤´å°±è¢«è™šçº¿å ä½ã€‚"
  interaction_rules:
    - "å¾®ç¼–è¾‘å™¨ä½¿ç”¨ AutoSizeTextareaï¼ˆminRows=1, maxRows=3ï¼‰+ `font:inherit`ï¼Œé«˜åº¦éšå†…å®¹è‡ªåŠ¨å¢é•¿ä½†å°é¡¶ä¸‰è¡Œï¼Œæœç»â€œç‚¹å‡»å³å†’å‡ºä¸‰è¡Œç©ºç™½â€ã€‚"
    - "Clock/Delete å›¾æ ‡ç»å¯¹å®šä½åœ¨å£³å±‚å³ä¸Šè§’ï¼Œåªåœ¨ hover æˆ–ç¼–è¾‘æ€æ—¶å°† opacity åˆ‡åˆ° 1ï¼›idle çŠ¶æ€å®Œå…¨é€æ˜ï¼Œä¸å½±å“è¡Œé«˜ã€‚"
    - "èƒŒæ™¯/æè¾¹å˜åŒ–åªåœ¨ `.textBlockShellEditing` æˆ– hover è§¦å‘ï¼Œview æ€ä¸é˜…è¯»æ¨¡å¼å®Œå…¨ä¸€è‡´ã€‚"
  status: "Adopted Dec 1, 2025"

block_renderer_plan83_v2:
  summary: "Plan83 Phase v2ï¼šBlockRenderer/BlockList å¢åŠ  todo/callout/quote/divider/image/image_gallery å…­ç±»å¯Œå— + æ’å…¥èœå• + Promoted Todo æ±‡æ€»ã€‚"
  scope:
    - "/admin/books/{bookId} â†’ Blocks Tab"
    - "/admin/blocks è°ƒè¯•å…¥å£ï¼ˆåªè¯»ä¸å†™å…¥å¯¹é½ï¼‰"
    - "Overview Tab Promoted Todo Preview"
  insert_menu:
    layout: "+ æ·»åŠ ä¸€æ®µæ–‡å­— CTA + Insert èœå•ï¼ˆåŸºç¡€/å¾…åŠ/æ ‡æ³¨/åª’ä½“åˆ†ç»„ï¼‰"
    behavior:
      - "Insert èœå•æŒ‰é’®ç‚¹å‡»åå±•å¼€ popoverï¼›ç‚¹å‡»ç©ºç™½å¤„æˆ–é€‰æ‹©é¡¹åè‡ªåŠ¨å…³é—­ã€‚"
      - "æ¯ä¸ªåˆ†ç»„çš„æŒ‰é’®ç›´æ¥è°ƒç”¨ onAddBlock(kind)ï¼Œåç«¯æ”¶åˆ° kind + serializeBlockContent(kind, createDefaultBlockContent(kind))ã€‚"
      - "ç©ºæ€ç•Œé¢ä»…æ˜¾ç¤ºæ®µè½ CTAï¼›å­˜åœ¨å—æ—¶åœ¨åˆ—è¡¨åº•éƒ¨æ¸²æŸ“åŒä¸€èœå•ã€‚"
  renderer_matrix:
    todo_list:
      display: "åŸç”Ÿ checkbox + inline text è¾“å…¥ï¼›is_promoted æ˜Ÿæ ‡ä¸æˆç†Ÿåº¦æç¤ºä¸€è‡´"
      editor: "æ¯è¡Œå¯ Enter æ–°å»º / Backspace åˆ é™¤ï¼ŒCtrl+Enter å®Œæˆï¼›æ”¯æŒ promoted toggleã€‚"
      update_strategy: "å‹¾é€‰/ç¼–è¾‘åé€šè¿‡ UpdateBlockUseCase å†™å› JSONï¼ŒserializeBlockContent è´Ÿè´£ stringâ†”JSONã€‚"
    callout:
      display: "variant=info|warning|danger|success -> èƒŒæ™¯ token (--wl-callout-*)ï¼ŒåŒ…å« icon + æ–‡æ¡ˆ"
      editor: "Variant Chip + textareaï¼›dropdown éœ€ aria-pressed è¡¨ç¤ºå½“å‰ variant"
    quote:
      display: "å·¦ä¾§ç«–çº¿ + å¼•å·è£…é¥°ï¼Œæ¥æºæ–‡æœ¬å¯é€‰"
      editor: "ä¸Šä¸‹ä¸¤æ®µ textareaï¼ˆå†…å®¹ + æ¥æºï¼‰ï¼ŒCtrl+Enter ä¿å­˜"
    divider:
      display: "hr æ ·å¼ solid/dashedï¼›åªè¯»"
      editor: "Style ä¸‹æ‹‰ + å³æ—¶é¢„è§ˆ"
    image:
      display: "å ä½ç°å— + captionï¼›URL ç¼ºå¤±æ—¶æ˜¾ç¤ºä¸Šä¼ æç¤º"
      editor: "URL è¾“å…¥ + captionï¼›æœªæ¥å°†æ¥å…¥ Media é€‰æ‹©å™¨"
    image_gallery:
      layout: "strip/grid åˆ‡æ¢ + å¤šå›¾ç¼©ç•¥ï¼›ç©ºæ€æç¤º + æ·»åŠ æŒ‰é’®"
      interactions:
        - "æ–°å¢é¡¹é»˜è®¤ idâ†’generateBlockScopedId()ï¼Œä¿è¯ Chronicle äº‹ä»¶ä¸ Todo ä¸€è‡´"
        - "å…è®¸ drag handle æ’åºï¼ˆåç»­ Plan85ï¼‰ï¼Œå½“å‰ä¸ºæŒ‰é’®ä¸Šç§»/ä¸‹ç§»"
  promoted_todo_overview:
    extraction: "frontend/src/features/block/lib/promotedTodos.ts è§£æ block.kind==='todo_list' ä¸” isPromoted=true çš„é¡¹"
    ui: "Overview Tab æ–°å¢ Todo Preview å¡ç‰‡ï¼Œæ”¯æŒå‹¾é€‰å†™å›åŸ Block å¹¶è‡ªåŠ¨åˆ·æ–° mature score è§†å›¾"
    readonly_guard: "Basement/Legacy ä¹¦ç±ç¦ç”¨äº¤äº’ï¼Œä»…å±•ç¤ºåˆ—è¡¨"
  accessibility:
    - "æ‰€æœ‰æ–°æ§ä»¶ï¼ˆinsert menuã€variant chipsã€gallery æŒ‰é’®ï¼‰æä¾› aria-label + é”®ç›˜å¯¼èˆª"
    - "BlockRenderer åœ¨é˜…è¯»æ€æ”¯æŒ Enter/Space è¿›å…¥ç¼–è¾‘ï¼ŒEsc å›æ»š"
  testing:
    - "Snapshotï¼šæ¯ä¸ªæ–° block kind è‡³å°‘ 1 ä¸ªæ¡ˆä¾‹ + ç©ºæ€"
    - "Interactionï¼šInsert æ–°å—â†’ç¼–è¾‘â†’ä¿å­˜ï¼›Promoted todo å‹¾é€‰å Overview å¡ç‰‡è®¡æ•°åˆ·æ–°"
    - "Regressionï¼šBlockList saveAll ä»é€å—è°ƒç”¨ UpdateBlockUseCaseï¼Œæ— æ‰¹é‡ç«¯ç‚¹"
  status: "Adopted Nov 27, 2025"
  plan128_alignment:
    - "2025-12-01 èµ·è¿™äº›å¯Œå—çš„ Display/Editor ç»„ä»¶è¿ç§»è‡³ modules/book-editor/ui ä¸‹ï¼ŒBlockItem ç»Ÿä¸€è°ƒç”¨ plugin registry å¹¶æ²¿ç”¨ SaveStatusBadgeã€‚"
    - "è‡ªå®šä¹‰(custom) block é€€åŒ–ä¸º JSON viewer/editorï¼Œç»™å†å²æ•°æ®æä¾›åªè¯»å‡ºå£ï¼Œè§†è§‰ä¸Šä¾æ—§é‡‡ç”¨ç°è‰²è™šçº¿å£³å±‚ã€‚"
    - "Plan130 inline shell è¦æ±‚å¯Œå—éµå®ˆâ€œView=Edit å£³å±‚â€åŸåˆ™ï¼šquote/callout/code/editor çŠ¶æ€åªæ”¹å˜ contentEditable/textarea å±æ€§ï¼Œä¸æ–°å¢é¢å¤– overlayã€‚"

block_editor_plan130_inline_shell:
  summary: "Plan130ï¼ˆDec 5, 2025ï¼‰æŠŠ Book Editor ä»â€œå—æ¨¡å¼â€è½¬ä¸ºâ€œæµæ–‡æ¡£æ¨¡å¼â€ï¼šç”¨æˆ·çœ‹åˆ°çš„æ˜¯è¿ç»­æ­£æ–‡ï¼Œå—å£³å±‚éšèº«ã€‚"
  why:
    - "Plan120/Plan126 åä»å­˜åœ¨â€œç‚¹å‡»å³é—ªçƒ overlayâ€â€œå³ä¸Šè§’ä¸‰é¢—å½©çƒæŠ¢æˆâ€çš„é—®é¢˜ï¼ŒPlan130 è¦æ±‚ inline contentEditable å½»åº•å–ä»£ overlayã€‚"
    - "Slash èœå•å’Œæ“ä½œæŒ‰é’®åªåœ¨éœ€è¦æ—¶å‡ºç°ï¼Œé¿å…å…‰æ ‡è½»ç§»å°±è§¦å‘æ•´æ’æ§ä»¶ã€‚"
  rules:
    - "`.blockItem` å†…å¿…é¡»åªæœ‰ `.blockItemMain` + `.blockItemActions` ä¸¤ä¸ªåŒºåŸŸï¼›ä¸»åŒºåŸŸ padding 24px ä»¥å†…ï¼Œä¿æŒä¸æ­£æ–‡ä¸€è‡´ã€‚"
    - "Display/Editor çš„ DOM ç»“æ„ä¸€è‡´ï¼›æ®µè½/æ ‡é¢˜/å¼•ç”¨åœ¨ view/edit çŠ¶æ€ä½¿ç”¨åŒä¸€ä¸ª `.textBlockShell`ï¼Œä»…é€šè¿‡ data-readonly æ§åˆ¶ caretã€‚"
    - "å·¥å…·æ¡é»˜è®¤éšè—ï¼Œä»…åœ¨ `:hover` + 150ms å»¶è¿Ÿåæ˜¾ç¤ºæ·¡ç°å›¾æ ‡ï¼›active block æ‰èƒ½çœ‹åˆ°å®Œæ•´æ“ä½œæŒ‰é’®ã€‚"
    - "Slash èœå•åªåœ¨æ‰“å¼€æœŸé—´ç›‘å¬ selectionchangeï¼Œä½ç½®é”šå®š `Range.getBoundingClientRect()`ï¼Œå…³é—­å³ç§»é™¤ç›‘å¬å™¨ã€‚"
  status: "Adopted Dec 5, 2025"

block_editor_plan148_placeholder_visuals:
  summary: "Plan148ï¼ˆDec 2, 2025ï¼‰æŠŠâ€œå†™ç‚¹ä»€ä¹ˆâ€¦â€ placeholder ä¸ç©ºçŠ¶æ€æç¤ºéƒ½å˜æˆçº¯è§†è§‰å åŠ ï¼Œæœç»æŠŠå ä½ç¬¦å½“çœŸå®æ–‡æœ¬ä¿å­˜ã€‚"
  placeholder_rules:
    - "PLACEHOLDER-01ï¼šplaceholder ä»…é€šè¿‡ `.textBlockContent[data-empty='true']::before { content: attr(data-placeholder); pointer-events:none; }` æ¸²æŸ“ï¼Œç¦æ­¢å†å¾€ contentEditable å¡ `å†™ç‚¹ä»€ä¹ˆâ€¦` æ–‡æœ¬æˆ– <br> å ä½ç¬¦ã€‚"
    - "PLACEHOLDER-02ï¼šdata-empty ç”± BlockEditorCore æ ¹æ®å®æ—¶ DOM æ–‡æœ¬ç»´æŠ¤ï¼ŒCSS é€‰æ‹©å™¨åªèƒ½ä¾èµ– `[data-empty='true']`ï¼Œä¸å‡†å†ä½¿ç”¨ `:empty`/`:has(br)` ç­‰æ˜“ç¢æ¡ä»¶ï¼›placeholder ä¸å›  focus/readOnly åˆ‡æ¢é—ªçƒã€‚"
    - "PLACEHOLDER-03ï¼š::before å¿…é¡»å æ»¡æ•´è¡Œï¼ˆposition:absolute + inset:0 + white-space:pre-wrapï¼‰ï¼Œå¹¶ç»§æ‰¿æ­£æ–‡å­—ä½“/è¡Œé«˜ï¼›é¢œè‰²ä½¿ç”¨ `#9ca3af` æˆ– `var(--wl-placeholder-text)`ï¼Œä¿æŒä¸ secondary æ–‡æœ¬ä¸€è‡´ã€‚"
  empty_state_rules:
    - "EMPTY-STATE-01ï¼šå½“ blocks.length === 0 æ—¶å±•ç¤ºå¸¦ inline CTA çš„ç©ºæ€å¡ç‰‡ï¼ˆæ ‡é¢˜ + hint + InlineCreateBarï¼‰ï¼›å½“ blocks.every(isRenderableBlockEmpty) æ—¶ï¼Œä»åœ¨ BlockList é¡¶éƒ¨å±•ç¤ºåŒæ¬¾å¡ç‰‡ä½†ä¸é‡å¤æ¸²æŸ“ InlineCreateBarã€‚"
    - "EMPTY-STATE-02ï¼šç©ºæ€å¡ç‰‡æ–‡æ¡ˆå›ºå®šä¸ºâ€œæš‚æ—¶æ²¡æœ‰å†…å®¹ + ç‚¹å‡»ä¸‹æ–¹çš„è¾“å…¥æ¡å¼€å§‹è®°å½•ç¬¬ä¸€æ®µå†…å®¹â€ï¼Œé¢œè‰²æ²¿ç”¨ `.emptyState/.emptyHint` tokenï¼Œä¸éšä¸»é¢˜æ“…è‡ªå˜æ›´ã€‚"
    - "EMPTY-STATE-03ï¼šç©ºæ€å¡ç‰‡å‡ºç°æ—¶åˆ—è¡¨ä»ä¿ç•™çœŸå® blockï¼Œç”¨æˆ·èƒ½ç›´æ¥åœ¨åŸå—è¾“å…¥ï¼›å¡ç‰‡åªä½œä¸ºæé†’ï¼Œä¸å¾—é®æŒ¡æˆ–é‡æ’ blockã€‚"
    - "EMPTY-STATE-04ï¼š`.emptyState` æ–‡æ¡ˆå¿…é¡»ç»§æ‰¿ placeholder tokenï¼ˆ#9ca3afã€font-weight:400ï¼‰ä¸ `.textBlockContent[data-empty]::before` ä¸€è‡´ï¼Œé¿å…ç©ºæ€æç¤ºæ¯”è¾“å…¥ placeholder æ›´çªå…€ï¼›`.emptyHint` ä»…è°ƒæ•´å­—å·ï¼Œä¸å…è®¸è‡ªå®šä¹‰é¢œè‰²ã€‚"
  testing:
    - "æ‰‹åŠ¨ï¼šç©ºä¹¦é¦–æ¬¡åŠ è½½ â†’ placeholder å±•ç¤º â†’ è¾“å…¥ä»»æ„å­—ç¬¦ â†’ placeholder æ¶ˆå¤± â†’ å…¨åˆ å…‰ â†’ placeholder æ¢å¤ã€‚"
    - "æ‰‹åŠ¨ï¼šå­˜åœ¨å¤šä¸ªç©º block æ—¶ç¡®è®¤ç©ºæ€å¡ç‰‡ä»å‡ºç°ä¸” InlineCreateBar ä»…åœ¨åˆ—è¡¨åº•éƒ¨å‡ºç°ä¸€æ¬¡ã€‚"
  status: "Adopted Dec 2, 2025"

block_insert_menu_plan85:
  summary: "Plan85ï¼šBlock æ’å…¥èœå•çš„äººä½“å·¥å­¦ä¼˜åŒ–ï¼ˆå…‰æ ‡é™„è¿‘ + é«˜é¢‘ä¼˜å…ˆ + å¯æ»šåŠ¨ More åŒºåŸŸï¼‰ã€‚"
  pain_points:
    - "åŸèœå•ä»åº•éƒ¨æ‹‰å‡ºï¼Œé«˜åº¦è¿‡é•¿ï¼ŒæŒ‡é’ˆéœ€è¦ç§»åŠ¨åŠä¸ªå±å¹•ã€‚"
    - "æ‰€æœ‰ç±»å‹å¹³é“ºåœ¨åŒä¸€å±‚çº§ï¼Œå¸¸ç”¨ä¸ä½é¢‘æ··åœ¨ä¸€èµ·ï¼Œå†³ç­–æˆæœ¬é«˜ã€‚"
  current_relief:
    css:
      - ".insertMenuPopover è®¾ç½® max-height:280px + overflow-y:autoï¼Œé•¿åˆ—è¡¨å†…éƒ¨æ»šåŠ¨ï¼Œé¿å…â€œé¡¶åˆ°å±å¹•è¾¹ç¼˜â€ã€‚"
    grouping:
      - "å¸¸ç”¨ç»„ï¼ˆAlways-onï¼‰ï¼šæ®µè½ / Todo åˆ—è¡¨ / Callout / åˆ†å‰²çº¿ï¼Œç›´æ¥æ˜¾ç¤ºåœ¨èœå•ä¸ŠåŠéƒ¨åˆ†ã€‚"
      - "ä½é¢‘ç»„æ”¶çº³åˆ°â€œæ›´å¤šå—ç±»å‹â€¦â€æŒ‰é’®ä¸‹ï¼Œç‚¹å‡»åå±•å¼€ å¼•ç”¨ / å›¾ç‰‡ / å›¾ç‰‡ç»„ ç­‰åˆ†ç»„ã€‚"
    inline_plus:
      summary: "BlockList æ¯ä¸ªå—å‰åæ‚¬æµ®å° + å·ï¼Œhover/focus æ—¶å‡ºç°ï¼Œè§¦å‘åŒæº Insert èœå•ã€‚"
      behavior:
        - "`.inlineInsertRow` åªåœ¨ hover/focus æ—¶å°†æŒ‰é’® opacity=1ï¼Œå‡å°‘è§†è§‰å™ªç‚¹ã€‚"
        - "ç‚¹å‡» + å·åå¼¹å‡ºçš„ popover å¤ç”¨ `BlockInsertMenuContent`ï¼ˆBlockList.tsxï¼‰ï¼Œå¹¶ä¼ é€’ anchorId + position â†’ onAddBlock(kind, options)ã€‚"
        - "åˆ›å»ºåé€šè¿‡ `resolveInsertionOrder` + `useReorderBlock` é‡æ–°èµ‹å€¼ fractional_indexï¼Œå—ä¼šè½åœ¨æŒ‡å®šä½ç½®ã€‚"
    text_kind_chip:
      summary: "Plan118 åœ¨å—å·¦ä¾§æ–°å¢æ–‡æœ¬ç±»å‹ Chipï¼Œä»…åœ¨ paragraph/heading èšç„¦æˆ– hover æ—¶å‡ºç°ã€‚"
      behavior:
        - "Chip ä¸æ­£æ–‡ä¿æŒ 48px å·¦å³æ°´å¹³é—´è·ï¼Œä½¿ç”¨ 12px èƒ¶å›Š + ä¸ç»¸è“æè¾¹ï¼Œé»˜è®¤é€æ˜ï¼ˆopacity:0ï¼‰ï¼ŒBlock èšç„¦/hover æ—¶æ¸æ˜¾ã€‚"
        - "æŒ‰é’®åªåœ¨ paragraph/heading æ¸²æŸ“ï¼Œæ–‡æ¡ˆæ˜¾ç¤º æ­£æ–‡/H1/H2/H3ï¼›ç‚¹å‡»å±•å¼€ç«–å‘èœå•ï¼Œé€‰é¡¹å«æ­£æ–‡ + H1~H3ã€‚"
        - "èœå•ä¸º 6px å†…è¾¹è· + 10px å€’è§’ + 1px é›¾ç°æè¾¹ï¼Œé€‰ä¸­é¡¹èƒŒæ™¯ä½¿ç”¨ rgba(46,94,146,0.1)ï¼Œé¿å…å–§å®¾å¤ºä¸»ã€‚"
        - "Chip/èœå•ç‚¹å‡»ä»…è§¦å‘ UI åˆ‡æ¢ï¼Œä¸å½±å“å…¶ä»–å—å¸ƒå±€ï¼›éæ–‡æœ¬å—ç»§ç»­ä¿æŒå¹²å‡€çš„ç•™ç™½ã€‚"
    slash_menu:
      summary: "ParagraphEditor æ•è· `/` å‘½ä»¤ï¼Œå…‰æ ‡é™„è¿‘å¼¹å‡º mini menuï¼ˆBlockRenderer.tsxï¼‰ã€‚"
      behavior:
        - "ç›‘å¬ textarea å†… `/` å¼€å¤´çš„å‘½ä»¤ä¸²ï¼Œå®æ—¶è¿‡æ»¤ `ALL_INSERT_ITEMS`ï¼Œå¹¶åœ¨ caret è¡Œè®¡ç®—ä½ç½®ã€‚"
        - "æ”¯æŒé”®ç›˜ï¼é¼ æ ‡ï¼šâ†‘â†“ åˆ‡æ¢ã€Enter é€‰ä¸­ã€Esc å…³é—­ã€é¼ æ ‡ `onMouseDown` ç›´æ¥æ’å…¥ã€‚"
        - "é€‰ä¸­åç§»é™¤ `/xxx` æ–‡æœ¬ï¼Œä¿æŒ focusï¼Œå¹¶è°ƒç”¨ onAddBlock(kind,{anchorId=å½“å‰ block,'after',source='slash-command'})ã€‚"
    markdown_shortcuts:
      summary: "è¡Œé¦–è¾“å…¥ `# / ## / ### + ç©ºæ ¼` è‡ªåŠ¨åˆ‡æ¢ä¸º H1/H2/H3ï¼Œè§†è§‰ä¸Šåªä¿ç•™æœ€ç»ˆæ ‡é¢˜ã€‚"
      behavior:
        - "æ£€æµ‹å‘½ä»¤åç«‹å³åˆ é™¤è¡Œé¦–ç¬¦å·ï¼Œé¿å…æ­£æ–‡å‰æ®‹ç•™äº•å·ã€‚"
        - "è½¬æ¢åçš„ heading æ–‡æœ¬é‡‡ç”¨ä¸ Chip ä¸€è‡´çš„å±‚çº§æ ·å¼ï¼šH1 1.9rem/H2 1.5rem/H3 1.25remï¼Œä¿æŒä¸Šä¸‹é—´è·å·®å¼‚ã€‚"
        - "è‹¥ç”¨æˆ·æ’¤é”€æˆ–åˆ‡æ¢å›æ­£æ–‡ï¼Œæ–‡æœ¬ç»§ç»­æ²¿ç”¨ paragraph æ ·å¼ï¼Œä¸æ–°å¢é¢å¤–æ ‡è®°ã€‚"
  future_variants:
    toolbar_plus_more:
      summary: "åº•éƒ¨ä¿ç•™ä¸€å°æ’é«˜é¢‘å›¾æ ‡ + â€œæ›´å¤šâ€å¯¹è¯æ¡†ã€‚"
      rules:
        - "æ®µè½/Todo/Callout/åˆ†å‰²çº¿/å›¾ç‰‡ä»¥ icon å½¢å¼å¸¸é©»ï¼Œç‚¹å‡»å³åˆ›å»ºã€‚"
        - "ç‚¹å‡» â‹¯ æ‰“å¼€ Block åº“å¯¹è¯æ¡†ï¼Œä»¥ç½‘æ ¼å±•ç¤ºå…¨éƒ¨ç±»å‹ï¼Œé¢‘æ¬¡è¾ƒä½ä½†å¯æ‰©å±•ã€‚"
  accessibility:
    - "Insert æŒ‰é’®ä½¿ç”¨ aria-haspopup='menu' + aria-expanded åæ˜ å±•å¼€çŠ¶æ€ã€‚"
    - "é”®ç›˜æ”¯æŒï¼šTab èšç„¦èœå•åï¼Œâ†‘/â†“ åœ¨é¡¹é—´ç§»åŠ¨ï¼ŒEnter é€‰æ‹©ï¼›Esc å…³é—­èœå•å¹¶è¿”å›è§¦å‘æŒ‰é’®ã€‚"
  status: "Adopted Nov 27, 2025ï¼ˆPhase3-5 å®Œæˆï¼šåº•éƒ¨èœå• + inline + + Slash å‘½ä»¤ï¼‰"

block_editor_plan160_slash_anchor:
  summary: "Plan160A/Bï¼ˆDec 4, 2025ï¼‰æŠŠ Slash èœå•æ”¹ä¸º caret ç›¸å¯¹å®šä½çš„ shell å†…éƒ¨å¼¹å±‚ï¼Œå¹¶æŠŠ hover â€œ+â€ ç»§ç»­é”åœ¨æ—§ QuickInsertMenuï¼Œå½»åº•åˆ†ç¦»ä¸¤å¥—å®šä½æ¨¡å‹ã€‚"
  layout_rules:
    - ".bookEditorShellï¼ˆBlockList æœ€å¤–å±‚å®¹å™¨ï¼‰å¿…é¡» `position: relative` å¹¶æŒ‚ä¸Š `ref={editorRootRef}`ï¼Œæ‰€æœ‰ SlashMenu dom éƒ½æ¸²æŸ“åœ¨è¯¥å®¹å™¨å†…éƒ¨ï¼Œä»¥ `{left:x, top:y}` ç»å¯¹å®šä½ã€‚"
    - "SlashMenu çš„é˜´å½±ã€åœ†è§’ã€max-heightã€æ»šåŠ¨æ¡æ²¿ç”¨ QuickInsert tokenï¼Œä½†ä¸å†é€šè¿‡ portal é™„ç€åœ¨ document.bodyï¼›å®šä½åªè®¡ç®—ä¸€æ¬¡ï¼Œèœå•æ‰“å¼€æœŸé—´ä¸è¿½è¸ª selectionchangeã€‚"
    - "QuickInsertMenuï¼ˆhover â€œ+â€/åº•éƒ¨ CTAï¼‰ä¾æ—§æ˜¯ `position: fixed` + portalï¼›ä»»ä½• Slash å…¥å£ç¦æ­¢å¤ç”¨è¯¥ç»„ä»¶ï¼Œå¦åˆ™ caret ç›¸å¯¹åæ ‡ä¼šä¸ viewport åæ ‡å†²çªã€‚"
  interaction_rules:
    - "ParagraphEditor ä»…åœ¨ `!event.nativeEvent.isComposing && event.key==='/' && isCaretAtEmptyLine()` æ—¶è§¦å‘ `props.onRequestSlashMenu(blockId)`ï¼›å…¶ä½™æ—¶æœºç›´æ¥ returnï¼Œé¿å…ä¸­æ–‡è¾“å…¥æ³•å€™é€‰é˜¶æ®µè¯¯å¼¹èœå•ã€‚"
    - "BlockList æ¥åˆ°è¯·æ±‚åè°ƒç”¨ `getSlashMenuAnchor(editorRoot)`ï¼šè‹¥ selection ä¸åœ¨ editorRoot å†…ã€Range æœª collapsed æˆ– rect ä¸ºç©ºï¼Œå‡½æ•°è¿”å› null å¹¶é˜»æ­¢èœå•æ‰“å¼€ï¼›å…œåº• fallback åæ ‡ä¸º `{16,16}`ï¼ŒåŒæ—¶è®°å½• QuickLogã€‚"
    - "SlashMenu æ‰“å¼€æ—¶ï¼ŒBlockList ç»‘å®šä¸€æ¬¡æ€§ keydown(Escape)/mousedown ç›‘å¬æ¥è°ƒç”¨ onCloseï¼Œå…³é—­åç«‹å³ç§»é™¤ç›‘å¬ï¼Œé˜²æ­¢ ParagraphEditor å±‚é‡å¤ attach/detachã€‚"
    - "é€‰é¡¹é€‰æ‹©åå…ˆè°ƒç”¨ `handleQuickActionSelect(action,'slash')`ï¼Œå®Œæˆ transform/insertï¼Œå†åœ¨ UI å†…éƒ¨ç§»é™¤ `/command` æ–‡æœ¬ä¸ SlashMenu stateã€‚"
  caret_anchor_contract:
    - "`getSlashMenuAnchor` ç»Ÿä¸€æŠ˜å  Rangeï¼ˆcollapse(false)ï¼‰å¹¶ä½¿ç”¨ `range.getClientRects()?.[0] ?? range.getBoundingClientRect()` è®¡ç®— caretRectï¼Œå†å‡å» editorRoot rect å¾—åˆ°ç›¸å¯¹åæ ‡ã€‚"
    - "y åæ ‡é»˜è®¤å– caretRect.bottomï¼›è‹¥ `y + menuHeight > editorRoot.height`ï¼ŒSlashMenu éœ€åœ¨æ‰“å¼€å‰æŠŠ y å‘ä¸Šåç§»ï¼ˆç®€å•ç¿»è½¬ï¼‰ä¿æŒèœå•å®Œå…¨å¯è§ï¼Œåç»­ Plan160C å†è®¨è®ºæ›´å¤æ‚çš„ç¿»è½¬ç­–ç•¥ã€‚"
    - "state ä¿å­˜ `{open,x,y,blockId}` å¹¶ä»…åœ¨ SlashMenu å…³é—­æ—¶æ¸…ç†ï¼›é‡æ–°è§¦å‘æ—¶é‡æ–°è®¡ç®— anchorï¼Œç¦æ­¢åœ¨ selectionchange æœŸé—´å·å·æ›´æ–°åæ ‡ä»¥å…èœå•æŠ–åŠ¨ã€‚"
  plus_menu_split:
    - "Hover â€œ+â€ å…¥å£ä»èµ° QuickInsertMenuï¼ŒæŒ‰é’® hover å»¶è¿Ÿ 150ms åæ¸æ˜¾ï¼›SlashMenu ä¸å¾—å“åº” hover æˆ– Alt+/ å¿«æ·é”®ï¼Œè¯¥å¿«æ·é”®ä¾æ—§ç”¨äº inline toolbarã€‚"
    - "QuickInsertMenu æ–°å¢ `trigger='plus'` æ ‡è¯†ï¼Œä»…ç”¨äºå›ºå®šåœ¨ block ä¸­çº¿ä½ç½®çš„å¼¹å±‚ï¼›ä»»ä½• slash ç›¸å…³åŠ¨çº¿å¿…é¡»ä¼  `trigger='slash'` å¹¶èµ° caret anchorã€‚"
  accessibility:
    - "SlashMenu `role='menu'`ï¼Œè·å¾—ç„¦ç‚¹åç®­å¤´é”®å¾ªç¯éå†é€‰é¡¹ï¼ŒEsc å…³é—­å°†ç„¦ç‚¹è¿˜ç»™ ParagraphEditorï¼›èœå•æŒ‚åœ¨ shell å†…é¿å…è¯»å±è·¨ document focus åŒºåŸŸã€‚"
    - "IME é˜¶æ®µæ— äº¤äº’ï¼š`isComposing` æ¡ä»¶è§¦å‘æ—¶ä¸æ¸²æŸ“èœå•ï¼Œä¹Ÿä¸æ”¹å˜ placeholder/selectionï¼Œé˜²æ­¢è¯­éŸ³/æ‹¼éŸ³è¾“å…¥è¢«æˆªæ–­ã€‚"
  testing:
    - "Storybookï¼šSlashMenu æ‰“å¼€/å…³é—­ã€caret é è¿‘åº•éƒ¨ç¿»è½¬ã€anchor null fallback ä¸‰ä¸ªåœºæ™¯ï¼›Plus èœå•ä¾æ—§åœ¨ portal ä¸­æ¸²æŸ“ç¡®ä¿ä¸ä¼šè¢« Plan160 æ”¹åŠ¨å½±å“ã€‚"
    - "Playwrightï¼šä¸­æ–‡è¾“å…¥æ³• / è‹±æ–‡è¾“å…¥ / ESC å…³é—­ / ç‚¹å‡»å¤–éƒ¨å…³é—­ / é‡æ–°è§¦å‘ / hover â€œ+â€ å¹¶å­˜ coexistenceã€‚"
  status: "Adopted Dec 4, 2025"

book_gallery_visual_rules:
  plan_reference: "Plan_64_BookGallery.md"
  adr_reference: "ADR-100-book-gallery-bookshelf-strip.md"
  objective: "åœ¨ Bookshelf Detail ä¸Šè¥é€ â€œé™ˆåˆ—å¾ˆå¤šä¹¦â€çš„å±•å°æ„Ÿï¼Œä¸‰å±‚ç»“æ„ï¼šé¡µé¢ â†’ é™ˆåˆ—åŒºæ¨¡å— â†’ ä¹¦æ¶æ¡ â†’ æ–œä¹¦ã€‚"
  layout_structure:
    - "å¤–å±‚å®¹å™¨ `.bookshelfSection` ä¸é¡µé¢å…¶ä»–å¡ç‰‡ä¿æŒ 24px é—´è·ï¼Œå®½åº¦éšå†…å®¹è‡ªé€‚åº”ã€‚"
    - "Header åŒºåŒ…å«å›¾æ ‡ + æ ‡é¢˜ + æè¿° + actionsï¼ˆ+NEW BOOK æŒ‰é’® / åˆ›å»ºè¡¨å•ï¼‰ï¼Œæ–‡æ¡ˆä½¿ç”¨ data-theme è‰²å€¼ã€‚"
    - "`shelfStrip`ï¼šradial-gradient ç™½â†’é›¾ç°èƒŒæ™¯ã€24px åœ†è§’ã€åŒå±‚é˜´å½± (0 18px 40px rgba(15,23,42,0.12) + 1px outline)ï¼Œpadding 32px 40px 56pxã€‚"
    - "`shelfBoard`ï¼šæ¤­åœ†æœ¨æ¿/é‡‘å±å°ï¼Œabsolute å®šä½åœ¨åº•éƒ¨ï¼Œä½¿ç”¨ linear-gradient(#cbd5e1â†’#94a3b8) + inset é«˜å…‰ã€‚"
    - "`shelfBooks`ï¼šflex row + gap:32px + align-items:flex-end + scroll-snap-type:x mandatoryï¼›`.bookSlot` flex:0 0 autoã€‚"
  book_display_cabinet:
    - "å°ºå¯¸ 140Ã—200pxï¼Œ`.bookTilted` ä½¿ç”¨ perspective rotateY(-18Â°) rotateZ(-1Â°)ã€‚"
    - "`.spine` å‘å·¦å»¶å±• 12pxï¼ŒskewY(-8Â°)ï¼Œæ¨¡æ‹Ÿåšåº¦ï¼›`.badge` å³ä¸Šè§’æ˜¾ç¤º DRAFT/LEGACY ç­‰çŠ¶æ€ã€‚"
    - "`.shadow` ä½¿ç”¨ radial-gradientï¼Œå®½åº¦ 60%ã€blur(2px)ï¼Œä¸ shelfBoard æ¥è§¦ä»¥äº§ç”Ÿâ€œç«™åœ¨æ¿ä¸Šâ€çš„é”™è§‰ã€‚"
    - "nth-child(2n/3n) å¯åˆ†åˆ«æ—‹è½¬ -16Â°/+1Â° ç­‰è½»å¾®æ‰°åŠ¨ï¼Œè¥é€ äººå·¥æ‘†æ”¾æ„Ÿã€‚"
  view_modes:
    showcase:
      summary: "A æ¨¡å¼ï¼ˆå±•æŸœï¼‰ï¼šæ¨ªå‘ strip + å°ä¹¦ + é“­ç‰Œï¼Œå¼ºè°ƒç­–å±•æ„Ÿã€‚"
      layout_rules:
        - "`BookShowcaseItem` = Book3D (showcase size) + plaqueï¼ˆæ ‡é¢˜/çŠ¶æ€ pill/blocks/æ›´æ–°æ—¶é—´ï¼‰ã€‚"
        - "é“­ç‰Œå®½åº¦å›ºå®š 92px å·¦å³ï¼Œæ–‡å­—èµ° ellipsisï¼›çŠ¶æ€ pill ç”¨ MATURITY paletteã€‚"
        - "åŒä¸€æ¡ strip åªæ¸²æŸ“å±•æŸœå¡ç‰‡ï¼Œä¸æ··å…¥ row cardã€‚"
    row:
      summary: "C æ¨¡å¼ï¼ˆæ¡ç›®ï¼‰ï¼šå·¦ 3D å°ä¹¦å°ï¼Œå³ä¿¡æ¯åˆ—ï¼Œä¿¡æ¯å¯†åº¦é«˜ï¼Œé€‚åˆç­›é€‰/ç®¡ç†ã€‚"
      layout_rules:
        - "`BookRowCard` æ°´å¹³ 16px paddingã€16px gapï¼ŒèƒŒæ™¯åŠé€æ˜ç™½ + outline + hover æå‡ã€‚"
        - "å·¦ä¾§ Book3D ä½¿ç”¨ size=compactï¼ˆ72Ã—96pxï¼‰ï¼Œç§»é™¤ hover overlayï¼›å³ä¾§åŒ…å«æ ‡é¢˜/çŠ¶æ€ pill/summary/meta/tagã€‚"
        - "meta è¡Œå›ºå®šâ€œblock æ•° + æ›´æ–°æ—¶é—´â€ä¸¤æ®µï¼Œä¸­é—´ç”¨åŠé€æ˜ dot åˆ†éš”ã€‚"
      accessibility:
        - "æ•´å¡ `role=button` + `tabIndex=0` + Enter/Space å¼€å¯ä¹¦ç±ã€‚"
    shared:
      - "Book3D ä¸ºå”¯ä¸€ 3D å¤–å½¢æ¥æºï¼Œé¢œè‰²/è§’åº¦/é˜´å½±ç”± CSS variables æ§åˆ¶ï¼Œç¦æ­¢æ´¾ç”Ÿç¬¬äºŒå¥— 3D DOMã€‚"
      - "è§†å›¾åˆ‡æ¢æŒ‰é’®ï¼ˆsegmented controlï¼‰æ”¾åœ¨ section header actions åŒºï¼Œaria-label='Book view mode'ï¼ŒæŒ‰é’®ç”¨ `aria-pressed` æ ‡è®°å½“å‰æ¨¡å¼ã€‚"
  tag_badges:
    - "BookShowcaseItem é“­ç‰Œä¸ BookRowCard ä¿¡æ¯åˆ—å…±ç”¨ tag badge rendererï¼Œæ¸²æŸ“ `book.tagsSummary`ï¼ˆåç«¯å­—æ®µ `tags_summary`ï¼‰ï¼ŒæŒ‰åˆ›å»ºé¡ºåºå–æœ€å¤š 3 ä¸ªæ ‡ç­¾åã€‚"
    - "Badge æ–‡æ¡ˆè½¬ä¸ºå¤§å†™ã€è¶…å‡º 12 ä¸ªå­—ç¬¦æ—¶ä½¿ç”¨ ellipsisï¼›å½“æ ‡ç­¾è¶…è¿‡ 3 ä¸ªæ—¶ç¬¬ä¸‰ä¸ª badge æ”¹ä¸º `+N`ã€‚"
    - "ç©ºåˆ—è¡¨æ—¶éšè— badge è¡Œä½†ä¿ç•™ 8px å ä½ï¼Œé¿å… row/card é«˜åº¦æŠ–åŠ¨ã€‚"
    - "å±•æŸœå³ä¸Šè§’å¾½æ ‡ä¼˜å…ˆæ˜¾ç¤ºé¦–ä¸ªæ ‡ç­¾ï¼Œä½†æ”¹ç”±ç»Ÿä¸€ helper å†³å®šæ˜¯å¦å›é€€åˆ°æˆç†Ÿåº¦æ–‡æ¡ˆã€‚"
  interaction_rules:
    - "ç‚¹å‡»ä»»ä¸€æœ¬ä¹¦è°ƒç”¨ onSelectBook â†’ `/admin/books/{bookId}`ï¼›hover æ—¶å…è®¸è½»å¾® scale(1.02) + highlightã€‚"
    - "é”®ç›˜æ”¯æŒï¼šstrip è®¾ `tabindex=0` + `aria-label='ä¹¦ç±é™ˆåˆ—åŒº'`ï¼Œå·¦å³ç®­å¤´æ»šåŠ¨ 80pxï¼ŒEnter è§¦å‘å½“å‰èšç„¦ä¹¦ç±ç‚¹å‡»ã€‚"
    - "`+NEW BOOK` æŒ‰é’®å¤ç”¨ Dashboard æ ·å¼ï¼ˆButton variant=primary size=sm æ–‡æ¡ˆ `+NEW BOOK`ï¼‰ï¼Œå±•å¼€çš„åˆ›å»ºè¡¨å•ç´§è´´ header åº•éƒ¨ã€‚"
    - "Hover Overlay ä»…ä¿ç•™ icon-only æ“ä½œï¼ˆEye/Pencil/Trash/Pinï¼‰ï¼ŒæŒ‰é’®æ”¾ç½®åœ¨å¡ç‰‡ä¸‹ç¼˜å¹¶ä½¿ç”¨ 30px åœ†å½¢ï¼›Legacy/Basement ä¹¦ç±çš„æŒ‰é’®ç°åŒ–ç¦ç”¨ã€‚"
    - "Hover èœå•é€šè¿‡ createPortal é™„ç€åˆ° document.bodyï¼Œé¿å…è¢«çˆ¶çº§ overflow æˆ– z-index æ ä½æˆªæ–­ã€‚"
    - "Pin å›¾æ ‡æ”¹ç”¨ Lucide Starï¼šæœªç½®é¡¶æ˜¾ç¤ºæè¾¹æ˜Ÿï¼Œis_pinned=true æ”¹ä¸º filled variant å¹¶ä½¿ç”¨ `--wl-pinned-accent-text` é¢œè‰²ã€‚"
  pin_ribbon:
    - "is_pinned=true æ—¶åœ¨ BookFlatCard å·¦ä¾§ç»˜åˆ¶ 6px ä¸ç»¸è“æ¸å˜å¸¦ï¼Œé¡¶éƒ¨å’Œåº•éƒ¨ç•™ä¸‹ 10px åœ†è§’ç©ºéš™ï¼Œåˆ¶é€ â€œå›ºå®šâ€é”™è§‰ã€‚"
    - "Row è¡Œçš„ pin æŒ‰é’®å¤ç”¨ icon-only èƒ¶å›Šï¼Œå¸¸æ€ 20% é€æ˜åº¦ï¼Œhover/active ä½¿ç”¨ä¸å±•æŸœä¸€è‡´çš„ä¸ç»¸è“ tokenã€‚"
    - "Bookmark åœ†å¾½ç« ä¿ç•™ä½†éœ€è´´åˆä¸å¸¦è‰²æ¿ï¼Œé¿å…äº§ç”Ÿç¬¬äºŒå¥—è¯­ä¹‰ã€‚"
    - "æ’åºè§„åˆ™ï¼šåŒä¸€æˆç†Ÿåº¦åˆ†åŒºå†…ï¼ŒPinned ä¹¦ç±å›ºå®šæ’åœ¨æœ€å‰ï¼ŒPinned æ®µå†…éƒ¨æŒ‰ updated_atï¼ˆé™åºï¼‰â†’ created_atï¼ˆé™åºï¼‰æ’åˆ—ï¼Œå…¶ä½™ä¹¦ç±ç»§ç»­æŒ‰ updated_at é™åºæ’åˆ—ã€‚"
  book_ribbon_label_strategy:
    summary: "BookShowcaseItem ä¸ BookRowCard é¡¶éƒ¨å¾½æ ‡ç»Ÿä¸€ç”± buildBookRibbon helper è®¡ç®—ï¼ˆfrontend/src/entities/book/lib/ribbon.tsï¼‰ã€‚"
    rules:
      - "Helper è¾“å…¥ `tags_summary` ä¸ maturityï¼Œå…ˆå°è¯•ä»é¦–ä¸ªæ ‡ç­¾æå–ä»…åŒ…å«è‹±æ–‡å­—æ¯çš„ç»„åˆï¼Œé€å­—è½¬ä¸ºå¤§å†™å¹¶åœ¨ 7 ä¸ªå­—ç¬¦æ—¶æˆªæ–­ã€‚"
      - "è‹¥é¦–ä¸ªæ ‡ç­¾ä¸ºç©º/éå­—æ¯å¯¼è‡´æ— å­—ç¬¦è¾“å‡ºï¼Œåˆ™å›é€€åˆ° maturity æ–‡æ¡ˆï¼ˆSEED/GROWING/STABLE/LEGACYï¼‰ï¼›Basement ä¹¦ç±ä¿æŒ maturity=LEGACY + åªè¯»æ ·å¼ã€‚"
      - "ç»„ä»¶ä¸å¾—è‡ªè¡Œæ‹¼æ¥å¾½æ ‡æ–‡æ¡ˆï¼Œå¿…é¡»è°ƒç”¨ buildBookRibbon æˆ–å…¶ re-exportï¼›ä»»ä½• UI åªè¯» badge éƒ½éœ€ä½¿ç”¨ helper è¿”å›çš„ label + fromTag å…ƒæ•°æ®å†³å®šé…è‰²ã€‚"
      - "æµ‹è¯•æˆªå›¾éœ€è¦†ç›–ï¼šçº¯è‹±æ–‡æ ‡ç­¾â†’æˆªæ–­ã€å«ç¬¦å·æ ‡ç­¾â†’è¿‡æ»¤åè¾“å‡ºã€æ— æ ‡ç­¾â†’æ˜¾ç¤º maturityã€‚"
    status: "Adopted Nov 27, 2025"
  responsive_rules:
    desktop: "ä¿æŒ 140Ã—200 ä¹¦æœ¬å°ºå¯¸ï¼›strip padding 32px/40pxã€‚"
    tablet: "ä¹¦æœ¬ç¼©è‡³ 120Ã—180ï¼Œgap 24pxï¼ŒrotateY -16Â°ï¼›wood board å®½åº¦å‡åˆ°å·¦å³ 24pxã€‚"
    mobile: "ä¹¦æœ¬ 110Ã—160ï¼Œgap 20pxï¼Œstrip padding 24px/20pxï¼Œ`scrollbar-width:none`ï¼›é˜´å½±é€æ˜åº¦é™ä½ 20%ã€‚"
  accessibility:
    - "é¢œè‰²å¯¹æ¯”è¾¾åˆ° WCAG AAï¼šæœ¨æ¿/èƒŒæ™¯ä¸ä¹¦æœ¬è‡³å°‘ 3:1ï¼Œbadge å‰æ™¯ #f9fafb ä¸èƒŒæ™¯å¯¹æ¯” >4.5ã€‚"
    - "ç©ºçŠ¶æ€ï¼šå±•ç¤ºâ€œæš‚æ— ä¹¦ç±â€æç¤º + å¼•å¯¼ç‚¹å‡» +NEW BOOKï¼›æœ¨æ¿é˜´å½±é€æ˜åº¦é™è‡³ 0.2 é¿å…é€ æˆç©ºæ´ã€‚"
  performance:
    - "ç¦ç”¨è¿ç»­åŠ¨ç”»ï¼›ä»…åœ¨ hover/focus ä¸‹è§¦å‘ 150ms ease-in-out å˜æ¢ã€‚"
    - "`prefers-reduced-motion` æ¡ä»¶ä¸‹ç§»é™¤ rotateZ æ‰°åŠ¨ä¸ hover scaleã€‚"
    - "å›¾ç‰‡åŠ è½½ä½¿ç”¨ `loading="lazy"` + é»˜è®¤å°é¢ `/images/default-cover.png`ï¼Œé¿å…é˜»å¡é¦–å±ã€‚"
  scope:
    - "/admin/bookshelves/[bookshelfId]"
    - "/admin/books"
  exclusions:
    - "/admin/books/[bookId]ï¼ˆBook å·¥ä½œåŒºä»…å±•ç¤ºå•æœ¬ä¹¦ä¿¡æ¯ä¸ BookMaturityBadgeï¼Œä¸æ¸²æŸ“æˆç†Ÿåº¦åˆ†åŒºåˆ—è¡¨æˆ– SummaryBarï¼‰"
  sections:
    - name: "Seed"
      palette: "èƒŒæ™¯ #F8FAFC æ¸å˜ã€æ–‡æœ¬ #1E293Bã€è½»é‡æŠ•å½±ï¼›å…è®¸å¿«é€Ÿç¼–è¾‘æŒ‰é’®ã€‚"
      description: "è‰åˆ›åŒºå‘ˆç°è½»é‡å ä½ï¼Œå¼ºè°ƒçµæ„Ÿæ•æ‰ã€‚"
    - name: "Growing"
      palette: "æµ…è“ç³»æ¸å˜ (#EFF6FFâ†’#E0F2FE)ï¼Œå¼ºè°ƒè¿›åº¦çŠ¶æ€ï¼›å±•ç¤º block_countã€‚"
      description: "æˆé•¿åŒºå±•ç¤ºç»“æ„åŒ–ä¿¡æ¯ï¼Œä¿ç•™ç¼–è¾‘å…¥å£ã€‚"
    - name: "Stable"
      palette: "ç»¿è‰²æ¸å˜ (#ECFDF5â†’#D1FAE5)ï¼ŒåŠ ç²—å¡ç‰‡é˜´å½±ï¼›å°é¢æŒ‰é’®å¯ç”¨å¹¶åœ¨ hover æ˜¾ç¤ºã€‚"
      description: "ç¨³å®šåŒºå¼ºè°ƒä¸Šçº¿å‡†å¤‡åº¦ï¼Œå°é¢æŒ‰é’® hoverâ¬† å‡ºç°ã€‚"
    - name: "Legacy"
      palette: "ç°é˜¶æ¸å˜ (#F3F4F6â†’#E5E7EB)ï¼Œå†…éƒ¨å…ƒç´ é™é¥±å’Œï¼Œå¡ç‰‡ä»…æ”¯æŒæŸ¥çœ‹ã€‚"
      description: "Legacy åªè¯»ï¼Œèœå•æ˜¾ç¤ºâ€œåªè¯»â€æç¤ºï¼Œç¼–è¾‘/åˆ é™¤/å°é¢æŒ‰é’®ç¦ç”¨ã€‚"
    section_header_hint: "æ¯ä¸ª section header ä¸‹æ–¹å¢åŠ è¯´æ˜ï¼š'æ¥æºï¼šå½“å‰ maturity = {section}'ï¼Œæ˜ç¡®åˆ†åŒºç”±æœåŠ¡ç«¯ maturity å­—æ®µå®æ—¶é©±åŠ¨ã€‚"
  summary_bar:
    layout: "å®Œæˆåº¦æ¡ + å››ç±»è®¡æ•° + Totalï¼ˆæ˜¾ç¤ºâ€œå·²åŠ è½½/æ€»æ•°â€ï¼‰ã€‚"
    formula: "progress = stable_count / max(1, total - legacy_count)ã€‚"
    empty_state: "counts.total == 0 æ—¶éšè—æ•´æ¡ SummaryBarã€‚"
  pagination:
    hook: "useInfiniteBooks(bookshelfId)ï¼›load more æŒ‰é’®ç½®äºåˆ†ç»„ä¸‹æ–¹ã€‚"
    interaction: "ç‚¹å‡»â€œåŠ è½½æ›´å¤šä¹¦ç±â€æ—¶æŒ‰é’®ç½® loading æ–‡æ¡ˆï¼›æ— æ›´å¤šé¡µéšè—æŒ‰é’®ã€‚"
  animation:
    card_entry: "BookPreviewCard ä½¿ç”¨ fadeSlideIn åŠ¨ç”» (0.18s, translateY 10pxâ†’0)ã€‚"
    cross_section: "React key ä¾èµ– book.id + data-maturityï¼Œè·¨æˆç†Ÿåº¦ç§»åŠ¨æ—¶è§¦å‘é‡æ–°æŒ‚è½½è¿‡æ¸¡ã€‚"
  accessibility:
    legacy_tooltip: "ç¦ç”¨å°é¢æŒ‰é’® title='ä»…ç¨³å®šä¹¦ç±å¯é…ç½®å°é¢'ï¼›åªè¯»æç¤ºæ–‡æœ¬ä¿æŒå¯¹æ¯”åº¦ â‰¥4.5ã€‚"
  testing:
    - "Snapshotï¼š4 ä¸ªåˆ†åŒºçš„ç©ºæ€/æœ‰æ•°æ®çŠ¶æ€ã€‚"
    - "Unitï¼šprogress å…¬å¼åœ¨ total==legacy æ—¶è¿”å› 0ã€‚"
    - "Interactionï¼šåŠ è½½æ›´å¤šâ†’æŒ‰é’®ç¦ç”¨â†’React Query fetchNextPage è¢«è°ƒç”¨ä¸€æ¬¡ã€‚"

book_edit_dialog_v3:
  summary: "BookEditDialogï¼ˆfrontend/src/features/book/ui/BookEditDialog.tsxï¼‰ç»Ÿä¸€å¤„ç†ä¹¦åã€æ‘˜è¦ã€æ ‡ç­¾å¹¶ä¸€æ¬¡æ€§æäº¤ PATCH /api/v1/books/{id}ã€‚"
  entry_points:
    - "BookShowcaseItem / BookRowCard æ“ä½œåˆ—çš„ Edit å›¾æ ‡"
    - "Book å·¥ä½œåŒº Overview tab å†…çš„â€œç¼–è¾‘ä¹¦ç±â€æŒ‰é’®"
  layout:
    - "æ ‡é¢˜åŒºåªå±•ç¤ºä¸»æ ‡é¢˜ä¸å…³é—­æŒ‰é’®ï¼Œç§»é™¤æ—§ç‰ˆå‰¯æ ‡é¢˜ï¼›Dialog æ”¯æŒ mode='edit'/'create' ä¸¤å¥—æ–‡æ¡ˆï¼ˆ'ç¼–è¾‘ä¹¦ç±' / 'æ–°å»ºä¹¦ç±'ï¼‰ã€‚"
    - "å­—æ®µé¡ºåºï¼šæ ‡é¢˜ â†’ æ‘˜è¦ â†’ å°é¢å›¾æ ‡ï¼ˆBookCoverIconPickerï¼‰â†’ æ ‡ç­¾åŒº â†’ footerï¼›å°é¢æ®µåŒ…å«å½“å‰é¢„è§ˆ + 'æ›´æ¢' æŒ‰é’® + 'æ¢å¤é»˜è®¤' æŒ‰é’®ã€‚"
    - "æ ‡ç­¾åŒºå±•ç¤ºå·²é€‰ chip + è¾“å…¥æ¡† + helper textï¼Œè¾¾åˆ° 3 ä¸ªåè¾“å…¥æ¡†ç¦ç”¨å¹¶æ˜¾ç¤º 'å·²è¾¾åˆ°ä¸Šé™'ï¼›å¸¸ç”¨æ ‡ç­¾åŒºä½¿ç”¨ç´§å‡‘ chip è¡Œï¼ˆæœ€å¤š 2 è¡Œï¼‰ã€‚"
    - "å»ºè®®åˆ—è¡¨åœ¨æœç´¢æ—¶åˆ‡æ¢ä¸º useTagSearch ç»“æœï¼Œé»˜è®¤å›é€€åˆ° useMostUsedTagsï¼›ä¸¤è€…éƒ½é™åˆ¶ 8 é¡¹å¹¶é¿å¼€å·²é€‰æ ‡ç­¾ã€‚"
  modes:
    edit: "mode='edit' æ—¶åŠ è½½ç°æœ‰ Bookï¼Œprimary æŒ‰é’®æ˜¾ç¤º 'ä¿å­˜'ï¼›æäº¤åè°ƒç”¨ UpdateBookUseCase å¹¶è§¦å‘ onSavedã€‚"
    create: "mode='create' ç”± BookMainWidget +NEW BOOK æŒ‰é’®æ‰“å¼€ï¼Œprimary æŒ‰é’®æ˜¾ç¤º 'åˆ›å»º'ï¼›payload {bookshelf_id,library_id,title,summary?,cover_icon?}ï¼ŒæˆåŠŸå toast 'å·²åˆ›å»ºä¹¦ç±' å¹¶è§¦å‘ onCreatedã€‚"
  interaction_rules:
    - "æäº¤å‰ resolveTagSelectionsï¼šå…ˆå°è¯•åŒ¹é…å·²æœ‰ tagï¼Œå† fallback è‡³ searchTagsï¼Œæ–°æ ‡ç­¾é€šè¿‡ useCreateTag åˆ›å»ºå¹¶èµ‹äºˆ deterministic colorã€‚"
    - "æäº¤ payload å§‹ç»ˆæ˜¯å•æ¬¡ PATCHï¼š{title, summary?, tag_ids[]}ï¼›ç¦æ­¢é¢å¤–è°ƒç”¨ Tag Associate APIï¼Œä¿æŒä¹¦ç±æ›´æ–°å¹‚ç­‰ã€‚"
    - "æˆåŠŸå showToast('ä¹¦ç±ä¿¡æ¯å·²æ›´æ–°') å¹¶ invalidate TanStack Query `['books']` + `['books', book.id]`ï¼›Modal å…³é—­å‰åˆ·æ–°æœ¬åœ°å›è°ƒ onSavedã€‚"
    - "isSaving=true æ—¶ç¦æ­¢å…³é—­/è¾“å…¥æ ‡ç­¾ï¼Œç¡®ä¿åç«¯åŒæ­¥å®Œæˆåå†å…è®¸äº¤äº’ï¼›Backdrop ç‚¹å‡»è¢«ç¦ç”¨é¿å…åŠé€”é€€å‡ºã€‚"
    - "422/409 ç­‰ detail é€šè¿‡ inline error + toast æç¤ºï¼Œä¿ç•™è¾“å…¥å€¼ï¼›TAG_LIMIT ç›´æ¥æç¤ºâ€œæ ‡ç­¾æœ€å¤š 3 ä¸ªâ€ã€‚"
    - "mode='create' ä¸‹è‹¥ tag_ids éœ€äºŒæ¬¡ PATCHï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰ï¼ŒUI ç»§ç»­æ˜¾ç¤ºå•ä¸€ Loadingï¼Œå®Œæˆåç»Ÿä¸€å…³é—­ Dialogã€‚"
  accessibility:
    - "åˆå§‹èšç„¦æ ‡é¢˜è¾“å…¥ï¼›æ ‡ç­¾ chip åˆ é™¤æŒ‰é’®å¸¦ aria-label='ç§»é™¤æ ‡ç­¾ {name}'ï¼ŒBackspace åœ¨è¾“å…¥ä¸ºç©ºæ—¶åˆ é™¤æœ€åä¸€ä¸ª chipã€‚"
    - "å»ºè®®åˆ—è¡¨æŒ‰é’®ä¸º <button type='button'>ï¼Œaria-label='ä½¿ç”¨æ ‡ç­¾ {name}' å¹¶å«çŠ¶æ€æ–‡æœ¬ï¼ˆå¸¸ç”¨/åŒ¹é…ï¼‰ã€‚"
  testing:
    - "Vitestï¼šresolveTagSelections å»é‡ + create åˆ†æ”¯ï¼Œensure 3+ tags è¢«æˆªæ–­ã€‚"
    - "E2Eï¼šæ‰“å¼€â†’æ–°å¢æ ‡ç­¾â†’ä¿å­˜â†’BookRibbon å³åˆ»æ˜¾ç¤ºæ–°æ ‡ç­¾â†’é‡æ–°æ‰“å¼€é¢„å¡«ä¸€è‡´ã€‚"
  status: "Adopted Nov 27, 2025"

  book_cover_icon_visual_rules:
    summary: "Plan88 å°†å°é¢ä¸­å¿ƒçš„ 3D å›¾æ ‡ä»â€œçº¯é¦–å­—æ¯â€å‡çº§ä¸º Lucide iconï¼Œå¯é€‰ 4 ç»„å…± 16â€“24 ä¸ªã€‚"
    hierarchy:
      icon_layer: "å°é¢æ­£é¢ä¸­å¤®å›¾æ ‡ï¼ˆLucide Icon or letterï¼‰"
      ribbon_layer: "å·¦ä¸Šè§’ ribbonï¼ˆæ ‡ç­¾/æˆç†Ÿåº¦ fallbackï¼‰"
      badge_layer: "å³ä¸Šè§’ maturity pillï¼ˆSeed/Growing/Stable/Legacyï¼‰"
    rendering_order:
      - "`book.coverIcon` å­˜åœ¨ â†’ æ¸²æŸ“ lucide-react Icon ç»„ä»¶ï¼ˆå¡«å……è‰²æ²¿ç”¨å½“å‰å°é¢å‰æ™¯è‰²ï¼‰ï¼Œä¸å†æ˜¾ç¤ºé¦–å­—æ¯ã€‚"
      - "`coverIcon` ä¸º null â†’ fallbackFn(title)ï¼›è§„åˆ™ï¼šè‹±æ–‡æ ‡é¢˜å–é¦–å­—æ¯ï¼ˆå¤§å†™ A-Zï¼‰ï¼Œå…¶å®ƒè¯­è¨€å›ºå®šä½¿ç”¨ `book-open` iconã€‚"
      - "Icon/Letter å¤§å° 48pxï¼Œä¿æŒä¸ 3D é€è§†ä¸€è‡´ï¼›é€æ˜èƒŒæ™¯ï¼Œé˜´å½±æ²¿ç”¨ç°æœ‰ CSS å˜é‡ã€‚"
    color_rules:
      - "æ‰€æœ‰ icon å¡«å……ä½¿ç”¨çº¯ç™½ (#FFFFFF) + 12% æŠ•å½±ï¼Œç¡®ä¿åœ¨è“ç´«ç³»å°é¢ä¸Šå…·å¤‡å¯¹æ¯”åº¦ï¼›hover ä»…æ”¹å˜åº•åº§é˜´å½±ï¼Œicon æœ¬èº«ä¸å˜è‰²ã€‚"
      - "æš—è‰²ä¸»é¢˜ä¸‹æ²¿ç”¨ç›¸åŒ SVGï¼Œä½†å°é¢åº•è‰²è‡ªåŠ¨å˜äº®ï¼›ç¦æ­¢æ ¹æ® theme åˆ‡æ¢ icon é¢œè‰²ï¼Œä¿æŒç»Ÿä¸€è§†è§‰è¯­è¨€ã€‚"
    guardrails:
      - "Icon ä¸ä¸æˆç†Ÿåº¦é¢œè‰²ç»‘å®šï¼Œé¿å…â€œçœ‹é¢œè‰²çŒœé˜¶æ®µâ€ã€‚"
      - "Tag ribbon ä»æŒ‰ tags_summary[0] â†’ buildBookRibbonï¼Œäº’ä¸å½±å“ã€‚"
      - "Basement/Legacy åªè¯»æ ·å¼ï¼šicon ä»å¯æ˜¾ç¤ºï¼Œä½† hover æ“ä½œæŒ‰é’®ä¿æŒç¦ç”¨ã€‚"
    testing:
      - "Screenshotï¼šé¦–å­—æ¯ fallback / Lucide icon / ä¸­æ–‡ä¹¦å / ç©ºæ ‡ç­¾åœºæ™¯ã€‚"
      - "Unitï¼šfallbackFn åˆ¤æ–­ ASCII æ ‡é¢˜ â†’ letterï¼Œå…¶ä½™ â†’ book-openã€‚"
    status: "Adopted Nov 28, 2025"

  book_cover_icon_picker_v1:
    summary: "BookEditDialog å¢åŠ â€œå°é¢å›¾æ ‡â€æ®µï¼Œä½¿ç”¨ Popover åˆ†ç»„å±•ç¤º 16â€“24 ä¸ª Lucide å›¾æ ‡ï¼Œå•å±é€‰å®Œã€‚"
    entry_points:
      - "BookShowcaseItem / RowCard æ“ä½œåˆ—çš„ Edit å›¾æ ‡"
      - "Book Detail Overview Tab çš„â€œç¼–è¾‘ä¹¦ç±â€æŒ‰é’®"
    ui_layout:
      - "åœ¨æ ‡é¢˜è¾“å…¥ä¸‹æ–¹æ–°å¢ä¸€è¡Œ labelï¼š'å°é¢å›¾æ ‡' + å½“å‰ icon é¢„è§ˆ + 'æ›´æ¢' æŒ‰é’®ã€‚"
      - "æŒ‰é’®ç‚¹å‡»å¼¹å‡º Popoverï¼Œå·¦ä¾§ 4 ä¸ª Tabï¼šğŸŒ é€šç”¨ã€âœ¨ å¤©ç©º/Moodã€ğŸ§ª ç ”ç©¶/å­¦ä¹ ã€âš–ï¸ è´¢åŠ¡/æ³•å¾‹ï¼›å³ä¾§å›ºå®š 4Ã—4/5Ã—5 gridï¼Œä¸€å±å±•ç¤ºå…¨éƒ¨ iconã€‚"
      - "æ¯ä¸ª icon button 40Ã—40ï¼Œhover æœ‰ä¸ç»¸è“æè¾¹ï¼Œé€‰ä¸­æ€å¡«å……èƒŒæ™¯ + check overlayï¼›å†æ¬¡ç‚¹å‡»åŒä¸€ icon = ç»´æŒé€‰ä¸­ï¼Œåº•éƒ¨æä¾›â€œæ¢å¤é»˜è®¤â€æŒ‰é’®æ¸…é™¤ coverIconã€‚"
    interaction:
      - "é€‰æ‹© icon å³ä¿®æ”¹æœ¬åœ° state å¹¶å®æ—¶æ›´æ–°å°é¢é¢„è§ˆï¼›ç‚¹å‡»ä¿å­˜æ—¶ä¸ title/summary/tag_ids åŒæ­¥ PATCH {cover_icon}."
      - "ä¸æä¾›æœç´¢æˆ–è‡ªå®šä¹‰è¾“å…¥ï¼›ç™½åå•å¸¸é‡æ”¾åœ¨ `frontend/src/entities/book/config/coverIcons.ts`ï¼Œå«ä¸­æ–‡åˆ†ç»„åã€‚"
      - "Popover æ”¯æŒé”®ç›˜ï¼šTab åœ¨ TabList â†” Grid é—´åˆ‡æ¢ï¼Œæ–¹å‘é”®åœ¨ grid ä¸­ç§»åŠ¨ï¼ŒEnter é€‰æ‹©ï¼›Esc å…³é—­ã€‚"
      - "Loading/ç¦ç”¨ï¼šå½“ mutation pending æ—¶ï¼ŒæŒ‰é’® disabledï¼Œé˜²æ­¢å¤šæ¬¡æäº¤ã€‚"
    accessibility:
      - "Popover role='dialog' aria-label='é€‰æ‹©å°é¢å›¾æ ‡'ï¼›Tab ä¸ button å‡æä¾› aria-label='é€‰æ‹©å›¾æ ‡ {name}'ã€‚"
      - "é»˜è®¤ç­–ç•¥è¯´æ˜æ–‡æœ¬ï¼š'è‹¥ä¸é€‰æ‹©ï¼Œå°†ä½¿ç”¨é¦–å­—æ¯æˆ– book-open å›¾æ ‡'ã€‚"
    status: "Adopted Nov 28, 2025"

chronicle_timeline_visual_rules:
  summary: "Chronicle æ—¶é—´çº¿ï¼ˆPlan42 â†’ Plan117ï¼‰åœ¨ Book è¯¦æƒ…ä¸ /admin/chronicle é¡µé¢å¤ç”¨ï¼Œç›®æ ‡æ˜¯è®²è¿°â€œä¹¦çš„æˆé•¿å²â€è€Œéåªåˆ—åå°äº‹ä»¶ã€‚"
  hook_contract:
    file: "frontend/src/features/chronicle/useChronicleTimeline.ts (å¾…å®ç°)"
    api: "GET /api/v1/chronicle/books/{bookId}/events?page&size&event_types[]&include_visits=false"
    pagination: "æ²¿ç”¨ Pagination Contract V2ï¼›hook æš´éœ² {events, fetchNextPage, hasMore, isFetchingNextPage}"
    consumer_notes:
      - "Book å·¥ä½œåŒº Timeline tab å¤ç”¨è¯¥ hookï¼›Block mutations ç»“æŸåä»…è°ƒç”¨ invalidateQueries(['chronicle',bookId])ï¼Œç¦æ­¢æ‰‹åŠ¨ append äº‹ä»¶ã€‚"
      - "UI é»˜è®¤ include_visits=falseï¼›å‹¾é€‰â€œæ˜¾ç¤ºè®¿é—®æ—¥å¿—â€æ—¶ä»…åˆ‡æ¢æŸ¥è¯¢å‚æ•°ï¼Œä¸å¦é€ ç«¯ç‚¹ã€‚"
  card_layout:
    - "å·¦ä¾§ 32px iconï¼ˆæ ¹æ® event_typeï¼šcreated/moved/basement/restored/deleted/opened/maturity_recomputed/structure_task_*ï¼‰ï¼›æˆç†Ÿåº¦é‡ç®—ä½¿ç”¨ Gaugeï¼Œç»“æ„ä»»åŠ¡å®Œæˆ/å›é€€åˆ†åˆ«ä½¿ç”¨ CheckCircle2/RotateCcwã€‚"
    - "ä¸»ä½“ï¼štitleï¼ˆæœ¬åœ°åŒ– event å­—æ®µï¼‰+ payload æ‘˜è¦ï¼ˆä¾‹å¦‚â€œä»ä¹¦æ©±A â†’ ä¹¦æ©±Bâ€ï¼‰+ è¡Œå†…æ ‡ç­¾ï¼ˆactorã€bookshelfï¼‰"
    - "å³ä¾§ï¼šæ—¶é—´æˆ³äºŒè¡Œæ˜¾ç¤ºï¼ˆoccurred_at ç›¸å¯¹æ—¶é—´ + ç»å¯¹æ—¶é—´ tooltipï¼‰"
    stage_changed_payload: "Stage change å¡ç‰‡å¿…é¡»å±•ç¤º fromâ†’to æ–‡æ¡ˆ + å½“å‰ maturity_scoreï¼›æ ‡é¢˜æ ¹æ® stage é¡ºåºå·®å¼‚è‡ªåŠ¨åˆ‡æ¢â€œæˆç†Ÿåº¦é˜¶æ®µæ™‹çº§â€/â€œæˆç†Ÿåº¦é˜¶æ®µå›é€€â€ï¼Œè‹¥ manual override åˆ™åœ¨æ ‡é¢˜å³ä¾§æ¸²æŸ“é—ªç”µ iconã€‚"
    maturity_events_payload:
      - "book_maturity_recomputedï¼šæ‘˜è¦æ˜¾ç¤º Score previousâ†’new + Î”delta + Stage + Triggerï¼›åˆæ¬¡è¯„ä¼°é™„åŠ â€œé¦–æ¬¡è®¡ç®—â€æç¤ºã€‚"
      - "structure_task_completedï¼šæ‘˜è¦æ˜¾ç¤ºä»»åŠ¡æ ‡é¢˜ + (+points) + Stage + Triggerï¼›points å–ç»å¯¹å€¼å¹¶æ·»åŠ æ­£å·ã€‚"
      - "structure_task_regressedï¼šæ‘˜è¦æ˜¾ç¤ºä»»åŠ¡æ ‡é¢˜ + (-points) + Stage + Triggerï¼›points ä¸ºè´Ÿå·ï¼Œå¼ºè°ƒå›é€€ã€‚"
  grouping_rules: "æŒ‰ occurred_at DESC å•åˆ—æ’åˆ—ï¼›ä¸åšåµŒå¥—åˆ†ç»„ï¼Œé¿å…ä¸ maturity åˆ—è¡¨å†²çªã€‚"
  event_palette:
    - "book_createdï¼šIcon=BookOpenCheckï¼ŒTitle='ä¹¦ç±åˆ›å»ºå®Œæˆ'ï¼Œæ‘˜è¦æ˜¾ç¤º {bookshelf_name} + åˆ›å»ºè€…ï¼›æ”¾åœ¨æ—¶é—´çº¿é¡¶éƒ¨ä½œä¸ºâ€œå‡ºç”Ÿè¯æ˜â€ã€‚"
    - "book_soft_deletedï¼šIcon=Trash2ï¼ŒTitle='ç§»å…¥ Basement'ï¼Œæ‘˜è¦åŒ…å«æ¥æºä¹¦æ©±ã€æ“ä½œäººï¼›å½“ä¹¦è¢«æ¢å¤æ—¶ stage_changed äº‹ä»¶ä¼šç´§éšå…¶åã€‚"
    - "cover_changed/cover_color_changedï¼šIcon=Image æˆ– Dropletï¼Œæ‘˜è¦ä¸º 'å°é¢æ”¹ä¸º {variant}' æˆ– 'ä¸»é¢˜è‰²æ›´æ–°ä¸º #{hex}'ï¼ŒHover æä¾›æ›´æ¢åŸå› ã€‚"
    - "content_snapshot_takenï¼šIcon=Layersï¼Œæ–‡æ¡ˆ 'ä»Šæ—¥å¿«ç…§ï¼š{block_count} blocks Â· {type_count} types Â· {word_count} å­—'ï¼ŒSnapshot tag å³å¯¹é½æ˜¾ç¤ºè§¦å‘å™¨ï¼ˆæ‰‹åŠ¨åˆ·æ–°/è‡ªåŠ¨ï¼‰ã€‚"
    - "wordcount_milestone_reachedï¼šIcon=BarChart2ï¼Œæ ‡é¢˜ 'çªç ´ {milestone} å­—'ï¼Œæ‘˜è¦æç¤ºç›¸å¯¹æ—¶é—´ä¸æ€»å­—æ•°ï¼›é»˜è®¤æä¾› 1k/5k/10k ä¸‰ä¸ªé˜ˆå€¼è‰²æ ‡ã€‚"
    - "todo_promoted_from_block/todo_completedï¼šIcon=Star æˆ– Checkï¼Œæ‘˜è¦åˆ—å‡º todo æ ‡é¢˜åˆ—è¡¨ï¼ˆæœ€å¤š 3 æ¡ï¼Œè¶…å‡ºä»¥ '+N' æ”¶å°¾ï¼‰ï¼Œå¹¶è¯´æ˜æ˜¯å¦å½±å“ maturityã€‚"
    - "stage_changedã€book_maturity_recomputedã€structure_task_* ç»§ç»­æ²¿ç”¨ Plan115 æè¿°ï¼Œä½†å­—ä½“/é¢œè‰²éµå®ˆ NextStepsChecklist è½»é‡å­—é‡ï¼ˆ0.875rem/450/secondaryï¼‰ã€‚"
  copy_templates:
    stage_changed: "{from_label} â†’ {to_label} Â· Score {score} Â· {trigger} Â· {manual?}"
    maturity_recomputed: "Score {prev} â†’ {next} Î”{delta} Â· é˜¶æ®µ {stage_label} Â· {trigger}"
    structure_task_completed: "å®Œæˆ {task_name} (+{points}) Â· é˜¶æ®µ {stage_label}"
    cover_changed: "å°é¢åˆ‡æ¢ä¸º {cover_variant}ï¼ˆ{actor}ï¼‰"
    content_snapshot_taken: "Blocks {block_count} Â· Types {type_count} Â· {word_count} å­— Â· è§¦å‘ {trigger}"
    wordcount_milestone_reached: "ç´¯è®¡ {word_count} å­—ï¼Œè¾¾åˆ° {milestone_label}"
    todo_promoted_from_block: "å‡çº§å¾…åŠï¼š{titles}"
    todo_completed: "å®Œæˆå¾…åŠï¼š{titles}"
  filters_update:
    - "æ—¶é—´çº¿ Tab é»˜è®¤å‹¾é€‰ P0+P1 äº‹ä»¶ï¼›Overview å¡ç‰‡ä»…å±•ç¤º P0 + wordcount milestonesï¼Œé¿å…å¡ç‰‡è¿‡åº¦æ»šåŠ¨ã€‚"
    - "Filter chips æ–°å¢ 'å†…å®¹å¿«ç…§'ã€'å­—æ•°é‡Œç¨‹ç¢‘'ã€'å°é¢'ã€'Todo' å››ç±»ï¼Œç‚¹å‡»å³è°ƒæ•´ event_types æ•°ç»„ï¼›åº•éƒ¨ Toggle ä¾æ—§å•ç‹¬æ§åˆ¶ book_openedã€‚"
    - "å½“ç”¨æˆ·ç¦ç”¨æ‰€æœ‰ç±»åˆ«æ—¶è‡ªåŠ¨æ¢å¤ P0 åŸºçº¿å¹¶ç»™å‡ºæç¤º 'è‡³å°‘ä¿ç•™ä¸€ç§äº‹ä»¶ç±»å‹'ã€‚"
  filtering:
    - "é»˜è®¤è¿‡æ»¤æ‰ book_openedï¼Œé™¤éç”¨æˆ·å‹¾é€‰â€œæ˜¾ç¤ºæ‰€æœ‰è®¿é—®æ—¥å¿—â€"
    - "UI é€šè¿‡ multi-select chips å†™å…¥ event_types[] æ•°ç»„"
  empty_state:
    message: "æš‚æ— äº‹ä»¶ï¼Œå®Œæˆç¬¬ä¸€ä¸ªæ“ä½œåä¼šåœ¨è¿™é‡Œçœ‹åˆ°å†å²è®°å½•"
    actions: "æä¾›â€œæ–°å»ºä¹¦ç±â€æˆ–â€œæ‰“å¼€ä¹¦ç±â€ CTA"
  accessibility:
    - "Timeline åˆ—è¡¨ä½¿ç”¨ role='feed' + aria-live='polite'ï¼Œæ–°äº‹ä»¶ append æ—¶ announce"
    - "Icon éœ€ aria-labelï¼ˆä¾‹å¦‚â€œä¹¦ç±å·²åˆ›å»ºâ€ï¼‰"
  testing:
    - "Hook mock testsï¼šåˆ†é¡µ + hasMore false åœºæ™¯"
    - "Component testsï¼šä¸åŒ event_type å›¾æ ‡/æ‘˜è¦å¿«ç…§"
    - "Interaction testsï¼šç‚¹å‡»â€œæ˜¾ç¤ºè®¿é—®æ—¥å¿—â€è§¦å‘ event_types åŒ…å« book_opened"
  updates:
    - date: "2025-11-29"
      note: "ChronicleTimelineList æ–°å¢æˆç†Ÿåº¦é‡ç®—/ç»“æ„ä»»åŠ¡äº‹ä»¶ä¸­æ–‡æ ‡ç­¾ä¸æ‘˜è¦ï¼Œå¹¶æ ¹æ®é˜¶æ®µé¡ºåºåŠ¨æ€è¾“å‡ºâ€œæ™‹çº§/å›é€€â€æ ‡é¢˜ï¼›Overview å¡ç‰‡åŒæ ·ç»§æ‰¿æ–°æ˜ å°„ã€‚"
    - date: "2025-11-30"
      note: "Timeline å¡ç‰‡èƒŒæ™¯æ”¹ä¸º var(--color-surface-shell,#fafbfc)ï¼ŒåŒæ­¥å¤ç”¨ maturity overview Shell è§†è§‰ï¼›åˆ—è¡¨å­—ä½“/é¢œè‰²å¯¹é½ Score breakdownï¼Œä»¥ä¾¿åœ¨ Book Overview åˆ—æ— ç¼å…±å­˜ã€‚"

block_internal_timeline_debug_view:
  summary: "Plan86 block å†…æ—¶é—´çº¿ä»…å¯¹ QA/å¼€å‘äººå‘˜å¯è§ï¼ˆ/admin/blocksï¼‰ï¼Œå±•ç¤ºå•ä¸ª Block/Todo çš„ chronicle äº‹ä»¶ã€‚"
  layout:
    - "é¡µé¢å·¦åˆ—æ¸²æŸ“ Block å†…å®¹å¡ç‰‡ï¼Œå³åˆ—ä¸ºç´§å‡‘å‹ Timelineï¼ˆicon 24pxã€è¡Œé«˜ 32pxï¼‰ã€‚"
    - "äº‹ä»¶ç±»å‹åŒ…å« block_created/updated/deleted/restored + todo_item_*ï¼›é¢œè‰²æ²¿ç”¨ Chroncile ä¸»è‰²ï¼Œä½†é€æ˜åº¦å‡åŠï¼Œæç¤ºâ€œè°ƒè¯•è§†å›¾â€ã€‚"
  filters:
    - "é¡¶éƒ¨æä¾›äº‹ä»¶ç±»åˆ«å¼€å…³ï¼ˆBlock / Todo / Systemï¼‰ï¼Œé»˜è®¤ä»…é€‰ä¸­ Blockã€‚"
    - "å¼€å‘è€…å¯é€šè¿‡ query param `?event_types=todo_item_created,todo_item_completed` ç›´æ¥è¿‡æ»¤ã€‚"
  accessibility:
    - "åˆ—è¡¨ä½¿ç”¨ role='log'ï¼Œaria-live='polite'ï¼›æ»šåŠ¨æ—¶ä¿ç•™ç„¦ç‚¹åœ¨äº‹ä»¶åˆ—è¡¨å†…ã€‚"
  guardrails:
    - "è¯¥è§†å›¾ä¸æš´éœ²åœ¨ç”Ÿäº§å¯¼èˆªä¸­ï¼Œä»…é€šè¿‡ç›´æ¥ URL è®¿é—®ï¼›Banner æ ‡æ³¨â€œDebug Onlyâ€ã€‚"
    - "ä»»ä½•æ“ä½œæŒ‰é’®å‡ä¸ºåªè¯»ï¼Œç¦æ­¢åœ¨ Debug å…¥å£ç¼–è¾‘ Book/Blockã€‚"
  testing:
    - "Storybookï¼šblock timelineï¼ˆblock events only / block+todoï¼‰"
    - "Manualï¼šéªŒè¯è¿‡æ»¤ chips æ˜¯å¦å½±å“ event_types å‚æ•°ä»¥åŠ URL åŒæ­¥ã€‚"

book_workspace_tabs_visual_rules:
  summary: "Plan56ï¼ˆNov 27, 2025ï¼‰é”å®š Book è¯¦æƒ…é¡µä¸ºå”¯ä¸€å·¥ä½œåŒºï¼šæ¦‚è§ˆ / å—ç¼–è¾‘ / æ—¶é—´çº¿ ä¸‰ä¸ªé€‰é¡¹å¡åœ¨åŒä¸€é¡µé¢å®Œæˆã€‚"
  hero_card:
    layout: "é¡¶éƒ¨ hero å¡ç‰‡å±•ç¤ºä¹¦ç±æ ‡é¢˜ã€å½’å±ï¼ˆä¹¦æ©±Â·ä¹¦åº“ï¼‰ã€ç®€ä»‹ä¸çŠ¶æ€ pillï¼›å³ä¾§ä»¥ maturity/status/lifecycle ä¸‰æšèƒ¶å›Šç»“åˆã€‚"
    metrics: "ä¸‹æ–¹æŒ‡æ ‡ç½‘æ ¼å±•ç¤º Stageã€æˆç†Ÿåº¦å¾—åˆ†ï¼ˆ0-100ï¼‰ã€Block æ€»æ•°ã€Chronicle äº‹ä»¶æ€»æ•°ã€æœ€è¿‘äº‹ä»¶æ—¶é—´ã€è¿‘ 90 å¤©è®¿é—®æ•°ä¸æœ€è¿‘è®¿é—®æ—¶é—´ï¼›å ä½ç¬¦ä»¥ 'â€”' å‘ˆç°ï¼Œhover tooltip è¡¥å……ç²¾ç¡®æ—¶é—´æˆ–è¯´æ˜ã€‚"
    coverage_indicator: "æˆç†Ÿåº¦è¿›åº¦æ¡ä»¥ Book.maturityScore æ˜¾ç¤º 0-100%ï¼Œæ ·å¼æ²¿ç”¨ BookMainWidget SummaryBarï¼›æ— è¶³å¤Ÿæ•°æ®æ—¶ä¿æŒç°è‰²è½¨é“ + 'æš‚æ— æ•°æ®' æ–‡æ¡ˆï¼Œä¸ä¼ªé€ ç™¾åˆ†æ¯”ã€‚"
    styling: "å¡ç‰‡ä½¿ç”¨ 16px åœ†è§’ + é˜´å½± + theme token è¾¹æ¡†ï¼›ç§»åŠ¨ç«¯æ”¶ç´§ä¸º 24px paddingï¼›Basement/Deleted ä¹¦ç±éœ€åœ¨æ ‡é¢˜å³ä¾§æ¸²æŸ“ 'Basement Â· åªè¯»' é»„è‰² Bannerï¼Œå¹¶åŒæ­¥ç¦ç”¨ hero actionã€‚"
    maturity_badge: "æœ¬é¡µé¢ä»…å±•ç¤º BookMaturityBadgeï¼ˆSeed/Growing/Stable/Legacyï¼‰ä¸çŠ¶æ€ capsuleï¼Œç¦æ­¢å¼•å…¥ Bookshelf/å…¨å±€æˆç†Ÿåº¦åˆ†åŒºç»„ä»¶ï¼Œä¿æŒâ€œå•æœ¬ä¹¦â€è¯­ä¹‰ã€‚"
  tabs:
    order: "æ¦‚è§ˆ â†’ å—ç¼–è¾‘ â†’ æ—¶é—´çº¿ï¼›æŒ‰é’®æ”¾åœ¨æµ…è‰² capsule å®¹å™¨å†…ï¼Œæ¿€æ´»æ€ç™½åº• + é˜´å½±ã€‚"
    persistence: "localStorage key `wordloom.book.detail.tab:{bookId}` å­˜å‚¨æœ€åä¸€æ¬¡é€‰æ‹©ï¼›åˆ‡æ¢ä¹¦ç±æ—¶é‡ç½®ä¸ºæ¦‚è§ˆï¼Œå¹¶æ¸…ç†ä¸Šä¸€æœ¬ä¹¦çš„ç¼“å­˜ï¼Œé˜²æ­¢è·¨å®ä½“æ±¡æŸ“ã€‚"
    behavior: "åˆ‡æ¢ä»…æ”¹å˜å±•ç¤ºå±‚ï¼Œé¿å…é‡æ–°è¯·æ±‚å·²æœ‰ TanStack Query æ•°æ®ï¼›aria-selected ä¸ role='tab' å¿…é¡»åŒæ­¥æ›´æ–°ï¼›`/admin/blocks` é“¾æ¥è¢«ç§»é™¤ï¼Œä»…åœ¨ DevTools åŒºåŸŸæ˜¾ç¤º 'Debug Only' badgeã€‚"
  typography:
    - "2025-12-01ï¼šWorkspace é¡¶éƒ¨ Tabs å­—é‡æ”¾å®½ä¸º 350ï¼ˆé»˜è®¤ï¼‰/450ï¼ˆæ¿€æ´»ï¼‰ï¼Œç»´æŒ 0.92rem + 0.08em letter-spacing ä¸å…¨å¤§å†™ï¼Œå‡è½»æ ‡é¢˜åŒºè§†è§‰å‹åŠ›ã€‚"
    - "Maturity Insights segmented control é‡‡ç”¨åŒæ ·çš„è½»é‡ pillï¼ˆfont-weight=400ï¼‰ï¼Œhover/active ä»ä½¿ç”¨ä¸ç»¸è“ä¸‹åˆ’çº¿å³å¯ï¼Œæ— éœ€é¢å¤–é˜´å½±ã€‚"
  overview_tab:
    layout: "å·¦åˆ—åŒ…å«â€œBook æ¦‚è§ˆâ€â€œå—æ´»åŠ¨â€â€œæ—¶é—´çº¿é€Ÿè§ˆâ€â€œBookshelf æ´»åŠ¨æ³¨è®°â€ç­‰ sectionCardï¼Œå³åˆ—ä¸ºç²˜æ€§ InfoPanelã€‚"
    info_panel: "å³ä¾§ InfoPanel ä½¿ç”¨ sticky top 96pxï¼Œå±•ç¤ºä¹¦åº“/ä¹¦æ©±/ID/æ—¶é—´æˆ³/å—æ•°/çŠ¶æ€/æ ‡ç­¾å ä½ï¼Œå¹¶åœ¨ Basement çŠ¶æ€ä¸‹æ›¿æ¢æ“ä½œæŒ‰é’®ä¸ºå•ä¸€â€œæ¢å¤ä¹¦ç±â€ CTAã€‚"
    timeline_summary: "â€œæœ€è¿‘äº‹ä»¶â€å¡ç‰‡è°ƒç”¨ useRecentChronicleEvents(bookId,{limit:5})ï¼Œé»˜è®¤æ’é™¤ book_openedï¼Œè¡Œå†…å‘ˆç°ç›¸å¯¹æ—¶é—´ + äº‹ä»¶æ ‡é¢˜ + payload æ‘˜è¦ï¼›æä¾›â€œæŸ¥çœ‹å…¨éƒ¨â€æŒ‰é’®åˆ‡æ¢åˆ° Chronicle tabã€‚"
    structure_tasks: "â€œç»“æ„ä»»åŠ¡â€å¡ç‰‡ä»¥ Checklist æ ·å¼ç½—åˆ—æœ€å¤š 5 é¡¹æˆç†Ÿåº¦å»ºè®®ï¼šæœªå®Œæˆé¡¹å‰ç½®å¹¶ä½¿ç”¨ç©ºå¿ƒåœ†ï¼Œå®Œæˆé¡¹æ·¡åŒ–ï¼›Legacy çŠ¶æ€åˆ‡æ¢ä¸ºæ¢å¤æç¤ºã€‚"
    bookshelf_activity_note: "æ¦‚è§ˆåŒºéœ€åŒ…å«æ‰€å± Bookshelf çš„æ´»è·ƒåº¦æç¤ºï¼ˆPinned/Archived/Last Activityï¼‰ï¼Œæ–‡æ¡ˆå¼•ç”¨ BookshelfDashboard DTOï¼›æ— é¢å¤– API æ—¶æ˜¾ç¤º '--' å ä½ã€‚"
    placeholders: "æœªæ¥å…¥çš„ç»Ÿè®¡ä»¥å¸¦è™šçº¿è¾¹æ¡†çš„ sectionPlaceholder å‘ˆç°ï¼Œå¹¶æ ‡æ³¨è´£ä»»ç«¯å£ï¼ˆä¾‹ï¼š'å¾…æ¥å…¥ block maturity heatmap Â· ä¾èµ– BlockMetricsPort'ï¼‰ã€‚"
  blocks_tab:
    composition: "æŒ‰é¡ºåºæ¸²æŸ“ InlineCreateBar â†’ BlockList â†’ BlockEditorï¼ˆå½“ editingId å­˜åœ¨ï¼‰â†’ DeletedBlocksPanelï¼›Basement/Legacy ä¹¦ç±é¡»éšè— InlineCreateBar ä¸ BlockEditorï¼Œä»…å±•ç¤º BlockList + BannerReadonlyã€‚"
    pagination: "å³ä¸‹è§’æŒ‰é’®ç”¨äº page Â±1 åˆ‡æ¢ï¼›ç¦ç”¨æ€åŠé€æ˜å¹¶ä¿æŒå¸ƒå±€ç¨³å®šï¼›é¡µè„šè¯´æ˜å½“å‰é¡µ/æ€»é¡µæ•°ï¼›Flat endpoint ç»§ç»­ä¼  page/pageSizeï¼Œç¦æ­¢åœ¨ UI ç«¯ä¸€æ¬¡æ€§å–å…¨éƒ¨å—ã€‚"
    editor_state: "ç‚¹å‡»åˆ—è¡¨é¡¹è¿›å…¥ BlockEditorï¼Œå³åˆ— InfoPanel ä¿æŒå¯è§ä»¥æä¾›ä¸Šä¸‹æ–‡ï¼›æˆåŠŸä¿å­˜/åˆ é™¤/æ¢å¤ååªè§¦å‘ invalidateQueries(['blocks',bookId])ï¼Œä¸æ‰‹åŠ¨ patch Chronicle åˆ—è¡¨ã€‚"
  chronicle_tab:
    layout: "å·¦åˆ—æ¸²æŸ“ ChronicleTimelineList å®Œæ•´åˆ†é¡µï¼ˆæ•°æ®æ¥è‡ª useChronicleTimelineï¼‰ï¼Œå³åˆ—æ²¿ç”¨ InfoPanelï¼›é¡¶éƒ¨æä¾›äº‹ä»¶è¿‡æ»¤ chipsï¼Œé»˜è®¤éšè— book_opened å¹¶é¢å¤–æä¾› include_visits toggleã€‚"
    empty_state: "å¤ç”¨ Timeline ç»„ä»¶ç©ºæ€æ–‡æ¡ˆï¼›ä»ä¿ç•™â€œæ–°å»ºä¹¦ç±â€/â€œæ‰“å¼€ä¹¦ç±â€ CTAï¼Œå¹¶æç¤ºâ€œæ—¶é—´çº¿ä»…åœ¨æœåŠ¡å™¨è®°å½•äº‹ä»¶åæ›´æ–°â€ã€‚"
    refresh_policy: "Block å†™æ“ä½œåä»…è°ƒç”¨ queryClient.invalidateQueries(['chronicle',bookId]) è§¦å‘åˆ·æ–°ï¼›include_visits å‚æ•°å˜åŒ–éœ€é‡æ–°å‘èµ·è¯·æ±‚ï¼›ç¦æ­¢æŠŠ mutation ç»“æœ append åˆ°æ—¶é—´çº¿ã€‚"
  responsiveness:
    - "â‰¤1100px æ—¶å¸ƒå±€åˆ‡æ¢ä¸ºå•åˆ—ï¼ŒInfoPanel å–æ¶ˆ stickyï¼›â‰¤768px æ—¶é¡µé¢ padding è°ƒæ•´ä¸º spacing-xlã€‚"
    - "TabList ä¸ pagination æ§ä»¶éœ€ä¿æŒå¯æ»šåŠ¨åŒºåŸŸä¸æŠ–åŠ¨ï¼ŒæŒ‰é’®é—´è·åœ¨çª„å±ä¿æŒ 4pxã€‚"
  accessibility:
    - "Breadcrumb + tabs +æŒ‰é’®å‡æä¾› aria æ ‡ç­¾ï¼›InfoPanel å†…å®¹ä½¿ç”¨ <dl> è¯­ä¹‰ã€‚"
    - "Block æ“ä½œæŒ‰é’®éµå¾ªåŸæœ‰ keyboard trapï¼ˆInlineCreateBar é¦–ä¸ªè¾“å…¥è‡ªåŠ¨èšç„¦ï¼‰ï¼›Basement åªè¯»æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç¦ç”¨æ§ä»¶éœ€æä¾› aria-disabled ä¸åªè¯»è¯´æ˜ã€‚"
  guardrails:
    - "Basement æˆ– Deleted ä¹¦ç±è¿›å…¥é¡µé¢æ—¶ï¼Œå±•ç¤º BannerReadonly + Restore CTAï¼Œå¹¶ç¦ç”¨å…¨éƒ¨ Block/Overview æ“ä½œï¼›æ¢å¤ååˆ·æ–°é¡µé¢æ¢å¤æ­£å¸¸æ¨¡å¼ã€‚"
    - "Legacy ä¹¦ç±ä¿ç•™ Block æµè§ˆï¼Œä½†åœ¨ hero card ä¸ BlockList å†…éƒ½åŠ åªè¯» iconï¼Œé˜»æ­¢å°é¢/é‡æ’æŒ‰é’®ã€‚"
    - "Page ä¸å¾—å¼•å…¥æ–°çš„ modal æˆ–æµ®å±‚æ¥ç¼–è¾‘ Blocksï¼›æ‰€æœ‰æ“ä½œå‡åœ¨è¡Œå†…å®Œæˆï¼Œé¿å…å›é€€åˆ° overlay æ–¹æ¡ˆã€‚"
    - "localStorage ä»…å­˜ activeTabï¼›å…¶ä»– UI çŠ¶æ€ï¼ˆfilterã€searchï¼‰å…¨éƒ¨èµ° React state/query paramsï¼Œé˜²æ­¢éš¾ä»¥æ¸…ç†çš„è·¨å®ä½“ç¼“å­˜ã€‚"
  testing:
    - "ç»„ä»¶å•æµ‹ï¼štab åˆ‡æ¢åä¿ç•™ activeTabï¼Œåˆ·æ–°åæ¢å¤ä¿å­˜å€¼ï¼›Basement ä¹¦ç±ç¦ç”¨ InlineCreateBarã€‚"
    - "è§†è§‰å›å½’ï¼šhero å¡ç‰‡ï¼ˆå« Basement Bannerï¼‰ã€Blocks è¯»å†™æ€ã€Chronicle tab è¿‡æ»¤æ§ä»¶ã€‚"
  status: "Updated Nov 27, 2025"

  # ===== Phase 1 ä¿®å¤ (Nov 20) =====
  bookshelf_creation_status: "âœ… FIXED - Dialog error handling + backend response serialization (Nov 20, 2025)"
  bookshelf_dialog_state_management: "âœ… RULE-SM-005 documented - No more race conditions (Nov 20, 2025)"
  backend_response_serialization_fix: "âœ… All 5 router endpoints: str() safe conversion instead of .value (Nov 20, 2025)"
  bookshelf_router_endpoints_fixed: "âœ… create_bookshelf | list_bookshelves | get_bookshelf | update_bookshelf | get_basement (Nov 20, 2025)"
  bookshelf_valuobject_fix: "âœ… create_bookshelf.py - Pass raw strings to factory, not str(ValueObject) (Nov 20, 2025)"

  # ===== ä¹‹å‰çš„çŠ¶æ€ (Nov 19) =====
  frontend_api_client_port: "âœ… Corrected to :30001"
  frontend_api_client_files_updated:
    - "/frontend/src/shared/api/client.ts"
    - "/frontend/next.config.js"
  frontend_cors_status: "âœ… Backend CORS updated for localhost:30002"

  backend_database_migration_status: "âœ… COMPLETE - WSL2 PostgreSQL (172.31.150.143:5432)"
  backend_running_port: 30001
  backend_running_url: "http://localhost:30001"
  backend_requirements_txt_updated: "âœ… asyncpg â†’ psycopg[binary]>=3.1"
  backend_files_synchronized: 5

  frontend_libraries_endpoint_status: "âœ… Library overview supports pinned segment + last-activity sort + archive toggle (Nov 22, 2025) - /api/v1/libraries?sort=last_activity&pinned_first=1&include_archived=0 è¿”å›æ‰©å±•å­—æ®µ pinned/pinned_order/archived_at/last_activity_at/views_count/last_viewed_atã€‚"
  basement_stats_degradation_status: "âœ… Basement stats temporarily degraded to static zeros; dynamic endpoint disabled after repeated 422/0B cascade (Nov 19, 2025)"
  lint_rule_enforcement_status: "âœ… Custom ESLint rule no-raw-fetch-host (blocks absolute host fetch & duplicate prefix) active (Nov 19, 2025)"
  frontend_performance_issues:
    - "main-app.js 1.3MB â†’ need code splitting"
    - "Preflight requests â†’ need CORS optimization"
    - "page.js 273KB â†’ analysis pending"
  frontend_architecture: "âœ… Feature-Sliced Design (FSD) - 6 strict layers with unified domain model"
  ui_card_components_status: "âœ… PHASE 5 COMPLETE - BookshelfPosterCard + hover controls + BookPreviewCard live (Nov 23, 2025)"
  css_theme_system_status: "âœ… Business Blue + Silk Blue runtime themes + Light/Dark/Loom legacy palettes (Nov 21, 2025)"
  theme_default_status: "âœ… Silk Blue promoted to default data-theme + storage fallback (Nov 21, 2025)"
  library_card_interaction_status: "âœ… Library card overlay layering + pointer/keyboard feedback hardened (Nov 21, 2025)"
  library_creation_dialog_accessibility_status: "âœ… Name è‡ªåŠ¨èšç„¦ + ESC å…³é—­ + Toast æˆåŠŸ/å¤±è´¥ (Nov 22, 2025)"
  flat_routing_status: "âœ… /admin/{entity} flat structure - Library, Bookshelf, Book as independent routes (Nov 17, 2025)"
  basement_virtual_library_status: "âœ… è™šæ‹Ÿ Basement å¡ç‰‡åŠ å…¥ libraries é¡µé¢ (ADR-072 Nov 18, 2025)"
  basement_delete_action_status: "âœ… Plan173E (Dec 6, 2025) BookMainWidget delete icon now routes through useMoveBookToBasement + confirm toast guard"
  basement_snapshot_widget_status: "âœ… Plan173H (Dec 6, 2025) BasementMainWidget consumes snapshot groups + availableBookshelves with hero stats"

basement_visual_rules:
  plan_reference: "Plan173A Â· Plan173B Â· Plan174B Basement refresh (Dec 2025)"
  summary: "Basement é¡µé¢å‡çº§ä¸ºâ€œä¹¦åº“é€‰æ‹© + å›æ”¶ç«™ä»ªè¡¨ç›˜â€åŒæ å¸ƒå±€ï¼Œå¹¶ç»Ÿä¸€ Restore æ¨¡æ€ä¸è™šæ‹Ÿ Basement å¡ç‰‡è§„åˆ™ã€‚"
  scope:
    - "frontend/src/widgets/basement/BasementMainWidget.tsx"
    - "frontend/src/app/admin/basement/page.tsx"
    - "frontend/src/widgets/RestoreBookModal"
    - "frontend/src/widgets/BasementLibraryCard"
  layout:
    hero_header:
      - "å·¦åˆ—æ˜¾ç¤º eyebrow=Basementã€title=å›æ”¶ç«™ã€å‰¯æ ‡é¢˜åŒæ­¥å½“å‰ä¹¦åº“åç§°ï¼›å³åˆ—æä¾› è¿”å›åº“åˆ—è¡¨ + åˆ·æ–°æŒ‰é’®ã€‚"
      - "æŒ‰é’®å‡ä½¿ç”¨ chip-styleï¼ˆborder-radius:999pxï¼‰ï¼›primary èµ° `--accent` tokenï¼Œsecondary ä½¿ç”¨é€æ˜èƒŒæ™¯+subtle è¾¹æ¡†ã€‚"
    grid:
      - "Desktop ä½¿ç”¨ä¸¤åˆ—å¸ƒå±€ï¼šå·¦åˆ— 240-300px ä¸ºä¹¦åº“é¢æ¿ï¼Œå³åˆ—ä¸º stats+groupï¼›â‰¤1024px è‡ªåŠ¨æŠ˜å ä¸ºå•åˆ—å¹¶æŠŠä¹¦åº“é¢æ¿ç½®é¡¶ã€‚"
    library_panel:
      search: "è¾“å…¥æ¡†ä½¿ç”¨ 999px åœ†è§’ã€`var(--border-subtle,#d5d9e2)` è¾¹æ¡†ï¼Œå®æ—¶é©±åŠ¨ useLibrariesï¼ˆå« 300ms debounceï¼‰ã€‚"
      list:
        - "Library å¡ç‰‡èƒŒæ™¯ `var(--surface-subdued,#f6f7fb)`ï¼Œhover/é€‰ä¸­æ—¶ä½¿ç”¨ silk-blue æ–¹æ¡ˆï¼šborder èµ° `var(--color-primary,#2e5e92)`ï¼ŒèƒŒæ™¯åˆ‡åˆ° rgb(240,246,254)#f0f6feï¼Œå¹¶å åŠ  0 8px 24px rgba(17,34,68,0.12) é˜´å½±ã€‚"
        - "æ–‡æ¡ˆç»Ÿä¸€ä½¿ç”¨ `--text-strong`/`--text-muted`ï¼›æœ€è¿‘æ´»åŠ¨æ˜¾ç¤º formatRelativeTimeã€‚"
    stats_panel:
      hero_cards: "å››ä¸ª statCardï¼ˆåˆ é™¤ä¹¦ç±/ä¹¦æ¶åˆ†ç»„/å¤±è”ä¹¦æ¶/æœ€è¿‘åˆ é™¤ï¼‰åœ¨ä¸€è¡Œ auto-fitï¼›ç§»åŠ¨ç«¯å †å ã€‚"
      tokens: "èƒŒæ™¯ `var(--surface,#fafbff)`ï¼Œlabel ç”¨ `--text-muted`ï¼Œvalue ç”¨ `--text-strong`ã€‚"
    groups_grid:
      structure: "CSS Grid auto-fillâ‰¥280pxï¼›å¡ç‰‡ 16px åœ†è§’ + 1px subtle borderã€‚"
      orphan_style: "åŸä¹¦æ¶ç¼ºå¤±æ—¶ä½¿ç”¨ #1d2233â†’#353c56 æ¸å˜ + ç™½è‰²å­—ä½“/æŒ‰é’®ï¼Œä¿è¯å¯¹æ¯”åº¦ â‰¥4.5ã€‚"
      content_rules:
        - "æ ‡é¢˜ + çŠ¶æ€è¡Œï¼ˆåŸä¹¦æ¶å¯ç”¨/ä¹¦æ¶å·²åˆ é™¤ Â· N æœ¬ä¹¦ï¼‰+ æœ€è¿‘åˆ é™¤æ—¶é—´ã€‚"
        - "åˆ—è¡¨æœ€å¤šå±•ç¤º 5 æœ¬ï¼Œè¶…å‡ºæ˜¾ç¤º 'è¿˜æœ‰ N æœ¬ä¹¦æœªå±•ç¤ºâ€¦'ã€‚"
        - "æ¢å¤æŒ‰é’® 12px pillï¼›æµ…è‰²å¡ç‰‡ä½¿ç”¨ç™½åº•æè¾¹ï¼Œæ·±è‰²å¡ç‰‡é€æ˜æè¾¹ã€‚"
  data_contract:
    - "BasementMainWidget åªæ¶ˆè´¹ useBasementGroups(libraryId, skip, limit) è¿”å›çš„ BasementGroupsResponseDtoï¼šitems[], total, stats{bookTotal,groupTotal,lostShelves,latestDeletedAt}, availableBookshelves[], fetchedAtã€‚"
    - "items[].bookshelf_exists=false æ—¶åˆ‡æ¢ orphan è§†è§‰ï¼›latest_deleted_at ç›´æ¥é©±åŠ¨ group æ’åºï¼Œæ— éœ€å‰ç«¯å†è§£ææ—¥æœŸã€‚"
    - "availableBookshelves[] æ˜¾ç¤ºåœ¨ hero header ä¸‹æ–¹ 'å¯ä¾›æ¢å¤çš„ä¹¦æ¶ï¼šN ä¸ª' è¡Œï¼Œå¹¶ä¼ ç»™ RestoreBookModalï¼›å½“åˆ—è¡¨ä¸ºç©ºæ—¶ modal åªå±•ç¤º `åŸä¹¦æ¶ç¼ºå¤±` æç¤ºä¸åˆ›å»ºä¹¦æ¶ CTAã€‚"
    - "Query ç¼“å­˜ staleTime=60sã€gcTime=5minï¼›`enabled: Boolean(libraryId)` é˜²æ­¢æ— åº“æ—¶æ‰“æ¥å£ã€‚"
    - "Hook retry ç­–ç•¥ï¼š429 æˆ– 5xx æœ€å¤šé‡è¯•ä¸¤æ¬¡ï¼Œè¶…å‡ºååœ¨ UI ä¸Šæ¸²æŸ“ error æç¤º + Retry æŒ‰é’®ã€‚"
  group_card_rules:
    - "ç»„æ ‡é¢˜ = original shelf nameï¼ˆæˆ– 'å·²åˆ é™¤ä¹¦æ¶ ****' / 'æœªæ ‡è®°ä¹¦æ¶ #N'ï¼‰ï¼ŒåŒæ—¶æ¸²æŸ“ `bookshelf_exists` pillï¼šç»¿è‰²=å¯æ¢å¤ï¼Œæ·±è‰²=å·²åˆ é™¤/æœªçŸ¥ã€‚"
    - "ä¹¦ç±åˆ—è¡¨ `group.items` ä»¥ deleted_at desc æ’åºï¼Œå±•ç¤ºä¹¦å + åˆ é™¤æ—¶é—´ + block_countï¼›ç‚¹å‡»æ•´è¡Œæ‰“å¼€ Restore modalã€‚"
    - "æº¢å‡ºæ–‡æ¡ˆ 'è¿˜æœ‰ N æœ¬ä¹¦æœªå±•ç¤ºâ€¦' ä½¿ç”¨ --text-mutedï¼Œå°å±ä¿æŒ 12px å­—å·ï¼›ç‚¹å‡»åæ»šåŠ¨åˆ° Basement é¡µé¢é¡¶éƒ¨ CTAã€‚"
    - "å¡ç‰‡ footer æä¾›ä¸¤ä¸ªæŒ‰é’®ï¼šå·¦ä¾§ 'æ¢å¤å…¨éƒ¨'ï¼ˆè®¡åˆ’ä¸­å ä½ï¼Œå½“å‰ disabledï¼‰ï¼Œå³ä¾§ 'æŸ¥çœ‹è¯¦æƒ…' â†’ è§¦å‘ Restore modalã€‚"
  hero_stats_rules:
    - "stats.bookTotal ç”¨ä½œ hero card #1 æ•°å­—ï¼›#2 ä½¿ç”¨ stats.groupTotalï¼ˆè‹¥ undefined å›é€€ groups.lengthï¼‰ã€‚"
    - "stats.lostShelves ç›´æ¥é©±åŠ¨ 'å¤±è”ä¹¦æ¶' å¡ç‰‡æ•°å€¼ï¼Œç­‰äº items ä¸­ bookshelf_exists=false çš„æ•°é‡ã€‚"
    - "stats.latestDeletedAt æ˜¾ç¤ºåœ¨ hero header æ¬¡çº§æ–‡æ¡ˆ 'æœ€è¿‘åˆ é™¤ Â· {relative}'ï¼Œä¸ºç©ºæ—¶éšè—ã€‚"
  restore_modal:
    trigger: "ç‚¹å‡» group å†…æ¢å¤æŒ‰é’®æ‰“å¼€ï¼Œå¿…é¡»é˜»æ­¢å†’æ³¡ã€‚"
    content:
      - "Modal å®½ 420pxï¼ˆmax 90vwï¼‰ï¼Œå±•ç¤ºä¹¦åã€IDã€åŸä¹¦æ¶æ‘˜è¦ã€‚"
      - "æ¨¡å¼ï¼šåŸä¹¦æ¶ / é€‰æ‹©å…¶ä»–ä¹¦æ¶ï¼›åŸä¹¦æ¶ç¼ºå¤±æ—¶è‡ªåŠ¨åˆ‡æ¢ custom å¹¶ç¦ç”¨ original æŒ‰é’®ã€‚"
      - "ä¸‹æ‹‰é€‰é¡¹æ¥æº `availableBookshelves`ï¼Œè‹¥ç©ºåˆ™æç¤ºéœ€å…ˆåˆ›å»ºä¹¦æ¶ã€‚"
      - "æ‰€æœ‰ä¸»æ“ä½œæŒ‰é’®å¤ç”¨ shared `<Button>`ï¼ˆvariant=primary,size=smï¼‰ä»¥ç»§æ‰¿ silk-blue tokenï¼›å–æ¶ˆæŒ‰é’®ä¿æŒè½»é‡ ghostï¼Œç¦ç”¨æ€ç»Ÿä¸€é™åˆ° 0.5 opacity + `aria-pressed`ã€‚"
      - "æäº¤æˆåŠŸ toast æ–‡æ¡ˆ 'æ¢å¤æˆåŠŸï¼Œæ­£åœ¨åˆ·æ–°â€¦'ï¼Œéšåå›è°ƒ refetchã€‚"
    accessibility:
      - "é®ç½© click/ESC å…³é—­ï¼ˆloading æ€ç¦ç”¨ï¼‰ï¼Œdialog `role=dialog` + `aria-modal=true`ã€‚"
      - "æŒ‰é’® aria-disabled ä¸ loading åŒæ­¥ï¼›åŸä¹¦æ¶æŒ‰é’®ç¦ç”¨æ—¶ cursor=not-allowed + opacity 0.5ã€‚"
  basement_library_card:
    rules:
      - "å…è®¸å¤–éƒ¨ stats è¦†ç›–è™šæ‹ŸæŸ¥è¯¢ç»“æœï¼›è‹¥ä¼ å…¥ loading åˆ™æ˜¾ç¤º 'â€”' å ä½ä¿æŒå¸ƒå±€ç¨³å®šã€‚"
      - "ç»§ç»­æ˜¾ç¤º ğŸ”’ å›¾æ ‡ä¸ 'è¿›å…¥å›æ”¶ç«™ â†’' CTAï¼Œé¢œè‰²æ²¿ç”¨ Library å¡ tokenã€‚"
  interactions:
    - "é€‰æ‹©ä¹¦åº“å³è§¦å‘ Basement æ•°æ®æ‹‰å–ï¼›åˆ·æ–°æŒ‰é’®è°ƒç”¨ queryClient.refetchQueriesã€‚"
    - "Restore æˆåŠŸåå¿…é¡» invalidate å½“å‰åº“çš„ Basement Query ä»¥ç§»é™¤è¯¥ä¹¦ã€‚"
    - "ç©ºæ€ï¼šæ— ä¹¦åº“â†’placeholder å¡ç‰‡ï¼›æ— åˆ é™¤é¡¹â†’'è¯¥ä¹¦åº“æš‚æ— åˆ é™¤å†…å®¹'ã€‚"
    - "useBasementGroups queryKey=['basement','groups',libraryId,skip,limit]ï¼›åˆ‡æ¢ libraryId æ—¶è‡ªåŠ¨æ¸…ç©ºæ—§æ•°æ®å¹¶æ˜¾ç¤º skeletonï¼Œé˜²æ­¢æ²¿ç”¨ä¸Šä¸€åº“æ•°æ®ã€‚"
    - "RestoreBookModal.onSuccess è°ƒç”¨ basementQuery.refetch() + toastï¼ŒonError å±•ç¤º inline bannerï¼Œé”™è¯¯è¯¦æƒ…æ²¿ç”¨åç«¯ messageã€‚"
  accessibility:
    - "Library åˆ—è¡¨é¡¹ä¸º buttonï¼Œaria-pressed åæ˜ é€‰ä¸­çŠ¶æ€ï¼›ç»Ÿè®¡å¡ä¸ group å¡æä¾›æ–‡å­—è¯´æ˜ï¼Œé¿å…é¢œè‰²å”¯ä¸€ä¼ è¾¾ä¿¡æ¯ã€‚"
    - "ç»Ÿä¸€ä½¿ç”¨ä¸­æ–‡ç›¸å¯¹æ—¶é—´æ–‡æ¡ˆï¼ˆåˆšåˆš/xx åˆ†é’Ÿå‰/...ï¼‰ã€‚"
  theming:
    - "Basement é¡µé¢åªå¤ç”¨æ—¢æœ‰ tokensï¼ˆ--surface/--surface-subdued/--text-strong/--accentï¼‰ï¼›ç¦æ­¢æ–°å¢å†…è”è‰²å€¼ã€‚"
    - "æ·±è‰² orphan å¡ç‰‡éœ€ä¿æŒæŒ‰é’®/æ–‡å­—å¯¹æ¯”åº¦â‰¥4.5:1ï¼Œå¯å åŠ  0.1 é€æ˜ç™½æè¾¹ã€‚"
  testing:
    - "Storybookï¼šç©ºåº“ / å•åº“å¤šç»„ / orphan ç»„åˆ / Modal è‡ªå®šä¹‰ä¹¦æ¶ã€‚"
    - "Unitï¼šformatRelativeTimeã€Restore åˆ†æ”¯ï¼ˆæˆåŠŸ/å¤±è´¥/æ— ä¹¦æ¶ï¼‰ã€‚"
    - "Manualï¼šåˆ‡æ¢ä¹¦åº“â†’stats/åˆ—è¡¨åˆ·æ–°ã€æ¢å¤å count é€’å‡ã€ç§»åŠ¨ç«¯å•åˆ—æ–­ç‚¹ã€‚"

  frontend_build_status: "âœ… 90+ files created (TypeScript + CSS Modules)"
  frontend_layers_complete: "âœ… Shared (15 files) + Entities (7 files) + Features (42 files) + Pages (10 files) + Config (5 files)"
  frontend_features_complete: "âœ… Library/Bookshelf/Book/Block/Tag/Media/Search (7 domains, all with model+ui)"
  frontend_layouts_complete: "âœ… Header-only navigation (top-right); Sidebar disabled by default"
  frontend_providers_complete: "âœ… QueryProvider (TanStack Query) + ThemeProvider (CSS Variables)"
  backend_database_ready: "âœ… CORE SCHEMA CREATED - CONNECTION READY (Nov 15, 2025)"
  backend_api_routers_ready: "âœ… ALL 7/7 ROUTERS LOADED & OPERATIONAL (Nov 15, 2025)"
  backend_api_endpoints_ready: "âœ… 73 ENDPOINTS REGISTERED (Nov 15, 2025)"
  backend_startup_status: "âœ… RUNNING ON http://localhost:30001 (Nov 17, 2025) - Windows SelectorEventLoop compat verified"
  backend_di_container_complete: "âœ… DIContainer 22/22 å·¥å‚æ–¹æ³• + Real Mode (Nov 17, 2025)"
  backend_async_migration_mode: "âœ… All 4 Repositories complete async (Nov 17) - Library âœ… | Bookshelf âœ… | Book âœ… | Block âœ…"
  backend_response_serialization: "âœ… Safe dict conversion + ValueObject handling + error logging (Nov 17)"
  backend_database_persistence: "âœ… VERIFIED - All operations write directly to PostgreSQL at 127.0.0.1:5433/wordloom (Nov 17, 2025)"
  backend_windows_compatibility: "âœ… FIXED - asyncio.WindowsSelectorEventLoopPolicy() in session.py prevents ProactorEventLoop conflict (Nov 17, 2025)"
  backend_database_adr: "ADR-053-wordloom-core-database-schema.md"
  backend_api_adr: "ADR-054-api-bootstrap-and-dependency-injection.md"
  backend_router_adr: "ADR-055-api-router-integration-completion.md"
  backend_async_adr: "ADR-069-async-repository-migration-and-windows-compatibility.md (COMPREHENSIVE - Nov 17)"
  backend_windows_compat_fix: "âœ… Event loop policy + connect_args in session.py (Nov 17, 2025)"
  frontend_architecture_adr: "ADR-057-frontend-layer-architecture-vertical-slice.md (SUPERSEDED)"
  frontend_shared_components_adr: "ADR-059-frontend-shared-components-and-libraries-page-implementation.md (SUPERSEDED)"
  frontend_fsd_adr: "ADR-060-frontend-fsd-architecture-implementation.md (NEW - Nov 16, 2025)"
  frontend_fsd_responsibility_adr: "ADR-061-frontend-fsd-layer-responsibilities-and-maturity-assessment.md (NEW - Nov 16, 2025)"
  fsd_maturity_score: "76/100 (Production-ready foundation, 44 tactical gaps identified)"
  fsd_maturity_details: "See ADR-061 for complete layer responsibility matrix and 4-week remediation roadmap"
  api_integration_phase: "Phase 2 (Week 2) - FSD foundation complete, ready for API integration testing"
  frontend_pages_implemented:
    - "âœ… / (root welcome page)"
    - "âœ… /admin/dashboard (dashboard)"
    - "âœ… /admin/libraries (real API wired; prefix /api/v1)"
    - "âœ… /admin/libraries/[libraryId] (dynamic; mock data)"
    - "âœ… /admin/libraries/[libraryId]/bookshelves/[bookshelfId] (dynamic; mock data)"
    - "âœ… /admin/libraries/[libraryId]/bookshelves/[bookshelfId]/books/[bookId] (dynamic; mock + BlockEditor)"
    - "âœ… /admin/bookshelves (routes ready)"
    - "âœ… /admin/books (routes ready)"
    - "âœ… /admin/tags (routes ready)"
    - "âœ… /admin/media (routes ready)"
    - "âœ… /admin/chronicle (routes ready)"
    - "âœ… /admin/stats (routes ready)"
    - "âœ… /admin/settings (routes ready)"
  frontend_shared_components:
    - "âœ… Header (Logo + right-aligned nav + ThemeSwitcher + User Info)"
    - "âœ… Sidebar (disabled by default; navigation handled by Header top-right)"
    - "âœ… Layout (wrapper; supports toggling Sidebar on/off)"
    - "âœ… ThemeSwitcher (for Light/Dark/Loom themes)"
  frontend_ui_library:
    - "âœ… Button (primary, secondary, danger variants)"
    - "âœ… Card (with shadow and hover effects)"
    - "âœ… Input (with focus states and validation)"
    - "âœ… Spinner + Skeleton + Modal + Toast"
  frontend_css_files:
    - "âœ… tokens.css (design system: colors, spacing, typography)"
    - "âœ… sidebar.css (280px fixed left sidebar with menu animations)"
    - "âœ… header.css (60px fixed top header with logo and user)"
    - "âœ… layout.css (3-column: header + sidebar + content)"
    - "âœ… libraries.css (grid layout, cards, form, empty state)"
  sync_source:
    - "DDD_RULES.yaml (business rules)"
    - "HEXAGONAL_RULES.yaml (architecture rules)"
  generated_at: "2025-11-16"
  generation_method: "Manual + auto-sync via ADR documentation"
  maturity: "Production Ready âœ…"
  related_files:
    - "backend/docs/DDD_RULES.yaml"
    - "backend/docs/HEXAGONAL_RULES.yaml"
    - "frontend/docs/ADR-FR-001-theme-strategy.md"
    - "frontend/scripts/sync-rules.py (planned)"

  # API Server Bootstrap Status (UPDATED - Nov 15, 2025)
  backend_api_status: "âœ… FULLY OPERATIONAL - ALL 7/7 ROUTERS LOADED (Nov 15, 2025)"
  backend_api_ready_date: "2025-11-15"
  api_bootstrap_adr: "ADR-054-api-bootstrap-and-dependency-injection.md"
  api_router_integration_adr: "ADR-055-api-router-integration-completion.md"
  api_server_details:
    server_address: "http://localhost:30001"
    health_endpoint: "GET http://localhost:30001/api/v1/health"
    health_status: "âœ… RESPONDING with routers_loaded: 7/7"
    framework: "FastAPI + Uvicorn (async)"
    database_connection: "âœ… PostgreSQL async with psycopg[binary] driver (port 5433)"
    database_driver: "psycopg[binary] (async-capable, prebuilt)"
    di_container: "âœ… IMPLEMENTED (backend/api/app/dependencies.py)"
    routers_loaded: "7/7 (all modules)"

  # API Integration Configuration (UPDATED - Nov 15, 2025)
  api_configuration:
    base_url: "http://localhost:30001"  # Frontend calls backend directly
    api_prefix: "/api/v1"              # Backend actual prefix (ADR-065 correction)
    timeout_ms: 30000
    retry_count: 3
    retry_delay_ms: 1000
    cors_origins:
      - "http://localhost:30002"  # Frontend dev origin

  api_integration_phase: "Phase 2.1+ (Week 2 - DIContainer å®Œæ•´å®ç°) - æ‰€æœ‰åç«¯åŸºç¡€è®¾æ–½å°±ç»ªï¼Œç­‰å¾…å‰ç«¯æµ‹è¯•é›†æˆ"
  frontend_backend_sync_status: "âœ… åç«¯åŸºç¡€è®¾æ–½å®Œæ•´ - DIContainer å®Œå…¨å®ç° (Nov 17, 2025)"
  frontend_backend_sync_issue: "See API_DESIGN_SYNC_ISSUE_AND_SOLUTION.md for detailed analysis and resolution options"
  api_router_status: "âœ… ALL 7/7 ROUTERS SUCCESSFULLY LOADED (Nov 15, 2025)"
  api_routers_available:
    - "/api/v1/tags - 14 endpoints"
    - "/api/v1/media - 9 endpoints"
    - "/api/v1/bookshelves - 12 endpoints"
    - "/api/v1/books - 11 endpoints"
    - "/api/v1/blocks - 13 endpoints"
    - "/api/v1/libraries - 8 endpoints"
    - "/api/v1/search - 6 endpoints"

  api_health_check_example:
    endpoint: "GET http://localhost:30001/api/v1/health"
    response: |
      {
        "status": "healthy",
        "version": "1.0.0",
        "infrastructure_available": true,
        "routers_loaded": 7,
        "endpoints_total": 73,
        "database_connected": true,
        "database_driver": "psycopg[binary]"
      }

  api_endpoints_planned:
    - "GET /libraries?user_id={userId} (list libraries for user)"
    - "POST /libraries (create library)"
    - "GET /bookshelves?library_id={libraryId} (list bookshelves)"
    - "POST /bookshelves (create bookshelf; body includes library_id)"
    - "GET /books?bookshelf_id={bookshelfId} (list books)"
    - "POST /books (create book; body includes bookshelf_id and library_id)"
    - "GET /blocks?book_id={bookId} (list blocks)"
    - "GET /blocks/{block_id} (get single block)"
    - "POST /blocks (create block; body includes book_id)"
    - "PATCH /blocks/{block_id} (update block)"
    - "DELETE /blocks/{block_id} (soft delete block)"

  api_connection_status: "âœ… BACKEND OPERATIONAL - Database configured (5433), Library creation working (Nov 17, 2025)"
  ui_library_creation_dialog_pattern: "âœ… Adopted standardized centered modal pattern for Library create/edit (ADR-088 Nov 22, 2025)"
  next_phase_tasks:
    - "âœ… Week 2: All 7 routers successfully loaded (COMPLETE)"
    - "âœ… Week 2: 73 endpoints registered (COMPLETE)"
    - "âœ… Week 2: Database async driver configured (COMPLETE)"
    - "âœ… Week 2: Frontend 4-layer architecture complete (COMPLETE - ADR-057)"
    - "â³ Week 2: Connect frontend TanStack Query to backend endpoints (TESTING)"
    - "â³ Week 2: End-to-end integration testing with database (PENDING)"
    - "â³ Week 3: Tag management + media upload implementation (PENDING)"
    - "â³ Week 3: Global search integration (PENDING)"

# ============================================
# Part 0: FSD Architecture (NEW - Nov 16, 2025)
# ============================================

fsd_architecture:
  definition: "Feature-Sliced Design - 6-layer strict architecture with unified domain model"
  layers: 6
  domains: 7
  files_total: 90+

  layer_0_shared:
    name: "Shared Infrastructure"
    purpose: "Global APIs, utilities, components, styles, providers"
    files: 15
    contents:
      - "api/client.ts: Axios with JWT interceptor + global error handling"
      - "api/types.ts: Global DTOs, ApiErrorResponse, HttpStatus mapping"
      - "lib/config.ts: Environment variables and app configuration"
      - "lib/utils.ts: Utility functions (formatDate, debounce, formatFileSize)"
      - "ui/Button.tsx: Base button component with 3 variants (primary, secondary, danger)"
      - "ui/Card.tsx: Reusable card container with shadow effects"
      - "ui/Input.tsx: Form input with validation states"
      - "ui/Spinner.tsx: Loading spinner indicator"
      - "ui/Modal.tsx: Modal dialog component with backdrop"
      - "styles/tokens.css: Design system (colors, spacing, typography, radius)"
      - "styles/*.module.css: Base component styles (button, card, input, spinner, modal)"
      - "layouts/Header.tsx: Top navigation with logo and menu links"
      - "layouts/Sidebar.tsx: Left sidebar with 8-menu navigation"
      - "layouts/Layout.tsx: Wrapper layout combining Header + Sidebar + main"
      - "providers/ThemeProvider.tsx: CSS variable injection + theme persistence"

  layer_1_entities:
    name: "Domain Models (Type Definitions)"
    purpose: "TypeScript interfaces for 7 domains, matching backend DTOs"
    files: 7
    domains:
      - "library/types.ts: LibraryDto, CreateLibraryRequest, UpdateLibraryRequest"
      - "bookshelf/types.ts: BookshelfDto + CRUD requests"
      - "book/types.ts: BookDto with author, ISBN, cover metadata"
      - "block/types.ts: BlockDto with fractional_index for sorting"
      - "tag/types.ts: TagDto with hierarchy support"
      - "media/types.ts: MediaDto with trash lifecycle (30-day purge)"
      - "search/types.ts: SearchResultDto, SearchRequest, SearchResponse"

  layer_2_features:
    name: "Feature Business Logic"
    purpose: "7 self-contained features (Library/Bookshelf/Book/Block/Tag/Media/Search)"
    files: 42
    per_feature:
      - "model/api.ts: HTTP operations (list, get, create, update, delete) - 7 functions"
      - "model/hooks.ts: TanStack Query hooks with query key strategy - 5-7 hooks"
      - "ui/Component1.tsx: Main display component (e.g., LibraryCard, BookshelfCard)"
      - "ui/Component2.tsx: List component with loading/empty states"
      - "ui/index.ts: Public API exports"
      - "index.ts: Feature-level public API barrel"
    feature_patterns: |
      âœ… Consistent API layer pattern (list, get, create, update, delete)
      âœ… Query key strategy: QUERY_KEY.all, QUERY_KEY.byId, QUERY_KEY.detail
      âœ… Cache invalidation on mutations
      âœ… React.forwardRef for component composition
      âœ… CSS Modules for isolated styles
      âœ… Public API exports prevent circular dependencies

  layer_3_widgets:
    name: "Composed Features"
    purpose: "Combine multiple feature components into larger UI panels"
    files: 8
    widgets:
      - "library/LibraryMainWidget.tsx: Compose LibraryList + CreateLibraryForm"
      - "bookshelf/BookshelfMainWidget.tsx: Compose BookshelfList + Create button"
      - "book/BookMainWidget.tsx: Compose BookList + Create button"
      - "block/BlockMainWidget.tsx: Compose BlockList + Create button"

  layer_4_layouts:
    name: "Page Layouts"
    purpose: "Reusable layout components for different page types"
    files: 3
    layouts:
      - "Header.tsx: Top navigation (moved to shared/layouts)"
      - "Sidebar.tsx: Left navigation (moved to shared/layouts)"
      - "Layout.tsx: Main wrapper (moved to shared/layouts)"

  layer_5_pages:
    name: "Next.js Routes"
    purpose: "Page components connected to routes (App Router)"
    files: 10
    pages:
      - "(admin)/layout.tsx: Admin section wrapper with Layout component"
      - "(admin)/libraries/page.tsx: Library management page"
      - "(admin)/bookshelves/page.tsx: Bookshelf listing"
      - "(admin)/books/page.tsx: Book listing"
      - "(admin)/tags/page.tsx: Tag management"
      - "(admin)/media/page.tsx: Media gallery"
      - "(admin)/search/page.tsx: Search results"
      - "(admin)/dashboard/page.tsx: Dashboard"
      - "(auth)/login/page.tsx: Login page"
      - "/page.tsx: Home/welcome page"

  layer_6_app:
    name: "Application Root"
    purpose: "Next.js root layout and providers initialization"
    files: 3
    files_detail:
      - "layout.tsx: Root <html> + metadata + Providers"
      - "providers.tsx: QueryProvider (TanStack Query) + ThemeProvider"
      - "page.tsx: Welcome page"

  config_files:
    description: "Configuration files for Next.js, TypeScript, npm"
    files: 5
    detail:
      - "package.json: Dependencies (React, Next.js, Axios, TanStack Query)"
      - "tsconfig.json: TypeScript config with @ path alias"
      - "tsconfig.node.json: Referenced config"
      - "next.config.js: Next.js configuration"
      - ".eslintrc.json: ESLint rules (next/core-web-vitals)"

  dependency_rules:
    principle: "Strict one-way dependency flow"
    rule_0: "Layer 0 imports: Only built-in Node.js modules"
    rule_1: "Layer 1 imports: Layer 0 only"
    rule_2: "Layer 2 imports: Layers 0-1 only"
    rule_3: "Layer 3 imports: Layers 0-2 only"
    rule_4: "Layer 4 imports: Layers 0-3 only"
    rule_5: "Layer 5 imports: Layers 0-4 only"
    rule_6: "Layer 6 imports: All layers (root can import everything)"
    violation: "âŒ Features CANNOT import from Pages or other Features"

  public_api_pattern:
    purpose: "Clean imports + prevent circular dependencies"
    pattern: |
      Each feature/layer exposes only through index.ts barrels

      // âœ… Good: Import through barrel
      import { useLibraries, LibraryCard } from '@/features/library';

      // âŒ Wrong: Direct imports
      import { useLibraries } from '@/features/library/model/hooks';

    benefits:
      - "Abstracts internal structure"
      - "Easy refactoring without breaking imports"
      - "Clear public API contract"
      - "Encourages module cohesion"

  query_key_strategy:
    purpose: "Prevent TanStack Query cache bugs"
    pattern: |
      const QUERY_KEY = {
        all: ['libraries'],
        byId: (id) => [...QUERY_KEY.all, id],
        detail: (id, extra) => [...QUERY_KEY.byId(id), extra]
      }

    benefits:
      - "Hierarchical invalidation (parent key invalidates all children)"
      - "Prevents stale data bugs"
      - "Enables precise cache management"
      - "Easy to test and reason about"

  css_variables_system:
    purpose: "Theme switching without component rewrites"
    tokens:
      colors:
        - "--color-primary: #2C3E50"
        - "--color-secondary: #3498DB"
        - "--bg-primary, --bg-secondary, --bg-tertiary"
        - "--text-primary, --text-secondary, --text-muted"
      spacing:
        - "--spacing-xs: 0.25rem | --spacing-sm: 0.5rem | --spacing-md: 1rem"
        - "--spacing-lg: 1.5rem | --spacing-xl: 2rem | --spacing-2xl: 3rem"
      typography:
        - "--font-h1-size, --font-h2-size, --font-body-size"
      radius:
        - "--radius-sm, --radius-md, --radius-lg, --radius-xl"

    benefits:
      - "Dynamic theme switching (Light/Dark/Loom)"
      - "Consistent design system"
      - "Easy maintenance (change in one place)"
      - "No component refactoring needed"

  benefits_summary:
    - "âœ… Clear module boundaries prevent merge conflicts"
    - "âœ… Self-contained features are testable and reusable"
    - "âœ… Public APIs abstract implementation details"
    - "âœ… One-way dependencies prevent circular imports"
    - "âœ… CSS Variables enable theme switching"
    - "âœ… TanStack Query cache strategy prevents data bugs"
    - "âœ… Unified domain model (7 domains with consistent patterns)"
    - "âœ… Easy to onboard new developers (predictable structure)"

  testing_structure:
    unit_tests: "Component logic isolation (60%)"
    integration_tests: "Feature workflows (30%)"
    e2e_tests: "Full user journeys (10%)"
    framework: "Vitest + React Testing Library + Playwright"

  next_steps_phase_2:
    - "âœ… npm install (COMPLETE)"
    - "âœ… npm run dev (RUNNING on http://localhost:30001)"
    - "âœ… Same-origin proxy enabled: /api/v1 â†’ http://localhost:30002"
    - "âœ… Mock disabled by default (NEXT_PUBLIC_USE_MOCK=0)"
    - "â³ API endpoint integration (connect features to backend)"
    - "â³ End-to-end user flows (test unified navigation)"
    - "â³ Error handling + loading states refinement"
    - "â³ Authentication integration (JWT + login flow)"

  documentation:
    adr: "ADR-060-frontend-fsd-architecture-implementation.md"
    responsibility_adr: "ADR-061-frontend-fsd-layer-responsibilities-and-maturity-assessment.md (NEW)"
    visual_rules: "This file (VISUAL_RULES.yaml)"
    related_adr: "ADR-057 (superseded), ADR-059 (superseded)"
    roadmap_reference: "Part 16: Implementation Roadmap & Priority Items (this file)"

# ============================================
# Navigation Policy (UPDATED - Nov 16, 2025)
# ============================================

navigation_policy:
  strategy: "Header-only navigation with global search + hover workbox"
navigation_language_switcher:
  plan_reference: ["Plan_174A_i18nDesign.md", "Plan_174B_i18nDesignImplementation.md", "ADR-154-plan174-i18n.md"]
  summary: "é¡¶éƒ¨ç²˜æ€§å¯¼èˆªæŠŠåŸ Libraries é“¾æ¥æ›¿æ¢ä¸º Language èœå•ï¼Œå¤ç”¨ Theme/Workbox çš„å¤–è§‚ä¸åŠ¨ç”»ï¼Œä¸º zh-CN / en-US åˆ‡æ¢æä¾›ç»Ÿä¸€å…¥å£ã€‚"
  layout:
    trigger: "å’Œ Theme èœå•ç›¸åŒçš„å­—ä½“(14px)ã€æƒé‡(500)ã€é—´è·(6pxÃ—8px) ä¸ caretï¼›åœ†è§’=var(--radius-sm)ï¼Œhover/Focus ä½¿ç”¨ --color-surface-hoverã€‚"
    panel: "å®½ 220pxã€å³å¯¹é½ã€åœ†è§’ 16pxã€é˜´å½±=var(--shadow-lg)ï¼Œå†…éƒ¨ padding 8pxâ€“12pxï¼Œä¸ Theme èœå•ä¿æŒåƒç´ çº§ parityã€‚"
    content: "LanguageSwitcher.variant='menu' çºµå‘æ’åˆ—ä¸¤æ¡æŒ‰é’®ï¼ˆä¸­æ–‡/Englishï¼‰ï¼Œactive é¡¹æ²¿ç”¨ Workbox èœå•çš„é«˜äº®/aria-checked è¡¨è¾¾ï¼›ç¦æ­¢å†å‡ºç°ç¬¬ä¸‰ç§æ ·å¼ã€‚"
  interactions:
    - "hover å»¶è¿Ÿ 120ms æ‰“å¼€ã€200ms å…³é—­ï¼Œä¸ Workbox/Theme ä¸€è‡´ï¼›Esc å…³é—­å¹¶æŠŠç„¦ç‚¹å›ä¼  triggerã€‚"
    - "ç‚¹å‡»èœå•é¡¹è°ƒç”¨ setLang åç«‹å³å…³é—­é¢æ¿ï¼Œæ— éœ€æ•´é¡µåˆ·æ–°ï¼›åˆ·æ–°åè¯­è¨€ä» localStorage æ¢å¤ã€‚"
    - "Language èœå•ä¸ Workbox èœå•ä¸å¯åŒæ—¶å±•å¼€ï¼Œhover åŒºåŸŸä¿æŒ 48px é—´éš”ï¼Œé¿å…é‡å ã€‚"
  copy_guidelines:
    - "æ‰€æœ‰å¯¼èˆª/æŒ‰é’®/æç¤ºæ–‡æ¡ˆéœ€åœ¨ frontend/src/i18n/locales/{zh-CN,en-US}.ts å®šä¹‰ï¼Œkey é‡‡ç”¨ nav.*, button.*, toast.* å‰ç¼€ï¼›ç¦æ­¢ç›´æ¥æŠŠä¸­æ–‡å†™è¿›ç»„ä»¶ã€‚"
    - "ç»„ä»¶å¿…é¡»é€šè¿‡ const { t } = useI18n() è®¿é—®æ–‡æ¡ˆï¼›å½“ key ç¼ºå¤±æ—¶å…è®¸å›é€€åˆ° key å­—ç¬¦ä¸²ï¼Œä½† PR å¿…é¡»è¡¥é½å­—å…¸ã€‚"
    - "å¯¼èˆªæœç´¢è¾“å…¥ placeholderã€ARIA æ ‡ç­¾ä¸æ¸…é™¤æŒ‰é’®ä¸€å¹¶æ¥å…¥ i18nï¼Œä¿æŒä¸­è‹±æ–‡ä¸€è‡´å¸ƒå±€ã€‚"
  accessibility:
    - 'trigger aria-haspopup="menu"ã€aria-expanded çœŸå®åæ˜ çŠ¶æ€ï¼›èœå• role="menu"ï¼ŒæŒ‰é’® role="menuitemradio" + aria-checkedã€‚'
    - 'è¯­è¨€åç§°é‡‡ç”¨ä¸­è‹±æ–‡è‡ªæˆ‘æè¿°ï¼ˆä¸­æ–‡ / Englishï¼‰ä»¥ä¾¿è¯»å±ï¼Œactive é¡¹ aria-pressed=trueã€‚'

  workbox_menu:
    purpose: "ç»Ÿä¸€ç³»ç»Ÿçº§å·¥å…·å…¥å£ï¼ˆLibrary/Basement/Chronicle/Statsï¼‰ï¼Œé¿å…ç³»ç»Ÿå·¥å…·å¹²æ‰°ä¸»å†…å®¹ç©ºé—´"
    component: "WorkboxMenu.tsx - ç‹¬ç«‹ç»„ä»¶ï¼Œæ”¯æŒ hover 120ms + click å…¼å®¹"
    trigger: "onMouseEnter (120ms delay) + onClick (keyboard & touch fallback)"
    close_delay: "onMouseLeave (200ms delay to prevent flicker)"
    accessibility:
      - "ARIA: button aria-haspopup=true aria-expanded"
      - "role=menu for panel, role=menuitem for items"
      - "Esc to close; â†‘â†“ arrow navigation inside menu"
      - "Focus first item when opened via keyboard"
    design:
      width: "240px desktop / 200px mobile"
      elevation: "shadow-lg + border subtle"
      active_indicator: "2px top bar (brand primary color)"
      hover_state: "background surface-hover + text primary"
    menu_items:
      - { label: "Library / ä¹¦åº“", href: "/admin/libraries" }
      - { label: "Basement / å›æ”¶ç«™", href: "/admin/basement" }
      - { label: "Chronicle / æ—¶é—´çº¿", href: "/admin/chronicle" }
      - { label: "Stats / ç»Ÿè®¡", href: "/admin/stats" }
  global_search:
    purpose: "å…¨å±€æœç´¢æ¡†ä½äº header å³ä¾§ï¼ˆWorkbox å·¦ä¾§ï¼‰ï¼Œé€šè¿‡ URL query (?q=) ä¸é¡µé¢è”åŠ¨"
    placement: "Header å³ä¾§å¯¼èˆªåŒºï¼ŒWorkbox æŒ‰é’®ä¹‹å‰"
    width: "220px desktop / 180px mobile"
    interaction:
      - "å›è½¦æäº¤æœç´¢ (Enter key)"
      - "Ã— æ¸…é™¤æŒ‰é’®ï¼ˆä»…åœ¨æœ‰è¾“å…¥æ—¶æ˜¾ç¤ºï¼‰"
      - "ç„¦ç‚¹è“è‰²è¾¹æ¡† + shadow feedback"
    url_model: "?q= æŸ¥è¯¢å‚æ•°ï¼ˆå¯ä¹¦ç­¾ã€å¯åˆ†äº«ã€çŠ¶æ€æŒä¹…åŒ–ï¼‰"
    scope_v1: "ä»… Libraries åç§°/æè¿°ï¼ˆåç«¯ ILIKE æœç´¢ï¼‰"
    future_extensions:
      - "æ‰©å±•åˆ°å…¨å±€ï¼ˆBooks/Bookshelves/Tagsï¼‰"
      - "æœç´¢å†å²ä¸è‡ªåŠ¨è¡¥å…¨"
  details:
    header_nav_position: "Top-right aligned links + search + workbox"
    sidebar: "Disabled by default across admin pages"
    mirrors:
      - "/admin/** routes visible via admin mirror of (admin) route group"
    header_links:
      - { label: "Dashboard", href: "/admin/dashboard" }
      - { label: "Libraries", href: "/admin/libraries" }
  rationale: "å°†ç³»ç»Ÿå·¥å…·ï¼ˆå›æ”¶ç«™/ç»Ÿè®¡ï¼‰ç»Ÿä¸€æ”¶çº³åˆ° Workboxï¼Œçªå‡ºä¸»å¯¼èˆªæ¸…æ™°åº¦ï¼›æœç´¢å…¨å±€åŒ–é¿å…é‡å¤è¾“å…¥ï¼ŒURL query ä¿è¯çŠ¶æ€å…±äº«ä¸ä¹¦ç­¾æ”¯æŒï¼›hover è§¦å‘é™ä½æ“ä½œæˆæœ¬åŒæ—¶ä¿æŒé”®ç›˜ä¸è§¦å±å…¼å®¹æ€§ã€‚"
  notes:
    - "If future needs require, Sidebar can be re-enabled per-layout via showSidebar prop"
    - "Mobile menu planned: collapse Header links into a hamburger menu"
    - "æœç´¢å½“å‰ä»…æ”¯æŒ Libraries é¡µï¼Œæœªæ¥å¯æ‰©å±•åˆ°å…¨å±€ï¼ˆBooks/Bookshelves/Tagsï¼‰"
    - "Workbox é¢æ¿æ”¯æŒå½“å‰è·¯ç”±é«˜äº®ï¼ˆactive state with brand color + medium font-weightï¼‰"

# ============================================
# Part 1: Theme System Rules
# ============================================

theme_system:
  strategy: "CSS Variables + Runtime Injection"

  library_theme_runtime:
    adr_reference: "ADR-094-library-bookshelf-dashboard-and-theme-integration.md"
    primary_source: "HEXAGONAL_RULES.theme_runtime_strategy"
    color_priority:
      - "å°é¢å›¾ä¸»è‰² (cover_large / ä»£è¡¨å›¾ï¼Œé€šè¿‡ Canvas/Vibrant æå–)"
      - "library.theme_color å­—æ®µ (hex â†’ HSL)"
      - "Hash fallback (library.id + name)"
    css_variables:
      - "--lib-h / --lib-s / --lib-lï¼šLibrary ä¸»è‰² HSL ä¸‰å…ƒç»„"
      - "--shelf-h / --shelf-s / --shelf-lï¼šåœ¨ Library ä¸»è‰²åŸºç¡€ä¸Šçš„ per-shelf åç§»"
    ui_scopes:
      - "Library Detail â†’ Bookshelf Dashboard é¡¶éƒ¨è¿›åº¦æ¡ä¸ç»Ÿè®¡å¡ç‰‡"
      - "BookshelfDashboardCard / BookshelfDashboardRow å°é¢æ¸å˜ä¸è‰²æ¡"
  current_phase: "Phase A (Local localStorage, no backend dependency)"
  future_phase: "Phase B (Backend /profile/theme-preference after Week 4)"

  runtime_themes:
    storage_key: "wl_theme"
    menu_location: "Header å³ä¸Šè§’ Theme ä¸‹æ‹‰ï¼Œä¸ Workbox åŒçº§"
    default: "business-blue"
    options:
      - id: "business-blue"
        label: "å•†åŠ¡è“"
        positioning: "åŸå§‹é…è‰²ï¼Œé€‚åˆä¼ä¸š/å•†åŠ¡åœºæ™¯"
        palette_highlights:
          bg: "#F8FAFC"
          primary: "#0066CC"
          border: "#E5E7EB"
          shadow: "0 2px 6px rgba(15,23,42,0.08)"
      - id: "silk-blue"
        label: "ä¸ç»¸è“"
        positioning: "Plan 8 è®¾è®¡ï¼šé›¾æ„ŸèƒŒæ™¯ + çº¸æ„Ÿç™½å¡ + æŸ”å’Œé“¶ç°"
        palette_highlights:
          bg: "#F5F7FA"
          primary: "#0B5CD6"
          border: "#E2E8F0"
          shadow: "0 1px 3px rgba(0,0,0,0.06)"
    persistence:
      client_side: "localStorage + <html data-theme> attribute"
      server_side: "æœªå¯ç”¨ï¼›æœªæ¥æ¥å…¥ç”¨æˆ·åå¥½ API åå†åŒæ­¥"
    accessibility:
      contrast_check: "åˆ‡æ¢åéœ€ç¡®è®¤æ–‡æœ¬å¯¹æ¯”åº¦ â‰¥ WCAG 4.5"
      keyboard_support: "Arrow ä¸Šä¸‹åˆ‡æ¢ï¼ŒEnter/Space é€‰æ‹©ï¼ŒEsc å…³é—­"

  theme_palette:
    description: "Legacy palette ç»“æ„ï¼Œç”¨äºä¿ç•™ Light/Dark/Loom æ–¹æ¡ˆï¼›è¿è¡Œæ—¶ä¸»é¢˜è¯¦è§ runtime_themes"
    default_theme: "business-blue"

    light_theme:
      name: "Light â†’ Business Blue"
      description: "æ—§ç‰ˆäº®è‰²åˆ«åï¼›å½“å‰è¿è¡Œæ—¶ç­‰åŒ business-blue"
      light_mode:
        primary: "#1F2937"        # æ·±ç°ï¼ˆä¸»è‰²ï¼‰
        primaryLight: "#374151"   # æµ…æ·±ç°
        secondary: "#6366F1"      # é›è“ï¼ˆç‚¹ç¼€ï¼‰
        surface: "#FFFFFF"        # èƒŒæ™¯ç™½
        surfaceAlt: "#F9FAFB"     # å¤‡é€‰èƒŒæ™¯
        muted: "#9CA3AF"          # è¾…åŠ©ç°
        border: "#E5E7EB"         # è¾¹æ¡†
        success: "#10B981"
        warning: "#F59E0B"
        error: "#EF4444"
        info: "#3B82F6"
        text: "#111827"           # ä¸»æ–‡æœ¬
        textSecondary: "#6B7280"  # æ¬¡æ–‡æœ¬
        textMuted: "#9CA3AF"      # è¾…åŠ©æ–‡æœ¬
      dark_mode:
        primary: "#F3F4F6"        # æµ…ç™½
        primaryLight: "#E5E7EB"   # æ›´æµ…ç™½
        secondary: "#A5B4FC"      # æ·¡é›è“
        surface: "#1F2937"        # æ·±ç°èƒŒæ™¯
        surfaceAlt: "#111827"     # æ›´æ·±ç°
        muted: "#6B7280"          # è¾…åŠ©ç°
        border: "#374151"         # è¾¹æ¡†
        success: "#34D399"
        warning: "#FBBF24"
        error: "#F87171"
        info: "#60A5FA"
        text: "#F9FAFB"           # ä¸»æ–‡æœ¬
        textSecondary: "#D1D5DB"  # æ¬¡æ–‡æœ¬
        textMuted: "#9CA3AF"      # è¾…åŠ©æ–‡æœ¬

    dark_theme:
      name: "Dark"
      description: "æ—§ç‰ˆæš—è‰²ä¸»é¢˜ï¼Œä¿ç•™ä¾›å¤œé—´ä½¿ç”¨ï¼›ä¸ runtime theme 'dark' å¯¹åº”"
      light_mode:
        primary: "#F3F4F6"
        primaryLight: "#E5E7EB"
        secondary: "#A5B4FC"
        surface: "#111827"
        surfaceAlt: "#1F2937"
        muted: "#6B7280"
        border: "#374151"
        success: "#34D399"
        warning: "#FBBF24"
        error: "#F87171"
        info: "#60A5FA"
        text: "#F9FAFB"
        textSecondary: "#D1D5DB"
        textMuted: "#9CA3AF"
      dark_mode:
        primary: "#F3F4F6"
        primaryLight: "#E5E7EB"
        secondary: "#A5B4FC"
        surface: "#0F172A"        # æ›´æ·±çš„é»‘
        surfaceAlt: "#111827"
        muted: "#475569"
        border: "#334155"
        success: "#22C55E"
        warning: "#FBBF24"
        error: "#EF4444"
        info: "#3B82F6"
        text: "#F1F5F9"
        textSecondary: "#CBD5E1"
        textMuted: "#94A3B8"

    loom_theme:
      name: "Loom (Wordloomä¸“ç”¨)"
      description: "Wordloom å“ç‰Œä¸“ç”¨çš„ç°è“è‰²é£æ ¼ï¼Œèåˆä¸“ä¸šæ„Ÿä¸åˆ›æ„æ„Ÿ"
      light_mode:
        primary: "#2C3E50"        # æ·±ç°è“ï¼ˆä¸»è‰²ï¼‰
        primaryLight: "#34495E"   # æµ…ç°è“
        secondary: "#3498DB"      # å“ç‰Œè“
        tertiary: "#16A085"       # é’ç»¿ç‚¹ç¼€
        surface: "#ECF0F1"        # æ·¡ç°èƒŒæ™¯
        surfaceAlt: "#F8F9FA"     # æ›´æµ…èƒŒæ™¯
        muted: "#7F8C8D"          # æ·¡ç°
        border: "#BDC3C7"         # è¾¹æ¡†
        success: "#27AE60"
        warning: "#F39C12"
        error: "#E74C3C"
        info: "#3498DB"
        text: "#2C3E50"           # ä¸»æ–‡æœ¬
        textSecondary: "#7F8C8D"  # æ¬¡æ–‡æœ¬
        textMuted: "#95A5A6"      # è¾…åŠ©æ–‡æœ¬
      dark_mode:
        primary: "#ECF0F1"        # æµ…ç°
        primaryLight: "#BDC3C7"   # æ·¡ç°
        secondary: "#3498DB"      # å“ç‰Œè“ï¼ˆä¿æŒä¸€è‡´ï¼‰
        tertiary: "#1ABC9C"       # é’ç»¿
        surface: "#1A252F"        # æ·±ç°è“èƒŒæ™¯
        surfaceAlt: "#0F1419"     # æ›´æ·±èƒŒæ™¯
        muted: "#34495E"          # ç°è“
        border: "#2C3E50"         # è¾¹æ¡†
        success: "#2ECC71"
        warning: "#E67E22"
        error: "#E74C3C"
        info: "#3498DB"
        text: "#ECF0F1"           # ä¸»æ–‡æœ¬
        textSecondary: "#BDC3C7"  # æ¬¡æ–‡æœ¬
        textMuted: "#7F8C8D"      # è¾…åŠ©æ–‡æœ¬

  spacing_system:
    xs: "0.25rem"   # 4px
    sm: "0.5rem"    # 8px
    md: "1rem"      # 16px
    lg: "1.5rem"    # 24px
    xl: "2rem"      # 32px
    2xl: "3rem"     # 48px

  typography_system:
    h1:
      size: "2rem"
      weight: 700
      lineHeight: 1.2
      letterSpacing: "-0.02em"
    h2:
      size: "1.5rem"
      weight: 600
      lineHeight: 1.3
      letterSpacing: "-0.01em"
    h3:
      size: "1.25rem"
      weight: 600
      lineHeight: 1.4
    body:
      size: "1rem"
      weight: 400
      lineHeight: 1.5
    small:
      size: "0.875rem"
      weight: 400
      lineHeight: 1.5
    caption:
      size: "0.75rem"
      weight: 500
      lineHeight: 1.4
      letterSpacing: "0.01em"

  radius_system:
    none: "0"
    sm: "0.25rem"
    md: "0.5rem"
    lg: "0.75rem"
    xl: "1rem"
    full: "9999px"

  rules:
    RULE_THEME_001_NEUTRAL_DEFAULT:
      description: "Default theme is Lightï¼Œbut users can choose Light/Dark/Loom"
      implementation: |
        âœ… Default localStorage: wl_theme = 'Light'
        âœ… All 3 themes must have light + dark modes
        âœ… Support system preference (prefers-color-scheme)
        âœ… All themes have consistent spacing & typography

    RULE_THEME_002_DYNAMIC_CSS_VARS:
      description: "Use CSS Variables, never hardcode colors in components"
      implementation: |
        âœ… Background: background-color: var(--color-primary);  // NOT #2C3E50
        âœ… Text: color: var(--color-text);
        âœ… Spacing: padding: var(--spacing-md);
        âœ… Radius: border-radius: var(--radius-lg);
        âŒ WRONG: background-color: '#2C3E50'  (hardcoded)

    RULE_THEME_003_SMOOTH_TRANSITIONS:
      description: "Theme/mode switches must have smooth transitions (no flicker)"
      implementation: |
        âœ… CSS: transition: all 0.3s ease;
        âœ… Hydrate on client useEffect
        âœ… Inject <style> before React render
        âœ… Use data-theme attribute on <html> for CSS selectors

    RULE_THEME_004_PERSISTENCE:
      description: "User theme choice persists across sessions"
      storage: "localStorage (Phase A) â†’ PostgreSQL (Phase B)"
      keys:
        - "wl_theme": 'Light' | 'Dark' | 'Loom'
        - "wl_mode": 'light' | 'dark'
      implementation: |
        âœ… Save on theme change: localStorage.setItem('wl_theme', theme)
        âœ… Load on mount: const saved = localStorage.getItem('wl_theme') ?? 'Light'
        âœ… Fallback: if (!saved) check system.matchMedia('(prefers-color-scheme: dark)')

# ============================================
# Part 2: Component Style Rules
# ============================================

component_styles:
  principle: "All interactive components must respond to theme changes in real-time"
  RULE-LIBRARY-CARD-POSTER-V1:
    rationale:
      - "æå‡è§†è§‰ç»Ÿä¸€æ€§ï¼šå°é¢æˆä¸ºè¯­ä¹‰ä¸è§†è§‰å…¥å£ï¼Œå‡å°‘ä¸Šä¸‹åˆ†å‰²çš„å‰²è£‚æ„Ÿã€‚"
      - "åº•éƒ¨é»‘è‰²æ¸å˜ä¿è¯ä»»æ„å°é¢ä¸‹æ–‡å­—å¯è¯»ï¼Œç¬¦åˆå¤œè‰²ä¹¦æˆ¿ä¸»é¢˜ã€‚"
    specs:
      - "Grid è§†å›¾ä½¿ç”¨æ•´å›¾æµ·æŠ¥å¡ï¼š16:9 å°é¢ + åº•éƒ¨æ¸å˜å±‚å åŠ æ ‡é¢˜/ç®€ä»‹/æŒ‡æ ‡ï¼Œä¸¤è¡Œå¸ƒå±€ã€‚"
      - "æ ‡é¢˜ + PINNED chip ç¬¬ä¸€è¡Œï¼›æè¿°ï¼ˆ2 è¡Œæˆªæ–­ï¼‰ + æŒ‡æ ‡ç»„ç¬¬äºŒè¡Œå³ä¾§å¯¹é½ã€‚"
      - "æ“ä½œæŒ‰é’®æ‚¬æµ®åœ¨å³ä¸Šè§’ï¼Œé»˜è®¤åŠé€æ˜ï¼ˆ30%ï¼‰ï¼Œhover æ¸æ˜¾ã€‚"
      - "ç©ºæè¿°æ˜¾ç¤º â€” æš‚æ— è¯´æ˜ï¼ˆä¸é—ªçƒ/ä¸å¡Œé™·ï¼‰ã€‚"
    accessibility:
      - "å¡ç‰‡å¯èšç„¦ï¼šEnter / Space æ¿€æ´»ï¼›æ“ä½œæŒ‰é’®å…·å¤‡ aria-labelã€‚"
      - "å°é¢å›¾ä¸ºè£…é¥°èƒŒæ™¯ï¼šå¯ç©º altï¼›æ–‡æœ¬ä¿æŒè¯­ä¹‰æ ‡ç­¾ã€‚"
    status: "Planned Nov 22, 2025"
  RULE-LIBRARY-LIST-LAYOUT-V1:
    rationale:
      - "æé«˜ä¿¡æ¯å¯†åº¦ä¸æ‰«ææ•ˆç‡ï¼Œé¿å…æ•´å›¾è¦†ç›–é™ä½å¯è¯»æ€§ã€‚"
      - "ä¸ Grid æ¨¡å¼ä¿æŒå¿ƒæ™ºä¸€è‡´ï¼šå°é¢ç¼©ç•¥å›¾ + æ ‡é¢˜ + PIN â†’ æè¿° â†’ æŒ‡æ ‡ã€‚"
    specs:
      - "List è§†å›¾é‡‡ç”¨ç¼©ç•¥å›¾ + è¡¨æ ¼åˆ—ï¼šåˆ—é¡ºåº = ç¼©ç•¥å›¾+æ ‡é¢˜ | æè¿°(å•è¡Œçœç•¥) | æŒ‡æ ‡ | æ—¶é—´ | æ“ä½œã€‚"
      - "æè¿°åˆ—ä½¿ç”¨ ellipsis + tooltip å…¨æ–‡ï¼›æŒ‡æ ‡åˆ—ä¸å—æè¿°é•¿åº¦å½±å“ã€‚"
      - "ç‚¹å‡»æ•´è¡Œï¼ˆæ“ä½œåˆ—é™¤å¤–ï¼‰è¿›å…¥è¯¦æƒ…ã€‚"
    accessibility:
      - "ç¼©ç•¥å›¾è£…é¥°å¯ç©º altï¼›æ•´è¡Œ focus æ—¶é«˜äº®ä¸å¡ç‰‡è¡Œä¸ºä¸€è‡´ã€‚"
    status: "Planned Nov 22, 2025"
  rules:
    RULE-LIBRARY-CREATION-DIALOG-V2: |
      Library æ–°å»º/ç¼–è¾‘ä½¿ç”¨ç»Ÿä¸€å±…ä¸­å¼¹çª—ï¼ˆå®½åº¦â‰¤480pxï¼ŒèƒŒæ™¯å¾„å‘åŠé€æ˜ + blurï¼‰ï¼Œæ ‡é¢˜ + å‰¯æ ‡é¢˜å¼•å¯¼ï¼›åº•éƒ¨ä»…ä¿ç•™ Create/Save ä¸»æŒ‰é’®ï¼Œå–æ¶ˆè¡Œä¸ºç”±å³ä¸Šè§’ close icon / Esc è´Ÿè´£ã€‚
      å¯è®¿é—®æ€§ï¼šName è‡ªåŠ¨èšç„¦ï¼›ESC / é®ç½©å…³é—­ï¼›role="dialog" aria-modal="true"ï¼›é”™è¯¯ toast ä¸æ¸…ç©ºè¾“å…¥ã€‚
      åé¦ˆï¼šåˆ›å»ºæˆåŠŸè½»å¾®é«˜äº®æ–°å¡ï¼ˆCSS .highlighted è„‰å†² â‰¤800msï¼‰ï¼›ç¼–è¾‘æˆåŠŸä»… toastã€‚
      æ–‡æ¡ˆï¼ˆä¸­æ–‡ä¼˜å…ˆï¼‰ï¼šâ€œæ–°å»ºä¹¦åº“â€/â€œç¼–è¾‘ä¹¦åº“â€ + å‰¯æ ‡é¢˜å¼•å¯¼ç”¨é€”ï¼›å ä½ç¬¦ç¤ºä¾‹ï¼ˆç¿»è¯‘é¡¹ç›®ã€è®ºæ–‡é˜…è¯»ã€å·¥ä½œæ—¥æŠ¥â€¦ï¼‰ã€‚
      çº¦æŸï¼šä¸æ‰©å±• Domainï¼›ç¦æ­¢å¼•å…¥å…¨å±è¦†ç›–ï¼›åç»­å¢å¼ºç„¦ç‚¹é™·é˜±ä¸ i18n æŠ½ç¦»ã€‚
  library_ui_refactor:
    - "Hero Row: æ ‡é¢˜ + å‰¯è¯´æ˜ + æœç´¢æ¡† + Grid/List åˆ‡æ¢ + ä¸»åˆ›å»ºæŒ‰é’® + å›æ”¶ç«™å…¥å£ (æ–‡å­—é“¾æ¥)ã€‚"
    - "å¡ç‰‡ hoverï¼šè½»å¾®æŠ¬èµ· (translateY -2px) + é˜´å½±æå‡ (shadow-smâ†’shadow-md)ã€‚"
    - "ç»Ÿä¸€åœ†è§’ï¼šå¡ç‰‡ radius ä½¿ç”¨ var(--radius-lg)ï¼›ç³»ç»Ÿèœå•ä½¿ç”¨ var(--radius-md)ã€‚"
    - "é—´è·ç»Ÿä¸€ï¼šä¸»åŒºå†…å®¹ç½‘æ ¼ gap 24pxï¼›æŒ‰é’®ç»„ä¸è¾“å…¥ä¹‹é—´ spacing-smã€‚"
    - "é¢œè‰²ä¸å†™æ­»ï¼šå…¨éƒ¨ä½¿ç”¨ tokens.css ä¸­ --color-* å˜é‡ï¼›ä¿ç•™å…¼å®¹åˆ«å --bg-secondary/--border-colorã€‚"
    - "List è§†å›¾ï¼šé«˜å¯†åº¦è¡Œé«˜ 48pxï¼Œåˆ—ï¼šåç§° / è¯´æ˜ / #Books(é¢„ç•™) / åˆ›å»ºæ—¶é—´ã€‚"
    - "ç©ºçŠ¶æ€ï¼šæä¾›åˆ›å»ºç¤ºä¾‹æ–‡æ¡ˆä¸å¼•å¯¼ï¼Œä¸ä½¿ç”¨çº¯ 'No data'ã€‚"

  rules:
    RULE_COMP_001_BUTTON:
      file_location: "frontend/src/components/ui/Button.tsx + styles/button.css"
      variants:
        primary: |
          background-color: var(--color-primary);
          color: var(--color-surface);
          transition: all 0.3s ease;
        secondary: |
          background-color: var(--color-secondary);
          color: white;
        outline: |
          background-color: transparent;
          border: 1px solid var(--color-border);
          color: var(--color-primary);
      states:
        hover: "opacity: 0.9; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15)"
        active: "transform: translateY(0)"
        disabled: "opacity: 0.5; cursor: not-allowed; transform: none"

    RULE_COMP_002_CARD:
      file_location: "frontend/src/components/ui/Card.tsx"
      implementation: |
        background-color: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: var(--spacing-lg);
        transition: all 0.3s ease;

    RULE_COMP_003_INPUT:
      file_location: "frontend/src/components/ui/Input.tsx"
      implementation: |
        background-color: var(--color-surface);
        border: 1px solid var(--color-border);
        color: var(--color-text);
        border-radius: var(--radius-md);
        padding: var(--spacing-sm) var(--spacing-md);
        transition: border-color 0.3s ease;

        &:focus {
          border-color: var(--color-primary);
          outline: none;
        }

    RULE_COMP_004_TEXT:
      file_location: "frontend/src/styles/tokens.css"
      implementation: |
        h1: color: var(--color-text); font-size: var(--font-h1-size);
        h2: color: var(--color-text); font-size: var(--font-h2-size);
        body: color: var(--color-textSecondary);
        muted: color: var(--color-textMuted);
        caption: color: var(--color-textMuted); font-size: 0.75rem;

# ============================================
# Part 3: State Management Rules
# ============================================

state_management:
  tool: "TanStack Query (React Query) + Context API"
  principle: "Server state â‰  UI state"

  rules:
    RULE_SM_001_SERVER_STATE:
      description: "API data (libraries, books, blocks) must use TanStack Query"
      implementation: |
        âœ… const { data, isLoading } = useQuery({
             queryKey: ['libraries'],
             queryFn: listLibraries,
             staleTime: 5 * 60 * 1000,  // 5 min
           });

        âŒ WRONG: const [libs, setLibs] = useState([]);
                  useEffect(() => api.getLibs().then(setLibs), []);  // Gets out of sync!

    RULE_SM_002_UI_STATE:
      description: "Local UI state (modal open, form input) uses useState + localStorage"
      implementation: |
        âœ… Modal visible: const [isOpen, setIsOpen] = useState(false);
        âœ… Form input: const [title, setTitle] = useState('');
        âœ… User preference: localStorage for theme, mode, selected library
        âŒ WRONG: Put server data in useState

    RULE_SM_003_OPTIMISTIC_UPDATES:
      description: "Update UI before server responds (mutate + rollback on error)"
      implementation: |
        âœ… useMutation({
             mutationFn: (newLib) => api.createLibrary(newLib),
             onMutate: async (newLib) => {
               queryClient.setQueryData(['libraries'], old => [...old, newLib]);
             },
             onError: (err) => {
               queryClient.invalidateQueries(['libraries']);  // Rollback
               showErrorToast(err.message);
             },
             onSuccess: () => {
               queryClient.invalidateQueries(['libraries']);  // Refresh from server
             },
           });

    RULE_SM_004_CACHE_INVALIDATION:
      description: "When data changes, invalidate related queries"
      implementation: |
        âœ… After creating library: queryClient.invalidateQueries({ queryKey: ['libraries'] });
        âœ… After updating book: queryClient.invalidateQueries({ queryKey: ['books'] });
        âœ… Use queryClient.setQueryData() for optimistic updates
        âœ… Use queryClient.getQueryData() to read cache without fetching

    RULE_SM_005_DIALOG_STATE_MUTATION_LIFECYCLE:
      description: "Dialog state management for async mutations (e.g., bookshelf creation)"
      related_pr_date: "2025-11-20"
      context_problem: "Dialog showed error message despite successful creation (201 Created); race condition between mutation callbacks and error display"
      root_cause_analysis: |
        âŒ WRONG PATTERN (Anti-pattern from pre-2025-11-20):
           1. useEffect with try/finally: setIsSubmitting(true) in try, setIsSubmitting(false) in finally
           2. Problem: finally block fires BEFORE mutation callback completes
           3. Result: Error handler reads stale data, displays wrong message even on success
           4. Race: mutation.onSuccess invalidates cache â†’ dialog closes â†’ but error still shows briefly

        âœ… CORRECT PATTERN (Post-2025-11-20 implementation):
           1. Remove local isSubmitting state entirely
           2. Use mutation.isMutating directly (TanStack Query manages async state correctly)
           3. onSuccess callback: close dialog immediately + clear form
           4. onError callback: keep dialog open for retry + show error message
           5. No try/finally, no race conditions
      implementation: |
        // âœ… CORRECT BOOKSHELF DIALOG STATE MANAGEMENT
        export function BookshelfDialog({ libraryId, onClose }) {
          const [formData, setFormData] = useState({ name: '', description: '' });

          // âœ… Use mutation's isMutating, NOT local state
          const mutation = useCreateBookshelf();

          const handleSubmit = async (e) => {
            e.preventDefault();
            mutation.mutate(
              { library_id: libraryId, ...formData },
              {
                // âœ… onSuccess: close dialog + clear form
                onSuccess: () => {
                  onClose();  // Close immediately
                  setFormData({ name: '', description: '' });
                  // Cache invalidation happens in useCreateBookshelf hook
                },
                // âœ… onError: keep dialog open, show error
                onError: (error) => {
                  // Extract proper error message chain:
                  // 1. Backend detail.message (if field-specific error)
                  // 2. Backend detail (if array of errors)
                  // 3. Backend response message (if wrapped)
                  // 4. Axios error message (generic fallback)
                  const errorMsg =
                    error?.response?.data?.detail?.message ||
                    error?.response?.data?.detail ||
                    error?.message ||
                    'Unknown error';
                  showErrorToast(errorMsg);
                  // Dialog stays open for user to retry
                }
              }
            );
          };

          return (
            <Dialog open={open} onOpenChange={onClose}>
              <form onSubmit={handleSubmit}>
                <Input
                  value={formData.name}
                  onChange={(e) => setFormData({...formData, name: e.target.value})}
                  disabled={mutation.isMutating}  // âœ… Use mutation.isMutating
                />
                <Button type="submit" disabled={mutation.isMutating}>
                  {mutation.isMutating ? 'Creating...' : 'Create'}
                </Button>
              </form>
            </Dialog>
          );
        }
      rules:
        - "âœ… Never use try/finally for async state management"
        - "âœ… Delegate async state to TanStack Query (isMutating flag)"
        - "âœ… onSuccess should close dialog + clear form"
        - "âœ… onError should keep dialog open + show user-friendly message"
        - "âœ… Extract error message: detail.message â†’ detail â†’ message (fallback chain)"
        - "âŒ WRONG: Setting error state in finally block"
        - "âŒ WRONG: Calling setIsSubmitting(false) unconditionally"
        - "âŒ WRONG: Closing dialog on error (user loses retry opportunity)"
      benefits:
        - "âœ… No race conditions between callbacks"
        - "âœ… Single source of truth for async state (mutation.isMutating)"
        - "âœ… Proper error recovery flow (dialog stays open)"
        - "âœ… Cleaner code (no manual try/finally handling)"
      related_files:
        - "frontend/src/widgets/bookshelf/BookshelfMainWidget.tsx"
        - "backend/api/app/modules/bookshelf/routers/bookshelf_router.py"
      validation_date: "2025-11-20"

# ============================================
# Part 4: Error Handling Rules
# ============================================

error_handling:
  rules:
    RULE_EH_001_HTTP_STATUS_MAPPING:
      description: "Map backend HTTP status codes to user-friendly messages"
      mapping:
        400: "Invalid input. Please check your entries."
        401: "Not authenticated. Please log in again."
        403: "Access denied. You don't have permission."
        404: "Item not found. It may have been deleted."
        409: "Conflict. This action conflicts with existing data."
        422: "Invalid data format. Please check and try again."
        500: "Server error. Please try again later."
        503: "Service unavailable. Please try again later."
      implementation: |
        âœ… Create util/errorMapper.ts
        âœ… Map backend exceptions to user messages
        âœ… Show Toast with user-friendly text
        âœ… Log technical details to console in dev mode

    RULE_EH_002_NETWORK_RESILIENCE:
      description: "Handle network failures gracefully"
      implementation: |
        âœ… Show loading state during API call
        âœ… Retry failed requests (exponential backoff: 1s, 2s, 4s)
        âœ… Display offline banner if no connectivity
        âœ… Queue mutations for replay when online (TanStack Query handles this)
        âœ… Set HTTP timeout to NEXT_PUBLIC_API_TIMEOUT env var (default 10000ms)

    RULE_EH_003_FORM_VALIDATION:
      description: "Client-side validation before API call"
      implementation: |
        âœ… Use Zod or Yup for schema validation
        âœ… Show field-level error messages in real-time
        âœ… Disable submit button if form invalid
        âœ… Match backend validation rules (from DDD_RULES: RULE-006, RULE-009, etc.)

# ============================================
# Part 5: API Client Rules
# ============================================

api_client:
  base_url: "æµè§ˆå™¨é»˜è®¤èµ°ç›¸å¯¹è·¯å¾„ï¼ˆ'' + /api/v1ï¼Œç”± Next rewrites â†’ API_PROXY_TARGET ä»£ç†ï¼‰ï¼›ä»…åœ¨ Storybook/CI/ç‹¬ç«‹è„šæœ¬ä¸­é€šè¿‡ NEXT_PUBLIC_API_BASE è¦†ç›–å®Œæ•´åŸŸåï¼Œç¦æ­¢åœ¨ UI ä»£ç ç¡¬ç¼–ç  30xxx ç«¯å£ã€‚"
  library_listing_mode: "å•ç”¨æˆ·æ¨¡å¼ï¼šæ— éœ€ä¼  user_idï¼›æ‰€æœ‰åº“ç›´æ¥æ˜¾ç¤ºã€‚"
  debug_endpoints:
    - "/api/v1/libraries?debug=true (X-Debug-Library-Count header)"
    - "/api/v1/libraries/debug/meta (count + has_libraries JSON)"
  env_overrides:
    DEV_USER_ID: "åç«¯å¯é€‰è¦†ç›–å½“å‰ç”¨æˆ· IDï¼ˆå¼€å‘è°ƒè¯•ï¼‰ï¼Œä¸å½±å“å‰ç«¯è°ƒç”¨ã€‚"
  timeout: "NEXT_PUBLIC_API_TIMEOUT (default: 10000ms)"
  auth_strategy: "JWT Bearer Token + Refresh Token"

  rules:
    RULE_API_001_JWT_INTERCEPT:
    RULE_API_BASE_001: "å¼€å‘ç¯å¢ƒå¿…é¡»ä¿æŒåŒæºï¼šä¼˜å…ˆä½¿ç”¨ Next.js rewrites å°† `/api/v1/*` ä»£ç†åˆ° `http://localhost:30002`ï¼›å¦‚éœ€ç›´è¿ï¼Œè®¾ç½® `NEXT_PUBLIC_API_BASE=http://localhost:30002` ä¸”ä¿æŒ `NEXT_PUBLIC_API_PREFIX=/api/v1`ã€‚é¿å…æ··ç”¨ä¸åŒç«¯å£å¯¼è‡´ CORS/ä»£ç†å¤±è´¥ã€‚"
      RULE_API_PREFIX_001: "æ‰€æœ‰æ‰‹å†™ fetch/URL æ‹¼æ¥å¿…é¡»ä½¿ç”¨ (base_url + api_prefix + path)ã€‚ç¦æ­¢é—æ¼ /api/v1 æˆ–é‡å¤åŒå†™ã€‚æ¨èç»Ÿä¸€ä½¿ç”¨å…±äº«é…ç½® config.api.baseUrl ä¸ config.api.prefixï¼›è‹¥ base_url å·²å«prefixï¼Œadapteréœ€æ£€æµ‹é¿å…é‡å¤ã€‚Basement ç›¸å…³ç«¯ç‚¹ï¼ˆ/books/deleted ç­‰ï¼‰ä¸¥ç¦çœç•¥å‰ç¼€ä»¥é¿å…é”™è¯¯æ‹¦æˆªå™¨è¯¯åˆ¤åº“åŠ è½½å¤±è´¥ã€‚"
    RULE_API_010_CONTRACT_SYNC: "åˆ—è¡¨ç«¯ç‚¹ç»Ÿä¸€è¿”å› `{items,total}`ï¼Œå‰ç«¯ API é€‚é…å±‚éœ€è¯»å– `response.data.items` å¹¶è½¬æ¢ä¸º UI æ‰€éœ€æ•°ç»„å½¢æ€ï¼›å•ä½“è¿”å›ç›´æ¥æ˜ å°„å¹¶é€šè¿‡ mapper å½’ä¸€å­—æ®µåã€‚"
    RULE_API_010_CONTRACT_SYNC: |
      åˆ†é¡µ/åˆ—è¡¨ç«¯ç‚¹ç»Ÿä¸€ä½¿ç”¨ Pagination Contract V2ï¼š
      Response Body:
        {
          "items": [...],          # å½“å‰é¡µèµ„æºæ•°ç»„
          "total": 234,            # èµ„æºæ€»æ•°ï¼ˆä¸å—åˆ†é¡µè£å‰ªï¼‰
          "page": 1,               # å½“å‰é¡µï¼ˆä» 1 å¼€å§‹ï¼‰
          "page_size": 20,         # æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤ 20ï¼Œå¯é…ç½®ï¼‰
          "has_more": true         # æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µï¼ˆç”±åç«¯ç›´æ¥ç»™å‡ºï¼‰
        }
      å–ä»£æ—§ç‰ˆ V1 `{items,total}` ç»“æ„ï¼›å‰ç«¯ä¸å†è‡ªè¡Œæ¨æ–­ hasMoreã€‚
      é€‚é…å±‚èŒè´£ï¼š
        - æ ¡éªŒå­˜åœ¨ page/page_sizeï¼›å¦‚ç¼ºå¤±ä¸”ä»…å‡ºç° `{items,total}` â†’ è®°å½• warningï¼ˆconsole.warnï¼‰å¹¶è¿›å…¥å…¼å®¹åˆ†æ”¯ã€‚
        - å°†æšä¸¾ä¼ è¾“å±‚å°å†™å€¼è½¬æ¢ä¸º UI å¤§å†™æšä¸¾ï¼ˆå‚è§ RULE_ENUM_001_CASING_NORMALIZATIONï¼‰ã€‚
        - ä¿æŒ DTO ä¸ TanStack Query ç¼“å­˜é”®ä¸€è‡´ï¼š['books', {page, pageSize, filters}]ã€‚
      å‘½åè§„èŒƒï¼šç¦æ­¢ä½¿ç”¨ total_count / size / current_page ç­‰å˜ä½“ï¼›ç»Ÿä¸€ total / page_size / pageã€‚
      çº¿ç¨‹å®‰å…¨ï¼šåç«¯è®¡ç®— has_more é¿å…å‰ç«¯æŒ‰ (items.length === page_size) æ¨æ–­å¯¼è‡´æœ€åä¸€é¡µè¯¯åˆ¤ã€‚
      ç©ºåˆ—è¡¨ï¼šè¿”å› items:[], total:0, page:1, page_size:20, has_more:falseã€‚
    RULE_API_011_PAGINATION_V1_DEPRECATION: |
      æ—§åˆ†é¡µå¥‘çº¦ V1 `{items,total}` çš„å…¼å®¹æ”¯æŒå°†äº 2025-12-15 ä¸‹çº¿ (sunset)ã€‚
      è¿ç§»ç­–ç•¥ï¼š
        Phase A (å½“å‰è‡³ 2025-12-01): è®°å½•ä½¿ç”¨ V1 ç«¯ç‚¹çš„æ§åˆ¶å° warningï¼Œä¸ä¸­æ–­åŠŸèƒ½ã€‚
        Phase B (2025-12-01 è‡³ 2025-12-15): å‰ç«¯åœ¨æ£€æµ‹åˆ° V1 ç»“æ„æ—¶è‡ªåŠ¨å‘èµ·ä¸€æ¬¡ V2 æ¢æµ‹è¯·æ±‚ï¼ˆ?page=1&page_size=20ï¼‰ï¼Œå¦‚ä»å¤±è´¥æ˜¾ç¤ºè¿ç§»æç¤ºæ¨ªå¹…ã€‚
        Sunset (>=2025-12-15): ç§»é™¤å…¼å®¹åˆ†æ”¯ï¼Œè‹¥ä»æ”¶åˆ° `{items,total}` ç›´æ¥æŠ›å‡º ContractVersionError ä¾›é”™è¯¯æ¨ªå¹…å±•ç¤ºã€‚
      æ–‡æ¡£åŒæ­¥ï¼šDDD_RULES.yaml CONVENTION-RESPONSES-001ã€HEXAGONAL_RULES.yaml response_shapeã€ADR-079 è®°å½•å†³ç­–ã€‚
    RULE_API_012_HAS_MORE_SOURCE_OF_TRUTH: |
      has_more å­—æ®µç”±åç«¯åœ¨åˆ†é¡µæŸ¥è¯¢é˜¶æ®µåˆ¤å®šï¼š`has_more = (page * page_size) < total`ã€‚
      å‰ç«¯ç¦æ­¢ä»¥ `items.length === page_size` æ¨æ–­ï¼ˆä¼šåœ¨ total æ°å¥½ä¸º page*page_size æ—¶è¯¯åˆ¤ trueï¼‰ã€‚
      Adapter è‹¥å‘ç°ç¼ºå¤± has_more è€Œå‡ºç° page/page_size/total æ—¶ä¸´æ—¶è®¡ç®—å¹¶å‘å‡º Deprecation Warningï¼š"Pagination V2 field has_more missing; computing client-side (will be removed after 2025-12-01)"ã€‚
    RULE_API_013_QUERY_KEY_PAGINATION: |
      TanStack Query åˆ†é¡µç¼“å­˜é”®ç»Ÿä¸€ï¼š['books', { page, pageSize, filters }] / ['bookshelves', { page, pageSize, filters }]ã€‚
      filters å¯¹è±¡å¿…é¡»ç¨³å®šåºåˆ—åŒ–ï¼ˆé”®é¡ºåºå›ºå®šï¼‰ï¼›ç¦æ­¢ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²å½¢æˆç¼“å­˜é”®ã€‚
      pageSize ç»Ÿä¸€ä½¿ç”¨é©¼å³° pageSizeï¼ˆä¸å“åº”å­—æ®µ page_size åŒºåˆ†ï¼Œadapter åšè½¬æ¢ï¼‰ã€‚
    RULE_ENUM_001_CASING_NORMALIZATION: "ä¼ è¾“å±‚æšä¸¾é‡‡ç”¨å°å†™ï¼ˆä¾‹å¦‚ `normal|basement`ï¼‰ï¼›UI æšä¸¾å¯ä¸ºå¤§å†™ï¼ˆ`NORMAL|BASEMENT`ï¼‰ã€‚å¿…é¡»åœ¨ API é€‚é…å±‚è¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œä¸å¾—åœ¨ç»„ä»¶å†…ç›´æ¥åˆ¤æ–­ä¼ è¾“å€¼ã€‚"
    RULE_ENUM_001_CASING_NORMALIZATION: |
      ä¼ è¾“å±‚ï¼ˆHTTP/DTOï¼‰æšä¸¾é‡‡ç”¨å°å†™ï¼ˆä¾‹å¦‚ normal/basement/active/archived/deletedï¼‰ã€‚
      UI å±•ç¤ºå±‚å¯é‡‡ç”¨å¤§å†™æšä¸¾æˆ– Title Caseï¼›å¤§å°å†™è½¬æ¢ä¸è¯æ±‡æ˜ å°„åªèƒ½å‘ç”Ÿåœ¨ API Adapterï¼š
        - Adapter è¾“å…¥ï¼šåç«¯ JSON â†’ æ­£è§„åŒ–å†…éƒ¨æšä¸¾ (BookStatus.ACTIVE)
        - ç»„ä»¶å±‚ï¼šåªæ¶ˆè´¹å†…éƒ¨æ ‡å‡†æšä¸¾ï¼Œä¸ç›´æ¥æ¯”è¾ƒä¼ è¾“åŸå§‹å­—ç¬¦ä¸²ã€‚
      ç¦æ­¢ï¼šåœ¨ç»„ä»¶å†…å†™ `if (status === 'active')`ï¼›åº”ä½¿ç”¨ `if (status === BookStatus.ACTIVE)`ã€‚
      æ‰©å±•ï¼šæ–°å¢æšä¸¾æ—¶éœ€åŒæ—¶æ›´æ–° DDD_RULES.yaml CONVENTION-ENUMS-001 ä¸ HEXAGONAL_RULES.yaml enum_casingã€‚
      å›é€€ï¼šè‹¥åç«¯æš‚æ—¶è¿”å›å¤§å†™ï¼ŒAdapter éœ€é™ä¸ºå°å†™å†æ˜ å°„ï¼Œè®°å½•ä¸€æ¬¡ warningã€‚
    RULE_ENUM_002_PLACEHOLDER_PRIORITY: |
      å°é¢/å ä½å›¾æ¥æºä¼˜å…ˆçº§ï¼ˆä¹¦æ©±/ä¹¦ç±ä¸€è‡´ï¼‰ï¼š
        1. ç”¨æˆ·æ˜¾å¼è®¾ç½®å°é¢ï¼ˆlocalStorage phase A æˆ– Media å…³è” phase Bï¼‰
        2. å…³è”åª’èµ„ä¸»å›¾ï¼ˆphase Bï¼‰
        3. é¢œè‰²å“ˆå¸Œå ä½å›¾ï¼ˆFNV-1a â†’ é¢„å®šä¹‰è°ƒè‰²æ¿ï¼‰
      é¢œè‰²å“ˆå¸Œç®—æ³•ä¸ glyph ç”Ÿæˆé€»è¾‘é›†ä¸­åœ¨ shared/util/coverPlaceholder.tsï¼›ç¦æ­¢åœ¨å¤šä¸ªç»„ä»¶é‡å¤å®ç°ã€‚
      æšä¸¾çŠ¶æ€å¾½ç« ï¼ˆPinned / Archived / Basement / Deletedï¼‰ä½¿ç”¨ä¸ä¸»é¢˜è‰²å¯¹æ¯”åº¦â‰¥4.5:1ã€‚
      æœªæ¥è®¡åˆ’ï¼šPhase C å¼•å…¥ç”¨æˆ·è‡ªå®šä¹‰è°ƒè‰²æ¿ï¼ˆä¸å½±å“é»˜è®¤å“ˆå¸Œè·¯å¾„ï¼‰ã€‚
    RULE_BOOK_PLACEHOLDER_COVER_STRATEGY: |
      BookPreviewCard å ä½å°é¢è§„åˆ™ï¼š
        - è¾“å…¥ï¼šbook.titleï¼ˆç©ºæ ‡é¢˜ä½¿ç”¨ 'Untitled' å ä½å­—ç¬¦ä¸²ï¼‰
        - å“ˆå¸Œï¼šFNV-1a 32bit â†’ index % palette.length é€‰è‰²ï¼›palette å›ºå®š 12 é¢œè‰²ï¼ˆé«˜å¯¹æ¯”åº¦ï¼Œæš—/äº®æ¨¡å¼å¯åŒºåˆ†ï¼‰
        - glyphï¼šå–é¦–ä¸ªéç©ºç™½å­—ç¬¦ï¼ˆè‹¥éå­—æ¯æ•°å­—â†’ '#'ï¼‰å¹¶è½¬ä¸ºå¤§å†™ï¼›å­—ä½“ä½¿ç”¨ var(--font-h2-size) & weight 600ã€‚
        - æ— é—ªçƒï¼šSSR ä¸ CSR ä¸€è‡´è¾“å‡ºï¼ˆé¿å… hydration mismatchï¼‰
        - å°é¢å°ºå¯¸ï¼šé»˜è®¤ 200Ã—120 (card) / 200Ã—280 (åˆ—è¡¨è¯¦ç»†)ï¼›åœ¨ grid æ¨¡å¼ç”¨ aspect-ratio ä¿æŒä¸€è‡´ã€‚
        - ç¦æ­¢ï¼šè¿è¡Œæ—¶éšæœºè‰²ï¼ˆå¯¼è‡´æ»šåŠ¨æˆ–åˆ·æ–°ä¸ç¨³å®šï¼‰ã€‚
      å¯è®¿é—®æ€§ï¼šaria-label="å°é¢å ä½: {glyph}"ï¼›glyph å¯¹æ¯”åº¦ç¬¦åˆ WCAG AAã€‚
    RULE_BOOK_LAYOUT_TOGGLE: |
      Book åˆ—è¡¨æ”¯æŒåŒå¸ƒå±€åˆ‡æ¢ï¼š"horizontal" (æ°´å¹³æ»šåŠ¨æ¡) ä¸ "grid" (è‡ªé€‚åº”åˆ—)ã€‚
      è¡Œä¸ºï¼š
        - åˆ‡æ¢ä¸é‡æ–°è¯·æ±‚æ•°æ®ï¼Œä»…æ”¹å˜å±•ç¤ºæ ·å¼ï¼›åˆ†é¡µçŠ¶æ€ä¿æŒã€‚
        - æ¨ªå‘æ¨¡å¼ï¼šä½¿ç”¨ overflow-x auto + snap-inline; æ¯å¡ç‰‡æœ€å°å®½åº¦ 200pxï¼›å‘å³æ— é™åŠ è½½ï¼ˆIntersectionObserver å“¨å…µä½äºè¡Œå°¾ï¼‰ã€‚
        - ç½‘æ ¼æ¨¡å¼ï¼šCSS Grid repeat(auto-fill, minmax(180px, 1fr))ï¼›åˆ†é¡µé€šè¿‡ä¸‹æ–¹â€œåŠ è½½æ›´å¤šâ€æŒ‰é’®æˆ–å“¨å…µã€‚
        - çŠ¶æ€ä¿æŒï¼šlayout æ¨¡å¼å­˜å‚¨åœ¨ localStorage key=book:layout æˆ–ç”¨æˆ·åå¥½åç«¯ï¼ˆPhase Bï¼‰ã€‚
      æ— éšœç¢ï¼š
        - åˆ‡æ¢æŒ‰é’®ï¼šaria-pressed æŒ‡ç¤ºå½“å‰æ¿€æ´»å¸ƒå±€ï¼›å¿«æ·é”® Alt+L åœ¨ horizontal ä¸ grid é—´åˆ‡æ¢ã€‚
      æ€§èƒ½ï¼šé¿å…åœ¨å¸ƒå±€åˆ‡æ¢æ—¶å¸è½½å…¨éƒ¨èŠ‚ç‚¹ï¼›ä»…è°ƒæ•´ classNameã€‚
    RULE_BOOK_PAGINATED_SECTION_INTEGRATION: |
      PaginatedBookSection ç»„åˆç»„ä»¶èŒè´£ï¼šæ•´åˆå¸ƒå±€åˆ‡æ¢ + åˆ—è¡¨æ˜¾ç¤º + åˆ†é¡µåŠ è½½æ§åˆ¶ã€‚
      ç»“æ„ï¼šHeader(Title + LayoutToggle) â†’ Content(BookPreviewList) â†’ Footer(LoadMoreButton / sentinel)ã€‚
      ç»Ÿä¸€åŠ è½½çŠ¶æ€ï¼š
        - åˆå§‹åŠ è½½ï¼šæ˜¾ç¤º skeletonï¼ˆ4 å¡ä½ï¼‰
        - åŠ è½½æ›´å¤šï¼šæŒ‰é’®æ–‡å­— "åŠ è½½æ›´å¤šâ€¦" + spinnerï¼›æ¨ªå‘æ¨¡å¼éšè—æŒ‰é’®ä»…ä½¿ç”¨å“¨å…µã€‚
        - é”™è¯¯ï¼šä¿ç•™å·²åŠ è½½é¡µé¢å†…å®¹ï¼Œåœ¨ footer åŒºåŸŸæ˜¾ç¤ºé”™è¯¯æç¤ºä¸é‡è¯•æŒ‰é’®ã€‚
      äº‹ä»¶ï¼šonLayoutChange(layout) / onLoadMore() / onRetry()ã€‚
      ç¦æ­¢ï¼šåœ¨ BookPreviewList å†…è‡ªè¡Œå‘è¯·æ±‚ï¼ˆå•ä¸€æ•°æ®æ¥æº usePaginatedBooksï¼‰ã€‚
    RULE_UI_003_BOOKSHELF_CREATE_FLOW: "åˆ›å»ºä¹¦æ©±çš„è¯·æ±‚è·¯å¾„ä¸º `/api/v1/bookshelves`ï¼Œè¯·æ±‚ä½“ä¸º `{library_id,name,description}`ï¼›ä¸å¾—å‘ `/libraries` å‘é€åˆ›å»ºè¯·æ±‚ã€‚åˆ›å»ºæˆåŠŸååº”å¤±æ•ˆ `useBookshelves(libraryId)` çš„æŸ¥è¯¢ç¼“å­˜ã€‚"
    RULE_DEV_WIN_001: "Windows æœ¬åœ°å¼€å‘å¿…é¡»é€šè¿‡ `backend/api/run_server_win.py` å¯åŠ¨åç«¯ï¼ˆåœ¨ uvicorn å¯åŠ¨å‰è®¾ç½® `WindowsSelectorEventLoopPolicy`ï¼‰ï¼›ç¦æ­¢ç›´æ¥ä½¿ç”¨ `python -m uvicorn ...` æ—§å…¥å£ã€‚"
      description: "Automatically inject JWT token in request headers"
      implementation: |
        âœ… axios interceptor: Authorization: Bearer {token}
        âœ… Store token in localStorage (wl_token) or sessionStorage
        âœ… On 401: Call refresh endpoint â†’ get new token â†’ retry original request
        âœ… On refresh fail: Logout user â†’ redirect to /auth/login

    RULE_API_002_ERROR_INTERCEPT:
      description: "Global error handling for all API calls"
      implementation: |
        âœ… Intercept response errors
        âœ… Map to user-friendly message (using RULE_EH_001_HTTP_STATUS_MAPPING)
        âœ… Show Toast automatically
        âœ… Log to console/monitoring in dev/prod

    RULE_API_003_REQUEST_TIMEOUT:
      description: "Set timeout to prevent hanging requests"
      implementation: |
        âœ… axios timeout: NEXT_PUBLIC_API_TIMEOUT
        âœ… Default 10000ms (10s)
        âœ… Configurable per environment (.env.local, .env.production)

# ============================================
# Part 6: Authentication Rules
# ============================================

authentication:
  method: "JWT Bearer Token + Refresh Token"
  storage: "localStorage (wl_token, wl_refresh_token)"
  auto_refresh: true

  rules:
    RULE_AUTH_001_LOGIN_FLOW:
      description: "Handle user login with token storage"
      implementation: |
        âœ… POST /auth/login â†’ get { token, refresh_token }
        âœ… Store both in localStorage
        âœ… Set axios Authorization header
        âœ… Redirect to /admin/dashboard
        âœ… On error: Show error toast, stay on /auth/login

    RULE_AUTH_002_TOKEN_REFRESH:
      description: "Auto-refresh token when expired"
      implementation: |
        âœ… On 401 response: Call POST /auth/refresh
        âœ… Get new token from response
        âœ… Update localStorage
        âœ… Retry original request with new token
        âœ… If refresh fails: Logout (clear tokens + redirect to /auth/login)

    RULE_AUTH_003_LOGOUT:
      description: "Clear tokens and redirect to login"
      implementation: |
        âœ… Clear localStorage (wl_token, wl_refresh_token, wl_theme, wl_mode)
        âœ… Clear axios default Authorization header
        âœ… Redirect to /auth/login
        âœ… Optional: Call POST /auth/logout on backend

    RULE_AUTH_004_PROTECTED_ROUTES:
      description: "Redirect unauthenticated users to login"
      implementation: |
        âœ… Use middleware to check token
        âœ… If no token: Redirect to /auth/login
        âœ… If token exists: Allow access to /admin/* routes
        âœ… Implement with Next.js middleware (middleware.ts)

# ============================================
# Part 7: Performance Rules
# ============================================

performance:
  rules:
    - "Library é¡µé¢å‰ç«¯æœç´¢é‡‡ç”¨å‰ç«¯è¿‡æ»¤ï¼ˆname/descriptionï¼‰ï¼Œåç«¯æœç´¢ç«¯ç‚¹è½åœ°åå†åˆ‡æ¢ API æ¨¡å¼ã€‚"
    RULE_LIBRARY_DETAIL_BOOKSHELF_INTEGRATION_001: "Library è¯¦æƒ…é¡µä¸­çš„ BookshelfMainWidget å¿…é¡»å§‹ç»ˆæ¸²æŸ“ï¼šé”™è¯¯ä»…ä»¥éé˜»å¡æ¨ªå¹…æ˜¾ç¤ºï¼Œåˆ—è¡¨ä¸åˆ›å»ºå…¥å£ä¸å¯è¢«æ•´ä½“æ›¿æ¢ã€‚"
    RULE_BOOKSHELF_VIEW_MODES_001: "Bookshelf åˆ—è¡¨ç»„ä»¶æ”¯æŒ 'grid' ä¸ 'list' åŒæ¨¡å¼ï¼›åˆ‡æ¢ä¸è§¦å‘é‡æ–°è¯·æ±‚ï¼Œåªæ”¹å˜å±•ç¤ºå¸ƒå±€ã€‚"
    RULE_BOOKSHELF_CARD_ILLUSTRATION_001: "æ¯ä¸ª BookshelfCard ä½¿ç”¨åç§°å“ˆå¸Œç”Ÿæˆç¨³å®š coverColor + é¦–å­—æ¯æ’å›¾ï¼Œé¿å…é—ªçƒä¸ Hydration mismatchã€‚"
    RULE_DEGRADATION_TIMEOUT_001: "3s è¶…æ—¶åä½¿ç”¨ localStorage ç¼“å­˜æ•°æ®å›å¡«ï¼Œä¸å¾—å‡ºç°æ•´é¡µç©ºç™½ï¼›æ˜¾ç¤º 'è¯·æ±‚è¶…æ—¶ï¼Œæ˜¾ç¤ºç¼“å­˜æ•°æ®' æ¨ªå¹…ã€‚"
    RULE_QUERY_KEY_COMPOSITION_001: "TanStack Query key å¿…é¡»åŒ…å« filters å¯¹è±¡åŒ…è£…ï¼ˆå¦‚ {libraryId}ï¼‰ï¼Œä¸¥ç¦ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé˜²æ­¢ç¼“å­˜æ±¡æŸ“ã€‚"
    RULE_WIDGET_VIEWMODE_STATE_001: "è§†å›¾æ¨¡å¼çŠ¶æ€åœ¨ BookshelfMainWidget å†…éƒ¨ç®¡ç†å¹¶å‘ä¸‹é€ä¼ ï¼Œä¸è¿›å…¥å…¨å±€ storeã€‚"
    RULE_NO_NESTED_ENDPOINTS_001: "å‰ç«¯ä¸å¾—æ„é€  /libraries/{id}/bookshelves åµŒå¥—è·¯ç”±è¯·æ±‚ï¼›ä¸€å¾‹ä½¿ç”¨å¹³é“º /bookshelves?library_id={id}."
    RULE_PERF_001_PAGINATION:
      description: "Large lists must paginate (max 20 items per page)"
      implementation: |
        âœ… Default page size: 20
        âœ… Support infinite scroll or "Load more" button
        âœ… Cache pages in TanStack Query (staleTime: 5 min)
        âœ… Show loading skeleton while fetching
        âŒ WRONG: Render 1000+ items at once

    RULE_PERF_002_LAZY_LOADING:
      description: "Defer non-critical data with React.lazy + Suspense"
      implementation: |
        âœ… const BookManager = React.lazy(() => import('./BookManager'));
        âœ… <Suspense fallback={<Skeleton />}>
             <BookManager />
           </Suspense>
        âœ… Load block details only when book detail page opens
        âœ… Prefetch on hover (useQueryClient().prefetchQuery)

    RULE_PERF_003_MEMOIZATION:
      description: "Prevent unnecessary re-renders with React.memo, useMemo, useCallback"
      implementation: |
        âœ… export const LibraryCard = React.memo(function LibraryCard(props) { });
        âœ… useMemo for expensive computations (filter, sort)
        âœ… useCallback for event handlers passed to children
        âš ï¸ Only memoize if you measure performance impact (use React DevTools Profiler)

    RULE_PERF_004_CODE_SPLITTING:
      description: "Bundle splitting by route (automatic with Next.js App Router)"
      implementation: |
        âœ… Each page.tsx is automatically code-split
        âœ… Each route loads only its required JS
        âœ… Use dynamic imports for heavy components
        âœ… Analyze bundle with next/bundle-analyzer

# ============================================
# Part 8: Accessibility Rules (A11y)
# ============================================

accessibility:
  framework: "WAI-ARIA + semantic HTML"
  testing_tools: "axe DevTools, pa11y, screen readers (NVDA, JAWS)"

  rules:
    RULE_A11Y_001_SEMANTIC_HTML:
      description: "Use semantic HTML elements"
      implementation: |
        âœ… <button> for clickable actions (NOT <div onClick={}>)
        âœ… <a> for navigation
        âœ… <form> with proper <label> tags
        âœ… Heading hierarchy: h1 (page title) â†’ h2 (section) â†’ h3 (subsection)
        âœ… <nav>, <main>, <article>, <section> for structure

    RULE_A11Y_002_KEYBOARD_NAVIGATION:
      description: "All interactive elements must be keyboard accessible"
      implementation: |
        âœ… All buttons/links focusable with Tab key
        âœ… Show visible focus indicator (outline or highlight)
        âœ… Support Enter/Space on buttons
        âœ… Support Escape to close modals/dropdowns
        âœ… Use tabindex only when necessary (keep order natural)

    RULE_A11Y_003_SCREEN_READER:
      description: "Support screen readers with ARIA labels"
      implementation: |
        âœ… aria-label for icon-only buttons
        âœ… aria-expanded for collapsible sections
        âœ… aria-hidden for decorative elements
        âœ… aria-live for dynamic content updates (use sparingly)
        âœ… Test with NVDA or JAWS

    RULE_A11Y_004_COLOR_CONTRAST:
      description: "Sufficient color contrast for readability"
      implementation: |
        âœ… Text: minimum 4.5:1 contrast ratio
        âœ… Large text (18pt+): minimum 3:1 ratio
        âœ… UI components: minimum 3:1 ratio
        âœ… Check with axe DevTools or WebAIM contrast checker

# ============================================
# Part 9: Testing Rules
# ============================================

testing:
  framework: "Vitest + React Testing Library"
  e2e_framework: "Playwright"
  pyramid:
    unit: "60% - Component logic"
    integration: "30% - Feature flows"
    e2e: "10% - Full user journeys"
  target_coverage: "80%+"

  rules:
    RULE_TEST_001_UNIT:
      file_location: "frontend/src/components/__tests__/Button.test.tsx"
      framework: "Vitest + React Testing Library"
      pattern: |
        import { render, screen } from '@testing-library/react';
        import { Button } from '../Button';

        test('Button renders with correct text', () => {
          render(<Button>Click me</Button>);
          expect(screen.getByText('Click me')).toBeInTheDocument();
        });

    RULE_TEST_002_INTEGRATION:
      file_location: "frontend/src/__tests__/integration/createLibrary.test.tsx"
      framework: "React Testing Library + MSW (Mock Service Worker)"
      pattern: |
        import { render, screen } from '@testing-library/react';
        import userEvent from '@testing-library/user-event';

        test('Create library flow', async () => {
          render(<LibraryManager />);
          await userEvent.click(screen.getByText('Create'));
          await userEvent.type(screen.getByLabelText('Name'), 'My Library');
          await userEvent.click(screen.getByText('Save'));
          expect(await screen.findByText('My Library')).toBeInTheDocument();
        });

    RULE_TEST_003_E2E:
      file_location: "frontend/e2e/library.spec.ts"
      framework: "Playwright"
      pattern: |
        import { test, expect } from '@playwright/test';

        test('Full library to bookshelf flow', async ({ page }) => {
          await page.goto('/');
          await page.click('text=My Library');
          await page.click('text=Create Bookshelf');
          await expect(page.locator('text=New Bookshelf')).toBeVisible();
        });

# ============================================
# Part 10: Code Organization Rules
# ============================================

code_organization:
  structure: |
    frontend/src/
      â”œâ”€â”€ lib/
      â”‚   â”œâ”€â”€ api/                # API client functions + endpoints
      â”‚   â”œâ”€â”€ hooks/              # Custom React hooks
      â”‚   â”œâ”€â”€ utils/              # Utility functions (formatDate, parseError, etc.)
      â”‚   â”œâ”€â”€ types/              # TypeScript types (DTOs matching backend)
      â”‚   â”œâ”€â”€ config.ts           # App configuration (API URL, env vars)
      â”‚   â””â”€â”€ themes.ts           # Theme definitions (3 themes Ã— 2 modes)
      â”‚
      â”œâ”€â”€ components/
      â”‚   â”œâ”€â”€ ui/                 # Reusable UI (Button, Input, Card, Modal, Toast, Skeleton)
      â”‚   â”œâ”€â”€ library/            # Library feature components
      â”‚   â”œâ”€â”€ bookshelf/          # Bookshelf feature components
      â”‚   â”œâ”€â”€ book/               # Book feature components
      â”‚   â”œâ”€â”€ block/              # Block feature components
      â”‚   â”œâ”€â”€ providers/          # React Context providers (Auth, Theme, Query)
      â”‚   â””â”€â”€ shared/             # Cross-cutting components (Header, Sidebar, Layout)
      â”‚
      â”œâ”€â”€ styles/
      â”‚   â”œâ”€â”€ tokens.css          # CSS Variables definitions
      â”‚   â”œâ”€â”€ globals.css         # Global styles
      â”‚   â”œâ”€â”€ button.css          # Button component styles
      â”‚   â”œâ”€â”€ card.css            # Card component styles
      â”‚   â”œâ”€â”€ input.css           # Input component styles
      â”‚   â””â”€â”€ util-surface.css    # Utility surface styles
      â”‚
      â”œâ”€â”€ app/
      â”‚   â”œâ”€â”€ (auth)/             # Auth routes (separate layout)
      â”‚   â”‚   â”œâ”€â”€ login/page.tsx
      â”‚   â”‚   â”œâ”€â”€ register/page.tsx
      â”‚   â”‚   â””â”€â”€ layout.tsx
      â”‚   â”œâ”€â”€ (admin)/            # Admin dashboard (requires auth)
      â”‚   â”‚   â”œâ”€â”€ layout.tsx
      â”‚   â”‚   â”œâ”€â”€ dashboard/page.tsx
      â”‚   â”‚   â””â”€â”€ ...
      â”‚   â””â”€â”€ layout.tsx          # Root layout
      â”‚
      â””â”€â”€ __tests__/
          â”œâ”€â”€ unit/               # Unit tests (60%)
          â”œâ”€â”€ integration/        # Integration tests (30%)
          â””â”€â”€ e2e/                # E2E tests (10%)

  rules:
    RULE_CO_001_NAMING:
      description: "Consistent naming conventions"
      implementation: |
        âœ… Components: PascalCase (LibraryCard.tsx)
        âœ… Hooks: camelCase, prefix with 'use' (useLibraries.ts)
        âœ… Utils: camelCase (formatDate.ts)
        âœ… Types: PascalCase (Library.ts, CreateLibraryRequest.ts)
        âœ… Constants: UPPER_SNAKE_CASE (MAX_LIBRARIES = 100)
        âœ… Files: kebab-case for components (library-card.tsx) or camelCase (useLibraries.ts)

    RULE_CO_002_IMPORTS:
      description: "Organized and clean imports"
      implementation: |
        âœ… Use absolute imports: import { useLibraries } from '@/lib/hooks';
        âœ… Avoid relative imports: âŒ import { X } from '../../../lib/hooks'
        âœ… Group imports: React â†’ External libs â†’ Local modules
        âœ… Use barrel exports (index.ts) for clean imports

        // Example:
        import React, { useState } from 'react';
        import { useQuery } from '@tanstack/react-query';
        import { useLibraries } from '@/lib/hooks';
        import { LibraryCard } from './LibraryCard';

    RULE_CO_003_EXPORTS:
      description: "Clear export patterns"
      implementation: |
        âœ… Default export: Main component of the file
        âœ… Named exports: Helper functions, types, constants

        // Example: LibraryCard.tsx
        export default function LibraryCard(props: LibraryCardProps) { }
        export type LibraryCardProps = { };
        export const LIBRARY_CARD_MARGIN = '1rem';

    RULE_CO_004_COMMENTS:
      description: "Meaningful comments for complex logic"
      implementation: |
        âœ… Document WHY, not WHAT
        âœ… Keep comments up-to-date when code changes
        âœ… Use JSDoc for exported functions
        âœ… Avoid obvious comments ("// set count to 5")

        // âœ… Good
        // We use a separate cache key for each library to avoid cross-contamination
        const queryKey = ['libraries', libraryId, 'books'];

# ============================================
# Part 11: Git & CI/CD Rules
# ============================================

git_workflow:
  strategy: "Feature branches + PR reviews + CI/CD"
  rules:
    RULE_GIT_001_BRANCH_NAMING:
      pattern: "feature/{feature-name} | fix/{bug-name} | refactor/{area}"
      example: |
        âœ… feature/library-create
        âœ… fix/theme-switch-flicker
        âœ… refactor/extract-api-client

    RULE_GIT_002_COMMITS:
      pattern: "{type}: {description}"
      types: "feat | fix | refactor | chore | style | test | docs"
      example: |
        âœ… feat: add theme switcher component
        âœ… fix: prevent theme flicker on mount
        âœ… test: add Button component unit tests
        âœ… Include ticket/issue: "Closes #123"

    RULE_GIT_003_PULL_REQUESTS:
      implementation: |
        âœ… Title: Same as commit message
        âœ… Description: Context, testing steps, screenshots
        âœ… Require 1 approval before merge
        âœ… Run tests + linting + build before merge

cicd:
  tools: "GitHub Actions + Vercel"
  checks:
    - "npm run lint (ESLint + Prettier)"
    - "npm run type-check (TypeScript)"
    - "npm run test (Vitest)"
    - "npm run build (Next.js)"
  deployment:
    preview: "Automatic on every PR (Vercel)"
    production: "Automatic on push to main"

# ============================================
# Part 12: Environment Variables
# ============================================

environment:
  files:
    - ".env.local (local development)"
    - ".env.production (production)"
  variables:
    NEXT_PUBLIC_API_BASE:
      description: "Same-origin base (Next dev) â€” rewrites proxy to backend"
      example: "http://localhost:30001"
      required: true
    NEXT_PUBLIC_API_TIMEOUT:
      description: "HTTP request timeout in milliseconds"
      example: "10000"
      required: false
      default: "10000"
    NEXT_PUBLIC_USE_MOCK:
      description: "Feature flag: 1/true enables mock data, 0/false uses real backend"
      example: "0"
      required: false
      default: "0"
    API_PROXY_TARGET:
      description: "Backend server base for Next rewrites"
      example: "http://localhost:30002"
      required: true
    API_PROXY_PREFIX:
      description: "API prefix (match backend). Recommend /api/v1"
      example: "/api/v1"
      required: true
    NEXT_PUBLIC_DEFAULT_THEME:
      description: "Default theme on first visit"
      example: "Light"
      required: false
      default: "Light"

# ============================================
# Part 13: Domain to UI Component Mapping
# ============================================

domain_to_ui_mapping:
  description: "How backend DDD domains map to frontend UI components"

  library:
    backend_entity: "Library (AggregateRoot from DDD_RULES)"
    basement_virtual_library_card: "å‰ç«¯è™šæ‹Ÿå…¥å£å¡ç‰‡ (id='__BASEMENT__') æ±‡æ€»è½¯åˆ é™¤å†…å®¹ (ADR-072)"
    basement_virtual_library_ui:
      overview: "Basement ä½œä¸ºè™šæ‹Ÿåº“å¡ç‰‡å‡ºç°åœ¨ /admin/librariesï¼Œæä¾›è¿›å…¥ /admin/basement çš„å…¥å£"
      card_design:
        locked_badge: "æ˜¾ç¤ºé”å›¾æ ‡ä¸ tooltip: 'å›æ”¶ç«™ï¼Œä¸å¯åˆ é™¤'"
        stats_display: "æ˜¾ç¤º deleted_books, deleted_bookshelves è®¡æ•°ï¼›0 æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º"
        colors: "ä½¿ç”¨ä¸»è‰²æ¢¯åº¦ + è½»é˜´å½±ï¼›æš—è‰²æ¨¡å¼é™ä½å¯¹æ¯”åº¦ä¿æŒå±‚çº§"
        hover: "å¡ç‰‡æå‡é˜´å½±ç­‰çº§ + å±•ç¤ºæ“ä½œæŒ‰é’® 'è¿›å…¥å›æ”¶ç«™'"
      interactions:
        click: "è·³è½¬ /admin/basement"
        keyboard: "Enter é”®æ¿€æ´»ï¼›aria-label='Basement å›æ”¶ç«™å…¥å£'"
      page_admin_basement:
        sections:
          - "FiltersBar (ä¹¦æ¶/å…³é”®è¯/è¿‡æœŸ)"
          - "GroupsGrid (BasementGroupCard åˆ—è¡¨)"
          - "BulkActionsBar (æ‰¹é‡æ¢å¤/æ¸…ç©º)"
        empty_state: "æ’ç”» + æ–‡æ¡ˆ 'æš‚æ— åˆ é™¤å†…å®¹' + è¿”å› libraries æŒ‰é’®"
      dto:
        virtual_library: "VirtualBasementLibraryDto { id:'__BASEMENT__', name:'Basement', locked:true, stats:{deleted_books,deleted_bookshelves} }"
      reference: "ADR-072-basement-ux-and-restore-flows.md"
    backend_invariant: "Unlimited libraries per user (ADR-071)"
    ui_components:
      - "LibraryCard: Display library summary"
      - "LibraryList: Display all libraries"
      - "CreateLibraryModal: Create new library"
      - "LibrarySelector: Choose active library (header optional)"
    pages:
      - "/admin/libraries (first-class page)"
      - "/admin/dashboard (optional library selector)"
    ui_rules:
      RULE_LIB_UI_UNLIMITED:
        description: "UI supports multiple libraries per user"
        implementation: |
          âœ… Always show Create Library action on /admin/libraries
          âœ… List shows all libraries of current user
          âœ… Header may include optional LibrarySelector
          âœ… No single-library constraints or warnings
      RULE_LIB_PAGE_ISOLATION:
        description: "Library page shows Library entity only"
        implementation: |
          âœ… /admin/libraries: list, create, basic manage of libraries
          âœ… Do not mix Bookshelf/Book widgets into Library list page
      RULE_LIB_OVERVIEW_SORT_PIN:
        description: "Libraries é¡µæä¾›æ’åºä¸‹æ‹‰ + ç½®é¡¶åˆ†åŒº + å¿«æ·ç½®é¡¶æ“ä½œ"
        implementation: |
          âœ… LibraryMainWidget.sortSelect (wl_libraries_sort) æä¾› last_activity / views / created / name å››ä¸ªæšä¸¾ï¼Œå¯¹åº”åç«¯ ?sort=ã€‚
          âœ… LibraryList.sections å°†åˆ—è¡¨æ‹†åˆ†ä¸º Pinned â†’ Recently Updated â†’ Archivedï¼ˆä¸‰æ®µï¼‰ï¼›includeArchived=false æ—¶éšè—å½’æ¡£æ®µã€‚
          âœ… ç½®é¡¶æŒ‰é’®è§¦å‘ useQuickUpdateLibrary mutationï¼Œå¹¶è®¡ç®— pinned_orderï¼ˆå–å…¶ä»–ç½®é¡¶åº“æœ€å°åºå· - 1ï¼‰ä¿æŒç½®é¡¶é¡ºåºç¨³å®šã€‚
      RULE_LIB_OVERVIEW_ARCHIVE_TOGGLE:
        description: "å½’æ¡£åº“é»˜è®¤éšè—ï¼Œä»…åœ¨æ˜¾å¼åˆ‡æ¢åæ˜¾ç¤º"
        implementation: |
          âœ… LibraryMainWidget.toggleArchived æŒä¹…åŒ– wl_libraries_include_archived åå¥½ï¼›æŒ‰é’®æ–‡æ¡ˆåœ¨â€œæ˜¾ç¤ºå½’æ¡£/éšè—å½’æ¡£â€é—´åˆ‡æ¢ã€‚
          âœ… LibraryList includeArchived å±æ€§å†³å®šæ˜¯å¦æ¸²æŸ“ Archived æ®µè½ï¼Œå¹¶ç¦ç”¨å½’æ¡£åº“çš„ç½®é¡¶é¡ºåºï¼ˆå‰ç«¯ badge æç¤ºï¼‰ã€‚
          âœ… LibraryCard badge æ ·å¼ä½¿ç”¨æµ…ç°èƒŒæ™¯ + æ·±ç°æ–‡å­—ï¼Œå¼ºè°ƒå½’æ¡£æ€ä¸å¯å‡ºç°åœ¨ Pinned åŒºã€‚
      RULE_LIB_OVERVIEW_VIEW_METRICS:
        description: "åº“å¡ç‰‡å±•ç¤º last_activity ä¸æµè§ˆè®¡æ•°å¹¶ä¸åç«¯å³æ—¶åŒæ­¥"
        implementation: |
          âœ… LibraryCard.metricsRow ä½¿ç”¨ Clock å›¾æ ‡æ˜¾ç¤º formatRelative(last_activity_at)ï¼›MousePointer å›¾æ ‡å±•ç¤º views_countã€‚
          âœ… Footer usageStat æ¸²æŸ“ "{views} views â€¢ last {relative(last_viewed_at)}"ï¼Œç¼ºçœæ—¶å›é€€ 'â€”'ã€‚
          âœ… LibraryList.handleSelect è°ƒç”¨ useRecordLibraryView mutationï¼›æ‰€æœ‰å¿«é€Ÿæ“ä½œæŒ‰é’® stopPropagationï¼Œé¿å…è¯¯è§¦å‘æµè§ˆè®¡æ•°ã€‚
      RULE_LIB_OVERVIEW_COVER_AVATAR:
        description: "åˆ—è¡¨è§†å›¾åç§°å‰å±•ç¤º 32px æ–¹å½¢å°é¢å¤´åƒï¼Œä¿æŒä¸ä¸»å¡ç‰‡ä¸€è‡´çš„è§†è§‰è¯­è¨€"
        implementation: |
          âœ… LibraryList list æ¨¡å¼ gridTemplateColumns å‰ç½® avatar åˆ—ï¼ˆ--library-avatar-size = 32pxï¼‰ï¼Œä¸åç§°æ é—´è· var(--spacing-sm)ã€‚
          âœ… LibraryCoverAvatar ç»„ä»¶å¤ç”¨ coverUrlï¼›æ— å°é¢æ—¶ä½¿ç”¨ coverGradientFromId æ¸å˜èƒŒæ™¯ + é¦–å­—æ¯ï¼Œç¡®ä¿è§†è§‰å ä½ç¨³å®šã€‚
          âœ… <img loading="lazy" + object-fit:coverï¼Œé¿å…ç¼©æ”¾å¤±çœŸï¼›coverUrl å˜æ›´é€šè¿‡ updated_at cache bust ç«‹å³ç”Ÿæ•ˆã€‚
          âœ… å¤§å¡ç‰‡å°é¢ä¿æŒ 16:9 æ¨ªå¹…ï¼ˆcoverUrlï¼‰+ æ¸å˜é®ç½©ï¼ŒCSS ä¸æ”¾å¤§ç¼©å°å›¾åƒï¼›é»˜è®¤æ¢¯åº¦éµå¾ª deterministic paletteã€‚
          âš™ï¸ Phase B é¢„ç•™åç«¯ç¼©ç•¥å›¾ç«¯ç‚¹ï¼ˆ/media/{id}/thumbnail?size=32ï¼‰åï¼Œç»„ä»¶ä»…éœ€åˆ‡æ¢ props.coverUrl æ¥æºã€‚
      RULE_BASEMENT_GRID_001:
        description: "Basement è™šæ‹Ÿåº“ä»¥é¦–ä½å¡ç‰‡å½¢å¼åµŒå…¥ Libraries ç½‘æ ¼ï¼Œä¸è®¡å…¥çœŸå®åº“æ•°é‡"
        implementation: |
          âœ… ä½¿ç”¨ LibraryList.extraFirst åœ¨ vertical/horizontal ä¸¤ç§å¸ƒå±€é¦–ä½æ¸²æŸ“ Basement å¡ç‰‡
          âœ… è§†è§‰æ ·å¼ä¿æŒç‹¬ç‰¹æ¢¯åº¦èƒŒæ™¯ + ğŸ”’ æ ‡è¯†ï¼›hover ä¸ focus ä¸æ™®é€šåº“ä¸€è‡´ï¼ˆå¯é”®ç›˜ Tab èšç„¦ï¼‰
          âœ… ç»Ÿè®¡åªæ˜¾ç¤º deleted_books / deleted_bookshelvesï¼›æ•°å€¼ä¸º 0 æ—¶ä»æ˜¾ç¤ºæ¡ç›®ä¿æŒå¸ƒå±€ç¨³å®š
          âœ… å¡ç‰‡è§¦å‘å¯¼èˆªè‡³ /admin/basementï¼›id é‡‡ç”¨ '__BASEMENT__' ä»…å‰ç«¯ä½¿ç”¨ï¼Œä¸è°ƒç”¨åˆ›å»º/åˆ é™¤ API
          âœ… ä¸å‚ä¸åº“æ€»æ•°ç»Ÿè®¡ä¸åˆ†é¡µï¼›åˆ†é¡µé€»è¾‘ä»…é’ˆå¯¹çœŸå®åº“é›†åˆ
          âœ… ä¸¥æ ¼ä½¿ç”¨ (base_url + api_prefix + path) è·å– Basement statsï¼Œç¦æ­¢çœç•¥ /api/v1ï¼ˆå‚è§ RULE_API_PREFIX_001ï¼‰
          âš ï¸ é”™è¯¯éš”ç¦»ï¼šBasement æ•°æ®åŠ è½½å¤±è´¥æ—¶ä»…æ›¿æ¢è¯¥å¡ç‰‡æ–‡æ¡ˆï¼Œä¸å½±å“åº“åˆ—è¡¨åŠ è½½çŠ¶æ€æˆ–é”™è¯¯åˆ¤æ–­
          â™¿ æ— éšœç¢ï¼šaria-label="Basement å›æ”¶ç«™å…¥å£" + Enter é”®è®¿é—®ï¼›é¢œè‰²å¯¹æ¯”ç¬¦åˆ WCAG AA
          ğŸ”„ æ€§èƒ½ï¼šåˆ—è¡¨åŠ è½½ skeleton æ—¶åŒæ—¶æ˜¾ç¤ºåŠé€æ˜ Basement å¡ç‰‡ï¼Œé¿å…å¸ƒå±€è·³åŠ¨ï¼›æœªæ¥åº“æ•°é‡ >50 æ—¶è€ƒè™‘è™šæ‹Ÿæ»šåŠ¨æ—¶ä»ä¿æŒé¦–ä½å›ºå®š

      RULE_BASEMENT_STATS_DEGRADATION_001:
        description: "Basement ç»Ÿè®¡æ¥å£ä¸´æ—¶é™çº§ç­–ç•¥ï¼ˆé™æ€ 0 å€¼ + ç½‘ç»œè°ƒç”¨ç¦ç”¨ï¼‰"
        rationale: |
          ç»æ’æŸ¥ /books/deleted ç«¯ç‚¹å‰ç¼€é—æ¼ä¸å“åº” 422 å¯¼è‡´å¡ç‰‡åŠ è½½æŒ‚èµ·å¹¶çº§è”è¯¯åˆ¤ Libraries ä¸»åˆ—è¡¨å¤±è´¥ã€‚
          ä¸ºä¿éšœé¦–å±å¯ç”¨ä¸æ„ŸçŸ¥æ€§èƒ½ï¼Œåœ¨åç«¯ç»Ÿè®¡ç«¯ç‚¹ä¸ç¨³å®šæœŸé—´ï¼š
          1. å‰ç«¯ Basement å¡ç‰‡ç›´æ¥æ¸²æŸ“é™æ€ {deleted_books:0, deleted_bookshelves:0}
          2. ç¦ç”¨é¦–æ¬¡æ¸²æŸ“æ—¶çš„åŠ¨æ€ç»Ÿè®¡è¯·æ±‚ï¼ˆqueryFn disabledï¼‰
          3. Axios é€‚é…å±‚ä¿ç•™æ–¹æ³•ä½†è¿”å›é™æ€ zerosï¼ˆä¾¿äºåç»­æ¢å¤ï¼‰
          4. UI ä¸å†æ˜¾ç¤º loading spinnerï¼Œé¿å…é”™è¯¯çš„â€œæŒ‚èµ·â€æ„Ÿå—
          5. é”™è¯¯ä¸å†’æ³¡åˆ° LibraryListï¼ˆéš”ç¦»ç­–ç•¥å»¶ç»­ RULE_BASEMENT_GRID_001ï¼‰
        implementation: |
          âœ… /features/basement/api/index.ts â†’ fetchBasementStats() è¿”å› {deleted_books:0, deleted_bookshelves:0}
          âœ… /features/basement/hooks/useVirtualBasementLibrary.ts â†’ disabled=true + initialData zeros
          âœ… BasementLibraryCard â†’ å»é™¤ loading/error åˆ†æ”¯ï¼Œå§‹ç»ˆå³æ—¶æ¸²æŸ“
          âœ… ESLint no-raw-fetch-host è§„åˆ™é˜²æ­¢å†æ¬¡å‡ºç°ç¼ºå‰ç¼€è°ƒç”¨
          âœ… Axios è¯·æ±‚æ‹¦æˆªå™¨æ£€æµ‹é‡å¤/é—æ¼å‰ç¼€å¹¶è­¦å‘Šå¼€å‘è€…
        reactivation_criteria: |
          æ¢å¤åŠ¨æ€ç»Ÿè®¡éœ€æ»¡è¶³è¿ç»­ 3 å¤©åç«¯ç¨³å®šï¼š
          - æ–°å¢ç»Ÿä¸€ç»Ÿè®¡ç«¯ç‚¹æˆ–å¤ç”¨åˆ†é¡µç«¯ç‚¹è¿”å› {deleted_books, deleted_bookshelves}
          - ä¸å‡ºç° 4xx éªŒè¯é”™è¯¯ï¼ˆ422ï¼‰
          - å“åº”ç»“æ„ä¸ `{items,total}` çº¦å®šä¸å†²çªï¼ˆä¿æŒé€‚é…å±‚ç®€æ´ï¼‰
          - DDD_RULES.yaml æ–°å¢ POLICY-015 æ ‡è®°â€œç»Ÿè®¡ç«¯ç‚¹ç¨³å®šå¯æ¢å¤â€å¹¶åœ¨ HEXAGONAL_RULES.yaml è®°å½•å¥‘çº¦
        related_files:
          - "frontend/src/features/basement/api/index.ts"
          - "frontend/src/features/basement/hooks/useVirtualBasementLibrary.ts"
          - "frontend/src/widgets/BasementLibraryCard/index.tsx"
          - "frontend/src/shared/api/client.ts"
          - "frontend/eslint-rules/no-raw-fetch-host.js"
        status: "active (degraded)"
        next_step: "åç«¯å®ç°ç¨³å®šç»Ÿè®¡ç«¯ç‚¹ /api/v1/basement/stats æˆ–åœ¨ /books/deleted ä¸­æ·»åŠ èšåˆå­—æ®µåå†è¯„ä¼°æ¢å¤"

  bookshelf:
    backend_entity: "Bookshelf (AggregateRoot, child of Library)"
    backend_invariant: "RULE-004: Max 100 bookshelves per library"
    ui_components:
      - "BookshelfList: Paginated list of bookshelves"
      - "BookshelfCard: Summary card (name, book count)"
      - "CreateBookshelfModal: Create new bookshelf"
      - "BookshelfEditor: Edit name, color, etc."
    pages:
      - "/admin/bookshelves (main list)"
      - "/admin/bookshelves/[id] (detail page)"
    ui_rules:
      RULE_004_UI_MAX_100:
        description: "Warn user at 100 bookshelves"
        implementation: |
          âœ… Display count: "95/100 bookshelves"
          âœ… At 100: Disable 'Create' button + show error toast
          âœ… Show progress bar at 80+ bookshelves

      RULE_BS_ILLUSTRATION_BUTTON:
        description: "ä¹¦æ©±é¢„è§ˆé¡µå³ä¸Šè§’æ’å›¾æ‚¬æµ®æŒ‰é’®ï¼ˆé¼ æ ‡ç§»å…¥æ—¶æ˜¾ç¤ºï¼‰"
        scope: "/admin/libraries/[libraryId]/bookshelves/[bookshelfId]"
        interaction: |
          âœ… é»˜è®¤éšè—æŒ‰é’®ï¼›å®¹å™¨ hover æ—¶æ·¡å…¥æ˜¾ç¤º
          âœ… ç‚¹å‡»æ‰“å¼€â€œæ’å›¾é“¾æ¥â€å¯¹è¯æ¡†ï¼Œæ”¯æŒ https:// URL é¢„è§ˆ
          âœ… æˆåŠŸåæ›´æ–°å°é¢å¹¶æŒä¹…åŒ–åˆ° localStorage
        accessibility: |
          âœ… å›¾æ ‡æŒ‰é’®éœ€ aria-label="è®¾ç½®æ’å›¾"ï¼Œå¯é”®ç›˜è§¦è¾¾ï¼ˆEnter/Spaceï¼‰
          âœ… å¯¹è¯æ¡†æ”¯æŒ Esc å…³é—­ä¸ç„¦ç‚¹é™·é˜±
        storage_keys:

      block_editor_plan132_heavy_block_visuals:
        summary: "Plan132ï¼ˆDec 2, 2025ï¼‰è®© Slash èœå•ä¸ hover â€œ+â€ å…¥å£å…±äº«åŒä¸€ QuickInsert UIï¼ŒåŒæ—¶æŠŠ Todo/Callout/Quote/Panel å£³å±‚æ ‡å‡†åŒ–æˆâ€œæ— å™ªç‚¹â€çš„ inline ä½“éªŒã€‚"
        slash_menu_ui:
          - "ParagraphEditor åœ¨ç©ºæ®µè½é¦–å­—ç¬¦æ•è· `/`ï¼Œç«‹å³é˜»æ­¢é»˜è®¤è¾“å…¥å¹¶äº caret rect ä¸‹æ–¹ 6px å¤„å¼¹å‡º 200px å®½çš„ popoverã€‚"
          - "`.quickMenu`ï¼šç™½åº•ã€12px åœ†è§’ã€#e5e7eb è¾¹æ¡†ã€0â€“10pxâ€“30px rgba(15,23,42,0.15) é˜´å½±ï¼Œå†…éƒ¨ 6px paddingï¼Œä»…åœ¨èœå•æ¿€æ´»æœŸé—´ç›‘å¬ document mousedown/keydownã€‚"
          - "èœå•é¡¹ `.quickMenuItem` ä½¿ç”¨ä¸Šä¸‹ä¸¤è¡Œï¼šç¬¬ä¸€è¡Œ 14px ç²—ä½“ labelï¼Œç¬¬äºŒè¡Œ 12px hintï¼ˆä¸­æ–‡ç¤ºä¾‹ï¼š[ ] ä»»åŠ¡æ¸…å•/é‡ç‚¹æç¤º/å¼•ç”¨æ®µè½/çª—æ ¼å›¾ï¼‰ï¼Œä¿æŒé”®ç›˜ â†‘â†“/Enter/Esc å¯¼èˆªã€‚"
        hover_plus_button:
          - "`.blockAddButton` åœé åœ¨å—å·¦è· 0 çš„ä½ç½®ï¼Œhover 150ms åæ‰æ·¡å…¥ï¼Œé»˜è®¤é€æ˜ï¼ˆopacity 0.5ï¼‰ã€#9CA3AF æ–‡æ¡ˆã€ç»†æè¾¹ï¼Œé¼ æ ‡ç§»å‡ºæˆ–è¡Œå¤±ç„¦å³ `display:none`ï¼Œé¿å…å¸¸é©»å¹²æ‰°æ­£æ–‡ã€‚"
          - "ç‚¹å‡» `+` ä¸ Slash èœå•å…±ç”¨ QUICK_INSERT_ACTIONS æ•°æ®æºï¼›æŒ‰é’®å¿…é¡» `event.stopPropagation()`ï¼Œé˜²æ­¢è§¦å‘ block focus åˆ‡æ¢ã€‚"
        transform_behavior_visuals:
          - "å½“æ®µè½ä¸ºç©ºä¸”é€šè¿‡ Slash é€‰æ‹© Todo/Callout/Quote æ—¶ï¼Œç›´æ¥æ›¿æ¢å£³å±‚ï¼šcheckbox/å½©æ¡/ç«–çº¿ç«‹å³å ä½ï¼Œä¸åœ¨ DOM ä¸­æ’å…¥é¢å¤–ç©ºè¡Œã€‚"
          - "æ®µè½å·²æœ‰æ–‡æœ¬æˆ–é€šè¿‡ hover â€œ+â€ æ’å…¥ï¼Œåˆ™åœ¨ç°æœ‰å—ä¸‹æ–¹æ·¡å…¥æ–°å—ï¼Œä¿ç•™åŸæ®µè½ï¼›è§†è§‰ä¸Šåˆ©ç”¨ BlockList gap=4px ç¡®ä¿ spacing ç¨³å®šã€‚"
          - "Panel å±äºç‹¬ç«‹å—ï¼Œæ°¸è¿œä»¥å¡ç‰‡å½¢å¼è½åˆ°ä¸‹ä¸€è¡Œï¼Œä¸ä¸å½“å‰æ®µè½å…±äº«å£³å±‚ï¼Œé¿å…ç”¨æˆ·è¯¯ä»¥ä¸ºâ€œæ®µè½é‡ŒåµŒå¥—å¡ç‰‡â€ã€‚"
        block_shells:
          todo: "`.todoList` 12px padding + 8px é—´éš” + checkbox + inline æ–‡æœ¬ï¼›promoted çŠ¶æ€ä»¥ `todoPromoted` èƒ¶å›Šå¼ºè°ƒï¼Œæ— éœ€é¢å¤–å›¾æ ‡ã€‚"
          callout: "`.callout` 10px åœ†è§’ + 1px border + variant èƒŒæ™¯ï¼ˆinfo è“ / warning æ / danger ç²‰ / success ç»¿ï¼‰ï¼›æ ‡é¢˜è¡Œ 12px label + iconï¼Œæ­£æ–‡æ²¿ç”¨ InlineEditorã€‚"
          quote: "`.quoteBlock` å·¦ä¾§ 4px ç°ç«–çº¿ + 12px å†…è¾¹è·ï¼Œå­—ä½“é¢œè‰² #4B5563ï¼Œsource è¾“å…¥å¯¹é½ä¸‹æ–¹ã€‚"
          panel: "`.panelBlock` ç½‘æ ¼å¸ƒå±€ï¼ˆé»˜è®¤ 120px å›¾ / two-column æ—¶ 160pxï¼‰ï¼Œç¼ºå›¾æ—¶æ˜¾ç¤ºâ€œæ·»åŠ å›¾ç‰‡â€ç°åº•å ä½ï¼›`.panelEditor` å†…å«å¸ƒå±€ä¸‹æ‹‰ã€URL/æ ‡é¢˜/æ­£æ–‡è¾“å…¥ä¸ `å®Œæˆ` secondary buttonã€‚"
        quick_menu_palette:
          - "Hover æˆ–é”®ç›˜èšç„¦ `.quickMenuItem` æ—¶èƒŒæ™¯ #f3f4f6ï¼Œä¿æŒ 4px åœ†è§’å†…æ”¶ï¼›active é¡¹è®¾ç½® data-active å¹¶åŒæ­¥åŒè‰²èƒŒæ™¯æ–¹ä¾¿è¯»å±æç¤ºã€‚"
          - "Hint é¢œè‰² #6B7280ï¼Œç¡®ä¿å¯¹æ¯”åº¦ â‰¥4.5ï¼›label å‰ç¦æ­¢æ·»åŠ  iconï¼Œä¿æŒèœå•å¹²å‡€ã€‚"
        accessibility:
          - "Slash èœå• `role='menu'`ï¼Œæ¯ä¸ªæŒ‰é’® `role='menuitem'` + `aria-label='Todoï½œ[ ] ä»»åŠ¡æ¸…å•'`ã€‚"
          - "Hover â€œ+â€ æŒ‰é’® `aria-haspopup='menu'` ä¸” `aria-expanded` ä¸èœå•çŠ¶æ€åŒæ­¥ï¼›éšè—æ—¶é€šè¿‡ `display:none` å½»åº•ç§»å‡º tab åºåˆ—ã€‚"
          - "PanelDisplay ä½¿ç”¨ `<button type="button">` åŒ…è£¹æ•´ä¸ªçª—æ ¼ï¼›éœ€æä¾› `aria-label='ç¼–è¾‘çª—æ ¼å†…å®¹'` æˆ–åŒç­‰æè¿°ï¼Œç‚¹å‡»åå°†ç„¦ç‚¹é€å…¥ PanelEditor çš„é¦–ä¸ªè¾“å…¥ã€‚"
        testing:
          - "Storybookï¼šSlash èœå•/hover â€œ+â€/Panel å¡ç‰‡/Panel ç¼–è¾‘å™¨ 4 ä¸ªåœºæ™¯ + æš—è‰²æ¨¡å¼ã€‚"
          - "Playwrightï¼šé”®ç›˜ `/` â†’ Todo â†’ å‹¾é€‰ + Undoï¼Œå†æ¬¡ `/` â†’ Panel â†’ å®Œæˆç¼–è¾‘ï¼›ç¡®ä¿èœå•å…³é—­åç„¦ç‚¹å›åˆ°æœ€æ–°å—ã€‚"
        status: "Adopted Dec 2, 2025"

      block_editor_plan134_undo_visuals:
        summary: "Plan134ï¼ˆDec 2, 2025ï¼‰ç¡®ç«‹ Block ç¼–è¾‘å™¨çš„æ’¤é”€/é‡åšäº¤äº’ï¼šä»¥é”®ç›˜å¿«æ·é”® + å¿«ç…§æ¢å¤ä¸ºä¸»ï¼Œä¸æ–°å¢å¯è§†åŒ–å·¥å…·æ¡ã€‚"
        keyboard_shortcuts:
          - "Ctrl/Cmd+Z â†’ Undoï¼›Ctrl/Cmd+Shift+Z æˆ– Ctrl/Cmd+Y â†’ Redoã€‚æ‰€æœ‰ç»„åˆåœ¨ `keydown` é˜¶æ®µ `preventDefault()`ï¼Œé¿å…æµè§ˆå™¨å¯¹ contentEditable çš„åŸç”Ÿæ’¤é”€å¯¼è‡´ DOM å¤±æ§ã€‚"
          - "ä¼ æ’­é¡ºåºï¼šBlockEditorRoot æ•è·å¿«æ·é”® â†’ è°ƒç”¨ UndoManager.undo()/redo() â†’ è‹¥è¿”å› snapshotï¼Œåˆ™åˆ·æ–° blocks state å¹¶åœ¨ä¸‹ä¸€å¸§é‡å»º selectionã€‚"
        snapshot_feedback:
          - "æ’¤é”€/é‡åšå®Œæˆåï¼Œ`SaveStatusBadge` ä»¥ `savingâ†’saved` çš„å·²æœ‰çŠ¶æ€åé¦ˆå†™å…¥ï¼›æ— éœ€é¢å¤– Toast é¿å…å™ªéŸ³ã€‚"
          - "è‹¥ Undo æ ˆä¸ºç©ºï¼Œä¿æŒé™é»˜ï¼Œä¸å¼¹å‡ºâ€œæ— æ³•æ’¤é”€â€æç¤ºï¼›å¯é€‰åœ¨è°ƒè¯• build ä¸­è®°å½• console.info ä¾› QA è§‚å¯Ÿã€‚"
        selection_restore:
          - "EditorSnapshot.selection åŒ…å« `{blockId, offset}`ï¼›æ¢å¤æ—¶å…ˆæ»šåŠ¨åˆ° blockï¼Œå†å°† caret æ”¾å› offsetã€‚è‹¥ block ä¸å­˜åœ¨ï¼ˆå·²åˆ é™¤ï¼‰ï¼Œå°† focus å›ç¬¬ä¸€å—å¹¶é«˜äº®ç©ºçŠ¶æ€ã€‚"
          - "Panel/Todo ç­‰å¤åˆå—ä»éµå¾ªâ€œæ‰¾æ¢è¡Œå‰ç¬¬ä¸€ä¸ªå¯ç¼–è¾‘è¾“å…¥â€è§„åˆ™ï¼Œä¿æŒé”®ç›˜ä½“éªŒä¸€è‡´ã€‚"
        non_goals:
          - "Undo æ ˆä¸è·¨ Book/é¡µé¢ï¼›åˆ‡æ¢ä¹¦ç±æˆ– refetch æˆåŠŸåå¿…é¡» resetï¼Œä»¥å…æŠŠæ—§å¿«ç…§å¥—ç”¨åœ¨æ–°æ•°æ®ã€‚"
          - "Undo ä¸å›æ»šæœåŠ¡å™¨ï¼›å½“æ’¤é”€ç»“æœä¸æœåŠ¡å™¨æœ€æ–°çŠ¶æ€å†²çªæ—¶ï¼Œä»¥ UI çŠ¶æ€ä¸ºå‡†å¹¶è§¦å‘å¸¸è§„ä¿å­˜æµç¨‹ã€‚"
        testing:
          - "Unitï¼šUndoManager push/undo/redo/reset/æ ˆæº¢å‡ºã€‚"
          - "Playwrightï¼šè¿ç»­è¾“å…¥æ–‡æœ¬ â†’ æ’¤é”€ä¸€æ¬¡æ¢å¤æ•´æ‰¹å­—ç¬¦ï¼›æ’å…¥ Panel å Ctrl+Z åˆ é™¤å¡ç‰‡ â†’ Ctrl+Shift+Z æ¢å¤ã€‚"
          - "Keyboard a11yï¼šmacOS Cmdã€Windows Ctrl å‡éœ€è¦†ç›–ï¼›ç¡®ä¿ç»„åˆé”®ä¸ä¼šä¸ç³»ç»Ÿè¾“å…¥æ³•äº§ç”Ÿå†²çªï¼ˆIME æ¨¡å¼ä¸‹è·³è¿‡ï¼‰ã€‚"
        status: "Adopted Dec 2, 2025"

          - "bookshelf:cover:{bookshelfId}"
        visual: |
          âœ… é¡¶éƒ¨ 220px å°é¢åŒºåŸŸï¼Œå›¾ç‰‡ä¸Šæ–¹å³ä¸Šè§’æ‚¬æµ®å›¾æ ‡æŒ‰é’®
          âœ… æ ‡é¢˜/æè¿°ä»¥ç™½è‰²æ–‡å­—å åŠ åœ¨å·¦ä¸‹ï¼Œå¸¦é˜´å½±æå‡å¯è¯»æ€§
          âœ… æ— å°é¢æ—¶æ˜¾ç¤ºå ä½å›¾ï¼ˆUnsplash ä¸»é¢˜èƒŒæ™¯ï¼‰

      RULE_BS_COVER_STRATEGY:
        description: "å°é¢/æ’å›¾ä¸¤é˜¶æ®µç­–ç•¥ï¼ˆPhase A â†’ Phase Bï¼‰"
        phase_a_frontend_only: |
          âœ… ä»…å‰ç«¯ï¼šé€šè¿‡ URL è®¾ç½®å°é¢å¹¶å­˜å…¥ localStorage
          âœ… ä¼˜å…ˆçº§ï¼šæ˜¾å¼å°é¢ï¼ˆlocalStorageï¼‰ > å ä½å›¾
          âœ… ä¸æ¶‰åŠåç«¯ä¿®æ”¹ï¼Œé›¶è€¦åˆã€ç«‹å³å¯ç”¨
        phase_b_media_association: |
          âœ… åç«¯åª’èµ„ï¼šä½¿ç”¨ MediaAssociation(entity_type=bookshelf, entity_id)
          âœ… å…³è”ä¸€å¼ ä¸»å›¾ä½œä¸ºå°é¢ï¼›APIï¼š
             - GET /api/v1/media/{entity_type}/{entity_id}
             - POST /api/v1/media/{id}/associate?entity_type=bookshelf&entity_id={uuid}
             - DELETE /api/v1/media/{id}/disassociate?entity_type=bookshelf&entity_id={uuid}
          âœ… UI ä¼˜å…ˆçº§ï¼šæ˜¾å¼å°é¢ï¼ˆç”¨æˆ·è®¾ç½®ï¼‰ > å…³è”åª’èµ„ä¸­çš„ä¸»å›¾ > å ä½å›¾
        notes: |
          âš ï¸ Bookshelf èšåˆæ ¹ä¸åŒ…å« cover å­—æ®µï¼ˆä¸ DDD/Hexagonal ä¸€è‡´ï¼‰ï¼›å°é¢ç”± Media æ¨¡å—æ‰˜ç®¡ã€‚
          ğŸ“„ è¯¦è§ ADR-070-bookshelf-cover-and-default-library.md

      RULE_BS_POSTER_SEGMENT:
        description: "Library è¯¦æƒ…é¡µä¸­çš„ Bookshelf åˆ—è¡¨ç»Ÿä¸€é‡‡ç”¨ Poster + pinned åˆ†æ®µç­–ç•¥ã€‚"
        implementation: |
          âœ… Grid è§†å›¾ï¼š220px Poster å¡ç‰‡ï¼Œæ ‡é¢˜å åŠ åœ¨å°é¢ä¸Šï¼Œå³ä¸Šè§’å±•ç¤º PINNED / FAVORITE å¾½ç« ã€‚
          âœ… List è§†å›¾ï¼š68px ç¼©ç•¥å›¾ + æ–‡æœ¬ä¿¡æ¯è¡Œï¼Œä¿æŒåŒä¸€è‰²æ¿ä¸ hover åé¦ˆã€‚
          âœ… Hover åœºæ™¯ï¼šæ˜¾ç¤ºæ’å›¾æŒ‰é’®ã€æŸ¥çœ‹æŒ‰é’®ï¼Œé”®ç›˜ç„¦ç‚¹ä¸ hover é€æ˜åº¦ä¸€è‡´ã€‚
          âœ… Count Guardï¼šé¡¶éƒ¨æ˜¾ç¤º `x/100 ä¹¦æ©±` + 80% èµ·çš„è¿›åº¦æ¡é¢œè‰²æ¢¯åº¦ã€‚
        pinned_behavior: |
          âœ… Pinned æ®µè½å¸¦åˆ†ç»„æ ‡é¢˜ + badgeï¼Œå›ºå®šåœ¨åˆ—è¡¨é¡¶éƒ¨ã€‚
          âœ… å…¶ä»–ä¹¦æ©±æŒ‰æ’åºé€‰é¡¹å±•ç¤ºï¼ŒPinned æ ‡è®°ä¸ä¼šåœ¨ç¬¬äºŒæ®µé‡å¤ã€‚
          âœ… Pinned é€»è¾‘åœ¨ grid/list ä¸¤ç§è§†å›¾ä¿æŒä¸€è‡´ï¼Œç©ºæ®µéšè—æ ‡é¢˜ã€‚
        references:
          - "frontend/src/widgets/bookshelf/BookshelfMainWidget.tsx"
          - "frontend/src/features/bookshelf/ui/BookshelfCard.tsx"

  book:
    backend_entity: "Book (Independent AggregateRoot, FK to Bookshelf)"
    ui_components:
      - "BookList: List books in a bookshelf"
      - "BookCard: Summary card (title, author, cover)"
      - "BookEditor: Edit book metadata"
      - "BookBasementView: Soft-deleted books recovery"
    pages:
      - "/admin/bookshelves/[id]/books (list)"
      - "/admin/books/[id] (detail)"
      - "/admin/books/basement (trash)"

  block:
    backend_entity: "Block (Lowest unit, FK to Book)"
    ui_components:
      - "BlockList: Ordered list of blocks (with Fractional Index)"
      - "BlockEditor: Edit block content"
      - "BlockReorder: Drag/drop with Fractional Index sorting"
      - "BlockPaperballs: Recovery for soft-deleted blocks"
    pages:
      - "/admin/books/[bookId] (main block editor)"
      - "/admin/books/[bookId]/paperballs (trash)"
    ui_rules:
      RULE_BLOCK_NO_STANDALONE_PAGE:
        description: "Block is not a standalone page; edit within Book page"
        implementation: |
          âœ… No /admin/blocks/[blockId] page
          âœ… All block editing happens in /admin/books/[bookId]
      RULE_015_UI_ORDERING:
        description: "Use Fractional Index for infinite drag/drop"
        implementation: |
          âœ… Blocks use Decimal sort keys (NOT integers)
          âœ… Drag/drop: calculate new Decimal between siblings
          âœ… No reordering of entire list on each move
          âœ… Support unlimited depth/precision
      RULE_BLOCK_PLAN80_INLINE_PAPER:
        description: "Plan80 HiddenBlocksï¼šBlockList å‘ˆç°ä¸ºä¸€å¼ é•¿çº¸çš„æ®µè½é˜Ÿåˆ—ï¼Œä¸å†æ˜¯å¡ç‰‡æ ˆã€‚"
        plan_reference: "assets/docs/QuickLog/D39-45- WordloomDev/Plan_80_HiddenBlocks.md"
        implementation: |
          âœ… BlockItem èƒŒæ™¯é€æ˜ï¼Œä»…ä¿ç•™ 8-12px çš„ä¸Šä¸‹ç•™ç™½ï¼›æ®µè½ä¹‹é—´ç”¨ 1px hairline åŒºéš”ã€‚
          âœ… textarea èƒŒæ™¯/é˜´å½±/åœ†è§’å…¨éƒ¨ç§»é™¤ï¼Œé»˜è®¤æ— è¾¹æ¡†ï¼Œä»…åœ¨ focus æ—¶æ˜¾ç¤º 1px ä¸ç»¸è“ä¸‹åˆ’çº¿ã€‚
          âœ… placeholder ç²¾ç®€ä¸ºâ€œå†™ç‚¹ä»€ä¹ˆ...â€ï¼Œé¢œè‰² 60% é€æ˜åº¦ï¼Œè¾“å…¥åå®Œå…¨æ¶ˆå¤±ã€‚
          âœ… Clock/Delete å›¾æ ‡æ”¹ä¸ºå³ä¸Šè§’æ‚¬æµ®å·¥å…·æ¡ï¼Œä»…åœ¨ block hover æˆ– focus æ—¶æ·¡å…¥ï¼Œé¿å…ä¸€è¡ŒæŒ‚æ»¡æŒ‰é’®ã€‚
          âœ… â€œ+ æ·»åŠ ä¸€æ®µæ–‡å­—â€ é‡‡ç”¨è™šçº¿èƒ¶å›ŠæŒ‰é’®ï¼Œæ”¾åœ¨åˆ—è¡¨æœ«å°¾ï¼ˆç©ºæ€åˆ™ç½®äºæç¤ºä¸‹æ–¹ï¼‰ï¼Œä¿æŒ Notion å¼è¿½åŠ ä½“éªŒã€‚
        keyboard_mouse:
          - "ä»æ”¯æŒ Enter=ä¿å­˜ã€Ctrl/Cmd+S=ä¿å­˜ã€Esc=å›é€€ã€‚"
          - "å·¥å…·æ¡æŒ‰é’®éœ€é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è¯¯è§¦ onBlockClickã€‚"
        accessibility: |
          âœ… æ‚¬æµ®å·¥å…·æ¡ä»¥ aria-label æç¤ºâ€œæŸ¥çœ‹æ—¶é—´ä¿¡æ¯/åˆ é™¤æ­¤å—â€ã€‚
          âœ… ä¸‹åˆ’çº¿ç„¦ç‚¹æ›¿ä»£æ•´æ¡†é«˜äº®ï¼Œç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦ > 3:1ã€‚
      RULE_BLOCK_PLAN82_PARAGRAPH_EDITING:
        description: "Plan82 HiddenBlocks++ï¼šBlock é‡‡ç”¨â€œé˜…è¯»æ€ + ç¼–è¾‘æ€â€åŒæ¨¡å¼ï¼Œåªä¿ç•™ä¸€ä¸ª textareaã€‚"
        plan_reference: "assets/docs/QuickLog/D39-45- WordloomDev/Plan_82_HiddenBlocks++.md"
        implementation: |
          âœ… BlockList ç»´æŠ¤ editingBlockIdï¼Œä»»ä¸€æ—¶åˆ»ä»…å…è®¸ä¸€ä¸ªå—å¤„äº textarea ç¼–è¾‘æ€ï¼Œå…¶ä»–å—æ¸²æŸ“æ®µè½å¼ divã€‚
          âœ… é˜…è¯»æ€ä»¥ <div role="button"> å‘ˆç°å¤šæ®µæ–‡æœ¬ï¼ˆwhite-space: pre-wrapï¼‰ï¼Œhover/ç„¦ç‚¹æ—¶æ‰æ˜¾ç¤ºæ·¡èƒŒæ™¯ä¸ä¸‹åˆ’çº¿ã€‚
          âœ… ç‚¹å‡»/Enter/Space è¿›å…¥ç¼–è¾‘æ€ â†’ textarea è‡ªåŠ¨ focusï¼›Ctrl/Cmd+S ä¿å­˜ï¼Œblur æ—¶è‡ªåŠ¨ä¿å­˜å¹¶å›åˆ°é˜…è¯»æ€ã€‚
          âœ… SaveAll handle ä¾æ—§éå†æ³¨å†Œçš„ save å‡½æ•°ï¼›åˆ‡æ¢ç¼–è¾‘å—ä¼šè§¦å‘ä¸Šä¸€å— blurâ†’saveï¼Œç¡®ä¿æ²¡æœ‰éšè—çš„è„æ•°æ®ã€‚
        keyboard_mouse:
          - "é˜…è¯»æ€ï¼šEnter/Space è¿›å…¥ç¼–è¾‘ï¼›Esc åœ¨ç¼–è¾‘æ€æ’¤é”€æ›´æ”¹å›é˜…è¯»ã€‚"
          - "ç¼–è¾‘æ€ï¼šCtrl/Cmd+S ä¿å­˜ä½†ä¿æŒç¼–è¾‘ï¼›ç‚¹å‡»å…¶ä»–å—è§¦å‘ blur ä¿å­˜å¹¶èšç„¦æ–°å—ã€‚"
        accessibility: |
          âœ… é˜…è¯»æ€å…ƒç´ å¸¦ role="button" + tabIndex=0ï¼Œaria è¡Œä¸ºä¸ textarea å¯¹é½ã€‚
          âœ… æ‚¬æµ®å·¥å…·æ¡ focus-within æ—¶ä¿æŒå¯è§ï¼Œç¡®ä¿é”®ç›˜ç”¨æˆ·å¯ä½¿ç”¨åˆ é™¤/æ—¶é—´æˆ³æŒ‰é’®ã€‚

  tag:
    backend_entity: "Tag (Global, cross-entity)"
    ui_components:
      - "TagSelector: Multi-select tag picker"
      - "TagManager: Create/edit/delete tags"
      - "TagHierarchy: Display tag tree"
    pages:
      - "/admin/tags (management)"
    ui_rules:
      RULE_TAG_STATE_SHAPE:
        description: "å‰ç«¯ä»…ç»´æŠ¤ Tag DTO åˆ—è¡¨ä¸å·²é€‰ tagIds"
        implementation: |
          âœ… allTags: TagDto[] ç”± GET /api/v1/tags?limit=... ç¼“å­˜
          âœ… selectedTagIds: UUID[] å­˜å‚¨åœ¨ form/stateï¼Œæäº¤ PUT /.../tags æ—¶ç›´æ¥ä¼ é€’
          ğŸš« ç¦æ­¢åœ¨ Bookshelf/Book payload ä¸­æºå¸¦å®Œæ•´ Tag å¯¹è±¡æˆ– name-only å­—ç¬¦ä¸²
      RULE_TAG_CREATE_ATTACH_FLOW:
        description: "æ–°å»ºæ ‡ç­¾ä¸¤æ­¥èµ°"
        implementation: |
          1. ç”¨æˆ·è¾“å…¥ä¸å­˜åœ¨çš„åç§° â†’ è§¦å‘ POST /api/v1/tags åˆ›å»ºï¼Œè¿”å›æ–° id
          2. å°†æ–° id æ¨å…¥ selectedTagIdsï¼Œå†è°ƒç”¨ PUT /api/v1/{aggregate}/tags æ›´æ–°å…¨é›†åˆ
          â™» æ‰€æœ‰æ›´æ–°ä½¿ç”¨å¹‚ç­‰æ›¿æ¢ï¼ˆæäº¤å®Œæ•´ tagIds åˆ—è¡¨ï¼‰ï¼Œé¿å…å¢é‡æ‹¼æ¥
      RULE_TAG_CACHE_INVALIDATION:
        description: "å¤šé¡µé¢ Tag ç¼“å­˜åŒæ­¥"
        implementation: |
          âœ… å®Œæˆåˆ›å»º/é‡å‘½å/åˆ é™¤åè°ƒç”¨ queryClient.invalidateQueries(['tags'])
          âœ… ä¾èµ– TagSelector çš„é¡µé¢ç›‘å¬ onSuccess åˆ·æ–°æœ¬åœ° options
          âš  å¿½ç•¥åˆ·æ–°ä¼šå¯¼è‡´æ—§æ ‡ç­¾æäº¤è§¦å‘ 404/409
      RULE_TAG_ERROR_SURFACE:
        description: "ä¿æŒ FastAPI é»˜è®¤ 422 detail å±•ç¤º"
        implementation: |
          âœ… æ•è· error.response?.data?.detail â†’ toast/modal åŸæ ·æ˜¾ç¤º loc/msg
          âœ… è®°å½• detail åˆ° console.warn æ–¹ä¾¿è°ƒè¯•
          âœ… è‹¥ msg åŒ…å« "not a valid UUID"ï¼ŒæŒ‡å¼•ç”¨æˆ·åˆ·æ–° Tag åˆ—è¡¨
          âœ… è‹¥è¿”å› 409 TagAlreadyExistsError â†’ é«˜äº®è¾“å…¥æ¡†æç¤ºâ€œåç§°å·²å­˜åœ¨â€

  media:
    backend_entity: "Media (Global asset store)"
    ui_components:
      - "MediaUploader: Upload image/video"
      - "MediaGallery: Browse uploaded media"
      - "MediaTrash: Recover deleted media (30-day recovery)"
    pages:
      - "/admin/media (gallery)"
      - "/admin/media/trash (recovery)"

# ============================================
# Part 14: Cross-Reference Documentation
# ============================================

documentation:
  frontend_files:
    visual_rules: "frontend/docs/VISUAL_RULES.yaml (this file)"
    adr_theme: "frontend/docs/ADR-FR-001-theme-strategy.md"
    adr_architecture: "frontend/docs/ADR-FR-002-architecture-decisions.md (planned)"

  backend_files:
    ddd_rules: "backend/docs/DDD_RULES.yaml"
    hexagonal_rules: "backend/docs/HEXAGONAL_RULES.yaml"
    adr_index: "backend/docs/ADR/ (42+ ADR files)"

  sync_mechanism:
    tool: "frontend/scripts/sync-rules.py (planned)"
    schedule: "Manual (can be automated via CI/CD)"
    purpose: "Auto-sync frontend rules with backend changes"

# ============================================
# Version History
# ============================================

version_history:
  "1.0":
    date: "2025-11-15"
    changes:
      - "Initial VISUAL_RULES.yaml created"
      - "3 themes defined: Light, Dark, Loom (ç°è“)"
      - "Complete component, state, error handling rules"
      - "Domain-to-UI mapping aligned with DDD_RULES"
      - "Sync with DDD_RULES.yaml + HEXAGONAL_RULES.yaml"
  future_versions:
    "1.1":
      planned_date: "2025-11-22 (Week 2)"
      planned_changes:
        - "Add Week 1 implementation feedback"
        - "Expand testing rules with real examples"
        - "Add performance benchmarks"
        - "Integrate initial BlockEditor (Phase 0: text + heading only)"
    "2.0":
      planned_date: "2025-12-01 (Phase B)"
      planned_changes:
        - "Backend theme persistence integration"
        - "Advanced A11y rules"
        - "Internationalization (i18n) strategy"
        - "Rich Block types expansion + Media linking"

# ============================================
# Block Editor Integration (NEW - Nov 21, 2025)
# ============================================

block_editor:
  adr_reference: "ADR-080-block-editor-integration-rich-block-types-media-plugin-architecture.md"
  adr_inline_editor_reference: "ADR-081-block-inline-editor-default-removal-overlay-and-component-refactor.md"
  phase_notes:
    phase_2: "å®ç°å†…è”ç¼–è¾‘ï¼ˆdebounce 800ms è‡ªåŠ¨ä¿å­˜ + Ctrl+Sï¼‰ã€æœ€å°æ ¼å¼å·¥å…·æ ã€è½¯åˆ é™¤ & æ¢å¤è§†å›¾ã€æ‹–æ‹½/å¿«æ·é”®é‡æ’"
    phase_3: "è·³è¿‡ï¼šåŸè®¡åˆ’ä¹è§‚å¹¶å‘ã€æ‰¹é‡æ€§èƒ½ä¼˜åŒ–ã€‚æ¨è¿Ÿè‡³åç»­æ€§èƒ½å†²åˆºã€‚"
    phase_4: "å®ç°å…¨å±€æœç´¢å…¥å£ä¸ç»“æœé¡µ /admin/searchï¼›å—å†…å®¹é¢„è§ˆç®€æ˜“ Markdown æˆªæ–­æ¸²æŸ“ï¼Œä¸åšæœåŠ¡ç«¯ html_cache"
  skipped_phases: [3]
  phases:
    phase_0_minimal:
      timeframe: "Nov 21 - Nov 23"
      scope: "åªè¯» + åŸºç¡€æ–‡æœ¬/æ ‡é¢˜å—æ¸²æŸ“ï¼Œåˆ†é¡µæ¶ˆè´¹ V2 å¥‘çº¦"
      goals:
        - "ç¨³å®šè·å– Block åˆ—è¡¨ (GET /blocks?book_id={})"
        - "å±•ç¤ºé¡ºåº (Fractional Index) ä¸åšé‡æ’ UI"
        - "æ”¯æŒæœ¬åœ°å†…è”åˆ›å»ºç®€å• TEXT/HEADING å— (POST /blocks)"
        - "ä½¿ç”¨ä¹è§‚æ›´æ–°æ’å…¥æ–°å—ï¼Œå ä½ skeleton"
    phase_1_editing:
      timeframe: "Nov 23 - Nov 27"
      scope: "å†…å®¹ç¼–è¾‘ï¼ˆæ–‡æœ¬/æ ‡é¢˜ï¼‰+ Debounce ä¿å­˜ + é”™è¯¯å›é€€"
      goals:
        - "BlockEditor ç»„ä»¶ï¼šå—æ§å†…å®¹çŠ¶æ€ + useUpdateBlockMutation"
        - "300ms debounce + æœ€é•¿ 2s å®½é™æœŸæ‰¹é‡æäº¤"
        - "æ˜¾ç¤º 'å·²ä¿å­˜/æ­£åœ¨ä¿å­˜/ä¿å­˜å¤±è´¥' çŠ¶æ€å¾½ç« "
        - "æ’¤é”€/é‡åš (å±€éƒ¨å†…å­˜ï¼Œä¸ä¸åç«¯äº‹ä»¶è€¦åˆ)"
    phase_2_reorder:
      timeframe: "Nov 27 - Nov 30"
      scope: "æ‹–æ‹½é‡æ’ï¼ˆFractional Indexï¼‰+ æ‰¹é‡å›å†™"
      goals:
        - "ä½¿ç”¨ IntersectionObserver é™åˆ¶å¤§åˆ—è¡¨é‡æ’æ¸²æŸ“"
        - "æ‹–æ‹½ç»“æŸè®¡ç®— new_key_between(prev,next) ç”Ÿæˆ order"
        - "æ‰¹é‡ç«¯ç‚¹ POST /blocks/reorder æäº¤èšåˆä¿®æ”¹"
    phase_3_soft_delete_restore:
      timeframe: "Nov 30 - Dec 02"
      scope: "Paperballs è§†å›¾ + æ¢å¤ 3 çº§å›é€€ç­–ç•¥ UI"
      goals:
        - "ç‹¬ç«‹ Tab /admin/books/[id]/paperballs"
        - "å±•ç¤º deleted_prev_id/next_id/section_path å…ƒæ•°æ®"
        - "è°ƒç”¨ POST /blocks/{id}/restore æ ¹æ®åç«¯è¿”å›æ›´æ–°åˆ—è¡¨"
    phase_4_media_linking:
      timeframe: "Dec 02 - Dec 05"
      scope: "IMAGE / VIDEO Block ä¸ Media æ¨¡å—å…³è”ï¼ˆä¸æ”¾äºŒè¿›åˆ¶ï¼‰"
      goals:
        - "BlockContent ä¸­ä»…å­˜ media_id + alt/æ ‡é¢˜å…ƒæ•°æ®"
        - "ä½¿ç”¨ MediaGallery é€‰æ‹©å¹¶å…³è” (POST /media/{id}/associate?entity_type=block)"
        - "æ’¤é”€å…³è”ä½¿ç”¨ DELETE /media/{id}/disassociate"
    phase_5_rich_types_plugin:
      timeframe: "Dec 05 - Dec 10"
      scope: "å¯Œç±»å‹æ‰©å±•ï¼šä»»åŠ¡ã€å¼•ç”¨ã€å›¾ç‰‡ä¸Šä¼ ã€è¡¨æ ¼ã€ä»£ç ã€åˆ—è¡¨ï¼›æ’ä»¶åŒ–æ¶æ„"
      goals:
        - "Plugin Registry (blockPlugins) é€šè¿‡æ ‡è¯†ç¬¦æ³¨å†Œæ¸²æŸ“/ç¼–è¾‘å™¨ç»„ä»¶"
        - "ä¿æŒ Hexagonal æ’æ‹”ï¼šå‰ç«¯æ¸²æŸ“ä¸è¦æ±‚åç«¯å˜æ›´èšåˆç»“æ„"
        - "æ–°å¢ç±»å‹éœ€è¦ï¼šEnum + Adapter è½¬æ¢ + å‰ç«¯æ’ä»¶ + å¯é€‰äº‹ä»¶"
  ui_components:
    - "BlockList"
    - "BlockItem (æ ¹æ®ç±»å‹åˆ†æ´¾å…·ä½“ç¼–è¾‘ç»„ä»¶)"
    - "BlockToolbar (ä¸Šä¸‹æ–‡å·¥å…·æ¡ + ç±»å‹åˆ‡æ¢)"
    - "InlineCreateBar (åœ¨æœ€åä¸€ä¸ªå—åæ’å…¥å ä½è¾“å…¥)"
    - "ReorderDragHandle"
    - "PaperballsList"
  key_rules:
    RULE_BLOCK_EDITOR_BOUNDARY:
      description: "ç¼–è¾‘å™¨çº¯å‰ç«¯å±‚ï¼Œä¸å¼•å…¥ Slate/ProseMirror å®ç°ç»†èŠ‚è¿› Domainï¼›åªé€šè¿‡ API DTO ä¼ è¾“ content/order/typeã€‚"
      benefits:
        - "DDD å±‚ä¸è¢« UI å¯Œæ–‡æœ¬ç»†èŠ‚æ±¡æŸ“"
        - "åç«¯å¯æ›¿æ¢æ¸²æŸ“/æŒä¹…åŒ–ç­–ç•¥"
    RULE_BLOCK_CONTENT_NORMALIZATION:
      description: "content ä¼ è¾“å±‚ç»Ÿä¸€ä¸ºå­—ç¬¦ä¸²ï¼›å¤æ‚æ•°æ® (table/list/task) é‡‡ç”¨ JSON.stringify å­˜å‚¨ï¼Œå‰ç«¯è§£æï¼›ç¦æ­¢åœ¨èšåˆä¸­å­˜å‚¨å¯Œç»“æ„ã€‚"
      notes:
        - "CodeBlock: content=æºç å­—ç¬¦ä¸² + meta.language å•ç‹¬å­—æ®µ (åç«¯ DTO)"
        - "Image/VideoBlock: content=media_idï¼›UI ä»¥è¯¥ id æŸ¥è¯¢ Media æ¨¡å—æ‹¿ URL"
    RULE_BLOCK_MEDIA_PRIORITY:
      description: "åª’ä½“æ˜¾ç¤ºä¼˜å…ˆçº§ï¼šæ˜¾å¼ media_id â†’ å ä½å›¾ (ç±»å‹å›¾æ ‡)ï¼›ä¸åšè¿è¡Œæ—¶éšæœºå ä½ã€‚"
    RULE_BLOCK_SAVE_DEBOUNCE:
      description: "ç¼–è¾‘æ—¶ 300ms é˜²æŠ–ï¼›å¤±ç„¦ç«‹å³ flushï¼›çª—å£å…³é—­å‰ä½¿ç”¨ beforeunload æ¸…ç†æœªæäº¤å†…å®¹ã€‚"
    RULE_BLOCK_REORDER_FRACTIONAL_INDEX:
      description: "æ‹–æ‹½ååªè®¡ç®—å±€éƒ¨æ–° keyï¼›ç¦æ­¢å…¨åˆ—è¡¨é‡æ’ï¼›é¿å… O(n) å†™å…¥ã€‚"
    RULE_BLOCK_PAPERBALLS_RECOVERY_UI:
      description: "æ¢å¤æ—¶æ ¹æ®åç«¯è¿”å›çš„æœ€ç»ˆå®šä½æ‰§è¡ŒåŠ¨ç”»æ’å…¥ï¼›è‹¥å‰åé‚»å±…ç¼ºå¤±é‡‡ç”¨é«˜äº®æç¤º fallbackã€‚"
    RULE_BLOCK_PLUGIN_ARCHITECTURE:
      description: "æ’ä»¶æ³¨å†Œå¯¹è±¡ blockPlugins: { type: { renderer, editor, icon, shortcuts } }ï¼›æ–°å¢ç±»å‹å¢é‡æ¥å…¥ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒç¼–è¾‘å™¨ã€‚"
    RULE_BLOCK_EDITOR_INTERACTION_001:
      description: "å—ç¼–è¾‘äº¤äº’ä¸å¿«æ·é”®è§„èŒƒ"
      interaction: |
        âœ… å•å‡»å—æ­£æ–‡ â†’ è¿›å…¥ç¼–è¾‘æ€ï¼ˆtextarea / code editorï¼‰
        âœ… Esc â†’ é€€å‡ºç¼–è¾‘æ€å¹¶ä¿å­˜æœªæäº¤å†…å®¹ï¼ˆè§¦å‘ flushï¼‰
        âœ… Ctrl+S / Cmd+S â†’ ç«‹å³å¼ºåˆ¶ä¿å­˜ï¼ˆè·³è¿‡ debounceï¼‰
        âœ… Enter+Enterï¼ˆç©ºè¡Œï¼‰â†’ åœ¨å½“å‰å—åæ–¹åˆ›å»ºæ–° TEXT å—å¹¶èšç„¦
        âœ… Alt+â†‘ / Alt+â†“ â†’ å°†å½“å‰å—å‘ä¸Š/å‘ä¸‹è¯·æ±‚ Fractional é‡æ’
        âœ… Ctrl+Shift+â†‘ / Ctrl+Shift+â†“ â†’ é”®ç›˜æ— æ‹–æ‹½æ¨¡å¼é‡æ’ï¼ˆæ‰¹é‡è§¦å‘ reorder æ¥å£ï¼‰
        âœ… Tab / Shift+Tab â†’ åœ¨å·¥å…·æ å†…å¾ªç¯ç„¦ç‚¹ï¼ˆä¸ç¦»å¼€ç¼–è¾‘åŒºï¼‰
        âŒ ç¦æ­¢åœ¨ç¼–è¾‘æ€ä¸­è§¦å‘æ•´é¡µæ»šåŠ¨é˜»å¡ç”¨æˆ·è¾“å…¥
      accessibility: |
        - ç¼–è¾‘åŒºåŸŸ aria-label="å— {index} ç±»å‹ {type} ç¼–è¾‘" ä¿æŒå¯è¯»
        - é‡æ’å¿«æ·é”®éœ€åœ¨å¸®åŠ©é¢æ¿ä¸æ–‡æ¡£ä¸­æ ‡è®°ï¼ˆ? æŒ‰é”®æç¤ºï¼‰
      error_feedback: |
        - ä¿å­˜å¤±è´¥ï¼šæ˜¾ç¤ºå·¦ä¾§çº¢ç«–æ¡ + tooltip="ä¿å­˜å¤±è´¥ï¼Œæ­£åœ¨è‡ªåŠ¨é‡è¯•â€¦"ï¼›ä¸‰æ¬¡åæŒä¹…çº¢è‰² + é‡è¯•æŒ‰é’®
        - é‡æ’å†²çªï¼štoast "é¡ºåºå†²çªï¼Œå·²åˆ·æ–°æœ€æ–°åˆ—è¡¨" + è‡ªåŠ¨é‡æ–°è·å–å½“å‰é¡µ
    RULE_BLOCK_PARAGRAPH_STYLE_PLAN33:
      description: "Plan_33 æ®µè½æ ·å¼ï¼ˆæ‚¬æŒ‚ç¼©è¿›æ¡ç›®ï¼‰ = æ ·å¼å˜ä½“ï¼Œè€Œéæ–° Block ç±»å‹"
      background: |
        ç›®æ ‡æ˜¯è®© â€œï¼ˆ1 è§†å›¾ï¼šâ€¦\nï¼ˆ2 ç†ç”±ï¼šâ€¦ï¼‰â€ è¿™ç±»æ¡ç›®å¯¹é½åˆ°ç¼–å·åï¼ŒåŒæ—¶ä¿æŒ Block èšåˆä»æ˜¯ TextBlockã€‚
        é‡‡ç”¨ä¸ Word/Notion ä¸€è‡´çš„åšæ³•ï¼šä½¿ç”¨æ®µè½æ ·å¼æˆ–æœ‰åºåˆ—è¡¨æ¸²æŸ“æ‚¬æŒ‚ç¼©è¿›ã€‚
      implementation: |
        âœ… BlockEditor å·¥å…·æ å¢åŠ  â€œæ‚¬æŒ‚æ¡ç›®â€ æŒ‰é’®ï¼ˆicon=list-olï¼‰ï¼›åˆ‡æ¢æ—¶ä»…æ›´æ–° paragraphStyle å­—æ®µã€‚
        âœ… é”®ç›˜è§¦å‘ï¼š
           - è¡Œé¦–è¾“å…¥ `1.` æˆ– `ï¼ˆ1` + ç©ºæ ¼ â†’ è‡ªåŠ¨åˆ‡æ¢ä¸º ordered-list-item æ ·å¼
           - Tab/Shift+Tab â†’ æ”¹å˜å±‚çº§ï¼›Shift+Enter åœ¨åŒä¸€æ¡å†…æ¢è¡Œä»ä¿æŒç¼©è¿›
        âœ… æ¸²æŸ“é‡‡ç”¨ <ol><li> æˆ– CSS `padding-left:2em + text-indent:-2em`ï¼Œå¤šè¡Œæ–‡æœ¬å¯¹é½åˆ°ç¼–å·åæ–¹ï¼Œç¦æ­¢æ‰‹æ•²ç©ºæ ¼ã€‚
        âœ… â€œæ ‡ç­¾ï¼šè¯´æ˜â€ åœºæ™¯å¯å¤ç”¨ definition-item æ ·å¼ï¼šå·¦ä¾§æ ‡ç­¾ï¼ˆå›ºå®š 6chï¼‰+ å³ä¾§æè¿°è‡ªåŠ¨æ‚¬æŒ‚ã€‚
        âœ… placeholder æç¤º â€œâ€” åˆ‡æ¢æ‚¬æŒ‚æ¡ç›®ä»¥ä¹¦å†™ Plan_33 æ¢³ç†â€ å¸®åŠ©ç”¨æˆ·ç†è§£æ¨¡å¼ã€‚
      non_goals: |
        âŒ ä¸ä¸ºæ­¤å†æ–°å¢ ParagraphBlock / PlanBlock èšåˆç±»å‹ã€‚
        âŒ ä¸æŠŠç¼–å·/æ ‡ç­¾å†™å…¥ Domain å­—æ®µï¼›å‡ç”±æ®µè½æ–‡æœ¬è´Ÿè´£ã€‚
      telemetry: |
        - è®°å½• paragraphStyle åˆ‡æ¢äº‹ä»¶ï¼ˆtoolbarã€å¿«æ·é”®ï¼‰ä»¥è¯„ä¼°ä½¿ç”¨é¢‘ç‡ã€‚
        - è‰ç¨¿çŠ¶æ€ä¸åç«¯ DTO çš„ paragraphStyle å­—æ®µä¿æŒä¸€ä¸€å¯¹åº”ï¼Œé¿å…å‰ç«¯è‡ªé€ çŠ¶æ€ã€‚
    RULE_BLOCK_MARKDOWN_LIMITS_001:
      description: "Markdown å†…å®¹é•¿åº¦ä¸ UX æç¤º"
          RULE_BLOCK_INLINE_EDITING_DEFAULT:
            description: "é»˜è®¤è¡Œå†…ç¼–è¾‘æ¨¡å¼ï¼Œæ— è¦†ç›–å±‚ BlockEditorï¼Œå—æ¸²æŸ“å³ç¼–è¾‘ã€‚"
            removal: "ç§»é™¤æ—§ BlockEditor.tsx è¦†ç›–ç»„ä»¶åŠåŒå‡»è¿›å…¥é€»è¾‘ã€‚"
            save_triggers:
              - "blur (å¤±ç„¦)"
              - "Ctrl+S / Cmd+S"
              - "Enter (é Shift)"
            cancel_trigger: "Esc æ¢å¤åŸå€¼"
            shortcuts:
              - "Alt+â†‘ / Alt+â†“ é‡æ’ (Fractional Index ä¸­å€¼è®¡ç®—)"
            styling:
              textarea:
                font_family: "system-ui, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif"
                font_size: "15px"
                line_height: "1.55"
                focus_ring: "2px rgba(0,102,204,0.25) å¤–å‘å…‰ + æ¸å˜è¾¹æ¡†"
                dark_mode: "é«˜å¯¹æ¯”åº¦æ¸å˜èƒŒæ™¯ + è¾¹æ¡† #444 èšç„¦é¢œè‰² #4d9bff"
            component_structure:
              - "BlockList ä»… map æ¸²æŸ“ <BlockItem/>ï¼Œä¸ç›´æ¥å£°æ˜ hooks"
              - "BlockItem å†…éƒ¨å°è£… useUpdateBlock / useStateï¼Œç¨³å®š hooks é¡ºåº"
            error_handling:
              - "åˆ é™¤åä¸å†å‡ºç° React Rendered fewer hooks é”™è¯¯"
            future_extensions:
              - "å¯Œç±»å‹æ’ä»¶æ²¿ç”¨åŒä¸€è¡Œå†…å®¹å™¨ï¼Œä¸å¼•å…¥ modal"
              - "åç»­æ·»åŠ è‡ªåŠ¨é«˜åº¦ä¸ç²˜è´´æ‹†åˆ†ç­–ç•¥"
      limits:
        warning_threshold: "15KB (æ˜¾ç¤ºé»„è‰²æç¤ºæ¡ï¼šå»ºè®®æ‹†åˆ†å—)"
        hard_limit: "20KB (æ‹’ç»ä¿å­˜å¹¶æç¤ºæ‹†åˆ†)"
      implementation: |
        å‰ç«¯ï¼š
          - è®¡ç®— UTF-8 å­—èŠ‚é•¿åº¦ï¼ˆnew TextEncoder().encode(content).lengthï¼‰
          - é•¿åº¦ â‰¥ 15KB ä¸” < 20KBï¼šå—ä¸‹æ–¹é»„è‰²è¾…åŠ©æ–‡æœ¬â€œå†…å®¹è¾ƒé•¿ï¼Œå»ºè®®æ‹†åˆ†ä»¥æé«˜æ€§èƒ½â€
          - é•¿åº¦ â‰¥ 20KBï¼šé˜»æ­¢æäº¤ï¼Œå­—æ®µæ ‡çº¢ + tooltip â€œè¶…è¿‡ 20KB ä¸Šé™ï¼Œè¯·æ‹†åˆ†æˆå¤šä¸ªå—â€
        åç«¯ï¼š
          - UseCase å±‚æ ¡éªŒ content é•¿åº¦ > 20000 å­—èŠ‚æŠ› BLOCK_CONTENT_TOO_LARGEï¼ˆ422ï¼‰
          - å“åº” detail.code = BLOCK_CONTENT_TOO_LARGEï¼Œé€‚é…å±‚æ˜ å°„åˆ° UI æç¤º
        æµ‹è¯•ï¼š
          - å•å…ƒï¼š15KBã€19KBã€20KBã€21KB å››ä¸ªè¾¹ç•Œç”¨ä¾‹
          - é›†æˆï¼šåˆ›å»ºä¸æ›´æ–°ç«¯ç‚¹è¿”å›æ­£ç¡®é”™è¯¯ç ä¸æ¶ˆæ¯
      rationale: "ä¿è¯ç¼–è¾‘æ€§èƒ½ä¸æ»šåŠ¨æµç•…åº¦ï¼›é¿å…è¶…é•¿å•å—å½±å“è™šæ‹Ÿåˆ—è¡¨ä¸é‡æ’è®¡ç®—ã€‚"
  accessibility:
    guidelines:
      - "æ‹–æ‹½æ“ä½œå¿…é¡»æä¾›é”®ç›˜æ›¿ä»£ï¼šä½¿ç”¨ä¸Šä¸‹ç®­å¤´ + Ctrl+Shift+â†‘/â†“ è§¦å‘ reorder"
      - "ç¼–è¾‘åŒº aria-label åŒ…å«å—ç±»å‹ä¸åºå·ï¼Œä¾‹å¦‚ 'ç¬¬3ä¸ªæ–‡æœ¬å—'"
      - "é”™è¯¯çŠ¶æ€ä½¿ç”¨ aria-live=polite åŒºåŸŸæç¤ºä¿å­˜å¤±è´¥"
  performance:
    guidelines:
      - "è¶…å‡ºè§†å£çš„å—ä½¿ç”¨è™šæ‹ŸåŒ–ï¼ˆä»… >200 å—é˜ˆå€¼åå¯ç”¨ï¼‰"
      - "å›¾ç‰‡/è§†é¢‘å—æ‡’åŠ è½½ (IntersectionObserver)"
      - "æ‰¹é‡é‡æ’å†™å…¥åˆå¹¶ (requestIdleCallback å›å†™)"
  testing:
    strategy:
      - "å•å…ƒï¼šè§£æ/åºåˆ—åŒ–å‡½æ•° (json â†’ content)"
      - "é›†æˆï¼šæ‹–æ‹½åé¡ºåºä¸ Fractional Index æ­£ç¡®æ€§"
      - "å›å½’ï¼šPaperballs æ¢å¤ 3 çº§ç­–ç•¥ UI å±•ç¤º"
      - "å¥‘çº¦ï¼šç¡®ä¿ IMAGE/VIDEO ç±»å‹ä¸ç›´æ¥åŒ…å« URLï¼Œåªå« media_id"
  deprecation:
    notes:
      - "ç¦æ­¢ç»§ç»­æ·»åŠ æ–°çš„å—ç±»å‹åˆ°æ—§ 'simple text only' åˆ†æ”¯ï¼Œç»Ÿä¸€èµ°æ’ä»¶æ³¨å†Œ"
      - "è‹¥å‘ç°ç›´æ¥åœ¨ Domain å¢åŠ å¯Œæ–‡æœ¬å­—æ®µï¼Œéœ€å›æ»šå¹¶è®°å½• ADR-080 Deviations"

block_visual_rules:
  RULE_BLOCK_CARD_MIN_WIDTH: "æœ€å°å®½åº¦ 680px ä¿è¯å·¥å…·æ¡å¸ƒå±€ç¨³å®šï¼›ç§»åŠ¨ç«¯ <600px æŠ˜å ä¸ºçºµå‘å·¥å…·æ¡ã€‚"
  RULE_LIBRARY_CARD_HOVER: "Library å¡ç‰‡ hover ä¸ä½¿ç”¨å¤§èŒƒå›´é˜´å½±æ‰©æ•£ï¼Œä¿æŒå•†ä¸šæ„Ÿä¸å…‹åˆ¶ã€‚"
  RULE_WORKBOX_DROPDOWN_STRUCTURE: "Workbox ä¸‹æ‹‰æœ€å¤§å®½åº¦ 240pxï¼Œæ¡ç›®é«˜åº¦ 32â€“36pxï¼Œé¿å…æ»šåŠ¨ï¼›è¶…è¿‡ 6 é¡¹ååˆ†ç»„æˆ–æŠ˜å ã€‚"
  RULE_BLOCK_TOOLBAR_POSITION: "å·¥å…·æ¡åœ¨èšç„¦æ—¶ç²˜é™„é¡¶éƒ¨ï¼›æ»šåŠ¨ç¦»å¼€åæ·¡å‡ºï¼Œä»…ä¿ç•™è¾¹ç•Œå ä½å‡å°‘è·³åŠ¨ã€‚"
  RULE_BLOCK_INLINE_CREATE_PLACEHOLDER: "æœ€åä¸€è¡Œå ä½æç¤ºï¼š'æŒ‰ Enter åˆ›å»ºæ–°å—â€¦'ï¼›èšç„¦åè½¬ä¸ºè¾“å…¥æ¡†ã€‚"
  RULE_BLOCK_ERROR_INDICATOR: "ä¿å­˜å¤±è´¥æ˜¾ç¤ºçº¢è‰²å·¦ä¾§ç«–æ¡ + tooltip(é‡è¯•)ï¼›è‡ªåŠ¨é‡è¯• 3 æ¬¡åè¿›å…¥æ°¸ä¹…å¤±è´¥çŠ¶æ€ã€‚"
  RULE_BLOCK_MEDIA_THUMBNAIL_SIZE: "å›¾ç‰‡/è§†é¢‘å—ç¼©ç•¥å›¾é«˜åº¦ 240pxï¼Œè‡ªé€‚åº”å®½åº¦ï¼›ä¿æŒ 12px åœ†è§’ä¸å¡ç‰‡ä¸€è‡´ã€‚"
  RULE_BLOCK_CODE_THEME: "ä»£ç å—ä½¿ç”¨ä¸åº”ç”¨ä¸»é¢˜è”åŠ¨çš„ Prism ä¸»é¢˜ï¼›æš—è‰²æ¨¡å¼å¯ç”¨è¡Œå·ä½å¯¹æ¯”åº¦é…è‰²ã€‚"
  RULE_BLOCK_TABLE_SCROLL: "è¡¨æ ¼å—æ¨ªå‘æº¢å‡ºä½¿ç”¨å†…åµŒæ»šåŠ¨æ¡ï¼Œä¸æ”¹å˜æ•´ä½“é¡µé¢å¸ƒå±€å®½åº¦ã€‚"


# ============================================
# Part 15: FSD Detailed Layer Responsibility Mapping (NEW - Nov 16, 2025)
# ============================================
# è¯¦ç»†èŒè´£æ˜ å°„ - æ¯å±‚çš„å…·ä½“æ–‡ä»¶èŒè´£å’Œå®Œæˆåº¦
# å‚è€ƒæ–‡æ¡£ï¼šADR-061-frontend-fsd-layer-responsibilities-and-maturity-assessment.md

fsd_layer_responsibilities:
  overview: "Complete responsibility matrix for 6-layer FSD architecture"
  maturity_score: "76/100 (Production-ready foundation, tactical gaps)"
  last_updated: "2025-11-16"
  reference_adr: "ADR-061"

  layer_0_shared:
    name: "Shared Infrastructure"
    maturity: "95/100"
    status: "âœ… Production Ready"
    responsibility: "Global APIs, utilities, base UI components, design tokens"
    files_count: 18
    files_detail:
      api:
        - "client.ts: Axios instance + JWT interceptor + error handling (âœ…)"
        - "types.ts: BaseDto + ApiErrorResponse + HttpStatus enum (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… 100% Complete"
      ui:
        - "Button.tsx/module.css: Primary action button (âœ…)"
        - "Card.tsx/module.css: Content card container (âœ…)"
        - "Input.tsx/module.css: Text input field (âœ…)"
        - "Modal.tsx/module.css: Dialog component (âœ…)"
        - "Spinner.tsx/module.css: Loading indicator (âœ…)"
        - "Toast.tsx/module.css: Notification (âš ï¸ MISSING)"
        - "Skeleton.tsx/module.css: Loading skeleton (âš ï¸ MISSING)"
        - "index.ts: barrel export (âœ…)"
        status: "âš ï¸ 80% Complete (5/7 components)"
      layouts:
        - "Layout.tsx/module.css: Main wrapper (Header+Sidebar+Content) (âœ…)"
        - "Header.tsx/module.css: Top navigation 60px fixed (âœ…)"
        - "Sidebar.tsx/module.css: Left menu 280px fixed (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… 100% Complete"
      providers:
        - "ThemeProvider.tsx: CSS variable injection + theme persistence (âœ…)"
        - "AuthProvider.tsx: Authentication context (âš ï¸ MISSING/Planned)"
        - "index.ts: barrel export (âœ…)"
        status: "âš ï¸ 60% Complete (1/2 providers)"
      lib:
        - "config.ts: Environment variables + constants (âœ…)"
        - "utils.ts: formatDate, debounce, formatFileSize (âœ…)"
        - "validators.ts: Input validation helpers (âš ï¸ MISSING)"
        - "errors.ts: Error message mapping (âš ï¸ MISSING)"
        - "index.ts: barrel export (âœ…)"
        status: "âš ï¸ 70% Complete (2/4 files)"
      styles:
        - "tokens.css: Design system variables (colors, spacing, typography) (âœ…)"
        - "globals.css: Global resets + base styles (âœ…)"
        - "button.css, card.css, input.css, spinner.css, modal.css: Component styles (âœ…)"
        status: "âœ… 100% Complete"
    blockers: "None"
    p0_items: "None"
    next_actions:
      - "Add Toast component"
      - "Add Skeleton component"
      - "Create validators.ts (email, url, length, etc.)"
      - "Create errors.ts (HTTP status mapping)"

  layer_1_entities:
    name: "Domain Models (Type Definitions)"
    maturity: "100/100"
    status: "âœ… Complete"
    responsibility: "TypeScript interfaces for 7 domains (zero business logic)"
    files_count: 14
    files_detail:
      library:
        - "types.ts: LibraryDto + CreateLibraryRequest + UpdateLibraryRequest (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
      bookshelf:
        - "types.ts: BookshelfDto + Create/Update requests (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
      book:
        - "types.ts: BookDto with author[], ISBN, cover_url (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
      block:
        - "types.ts: BlockDto (6 types: HEADING|TEXT|IMAGE|VIDEO|CODE|LIST) + fractional_index (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
      tag:
        - "types.ts: TagDto + parent_id (hierarchy support) (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
      media:
        - "types.ts: MediaDto with media_type + trashed_at + restored_at (soft delete) (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
      search:
        - "types.ts: SearchRequest + SearchResponse + SearchResultDto (âœ…)"
        - "index.ts: barrel export (âœ…)"
        status: "âœ… Complete"
    blockers: "None"
    p0_items: "None"
    coverage: "7/7 domains complete"

  layer_2_features:
    name: "Feature Business Logic"
    maturity: "74/100"
    status: "âš ï¸ Partially Complete"
    responsibility: "Feature-specific model (API + hooks) + UI components"
    files_count: "40/54 (74%)"
    features_matrix:
      library:
        - "model/api.ts: 5 functions (list/get/create/update/delete) (âœ…)"
        - "model/hooks.ts: 5 hooks (useLibraries, useLibrary, useCreate, useUpdate, useDelete) (âœ…)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/LibraryCard.tsx: Card display (âœ…)"
        - "ui/LibraryList.tsx: List container (âœ…)"
        - "ui/LibraryForm.tsx: Create/edit form (âœ…)"
        - "ui/index.ts: barrel export (âœ…)"
        - "index.ts: public API (âœ…)"
        completeness: "85%"
      bookshelf:
        - "model/api.ts: 5 functions (nested routes) (âœ…)"
        - "model/hooks.ts: 5 hooks (âœ…)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/BookshelfCard.tsx, BookshelfList.tsx, index.ts (âœ…)"
        - "index.ts: public API (âœ…)"
        completeness: "80%"
      book:
        - "model/api.ts: 5 functions (3-layer nested) (âœ…)"
        - "model/hooks.ts: 5 hooks (âœ…)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/BookCard.tsx, BookList.tsx, index.ts (âœ…)"
        - "ui/BookDetail.tsx, BookEditor.tsx (âŒ MISSING)"
        - "index.ts: public API (âœ…)"
        completeness: "70%"
      block:
        - "model/api.ts: 5 functions (4-layer nested) (âœ…)"
        - "model/hooks.ts: 5 hooks (âœ…)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/BlockCard.tsx, BlockList.tsx, index.ts (âœ…)"
        - "ui/BlockEditor.tsx: Rich text editor (âŒ CRITICAL MISSING)"
        - "ui/BlockTypes/: Specialized block types (âŒ MISSING)"
        - "index.ts: public API (âœ…)"
        completeness: "65%"
        note: "BlockEditor is core functionality blocker"
      tag:
        - "model/api.ts: 5 functions (library-scoped) (âœ…)"
        - "model/hooks.ts: 5 hooks (âœ…)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/TagBadge.tsx, TagList.tsx, index.ts (âœ…)"
        - "ui/TagSelector.tsx: Tag picker (âŒ MISSING)"
        - "ui/TagManager.tsx: Tag management UI (âŒ MISSING)"
        - "ui/TagHierarchy: Hierarchy rendering (âŒ MISSING)"
        - "index.ts: public API (âœ…)"
        completeness: "60%"
      media:
        - "model/api.ts: 4 functions + restoreMedia (soft delete support) (âœ…)"
        - "model/hooks.ts: 3 hooks (partial) (âš ï¸)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/MediaCard.tsx, MediaList.tsx, index.ts (âœ…)"
        - "ui/MediaUploader.tsx: File upload (âŒ MISSING)"
        - "ui/MediaGallery.tsx: Gallery view (âŒ MISSING)"
        - "ui/MediaViewer.tsx: Full view (âŒ MISSING)"
        - "index.ts: public API (âœ…)"
        completeness: "55%"
      search:
        - "model/api.ts: search() + getSearchResult() (âœ…)"
        - "model/hooks.ts: 2 hooks (âœ…)"
        - "model/store.ts: Zustand store (âŒ MISSING)"
        - "ui/SearchResultCard.tsx, SearchResultsList.tsx, index.ts (âœ…)"
        - "ui/SearchBar.tsx: Search input (âŒ MISSING)"
        - "ui/SearchFilters.tsx: Filter panel (âŒ MISSING)"
        - "index.ts: public API (âœ…)"
        completeness: "50%"
    summary_by_category:
      model_api_layer: "âœ… 100% (all 7 features have complete API)"
      model_hooks_layer: "âœ… 95% (all features have hooks, minor gaps)"
      model_store_layer: "âŒ 0% (Zustand stores NOT YET IMPLEMENTED)"
      ui_components_layer: "âš ï¸ 60% (basic CRUD components exist, specializations missing)"
    blockers:
      - "ğŸ”´ Block editor (P0) - Core editing functionality"
      - "ğŸŸ¡ Zustand stores (P1) - State management across all features"
      - "ğŸŸ¡ Specialized components (P1) - UI completeness"
    p0_items: "Block editor implementation"
    p1_items: "All store.ts files, specialized UI components"
    p2_items: "Advanced features (file upload, search filters)"

  layer_3_widgets:
    name: "Composed Features"
    maturity: "80/100"
    status: "âš ï¸ Mostly Complete"
    responsibility: "Combine multiple feature components into larger UI panels"
    files_count: "4/6 (67%)"
    widgets:
      LibraryMainWidget:
        - "Composes: LibraryList + LibraryForm + Sort/IncludeArchived controls"
        - "Status: âœ… Complete (Plan20 refresh Nov 22, 2025)"
        - "Completeness: 98%"
      BookshelfMainWidget:
        - "Composes: BookshelfList + BookshelfForm"
        - "Status: âœ… Complete"
        - "Completeness: 95%"
      BookMainWidget:
        - "Composes: BookList + BookForm"
        - "Status: âœ… Complete"
        - "Completeness: 90%"
      BlockMainWidget:
        - "Composes: BlockList + BlockEditor"
        - "Status: âš ï¸ Incomplete (BlockEditor missing)"
        - "Completeness: 60%"
      SidebarNav:
        - "Purpose: Global navigation + breadcrumbs"
        - "Status: âŒ MISSING"
        - "Completeness: 0%"
        - "Priority: ğŸŸ¡ P1 (Medium)"
      SearchPanel:
        - "Purpose: Composed search experience (bar + filters + results)"
        - "Status: âŒ MISSING"
        - "Completeness: 0%"
        - "Priority: ğŸŸ¡ P1 (Medium)"
    blockers: "BlockEditor (blocks all features)"
    p0_items: "None"
    p1_items: "SidebarNav, SearchPanel widgets"

  layer_4_layouts:
    name: "Page Templates"
    maturity: "100/100"
    status: "âœ… Complete"
    responsibility: "Reusable page structure templates"
    note: "Moved to shared/layouts/ for reusability"
    files:
      - "Layout.tsx: Main wrapper (Header+Sidebar+content area)"
      - "Header.tsx: Top navigation (60px fixed)"
      - "Sidebar.tsx: Left menu (280px fixed)"
    blockers: "None"

  layer_5_pages:
    name: "Next.js Routes (App Router)"
    maturity: "55/100"
    status: "âš ï¸ Partial Implementation"
    responsibility: "Route handlers and page-level components"
    pages_matrix:
      root:
        - "/ (home): Welcome page (âœ… 100%)"
      auth:
        - "/login: Login form (âœ… 80%)"
        - "/register: Registration form (âŒ MISSING)"
      admin:
        - "/dashboard: Placeholder (âš ï¸ 50%)"
        - "/libraries: Fully functional with CRUD (âœ… 100%)"
        - "/bookshelves: List only (âš ï¸ 50%)"
        - "/books: List only (âš ï¸ 50%)"
        - "/tags: Placeholder only (âŒ 10%)"
        - "/media: Placeholder only (âŒ 10%)"
        - "/search: Placeholder only (âŒ 10%)"
    critical_missing:
      - "âŒ Dynamic routes NOT IMPLEMENTED"
      - "(admin)/libraries/[libraryId]/page.tsx"
      - "(admin)/libraries/[libraryId]/bookshelves/[bookshelfId]/page.tsx"
      - "(admin)/libraries/[libraryId]/bookshelves/[bookshelfId]/books/[bookId]/page.tsx"
    blockers:
      - "ğŸ”´ Dynamic routing (P0) - Blocks nested navigation"
    p0_items:
      - "Implement dynamic route structure"
      - "Add [id] folders for nested navigation"
      - "Update page components to use URL params"
    p1_items:
      - "Tag/Media/Search page implementations"
      - "Dashboard page completion"

  layer_6_app:
    name: "Application Root"
    maturity: "100/100"
    status: "âœ… Complete"
    responsibility: "Root layout, providers, global configuration"
    files:
      - "layout.tsx: Root <html> + metadata + Providers wrapper (âœ…)"
      - "providers.tsx: ThemeProvider + QueryClientProvider (âœ…)"
      - "page.tsx: Welcome page (âœ…)"
    config_files:
      - "package.json: Dependencies (âœ…)"
      - "tsconfig.json: TypeScript strict + @ alias (âœ…)"
      - "next.config.js: Next.js config (âœ…)"
      - ".eslintrc.json: ESLint rules (âœ…)"
    blockers: "None"

  dependency_rules:
    description: "Strict one-way dependency flow validation"
    rule_0: "Layer 0 (shared): Only built-in Node.js modules"
    rule_1: "Layer 1 (entities): Layer 0 only"
    rule_2: "Layer 2 (features): Layers 0-1 only"
    rule_3: "Layer 3 (widgets): Layers 0-2 only"
    rule_4: "Layer 4 (layouts): Layers 0-3 only"
    rule_5: "Layer 5 (pages): Layers 0-4 only"
    rule_6: "Layer 6 (app): All layers (root exception)"
    violation: "âŒ Features CANNOT import from Pages or other Features"
    current_status: "âœ… No circular dependencies detected"
    validation_tool: "ğŸ”§ Recommend: madge (circular dependency detector)"

# ============================================
# Part 16: Implementation Roadmap & Priority Items (NEW - Nov 16, 2025)
# ============================================
# 48å°æ—¶å¿«é€Ÿä¿®å¤ + 4å‘¨å®Œæ•´å®ç°è®¡åˆ’
# å‚è€ƒæ–‡æ¡£ï¼šADR-061

implementation_roadmap:
  overview: "Phase-based roadmap to achieve 95% FSD maturity"
  timeline: "4 weeks"
  reference_adr: "ADR-061"

  phase_4_foundation_stability:
    name: "Phase 4: Foundation Stability (Week 1)"
    goal: "Fix critical blockers, enable nested navigation"
    status: "â³ Starting"
    tasks:
      task_1:
        title: "Dynamic routing setup (P0)"
        work: "Implement (admin)/[domain]/[id]/page.tsx pattern"
        effort: "1-2 days"
        deliverable: "Nested routes functional"
        acceptance_criteria:
          - "User can navigate Library â†’ Bookshelf â†’ Book â†’ Block via URL"
          - "URL params correctly populate views"
          - "Breadcrumbs display navigation path"
      task_2:
        title: "Breadcrumb component (P1)"
        work: "Add breadcrumb navigation widget"
        effort: "0.5 days"
        deliverable: "SidebarNav widget with breadcrumbs"
      task_3:
        title: "Page completions (P1)"
        work: "Replace tag/media/search placeholders"
        effort: "1 day"
        deliverable: "3 functional pages (basic implementation)"
      task_4:
        title: "Error boundary (P1)"
        work: "Add Error component for error handling"
        effort: "0.5 days"
        deliverable: "Error fallback UI"
      task_5:
        title: "Loading states (P1)"
        work: "Add Skeleton component to shared"
        effort: "0.5 days"
        deliverable: "Consistent loading UX"
    completion_criteria: "âœ… Nested navigation working + placeholder pages replaced"

  phase_5_block_editor:
    name: "Phase 5: Block Editor Implementation (Week 2)"
    goal: "Complete core editing functionality"
    status: "â³ Pending"
    tasks:
      task_1:
        title: "BlockEditor component (P0)"
        work: "Rich text editor (Slate.js or ProseMirror)"
        effort: "2-3 days"
        deliverable: "Block editing UI"
        note: "Core feature - highest priority"
        acceptance_criteria:
          - "User can edit block content"
          - "Changes persist to backend"
          - "Toolbar with formatting options"
      task_2:
        title: "BlockType specialization (P1)"
        work: "HeadingBlock, TextBlock, ImageBlock, etc."
        effort: "1 day"
        deliverable: "6 block type components"
      task_3:
        title: "Zustand store setup (P1)"
        work: "Implement store.ts for all 7 features"
        effort: "1 day"
        deliverable: "State management for all domains"
      task_4:
        title: "Optimistic updates (P1)"
        work: "UI updates before API response"
        effort: "0.5 days"
        deliverable: "Fast UX feedback"
    completion_criteria: "âœ… Block editing fully functional"

  phase_6_feature_completion:
    name: "Phase 6: Feature Completion (Week 3)"
    goal: "All 7 features fully functional"
    status: "â³ Pending"
    tasks:
      task_1:
        title: "Tag selector (P1)"
        work: "Tag picker for blocks"
        effort: "0.5 days"
        deliverable: "TagSelector component"
      task_2:
        title: "Media uploader (P1)"
        work: "File upload with progress"
        effort: "1 day"
        deliverable: "MediaUploader component"
      task_3:
        title: "Search filters (P1)"
        work: "Advanced search panel"
        effort: "1 day"
        deliverable: "SearchFilters component"
      task_4:
        title: "Form validation (P1)"
        work: "Client-side validators"
        effort: "0.5 days"
        deliverable: "Validation helpers"
      task_5:
        title: "End-to-end flows (P1)"
        work: "Test complete user journeys"
        effort: "1 day"
        deliverable: "E2E scripts"
    completion_criteria: "âœ… All CRUD operations + file upload + search working"

  phase_7_quality_polish:
    name: "Phase 7: Quality & Polish (Week 4)"
    goal: "Production readiness, test coverage, documentation"
    status: "â³ Pending"
    tasks:
      task_1:
        title: "Vitest unit tests (P2)"
        work: "Component logic tests"
        effort: "1 day"
        deliverable: "60% coverage"
      task_2:
        title: "Integration tests (P2)"
        work: "Feature workflow tests"
        effort: "1 day"
        deliverable: "30% coverage"
      task_3:
        title: "Circular dep check (P2)"
        work: "Install madge, validate"
        effort: "0.5 days"
        deliverable: "0 circular dependencies"
      task_4:
        title: "API documentation (P2)"
        work: "JSDoc comments"
        effort: "1 day"
        deliverable: "Self-documented code"
      task_5:
        title: "ADR updates (P2)"
        work: "Document implementation decisions"
        effort: "1 day"
        deliverable: "ADR-062+"
    completion_criteria: "âœ… 80%+ test coverage + 0 linting errors"

  priority_levels:
    p0_critical_blockers:
      description: "Blocks core functionality"
      items:
        - "Dynamic nested routes - Enables 4-layer navigation"
        - "Block editor - Core editing feature"
        - "API integration - Backend connection"
      effort: "4-5 days total"
      impact: "ğŸ”´ CRITICAL"
    p1_functional_gaps:
      description: "Needed for complete features"
      items:
        - "Zustand stores - State management"
        - "Specialized UI components - UI completeness"
        - "Tag/Media/Search pages - Feature pages"
        - "File upload - Media functionality"
        - "Search filters - Search UX"
      effort: "4-5 days total"
      impact: "ğŸŸ¡ HIGH"
    p2_optimization:
      description: "Nice-to-have, quality improvements"
      items:
        - "Unit tests - Code coverage"
        - "Advanced components - Polish"
        - "Documentation - Developer experience"
        - "Performance optimization - Speed"
      effort: "3-4 days total"
      impact: "ğŸŸ¢ MEDIUM"

  success_metrics:
    week_1:
      - "âœ… Nested routing working"
      - "âœ… Breadcrumbs displayed"
      - "âœ… All 9 pages at least rendering"
    week_2:
      - "âœ… Block editor functional"
      - "âœ… Zustand stores implemented"
      - "âœ… Optimistic updates working"
    week_3:
      - "âœ… All 7 features with complete CRUD"
      - "âœ… File upload working"
      - "âœ… Search with filters"
    week_4:
      - "âœ… 80%+ test coverage"
      - "âœ… 0 circular dependencies"
      - "âœ… All ADRs current"

  resource_requirements:
    engineers: "1 frontend developer"
    hours_per_week: "40"
    total_hours: "160 (4 weeks)"
    dependencies: "Backend API stable (already running)"
    risks:
      - "Block editor complexity (mitigation: use proven library)"
      - "Dynamic routes edge cases (mitigation: thorough testing)"
      - "Performance with large datasets (mitigation: virtual scrolling)"

  estimated_completion:
    phase_4: "2025-11-23 (1 week from Nov 16)"
    phase_5: "2025-11-30 (2 weeks)"
    phase_6: "2025-12-07 (3 weeks)"
    phase_7: "2025-12-14 (4 weeks)"
    total_timeline: "4 weeks â†’ 95% FSD maturity"

  final_metrics:
    layer_0_target: "âœ… 100% (from 95%)"
    layer_1_target: "âœ… 100% (stable)"
    layer_2_target: "âœ… 95% (from 74%)"
    layer_3_target: "âœ… 95% (from 80%)"
    layer_4_target: "âœ… 100% (stable)"
    layer_5_target: "âœ… 90% (from 55%)"
    layer_6_target: "âœ… 100% (stable)"
    overall_target: "âœ… 95% (from 76%)"

# ============================================
# Part 17: Phase 4 Implementation Progress (NEW - Nov 16, 2025)
# ============================================
# Phase 4 å®æ–½ä¸­çš„è¿›åº¦å¿«ç…§ - åŠ¨æ€è·¯ç”± + Block ç¼–è¾‘å™¨å†³ç­–
# æ‰§è¡Œæ—¥æœŸï¼š2025-11-16
# ç›¸å…³æ–‡æ¡£ï¼šPHASE_4_BLOCK_EDITOR_DECISION.md

phase_4_implementation_snapshot:
  execution_date: "2025-11-16"
  phase_name: "Phase 4: Foundation Stability (Week 1)"
  reference_adr: "ADR-061"
  decision_document: "PHASE_4_BLOCK_EDITOR_DECISION.md"

  completed_tasks:
    task_1_block_editor_research:
      status: "âœ… COMPLETED"
      description: "æ·±å…¥ç ”ç©¶ Slate.js vs ProseMirrorï¼Œåˆ¶ä½œå¯¹æ¯”åˆ†æ"
      deliverables:
        - "å¯¹æ¯”çŸ©é˜µï¼ˆ10+ æŒ‡æ ‡ï¼‰"
        - "æœ€ç»ˆå†³ç­–ï¼šSlate.js ğŸ¯"
        - "ç†ç”±è¯´æ˜ï¼ˆ5 ç‚¹æ ¸å¿ƒä¼˜åŠ¿ï¼‰"
        - "npm ä¾èµ–æ¸…å•"
        - "4 å¤©å®ç°è®¡åˆ’"
      decision: "é€‰æ‹© Slate.jsï¼ˆReact-first + plugin architecture + TypeScript supportï¼‰"
      rationale:
        - "åŸç”Ÿ React é›†æˆï¼ˆvs ProseMirror ç‹¬ç«‹ç³»ç»Ÿï¼‰"
        - "å®Œç¾æ”¯æŒ 6 å—ç±»å‹ + åµŒå¥—ç»“æ„"
        - "æ’ä»¶ä¼˜å…ˆæ¶æ„æ˜“äºæ‰©å±•"
        - "å­¦ä¹ æ›²çº¿å‹å¥½ï¼ˆ2-3 å°æ—¶ POCï¼‰"
        - "ååŒç¼–è¾‘å¯åç»­é€šè¿‡ Yjs é›†æˆ"
      implementation_timeline:
        day_1: "Setup + POC (basic rich text)"
        day_2: "Block types (HEADING, TEXT, IMAGE, VIDEO, CODE, LIST)"
        day_3: "Advanced features (Marks, nesting, copy/paste)"
        day_4: "API integration + optimistic updates"
      success_criteria:
        - "âœ… User can edit text"
        - "âœ… Can toggle formatting (bold/italic/underline)"
        - "âœ… Can switch block types via toolbar"
        - "âœ… Can upload images"
        - "âœ… Changes persist to backend"
        - "âœ… Optimistic updates working"

    task_2_dynamic_routing:
      status: "âœ… COMPLETED"
      description: "åˆ›å»ºå®Œæ•´çš„åµŒå¥—è·¯ç”±ç»“æ„æ”¯æŒ 3 å±‚å¯¼èˆª"
      created_directories:
        - "(admin)/libraries/[libraryId]/"
        - "(admin)/libraries/[libraryId]/bookshelves/[bookshelfId]/"
        - "(admin)/libraries/[libraryId]/bookshelves/[bookshelfId]/books/[bookId]/"
      created_files:
        - "[libraryId]/page.tsx - Library detail view"
        - "[libraryId]/page.module.css - Library detail styles"
        - "[bookshelfId]/page.tsx - Bookshelf detail view"
        - "[bookshelfId]/page.module.css - Bookshelf detail styles"
        - "[bookId]/page.tsx - Book detail (Block editor)"
        - "[bookId]/page.module.css - Book detail styles"
      implementation_details:
        - "âœ… useParams() é’©å­æ­£ç¡®è·å–è·¯ç”±å‚æ•°"
        - "âœ… useLibrary/useBookshelf/useBook/useBlocks hooks é›†æˆ"
        - "âœ… é¢åŒ…å±‘å¯¼èˆªå®Œæ•´æ˜¾ç¤ºè·¯å¾„"
        - "âœ… é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€"
        - "âœ… TypeScript ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€šè¿‡"
      features:
        - "4 å±‚é¢åŒ…å±‘å¯¼èˆªï¼ˆLibrary â†’ Bookshelf â†’ Bookï¼‰"
        - "å®æ—¶åŠ è½½çŠ¶æ€æ˜¾ç¤º"
        - "é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º"
        - "é›†æˆ TanStack Query ç¼“å­˜"
        - "æ”¯æŒè¿”å›ä¸Šçº§æ“ä½œ"

    task_3_route_parameter_handling:
      status: "âœ… COMPLETED"
      description: "ä¸ºæ‰€æœ‰é¡µé¢é›†æˆ useParams å’Œå‚æ•°ä¼ é€’"
      pages_updated:
        library_detail:
          - "useLibrary(libraryId) - è·å–åº“å…ƒæ•°æ®"
          - "useBookshelves(libraryId) - è·å–ä¹¦æ©±åˆ—è¡¨"
          - "LibraryDetailPage æ¥æ”¶ libraryId å‚æ•°"
        bookshelf_detail:
          - "useBookshelf(libraryId, bookshelfId) - è·å–ä¹¦æ©±å…ƒæ•°æ®"
          - "useBooks(libraryId, bookshelfId) - è·å–ä¹¦ç±åˆ—è¡¨"
          - "BookshelfDetailPage æ¥æ”¶åŒå‚æ•°"
        book_detail:
          - "useBook(libraryId, bookshelfId, bookId) - è·å–ä¹¦å…ƒæ•°æ®"
          - "useBlocks(libraryId, bookshelfId, bookId) - è·å–å—åˆ—è¡¨"
          - "BookDetailPage æ¥æ”¶ä¸‰å‚æ•°"
      data_flow:
        - "URL params â†’ useParams() â†’ hooks â†’ TanStack Query"
        - "æ‰€æœ‰ hooks éƒ½æœ‰æ­£ç¡®çš„ query key åˆ†å±‚"
        - "ä¾èµ–æŸ¥è¯¢è‡ªåŠ¨çº§è”å¤±æ•ˆ"

    task_4_block_editor_poc:
      status: "âœ… COMPLETED (Skeleton)"
      description: "åˆ›å»º BlockEditor ç»„ä»¶æ¡†æ¶å’Œæ ·å¼"
      files_created:
        - "BlockEditor.tsx - å®Œæ•´ç»„ä»¶æ¡†æ¶ï¼ˆä¿å­˜/å–æ¶ˆæŒ‰é’®ã€çŠ¶æ€æŒ‡ç¤ºï¼‰"
        - "BlockEditor.module.css - å®Œæ•´ç¼–è¾‘å™¨æ ·å¼"
        - "BlockMainWidget æ›´æ–° - æ”¯æŒç¼–è¾‘å™¨æ¨¡å¼åˆ‡æ¢"
      features_skeleton:
        - "âœ… å·¥å…·æ ï¼ˆå—ç±»å‹ã€ä¿å­˜/å–æ¶ˆæŒ‰é’®ã€æœªä¿å­˜æŒ‡ç¤ºï¼‰"
        - "âœ… ç¼–è¾‘å™¨å†…å®¹åŒºåŸŸ"
        - "âœ… çŠ¶æ€æ ï¼ˆå­—ç¬¦è®¡æ•°ã€å— IDï¼‰"
        - "âœ… åŠ è½½/ç¦ç”¨çŠ¶æ€å¤„ç†"
        - "âœ… ä¿å­˜/å–æ¶ˆå›è°ƒ"
      next_steps:
        - "Week 2 Day 1: é›†æˆ Slate.js åº“"
        - "Week 2 Day 1-2: å®ç°æ–‡æœ¬ç¼–è¾‘å’Œæ ¼å¼åŒ–"
        - "Week 2 Day 2-3: æ·»åŠ å—ç±»å‹æ”¯æŒ"
        - "Week 2 Day 4: API é›†æˆå’Œä¼˜åŒ–æ›´æ–°"

    task_5_visual_rules_update:
      status: "âœ… IN PROGRESS"
      description: "æ›´æ–° VISUAL_RULES Part 17ï¼ˆæ­¤èŠ‚ç‚¹ï¼‰"
      sections:
        - "Phase 4 æ‰§è¡Œå¿«ç…§ï¼ˆæœ¬èŠ‚ï¼‰"
        - "å®Œæˆä»»åŠ¡æ€»ç»“ï¼ˆ4/5 å®Œæˆï¼‰"
        - "å…³é”®æŒ‡æ ‡æ›´æ–°"
        - "åç»­æ­¥éª¤"

  status_summary:
    overall: "ğŸŸ¡ Phase 4 Week 1 è¿›è¡Œä¸­"
    dynamic_routing: "âœ… 100% (routes + pages + parameters)"
    block_editor_research: "âœ… 100% (decision + timeline)"
    block_editor_poc: "âœ… 80% (skeleton complete, Slate integration pending)"
    documentation: "â³ 90% (this part 17 in progress)"

  key_metrics:
    files_created: "6 page files + 6 CSS modules"
    routes_implemented: "3-layer nesting (Library â†’ Bookshelf â†’ Book)"
    breadcrumbs: "4 levels (Library list â†’ Library â†’ Bookshelf â†’ Book)"
    ts_type_errors: "0 new errors (existing issues from v1 unrelated)"
    compilation_status: "âœ… All new files compile successfully"

  blockers_resolved:
    issue_1: "BookMainWidget Props vs BlockMainWidget Props"
      solution: "Updated widget to accept `blocks` array instead of `bookshelfId`"
    issue_2: "useBooks signature requires (libraryId, bookshelfId)"
      solution: "Updated page to pass both parameters from useParams"
    issue_3: "BookDto field names (title â†’ name, isbn â†’ description)"
      solution: "Updated pages to use correct BookDto interface fields"

  next_immediate_actions:
    action_1:
      priority: "ğŸ”´ P0"
      title: "Install Slate.js + dependencies"
      command: "npm install slate slate-react slate-history"
      timeline: "Nov 23 (Phase 5 Week 2 start)"
    action_2:
      priority: "ğŸ”´ P0"
      title: "Implement BlockEditor with Slate"
      description: "Integrate Slate editor into BlockEditor.tsx POC"
      timeline: "Nov 23-24 (Phase 5 Day 1-2)"
    action_3:
      priority: "ğŸŸ¡ P1"
      title: "Create 6 block type renders"
      description: "HeadingBlock, TextBlock, ImageBlock, VideoBlock, CodeBlock, ListBlock"
      timeline: "Nov 24-25 (Phase 5 Day 2-3)"
    action_4:
      priority: "ğŸŸ¡ P1"
      title: "Implement Zustand stores"
      description: "Create store.ts for all 7 features"
      timeline: "Nov 26-27 (Phase 5 Day 3-4)"

  risks_and_mitigations:
    risk_1:
      description: "Slate.js learning curve steeper than expected"
      mitigation: "Use TipTap (simpler Slate wrapper) as fallback"
      probability: "Low (documentation is comprehensive)"
    risk_2:
      description: "Dynamic routes edge cases with URL encoding"
      mitigation: "Add thorough E2E tests for nested navigation"
      probability: "Medium (typical with App Router)"
    risk_3:
      description: "Performance with large block lists"
      mitigation: "Implement virtual scrolling + pagination"
      probability: "Low (defer to Phase 6)"

  quality_metrics:
    typescript_strict: "âœ… Enabled (all new files type-safe)"
    no_circular_deps: "âœ… Validated (FSD rules followed)"
    breadcrumb_coverage: "âœ… 4 levels complete"
    error_handling: "âœ… All pages have error boundaries"
    loading_states: "âœ… Spinner components integrated"
    css_modules: "âœ… All styling scoped and isolated"

  phase_4_acceptance_criteria:
    criteria_1:
      requirement: "âœ… Nested routing working (3 levels)"
      status: "âœ… COMPLETE"
      evidence: "3 new page files with dynamic [id] parameters"
    criteria_2:
      requirement: "âœ… Breadcrumbs display navigation path"
      status: "âœ… COMPLETE"
      evidence: "4-level breadcrumb in BookDetailPage"
    criteria_3:
      requirement: "âœ… All 9 pages at least rendering"
      status: "â³ IN PROGRESS"
      note: "Dynamic pages created, existing pages stable"
    criteria_4:
      requirement: "âœ… Block editor framework ready"
      status: "âœ… COMPLETE"
      evidence: "BlockEditor.tsx POC with toolbar, save/cancel"
    criteria_5:
      requirement: "âœ… TypeScript all passing"
      status: "âœ… COMPLETE (new files only)"
      note: "0 new errors, existing issues from v1 code"

  timeline_status:
    phase_4_start: "2025-11-16"
    phase_4_target_end: "2025-11-23"
    days_used: "1 day (16th)"
    days_remaining: "6 days"
    progress_percentage: "75% (routing + editor decision complete)"
    on_track: "âœ… YES - ahead of schedule"

  summary:
    headline: "Phase 4 Week 1: Dynamic Routing + Block Editor Framework âœ…"
    achievements:
      - "3-layer nested routing architecture complete"
      - "4-level breadcrumb navigation working"
      - "Block editor framework + Slate.js decision documented"
      - "All page components type-safe and compiling"
      - "Ready for Phase 5 Slate integration"
    ready_for_phase_5: "âœ… YES - all prerequisites in place"
    estimated_phase_5_start: "2025-11-23 (Week 2)"


  estimated_completion:
    phase_4: "2025-11-23 (1 week from Nov 16)"
    phase_5: "2025-11-30 (2 weeks)"
    phase_6: "2025-12-07 (3 weeks)"
    phase_7: "2025-12-14 (4 weeks)"
    total_timeline: "4 weeks â†’ 95% FSD maturity"

  final_metrics:
    layer_0_target: "âœ… 100% (from 95%)"
    layer_1_target: "âœ… 100% (stable)"
    layer_2_target: "âœ… 95% (from 74%)"
    layer_3_target: "âœ… 95% (from 80%)"
    layer_4_target: "âœ… 100% (stable)"
    layer_5_target: "âœ… 90% (from 55%)"
    layer_6_target: "âœ… 100% (stable)"
    overall_target: "âœ… 95% (from 76%)"


# ============================================
# Part 18: Phase 5 Day 1 - BlockEditor Slate.js Implementation
# Completion Report (November 16, 2025)
# ============================================

phase_5_day_1_snapshot:
  session_metadata:
    phase: 'Phase 5 (Nov 23-30)'
    day: 'Day 1'
    date: '2025-11-16'
    session_duration: '90 minutes (14:00-15:30 UTC+8)'
    status: '? COMPLETE (100%)'


# ============================================
# Part 19: November 20 - Phase 2 Complete
# Book Preview Cards + Horizontal Scrolling
# ============================================

book_preview_cards_phase_2:
  session_metadata:
    phase: "Phase 2 (Book Preview Cards + Horizontal Scrolling)"
    date: "2025-11-20"
    status: "âœ… COMPLETE"
    components_count: 3
    files_modified: 9

  RULE_SM_006_BOOK_PREVIEW_CARD:
    description: "BookPreviewCard component specifications (200Ã—280px card with color hash cover)"
    component_name: "BookPreviewCard"
    file_path: "frontend/src/features/book/ui/BookPreviewCard.tsx"
    specifications:
      dimensions:
        - "Card width: 200px (fixed, flex: 0 0 auto for horizontal scroll)"
        - "Card height: 280px (fixed to create portrait appearance)"
        - "Cover height: 120px (45% of card, color hash based)"
        - "Content area: 160px (text + metadata display)"
      cover_design:
        - "Color hash algorithm: Use book title to generate stable, unique color"
        - "Pattern: Gradient background from hash-color to lighten(hash-color, 10%)"
        - "Display: Book emoji icon ğŸ“– centered on gradient background"
      content_section:
        - "Title: 2 lines max, overflow ellipsis, font-weight: 600"
        - "Summary: 1 line max, text-overflow: ellipsis, font-size: 12px"
        - "Status badge: READING/PLANNING/COMPLETED, color-coded circle (4px)"
        - "Stats: 'ğŸ“Š 3 blocks' (small, 11px), bottom-left corner"
        - "Pin icon: ğŸ“Œ if is_pinned=true, top-right corner"
      hover_menu:
        - "Trigger: MouseEnter shows semi-transparent dark overlay (rgba(0,0,0,0.7))"
        - "Buttons: 3 emoji buttons centered vertically"
        - "Button 1: ğŸ‘ï¸ (View) - onClick: onSelect(book)"
        - "Button 2: âœï¸ (Edit) - onClick: onEdit(book)"
        - "Button 3: ğŸ—‘ï¸ (Delete) - onClick: onDelete(book) with confirmation"
        - "Animation: fadeIn 200ms ease-in on hover"
      responsive:
        - "Desktop: 200px width unchanged"
        - "Tablet: 180px width (calc: 100% - spacing)"
        - "Mobile: 160px width (smaller for cramped screens)"
      data_props:
        - "bookshelfId: string (from BookDto)"
        - "title: string (from BookDto.title)"
        - "summary: string (from BookDto.summary)"
        - "status: 'READING'|'PLANNING'|'COMPLETED' (from BookDto.status)"
        - "block_count: number (from BookDto.block_count)"
        - "is_pinned: boolean (from BookDto.is_pinned)"
      callbacks:
        - "onSelect?(book: BookDto): void - Fires on View button"
        - "onEdit?(book: BookDto): void - Fires on Edit button"
        - "onDelete?(bookId: string): void - Fires on Delete button with confirmation"
    implementation_notes: |
      1. Use CSS Modules scoped to .cardWrapper
      2. Export const colorHashFromString = (str: string) â‡’ color code
      3. No external color library; use HSL color space for consistency
      4. Hover menu buttons are emoji-only (no text labels)
      5. Keep card click-inert; only respond to button clicks
    related_files:
      - "frontend/src/entities/book/types.ts (BookDto type)"
      - "frontend/src/features/book/ui/BookPreviewCard.module.css"
      - "frontend/src/features/book/ui/BookPreviewList.tsx (parent)"

  RULE_SM_007_BOOK_PREVIEW_LIST:
    description: "BookPreviewList component - horizontal scroll container with CSS native scrolling"
    component_name: "BookPreviewList"
    file_path: "frontend/src/features/book/ui/BookPreviewList.tsx"
    specifications:
      container_properties:
        - "Display: flex with flex-direction: row (horizontal layout)"
        - "Overflow: overflow-x: auto (CSS native scroll, no libraries)"
        - "Scroll-behavior: smooth for better UX"
        - "Gap: 12px between BookPreviewCard items"
        - "Padding: 16px top/bottom, 12px left/right"
      scrollbar_styling:
        - "Width: 8px (thin, not intrusive)"
        - "Background: --color-surface-variant"
        - "Thumb: --color-primary with 50% opacity"
        - "Thumb hover: --color-primary at 100% opacity"
        - "Border-radius: 4px (rounded thumb)"
        - "Implementation: webkit-scrollbar pseudo-elements (CSS, no JS)"
      empty_state:
        - "Display when: books.length === 0 && !loading"
        - "Icon: ğŸ“š (books emoji)"
        - "Message: 'æš‚æ— ä¹¦ç±' (Chinese: 'No books yet')"
        - "Color: --color-text-secondary"
        - "Styling: centered, min-height: 200px (vertical centering)"
      loading_state:
        - "Display when: loading === true"
        - "Component: <Spinner /> (shared from shared/ui)"
        - "Message: 'åŠ è½½ä¸­...' (Chinese: 'Loading...')"
        - "Styling: centered, same min-height: 200px"
      populated_state:
        - "Display when: books.length > 0 && !loading"
        - "Map books array to BookPreviewCard components"
        - "Pass callbacks: onSelect, onEdit, onDelete to each card"
        - "No pagination controls (infinite scroll can be Phase 3)"
      responsive_behavior:
        - "Desktop: Full width available for horizontal scroll"
        - "Tablet: Adjust padding/gap proportionally"
        - "Mobile: Padding reduced to 8px, gap: 8px"
      data_props:
        - "books: BookDto[] (array of books to display)"
        - "loading: boolean (true = show loading state)"
        - "onSelectBook?(book: BookDto): void"
        - "onEditBook?(book: BookDto): void"
        - "onDeleteBook?(bookId: string): void"
    implementation_notes: |
      1. Use CSS Modules with .scrollWrapper as root class
      2. Flex container with overflow-x: auto (browser-native scrolling)
      3. CustomScrollbar via webkit-scrollbar CSS pseudo-elements
      4. State: 3 exclusive states (empty, loading, populated)
      5. No external scroll library (Radix ScrollArea, etc.)
      6. Smooth scroll for better perceived performance
    related_files:
      - "frontend/src/features/book/ui/BookPreviewCard.tsx (child component)"
      - "frontend/src/features/book/ui/BookPreviewList.module.css"
      - "frontend/src/widgets/book/BookMainWidget.tsx (parent)"
      - "frontend/src/shared/ui/Spinner.tsx (loading indicator)"

  RULE_SM_008_BOOK_MAIN_WIDGET:
    description: "BookMainWidget - orchestrator for book display within bookshelf context"
    component_name: "BookMainWidget"
    file_path: "frontend/src/widgets/book/BookMainWidget.tsx"
    specifications:
      widget_structure:
        - "Header section: Title 'My Books' + Add button"
        - "Stats line: 'ğŸ“Š 12 books â€¢ ğŸ“Œ 3 pinned'"
        - "BookPreviewList component (main content)"
        - "Error boundary: ErrorFallback if data fetch fails"
      header_section:
        - "Title: 'ğŸ“š æˆ‘çš„ä¹¦ç±' (Chinese: 'My Books') or configurable label"
        - "Add button: 'â• æ·»åŠ ä¹¦ç±' (Add Book) - triggers onAddBook callback"
        - "Button style: Secondary variant, no icon duplicates"
        - "Layout: Flex row, space-between, align-items: center"
      stats_line:
        - "Total: 'ğŸ“Š {total} æœ¬' (e.g., 'ğŸ“Š 12 æœ¬')"
        - "Pinned: 'ğŸ“Œ {pinned} ä¸ª' (e.g., 'ğŸ“Œ 3 ä¸ª')"
        - "Format: '{totalBooks} â€¢ {pinnedBooks}' on single line"
        - "Font-size: 12px, color: --color-text-secondary"
      data_loading:
        - "Hook: useBooks(bookshelfId) - from React Query"
        - "Returns: {data: BookDto[], loading: boolean, error: Error|null}"
        - "Caching: 5 minute stale time (configurable)"
        - "Refetch: onSuccess of book mutations automatically refetches"
      error_handling:
        - "Display: ErrorFallback component with icon + message"
        - "Message: 'ğŸ“› Failed to load books. Please try again.'"
        - "Retry button: Calls invalidateQueries('books')"
        - "Layout: centered, min-height: 300px"
      callbacks:
        - "onSelectBook?(book: BookDto): void - Route to /book/{id}"
        - "onEditBook?(book: BookDto): void - Open BookEditDialog or route to /book/{id}/edit"
        - "onDeleteBook?(bookId: string): void - Call deleteBook mutation with confirmation"
        - "onAddBook?(): void - Route to /bookshelves/{id}/books/new or open BookCreateDialog"
      responsive_layout:
        - "Desktop: Full width, centered in bookshelf detail page"
        - "Tablet: Adjusted padding, maintains scroll"
        - "Mobile: Edge-to-edge horizontal scroll"
      integration_point:
        - "Parent: BookshelfDetailPage (frontend/src/app/admin/bookshelves/[id]/page.tsx)"
        - "Props: bookshelfId: string (extracted from route params)"
        - "Sibling components: BookshelfHeader, BookshelfTabs, ..."
    implementation_notes: |
      1. Use useBooks(bookshelfId) to fetch books for specific bookshelf
      2. Pass BookPreviewList all necessary props (books, loading, callbacks)
      3. Stats calculation: filter(is_pinned) to get pinned count
      4. Error state replaces BookPreviewList content entirely
      5. No manual book management; rely on React Query for caching
      6. Callbacks passed down to BookPreviewCard via BookPreviewList
    related_files:
      - "frontend/src/features/book/model/api.ts (useBooks hook)"
      - "frontend/src/features/book/ui/BookPreviewList.tsx (child component)"
      - "frontend/src/widgets/book/BookMainWidget.module.css"
      - "frontend/src/app/admin/bookshelves/[bookshelfId]/page.tsx (integration)"

  integration_summary:
    files_created: 6
    files_modified: 3
    total_files_touched: 9
    typescript_errors: "âœ… 0"
    compilation_status: "âœ… SUCCESS"
    frontend_restart_needed: "âŒ NO (HMR handles CSS/exports)"
    api_integration: "âœ… useBooks hook wired to /api/v1/books"
    database_verification: "âœ… list_books endpoint returns correct fields"

  phase_2_acceptance_criteria:
    criteria_1:
      requirement: "âœ… BookPreviewCard renders 200Ã—280px cards"
      status: "âœ… COMPLETE"
      evidence: "Component file created, CSS with fixed dimensions"
    criteria_2:
      requirement: "âœ… Color hash from book title (stable, unique)"
      status: "âœ… COMPLETE"
      evidence: "colorHashFromString() function implemented"
    criteria_3:
      requirement: "âœ… Horizontal scroll (CSS native, no library)"
      status: "âœ… COMPLETE"
      evidence: "BookPreviewList uses overflow-x: auto + webkit-scrollbar"
    criteria_4:
      requirement: "âœ… Hover menu with View/Edit/Delete"
      status: "âœ… COMPLETE"
      evidence: "Emoji buttons in overlay, onClick callbacks wired"
    criteria_5:
      requirement: "âœ… BookMainWidget orchestrator pattern"
      status: "âœ… COMPLETE"
      evidence: "Widget handles useBooks, stats, error state"
    criteria_6:
      requirement: "âœ… Integration in bookshelf detail page"
      status: "âœ… COMPLETE"
      evidence: "BookshelfDetailPage imports and uses BookMainWidget"

  quality_checklist:
    typescript_strict: "âœ… All new files type-safe"
    responsive_design: "âœ… Desktop/Tablet/Mobile breakpoints defined"
    accessibility: "âœ… Semantic HTML + ARIA labels on buttons"
    performance: "âœ… React.memo on BookPreviewCard + useCallback on handlers"
    error_handling: "âœ… Try/catch in useBooks, error boundary ready"
    css_modules: "âœ… All styles scoped, no global pollution"
    code_documentation: "âœ… JSDoc comments on all components"

  timeline:
    phase_2_start: "2025-11-20"
    phase_2_complete: "2025-11-20 (same day)"
    duration: "~3 hours end-to-end (data layer â†’ UI â†’ integration â†’ testing)"
    ready_for_phase_4: "âœ… YES - documentation pending (VISUAL_RULES, DDD_RULES, HEXAGONAL_RULES, ADR-077)"

  deliverables:
    blockeditor_tsx: 'BlockEditor.tsx - 270 lines, Slate.js integration'
    blockeditor_css: 'BlockEditor.module.css - 110 lines, responsive styling'
    dependencies: 'slate, slate-react, slate-history (14 packages, 0 vulnerabilities)'
    dev_server: 'Next.js 14.2.33 running on http://localhost:30001 (2.8s startup)'

  completion_metrics:
    typescript_errors_new: '0'
    typescript_errors_existing: '22 (pre-Phase 5, acceptable)'
    fsd_maturity_before: '76%'
    fsd_maturity_after: '78%'
    quality_gates_passed: '6/6'
    ready_for_phase_5_day_2: '? YES'

  summary:
    achievements: 'Slate.js integration complete, dev server running, 0 new TS errors'
    next_session: 'Phase 5 Day 2 - Block Type Specialization (6 types + selector)'
    estimated_completion: '2025-11-17, 18:00 UTC+8'
