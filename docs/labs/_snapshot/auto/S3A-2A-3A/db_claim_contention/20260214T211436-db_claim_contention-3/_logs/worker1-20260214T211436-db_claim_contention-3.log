D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.WindowsSelectorEventLoopPolicy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
[OK] Database: postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test
{"ts": "2026-02-14T13:15:43.208409+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.startup", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "otlp_target_raw": "http://localhost:4318/v1/traces", "collector_reachable": true, "exporter_configured": true, "exporter_reason": "configured", "sampler": "always_on", "sampler_arg": "", "message": "tracing.startup", "taskName": null}
{"ts": "2026-02-14T13:15:43.209017+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.config", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "sampler": "always_on", "sampler_arg": "", "message": "tracing.config", "taskName": null}
{"ts": "2026-02-14T13:15:43.295789+00:00", "level": "INFO", "logger": "__main__", "message": "Search outbox worker starting: db=postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test, es=http://localhost:19200 index=wordloom-test-search-index, bulk=1, concurrency=1, poll=0.010s, worker_id=labs-expE-w1, lease=30s, max_processing=300s", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:43.295909+00:00", "level": "INFO", "logger": "__main__", "message": "Observability schema: labs-009-v2 (file=D:\\Project\\wordloom-v3\\backend\\scripts\\legacy\\search_outbox_worker.py)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:43.295968+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_BREAK_CLAIM enabled: claim is non-atomic (no row lock) with 1.500s delay", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:43.296105+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_PROCESS_SLEEP_SECONDS enabled: sleeping 1.500s after claim before processing", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:43.300816+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox worker metrics listening on :19130", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:43.423851+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox runtime endpoints listening on :19150 (/healthz,/readyz)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:43.454705+00:00", "level": "INFO", "logger": "__main__", "message": "[ENV_GUARD] Database environment check: OK", "taskName": "Task-1"}
{"ts": "2026-02-14T13:15:45.649601+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "8562fb05-6c85-439e-a5ba-1107928395df", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "cdb8f12f730d13432474a0ffca1d1694", "span_id": "87a5c24800a62b61"}
{"ts": "2026-02-14T13:15:47.459996+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:78d20eae-0222-46c9-aa4b-c15abc48bbc0 \"HTTP/1.1 201 Created\"", "taskName": "Task-7", "trace_id": "df62a1be32b62d325883055299daa752", "span_id": "293b265514422088"}
{"ts": "2026-02-14T13:15:47.466992+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 78d20eae-0222-46c9-aa4b-c15abc48bbc0 (version=0) into ES", "taskName": "Task-7", "trace_id": "df62a1be32b62d325883055299daa752", "span_id": "293b265514422088"}
{"ts": "2026-02-14T13:15:47.475627+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "8562fb05-6c85-439e-a5ba-1107928395df", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "df62a1be32b62d325883055299daa752", "span_id": "00405aaebe54d96e"}
{"ts": "2026-02-14T13:15:47.501579+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "531b3266-7a7d-4db8-a04a-ea4e9276ddf4", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "dfea594d629f6ca5f28871961d56662a", "span_id": "d95da79a5c043628"}
{"ts": "2026-02-14T13:15:47.540518+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "aec56329-a299-4b23-ba3d-4132950ea77f", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "deba6c6301ea5eaac48e1fecbb2745cb", "span_id": "880bb035644adbf6"}
{"ts": "2026-02-14T13:15:47.573985+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "45208603-4a08-44e7-a066-87b63353a185", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "4586c0e2a3f3a0e2345487379aa2cc32", "span_id": "7f36f050178ae28d"}
{"ts": "2026-02-14T13:15:49.126847+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "20de86ed-baca-4360-b280-5e1348609418", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "65308ba327031a0b2459f53f2c75ca1b", "span_id": "cb69a89b6b2d2846"}
{"ts": "2026-02-14T13:15:50.678056+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:6dbc9bd1-3843-4092-b07f-d5d5722a495e \"HTTP/1.1 201 Created\"", "taskName": "Task-14", "trace_id": "142ec8f779049c008c70ec611ffb7486", "span_id": "c51c639fc5090868"}
{"ts": "2026-02-14T13:15:50.682395+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 6dbc9bd1-3843-4092-b07f-d5d5722a495e (version=0) into ES", "taskName": "Task-14", "trace_id": "142ec8f779049c008c70ec611ffb7486", "span_id": "c51c639fc5090868"}
{"ts": "2026-02-14T13:15:50.691896+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "20de86ed-baca-4360-b280-5e1348609418", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "142ec8f779049c008c70ec611ffb7486", "span_id": "55ce83e70f91865c"}
{"ts": "2026-02-14T13:15:52.248943+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "d89c9715-a6f4-45aa-8f66-371c84db83d7", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "1b9e22dd4cae893a364d1fd7ebcb6c84", "span_id": "f30037f906eca192"}
{"ts": "2026-02-14T13:15:53.777476+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:95ed66bd-f075-4420-a2c3-1620f3df8762 \"HTTP/1.1 201 Created\"", "taskName": "Task-20", "trace_id": "c039e3d979cb0410b44ec676b7f90047", "span_id": "f9254ace3dc30d36"}
{"ts": "2026-02-14T13:15:53.780653+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 95ed66bd-f075-4420-a2c3-1620f3df8762 (version=0) into ES", "taskName": "Task-20", "trace_id": "c039e3d979cb0410b44ec676b7f90047", "span_id": "f9254ace3dc30d36"}
{"ts": "2026-02-14T13:15:53.785681+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "d89c9715-a6f4-45aa-8f66-371c84db83d7", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "c039e3d979cb0410b44ec676b7f90047", "span_id": "d8f041837d047940"}
{"ts": "2026-02-14T13:15:55.323622+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "8dec83fa-65cc-4ce4-ae6e-fe6aa31df7ca", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "56df4ce15bcc23abcd526a6e6bea9418", "span_id": "211369fbc1feea44"}
{"ts": "2026-02-14T13:15:56.848443+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:1ab0e4b7-c516-4a8a-a2e1-c0010889057a \"HTTP/1.1 201 Created\"", "taskName": "Task-24", "trace_id": "9af7ca10ce9edacdc84a991b8ff705e1", "span_id": "c07341dcbc1bc287"}
{"ts": "2026-02-14T13:15:56.850780+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 1ab0e4b7-c516-4a8a-a2e1-c0010889057a (version=0) into ES", "taskName": "Task-24", "trace_id": "9af7ca10ce9edacdc84a991b8ff705e1", "span_id": "c07341dcbc1bc287"}
{"ts": "2026-02-14T13:15:56.856226+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "8dec83fa-65cc-4ce4-ae6e-fe6aa31df7ca", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "9af7ca10ce9edacdc84a991b8ff705e1", "span_id": "06c18cbb1020e265"}
{"ts": "2026-02-14T13:15:58.394399+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "04dff038-163b-43fa-8a90-76e140d4d78d", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "fe7401b39f16a8c610f1910c08f3450d", "span_id": "5e638fe324cfd03c"}
{"ts": "2026-02-14T13:15:59.920220+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:4d61472f-9bd9-4fea-b7b5-2e4eb48d6948 \"HTTP/1.1 201 Created\"", "taskName": "Task-30", "trace_id": "bd3a50f2c8836a4219f008b5e9851f35", "span_id": "0cc136416e285873"}
{"ts": "2026-02-14T13:15:59.922101+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 4d61472f-9bd9-4fea-b7b5-2e4eb48d6948 (version=0) into ES", "taskName": "Task-30", "trace_id": "bd3a50f2c8836a4219f008b5e9851f35", "span_id": "0cc136416e285873"}
{"ts": "2026-02-14T13:15:59.927795+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "04dff038-163b-43fa-8a90-76e140d4d78d", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "bd3a50f2c8836a4219f008b5e9851f35", "span_id": "d3b2032fbbc8c377"}
{"ts": "2026-02-14T13:16:01.459992+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "3b5fc927-c904-437b-a7a5-3f57fd49b6da", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "1027a6a28c270d01276f2140666b28b7", "span_id": "6a29de032e426c8f"}
{"ts": "2026-02-14T13:16:02.984565+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:bf64a292-7ac0-4340-93a1-4dba6cca3a22 \"HTTP/1.1 201 Created\"", "taskName": "Task-34", "trace_id": "191ec27da9dc1e9317f69b3bd48bdfb8", "span_id": "460625d4f22036b8"}
{"ts": "2026-02-14T13:16:02.986435+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book bf64a292-7ac0-4340-93a1-4dba6cca3a22 (version=0) into ES", "taskName": "Task-34", "trace_id": "191ec27da9dc1e9317f69b3bd48bdfb8", "span_id": "460625d4f22036b8"}
{"ts": "2026-02-14T13:16:02.992045+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "3b5fc927-c904-437b-a7a5-3f57fd49b6da", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "191ec27da9dc1e9317f69b3bd48bdfb8", "span_id": "e4d23019e7c68882"}
{"ts": "2026-02-14T13:16:04.535274+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "555e3cad-5543-4be3-84b8-6283ce1a937a", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "b80f5a1ea9d62395ed1d9818dc48498e", "span_id": "f8f723ecc9d13013"}
{"ts": "2026-02-14T13:16:06.058523+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:126679df-aeb2-49d4-b5c6-c056379c9911 \"HTTP/1.1 201 Created\"", "taskName": "Task-40", "trace_id": "20f779dae33a157cfa07fa3812f3fa05", "span_id": "1c47ecb9d94d7177"}
{"ts": "2026-02-14T13:16:06.060483+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 126679df-aeb2-49d4-b5c6-c056379c9911 (version=0) into ES", "taskName": "Task-40", "trace_id": "20f779dae33a157cfa07fa3812f3fa05", "span_id": "1c47ecb9d94d7177"}
{"ts": "2026-02-14T13:16:06.065765+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "555e3cad-5543-4be3-84b8-6283ce1a937a", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "20f779dae33a157cfa07fa3812f3fa05", "span_id": "f9124f11f0f8ffc5"}
{"ts": "2026-02-14T13:16:07.589619+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "81c9e4dc-ccb2-4a6c-b148-d808032f0b39", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "352f957c573e470b5f5812a441895c8f", "span_id": "7c57d2f20927fce3"}
{"ts": "2026-02-14T13:16:09.116760+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:eca0fdf5-dfac-4a2d-90c8-bb1759f1c06d \"HTTP/1.1 201 Created\"", "taskName": "Task-44", "trace_id": "18f66eac55b446176be94c86e165667b", "span_id": "4e97c932a448f476"}
{"ts": "2026-02-14T13:16:09.119002+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book eca0fdf5-dfac-4a2d-90c8-bb1759f1c06d (version=0) into ES", "taskName": "Task-44", "trace_id": "18f66eac55b446176be94c86e165667b", "span_id": "4e97c932a448f476"}
{"ts": "2026-02-14T13:16:09.123801+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "81c9e4dc-ccb2-4a6c-b148-d808032f0b39", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "18f66eac55b446176be94c86e165667b", "span_id": "35389e31a066bf74"}
{"ts": "2026-02-14T13:16:10.669153+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "efa25928-744f-424d-8399-5649787e03b4", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "3ea6b0683da6166df7d554407fb041cf", "span_id": "437c7431ceafaab5"}
