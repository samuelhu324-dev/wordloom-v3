D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.WindowsSelectorEventLoopPolicy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
[OK] Database: postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test
{"ts": "2026-02-14T13:16:15.579107+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.startup", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "otlp_target_raw": "http://localhost:4318/v1/traces", "collector_reachable": true, "exporter_configured": true, "exporter_reason": "configured", "sampler": "always_on", "sampler_arg": "", "message": "tracing.startup", "taskName": null}
{"ts": "2026-02-14T13:16:15.579807+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.config", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "sampler": "always_on", "sampler_arg": "", "message": "tracing.config", "taskName": null}
{"ts": "2026-02-14T13:16:15.643095+00:00", "level": "INFO", "logger": "__main__", "message": "Search outbox worker starting: db=postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test, es=http://localhost:19200 index=wordloom-test-search-index, bulk=1, concurrency=1, poll=0.010s, worker_id=labs-expE-w2, lease=30s, max_processing=300s", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.643224+00:00", "level": "INFO", "logger": "__main__", "message": "Observability schema: labs-009-v2 (file=D:\\Project\\wordloom-v3\\backend\\scripts\\legacy\\search_outbox_worker.py)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.643275+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_BREAK_CLAIM enabled: claim is non-atomic (no row lock) with 1.500s delay", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.643408+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_PROCESS_SLEEP_SECONDS enabled: sleeping 1.500s after claim before processing", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.647041+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox worker metrics listening on :19133", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.758905+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox runtime endpoints listening on :19153 (/healthz,/readyz)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.799764+00:00", "level": "INFO", "logger": "__main__", "message": "[ENV_GUARD] Database environment check: OK", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:17.960972+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "b96c2fac-ddd0-4a65-bc63-f09db6a6fd08", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "5897d6de9922daa68ef704cd445d9864", "span_id": "abe6e339bdc14d04"}
{"ts": "2026-02-14T13:16:19.469378+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] Skipped 1 outbox events due to owner mismatch (race / lost claim). Latest: id=e2b81cb9-b71f-4c10-9f26-c151d9321d24 owner=labs-expE-w1", "taskName": "Task-7", "trace_id": "569250fdd7efe6f89340f16024bd12bf", "span_id": "f151fcb459823818"}
{"ts": "2026-02-14T13:16:19.470244+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "b96c2fac-ddd0-4a65-bc63-f09db6a6fd08", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "569250fdd7efe6f89340f16024bd12bf", "span_id": "b84410eef7c9ec32"}
{"ts": "2026-02-14T13:16:19.485634+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "337f2705-b9fc-424d-b4c1-5c51957159eb", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "0c929a8b067c6d4fba0b313eb2824b2b", "span_id": "56184e2fd28a7bd6"}
{"ts": "2026-02-14T13:16:19.525836+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "728c975c-6ce4-4340-8feb-284d572e7858", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "a1cdfe0a330cd8deed689c25b54ca6cd", "span_id": "a149017e221eab62"}
{"ts": "2026-02-14T13:16:19.557115+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "194ee805-331e-48db-b5bd-f48448ef15fa", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "6c92d8be9f9d0928b8978f1928d1efa9", "span_id": "6772973e3595f831"}
{"ts": "2026-02-14T13:16:19.586886+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "5e88fc6a-22cc-456b-895a-ef0873e89458", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "410a8f4b7dd949a7a00f8451370560a9", "span_id": "f399bf86452c9ab2"}
{"ts": "2026-02-14T13:16:19.618481+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "7dfd632a-588f-4596-8cb6-fede21d4e9a1", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "b2cfec24b150585d297f5ffa14e43b18", "span_id": "d3792b044903750a"}
{"ts": "2026-02-14T13:16:19.648585+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "546ccdcb-b54a-4899-bb82-28cebff09609", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "713ff8c09bb6bf0bf10bfb097d6d81d2", "span_id": "570c4788f95d59ac"}
{"ts": "2026-02-14T13:16:19.681082+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "5f2c9577-9c46-4bd6-b9f3-c88caa0abebe", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "a0f80efdfb3b2598ff58f996512c9016", "span_id": "69f2dafb20a80f09"}
{"ts": "2026-02-14T13:16:19.716756+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "e4692496-cf5b-4027-ae90-47f93275ffa5", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "f61f4c0b8df3457c782516c1c387cbf2", "span_id": "4e4074100325d2b0"}
{"ts": "2026-02-14T13:16:19.763647+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "fdf47dee-a69f-4237-95f7-78f0be2c5310", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "dbd6c94336d1d3c8b6a3482a303655a1", "span_id": "2c00128707a0b586"}
{"ts": "2026-02-14T13:16:19.808514+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "a2da243d-e7fb-4991-822e-e8a3874a6322", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "c0cc9e688e7bffe6215218778c60e2a6", "span_id": "bd18f82e606330b9"}
{"ts": "2026-02-14T13:16:19.839360+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "b0f2e02e-0f8f-48a2-a72d-b0d4cd811d79", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "2bfe530534bb6ec513e4de31bd00b66d", "span_id": "2940d37064ce11ce"}
{"ts": "2026-02-14T13:16:19.869572+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "85b55a65-d428-403e-8627-d29dccd32c34", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "6853f3f67aa4c2e55b6f89a5faa28fc5", "span_id": "7593dea83dcfee40"}
{"ts": "2026-02-14T13:16:19.902429+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "da8ec99c-714c-4605-aafa-31854b9c9658", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "36949129cbf8de1262db7c6ba59f9739", "span_id": "d77dde4f92e9f396"}
{"ts": "2026-02-14T13:16:21.459179+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "256e131a-e3b8-486a-9d1c-d7d3512957b3", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "16b4945ea73ce846155c83cafebcd2bf", "span_id": "1fc088e6eb946db2"}
{"ts": "2026-02-14T13:16:22.974674+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "256e131a-e3b8-486a-9d1c-d7d3512957b3", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "10ca1ea96009e64c3b70da1789ad20a2", "span_id": "5a7dc2c2f1dc1d9f"}
{"ts": "2026-02-14T13:16:24.522836+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "ae0af2da-9d89-4264-a10b-d2f58a849a65", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "d560c82f162c62d8d02c88db29f1ade6", "span_id": "b36211e35771c3a9"}
{"ts": "2026-02-14T13:16:26.034114+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] Skipped 3 outbox events due to owner mismatch (race / lost claim). Latest: id=ecf36abf-1b9e-48ff-95b4-57423fa3efc0 owner=labs-expE-w1", "taskName": "Task-30", "trace_id": "9d0912887ae9b911c68f1d5d433b9ffd", "span_id": "83c7200465849996"}
{"ts": "2026-02-14T13:16:26.034917+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "ae0af2da-9d89-4264-a10b-d2f58a849a65", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "9d0912887ae9b911c68f1d5d433b9ffd", "span_id": "bd3fedf6b48d1cd8"}
{"ts": "2026-02-14T13:16:27.567732+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "e71464c3-8008-4683-aa7f-622947b338a5", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "35156b68c7d8e87d792a29812cd67b3a", "span_id": "daa71d089eebbd7a"}
{"ts": "2026-02-14T13:16:29.082653+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "e71464c3-8008-4683-aa7f-622947b338a5", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "249aaedb5404e17b282e47ebe2557633", "span_id": "4c85d01ab01e4f3c"}
{"ts": "2026-02-14T13:16:30.611809+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "b0237b2a-4077-4e89-a944-9c4a93eeab19", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "18ba5b8a24a85763c620fe104aa6bb88", "span_id": "e8a4800b19a26f0f"}
{"ts": "2026-02-14T13:16:32.124007+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] Skipped 5 outbox events due to owner mismatch (race / lost claim). Latest: id=b5769ea2-55fa-41d6-b78c-68b233dc22ca owner=labs-expE-w1", "taskName": "Task-40", "trace_id": "685785ce9d2269297ab8b0aa78fba54a", "span_id": "169dd66d8fef967b"}
{"ts": "2026-02-14T13:16:32.124975+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "b0237b2a-4077-4e89-a944-9c4a93eeab19", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "685785ce9d2269297ab8b0aa78fba54a", "span_id": "13984786932f53ba"}
{"ts": "2026-02-14T13:16:33.655025+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "88769c4a-3446-42ec-a886-b209b028ce6f", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "6dd37a19528fa5169415e06e5bc1d36d", "span_id": "4c563ca887627725"}
{"ts": "2026-02-14T13:16:35.170068+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "88769c4a-3446-42ec-a886-b209b028ce6f", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "a9379b2608df1601e63c8b3ae838c497", "span_id": "57ac260d80c8d858"}
{"ts": "2026-02-14T13:16:36.714929+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "3688c12d-e1af-4499-919e-ca2f96f14570", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "6bebd40505fcdc17a0990ed3051d0fb4", "span_id": "ca3930146bbfc34a"}
{"ts": "2026-02-14T13:16:38.221773+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] Skipped 7 outbox events due to owner mismatch (race / lost claim). Latest: id=1a0f32ea-da91-4f8b-9b6e-bf17c26655f9 owner=labs-expE-w1", "taskName": "Task-50", "trace_id": "d47326841ccf19617724061bea2b7363", "span_id": "43895e15fa05c9da"}
{"ts": "2026-02-14T13:16:38.222853+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "3688c12d-e1af-4499-919e-ca2f96f14570", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "d47326841ccf19617724061bea2b7363", "span_id": "95a6195abc739327"}
{"ts": "2026-02-14T13:16:39.765177+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "307a2f4c-0c84-48e9-ab9d-fceaf9275f87", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "74186f0acd7ae867f357589e11ad67db", "span_id": "7ebd2c29894809be"}
{"ts": "2026-02-14T13:16:41.276134+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "307a2f4c-0c84-48e9-ab9d-fceaf9275f87", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "owner_mismatch", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "0303ef4d29511c59e3e07be4a27aed04", "span_id": "f4ec40ce6a14a62f"}
{"ts": "2026-02-14T13:16:41.290622+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 1 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:42.824454+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w2", "claim_batch_id": "99cb141e-864c-4cb7-843f-2c4bea23dc45", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "991b7b9e376cea887b062fdeaa909522", "span_id": "1ff1ddf224b120c8"}
