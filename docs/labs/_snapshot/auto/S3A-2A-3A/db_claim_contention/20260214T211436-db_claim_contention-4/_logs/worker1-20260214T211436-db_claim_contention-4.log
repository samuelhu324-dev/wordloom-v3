D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.WindowsSelectorEventLoopPolicy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
[OK] Database: postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test
{"ts": "2026-02-14T13:16:15.593546+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.startup", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "otlp_target_raw": "http://localhost:4318/v1/traces", "collector_reachable": true, "exporter_configured": true, "exporter_reason": "configured", "sampler": "always_on", "sampler_arg": "", "message": "tracing.startup", "taskName": null}
{"ts": "2026-02-14T13:16:15.593890+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.config", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "sampler": "always_on", "sampler_arg": "", "message": "tracing.config", "taskName": null}
{"ts": "2026-02-14T13:16:15.665313+00:00", "level": "INFO", "logger": "__main__", "message": "Search outbox worker starting: db=postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test, es=http://localhost:19200 index=wordloom-test-search-index, bulk=1, concurrency=1, poll=0.010s, worker_id=labs-expE-w1, lease=30s, max_processing=300s", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.665489+00:00", "level": "INFO", "logger": "__main__", "message": "Observability schema: labs-009-v2 (file=D:\\Project\\wordloom-v3\\backend\\scripts\\legacy\\search_outbox_worker.py)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.665569+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_BREAK_CLAIM enabled: claim is non-atomic (no row lock) with 1.500s delay", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.665759+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_PROCESS_SLEEP_SECONDS enabled: sleeping 1.500s after claim before processing", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.670574+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox worker metrics listening on :19132", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.778951+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox runtime endpoints listening on :19152 (/healthz,/readyz)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:15.811974+00:00", "level": "INFO", "logger": "__main__", "message": "[ENV_GUARD] Database environment check: OK", "taskName": "Task-1"}
{"ts": "2026-02-14T13:16:17.975894+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "96c2d9a6-220e-4bf0-bf2e-0d01023ce55f", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "cb33080a748d7b317edae37cffbb4a41", "span_id": "e8e8882a5d688e40"}
{"ts": "2026-02-14T13:16:19.781253+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:f7201909-1da2-4ff7-9f82-c29f9ff1f159 \"HTTP/1.1 201 Created\"", "taskName": "Task-7", "trace_id": "737256807d71ed343d77a3c9b59f02fe", "span_id": "db8db6124dbb6452"}
{"ts": "2026-02-14T13:16:19.783176+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book f7201909-1da2-4ff7-9f82-c29f9ff1f159 (version=0) into ES", "taskName": "Task-7", "trace_id": "737256807d71ed343d77a3c9b59f02fe", "span_id": "db8db6124dbb6452"}
{"ts": "2026-02-14T13:16:19.789371+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "96c2d9a6-220e-4bf0-bf2e-0d01023ce55f", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "737256807d71ed343d77a3c9b59f02fe", "span_id": "c12117d4c5b1b6df"}
{"ts": "2026-02-14T13:16:19.812058+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "a9ed1d34-7ec7-4b84-97f7-5a8cd2de0fb6", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "8bbf0e281b420cb1e2c4201d0cd9332f", "span_id": "b3f5edc01f6d6c7d"}
{"ts": "2026-02-14T13:16:19.853535+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "7d10030a-4dcc-42ae-a0a2-dc485b5f220b", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "7afb419cd6663131164f851cb432ca7d", "span_id": "a296b47ca60cd047"}
{"ts": "2026-02-14T13:16:19.885962+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "8faf07db-5b91-4f14-bbbc-d55af4a29165", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "39f548ef3aa6391efeb0472a8eadbd80", "span_id": "94d56749d5cb164d"}
{"ts": "2026-02-14T13:16:19.928132+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "294c4076-1ec0-4d50-8707-a63919006ec7", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 0, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "389631941aed9e9984f69a935cab8857", "span_id": "0a6f2a44b402c449"}
{"ts": "2026-02-14T13:16:21.475234+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "0c82f618-859e-446c-916a-1440b66d3022", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "c502d48f6014d14307bd88a193988343", "span_id": "ef8c9e05467661e5"}
{"ts": "2026-02-14T13:16:23.003158+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:384f4951-44c1-4f49-a962-272a309afbf6 \"HTTP/1.1 201 Created\"", "taskName": "Task-15", "trace_id": "7f66446c80057b16923ee8904bebb025", "span_id": "9bfb4e56f1d830cc"}
{"ts": "2026-02-14T13:16:23.005360+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 384f4951-44c1-4f49-a962-272a309afbf6 (version=0) into ES", "taskName": "Task-15", "trace_id": "7f66446c80057b16923ee8904bebb025", "span_id": "9bfb4e56f1d830cc"}
{"ts": "2026-02-14T13:16:23.010555+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "0c82f618-859e-446c-916a-1440b66d3022", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "7f66446c80057b16923ee8904bebb025", "span_id": "a891440dab671f78"}
{"ts": "2026-02-14T13:16:24.554055+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "1e348226-6f56-4b6e-a4f3-885c3c7a5d84", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "67dd44383b5c2d193af20f3c3c326b07", "span_id": "fc5d6768dd698037"}
{"ts": "2026-02-14T13:16:26.083031+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:103d752e-c1de-47a6-ab9b-fae6899071a1 \"HTTP/1.1 201 Created\"", "taskName": "Task-21", "trace_id": "574e5a4812c7550b7359e0b7fa5e3fa6", "span_id": "22acb947a413f409"}
{"ts": "2026-02-14T13:16:26.085176+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 103d752e-c1de-47a6-ab9b-fae6899071a1 (version=0) into ES", "taskName": "Task-21", "trace_id": "574e5a4812c7550b7359e0b7fa5e3fa6", "span_id": "22acb947a413f409"}
{"ts": "2026-02-14T13:16:26.090837+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "1e348226-6f56-4b6e-a4f3-885c3c7a5d84", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "574e5a4812c7550b7359e0b7fa5e3fa6", "span_id": "2503b2e6672d2419"}
{"ts": "2026-02-14T13:16:27.628670+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "fbc96f93-4f0d-4447-9880-0ae0015fb6dc", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "c1c2c6181f6a937b2b4964c0f3af5ac0", "span_id": "b66ffdc5b57bdf1b"}
{"ts": "2026-02-14T13:16:29.156357+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:085d2a64-6d5e-40ed-8d0f-2692fbdbf7ee \"HTTP/1.1 201 Created\"", "taskName": "Task-25", "trace_id": "cc24364d46548048cce7a276c30b30ae", "span_id": "dae4c78011a550b0"}
{"ts": "2026-02-14T13:16:29.158407+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 085d2a64-6d5e-40ed-8d0f-2692fbdbf7ee (version=0) into ES", "taskName": "Task-25", "trace_id": "cc24364d46548048cce7a276c30b30ae", "span_id": "dae4c78011a550b0"}
{"ts": "2026-02-14T13:16:29.163234+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "fbc96f93-4f0d-4447-9880-0ae0015fb6dc", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "cc24364d46548048cce7a276c30b30ae", "span_id": "e08c596ccd79082e"}
{"ts": "2026-02-14T13:16:30.705212+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "d794bd69-f7cf-4ebd-8f54-70e39d70af45", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "3b7e936a366a0e691fee7de867f896ab", "span_id": "7802e10665b2d5e9"}
{"ts": "2026-02-14T13:16:32.239570+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:7e0be22b-2b05-4aeb-833d-1248b052c672 \"HTTP/1.1 201 Created\"", "taskName": "Task-31", "trace_id": "48cb6f6e6d0c6cfec8e1403833fb57ef", "span_id": "b15a8985619e6889"}
{"ts": "2026-02-14T13:16:32.242930+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 7e0be22b-2b05-4aeb-833d-1248b052c672 (version=0) into ES", "taskName": "Task-31", "trace_id": "48cb6f6e6d0c6cfec8e1403833fb57ef", "span_id": "b15a8985619e6889"}
{"ts": "2026-02-14T13:16:32.249787+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "d794bd69-f7cf-4ebd-8f54-70e39d70af45", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "48cb6f6e6d0c6cfec8e1403833fb57ef", "span_id": "2bc49156bfda3ddb"}
{"ts": "2026-02-14T13:16:33.778428+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "649a1b8c-78fd-489f-9e40-3d6489e656d7", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "25e87c6213d21a5a9bb1010422e33d5b", "span_id": "b329d62bcf12db44"}
{"ts": "2026-02-14T13:16:35.309514+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:f1d30c2a-65a3-4d13-af4f-5204bd721c86 \"HTTP/1.1 201 Created\"", "taskName": "Task-35", "trace_id": "c623bcd12eac4276d31a3c2054860a2c", "span_id": "8f2339cf150c0e67"}
{"ts": "2026-02-14T13:16:35.311467+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book f1d30c2a-65a3-4d13-af4f-5204bd721c86 (version=0) into ES", "taskName": "Task-35", "trace_id": "c623bcd12eac4276d31a3c2054860a2c", "span_id": "8f2339cf150c0e67"}
{"ts": "2026-02-14T13:16:35.317008+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "649a1b8c-78fd-489f-9e40-3d6489e656d7", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "c623bcd12eac4276d31a3c2054860a2c", "span_id": "8635f8f7addeccff"}
{"ts": "2026-02-14T13:16:36.870518+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "a033ce0f-3c38-430b-b3a2-033b2bec6377", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "6e6d42331758e758009ad9a61bb66c1a", "span_id": "50408cbbffcc3259"}
{"ts": "2026-02-14T13:16:38.407668+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:3f79461e-bd70-4237-b3ef-0c59ffc2e809 \"HTTP/1.1 201 Created\"", "taskName": "Task-41", "trace_id": "b0df1e4114632b9958442037c3d93fd0", "span_id": "f9b45efd2d542ce2"}
{"ts": "2026-02-14T13:16:38.410255+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 3f79461e-bd70-4237-b3ef-0c59ffc2e809 (version=0) into ES", "taskName": "Task-41", "trace_id": "b0df1e4114632b9958442037c3d93fd0", "span_id": "f9b45efd2d542ce2"}
{"ts": "2026-02-14T13:16:38.416671+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "a033ce0f-3c38-430b-b3a2-033b2bec6377", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "b0df1e4114632b9958442037c3d93fd0", "span_id": "51366b249bec1649"}
{"ts": "2026-02-14T13:16:39.950279+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "344d9c92-887b-4ea0-942a-56ef3c73508f", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "49b07b008aaa3ba1629e7588495734de", "span_id": "26c60615b285eebb"}
{"ts": "2026-02-14T13:16:41.474428+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://localhost:19200/wordloom-test-search-index/_doc/book:4514a0ab-84d5-4da2-b797-42c138791998 \"HTTP/1.1 201 Created\"", "taskName": "Task-45", "trace_id": "c12d7fe43f4b49e0b838bf8da03a8b78", "span_id": "9d06a8bda51333d0"}
{"ts": "2026-02-14T13:16:41.477243+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox upsert: indexed book 4514a0ab-84d5-4da2-b797-42c138791998 (version=0) into ES", "taskName": "Task-45", "trace_id": "c12d7fe43f4b49e0b838bf8da03a8b78", "span_id": "9d06a8bda51333d0"}
{"ts": "2026-02-14T13:16:41.481329+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "344d9c92-887b-4ea0-942a-56ef3c73508f", "obs_schema": "labs-009-v2", "batch_size": 1, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "ok", "reason": "none", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "c12d7fe43f4b49e0b838bf8da03a8b78", "span_id": "433b5a07d1c8d20b"}
{"ts": "2026-02-14T13:16:43.021008+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expE-w1", "claim_batch_id": "6ecf2bbf-d105-4b62-b46a-85bcd46048cf", "obs_schema": "labs-009-v2", "batch_size": 1, "claimed": 1, "claim_mode": "non_atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "65bdba4d37e48210ca5d1ac276b7b225", "span_id": "ca2db85d8e826e80"}
