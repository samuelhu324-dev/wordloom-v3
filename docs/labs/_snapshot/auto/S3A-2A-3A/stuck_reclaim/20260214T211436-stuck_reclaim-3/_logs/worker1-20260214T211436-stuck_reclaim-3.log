

# controller: spawn attempt 1/4 metrics_port=19132 http_port=19152
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.WindowsSelectorEventLoopPolicy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
[OK] Database: postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test
{"ts": "2026-02-14T13:18:17.506383+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.startup", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "otlp_target_raw": "http://localhost:4318/v1/traces", "collector_reachable": true, "exporter_configured": true, "exporter_reason": "configured", "sampler": "always_on", "sampler_arg": "", "message": "tracing.startup", "taskName": null}
{"ts": "2026-02-14T13:18:17.506607+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.config", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "sampler": "always_on", "sampler_arg": "", "message": "tracing.config", "taskName": null}
{"ts": "2026-02-14T13:18:17.569613+00:00", "level": "INFO", "logger": "__main__", "message": "Search outbox worker starting: db=postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test, es=http://localhost:19200 index=wordloom-test-search-index, bulk=50, concurrency=1, poll=0.100s, worker_id=labs-expF-w1, lease=3s, max_processing=60s", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:17.569731+00:00", "level": "INFO", "logger": "__main__", "message": "Observability schema: labs-009-v2 (file=D:\\Project\\wordloom-v3\\backend\\scripts\\legacy\\search_outbox_worker.py)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:17.569778+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_PROCESS_SLEEP_SECONDS enabled: sleeping 4.000s after claim before processing", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:17.573377+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox worker metrics listening on :19132", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:17.672758+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox runtime endpoints listening on :19152 (/healthz,/readyz)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:17.699419+00:00", "level": "INFO", "logger": "__main__", "message": "[ENV_GUARD] Database environment check: OK", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:18.232510+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "988b0fdf-c6c1-42a1-ba69-ddfd75f60463", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "a67d340063e546d822c86b5d07038491", "span_id": "5d84c8056d9ff978"}
{"ts": "2026-02-14T13:18:22.248502+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "988b0fdf-c6c1-42a1-ba69-ddfd75f60463", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "090ef2ae58d31d707b31ced66ec30f7b", "span_id": "7b669293ecf733eb"}
{"ts": "2026-02-14T13:18:22.262303+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:22.274774+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "d14cb3b0-3a64-4de4-b8cd-8a81563f61f0", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "4cee1b8af3aababfa0efe69c93e20d1b", "span_id": "330cbd0834cfe8e2"}
{"ts": "2026-02-14T13:18:26.292368+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "d14cb3b0-3a64-4de4-b8cd-8a81563f61f0", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "30b4bedb667f86003f6efad745310335", "span_id": "3478515f4a23387d"}
{"ts": "2026-02-14T13:18:26.306304+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:18:26.321729+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "701fb51e-dbff-402b-ba3a-6373825e9e5b", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "a6ea42b0dec0703664dc309e217e39e0", "span_id": "a765b35e98fd6271"}
