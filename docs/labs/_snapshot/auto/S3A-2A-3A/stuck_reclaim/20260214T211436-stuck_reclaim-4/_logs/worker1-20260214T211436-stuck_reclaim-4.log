

# controller: spawn attempt 1/4 metrics_port=19134 http_port=19154
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.WindowsSelectorEventLoopPolicy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
[OK] Database: postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test
{"ts": "2026-02-14T13:19:00.068039+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.startup", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "otlp_target_raw": "http://localhost:4318/v1/traces", "collector_reachable": true, "exporter_configured": true, "exporter_reason": "configured", "sampler": "always_on", "sampler_arg": "", "message": "tracing.startup", "taskName": null}
{"ts": "2026-02-14T13:19:00.068192+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.config", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "sampler": "always_on", "sampler_arg": "", "message": "tracing.config", "taskName": null}
{"ts": "2026-02-14T13:19:00.110625+00:00", "level": "INFO", "logger": "__main__", "message": "Search outbox worker starting: db=postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test, es=http://localhost:19200 index=wordloom-test-search-index, bulk=50, concurrency=1, poll=0.100s, worker_id=labs-expF-w1, lease=3s, max_processing=60s", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:00.110722+00:00", "level": "INFO", "logger": "__main__", "message": "Observability schema: labs-009-v2 (file=D:\\Project\\wordloom-v3\\backend\\scripts\\legacy\\search_outbox_worker.py)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:00.110763+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_PROCESS_SLEEP_SECONDS enabled: sleeping 4.000s after claim before processing", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:00.113682+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox worker metrics listening on :19134", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:00.190267+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox runtime endpoints listening on :19154 (/healthz,/readyz)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:00.214247+00:00", "level": "INFO", "logger": "__main__", "message": "[ENV_GUARD] Database environment check: OK", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:00.699847+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "401a1a3b-696c-4d21-991b-600796a4a569", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "244b2edc9eb217d7453558f0b778287c", "span_id": "89938f9f372baa21"}
{"ts": "2026-02-14T13:19:04.725908+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "401a1a3b-696c-4d21-991b-600796a4a569", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "f3a60c7274a974e9af1367ab364b5c89", "span_id": "d9c4c3b6e8a34916"}
{"ts": "2026-02-14T13:19:04.741249+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:04.757325+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "c0cf88c0-52ac-4f54-84e8-81b4fa956a5e", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "14fe4c6a29baa432997f344b4e3667a9", "span_id": "6f0be83d40c0a5a8"}
{"ts": "2026-02-14T13:19:08.779794+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "c0cf88c0-52ac-4f54-84e8-81b4fa956a5e", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "b9992487e4e228879be6c805caad9307", "span_id": "e66cf07a8c39f9df"}
{"ts": "2026-02-14T13:19:08.795939+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T13:19:08.808856+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "bce33e80-7f08-433a-8443-c4d92d226fc4", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "d609bb33bc340838b461291e74ee33c8", "span_id": "34532717e7d858a1"}
