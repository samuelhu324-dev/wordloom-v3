

# controller: spawn attempt 1/4 metrics_port=19148 http_port=19168
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.WindowsSelectorEventLoopPolicy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
D:\Project\wordloom-v3\backend\scripts\legacy\search_outbox_worker.py:52: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
  asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
[OK] Database: postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test
{"ts": "2026-02-14T14:41:08.360583+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.startup", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "otlp_target_raw": "http://localhost:4318/v1/traces", "collector_reachable": true, "exporter_configured": true, "exporter_reason": "configured", "sampler": "always_on", "sampler_arg": "", "message": "tracing.startup", "taskName": null}
{"ts": "2026-02-14T14:41:08.360721+00:00", "level": "INFO", "logger": "infra.observability.tracing", "event": "tracing.config", "enabled": true, "otel_service_name": "wordloom-search-outbox-worker", "otlp_protocol": "http/protobuf", "otlp_target": "http://localhost:4318/v1/traces", "sampler": "always_on", "sampler_arg": "", "message": "tracing.config", "taskName": null}
{"ts": "2026-02-14T14:41:08.406297+00:00", "level": "INFO", "logger": "__main__", "message": "Search outbox worker starting: db=postgresql+psycopg://wordloom:wordloom@localhost:5435/wordloom_test, es=http://localhost:19200 index=wordloom-test-search-index, bulk=50, concurrency=1, poll=0.100s, worker_id=labs-expF-w1, lease=3s, max_processing=60s", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:08.406394+00:00", "level": "INFO", "logger": "__main__", "message": "Observability schema: labs-009-v2 (file=D:\\Project\\wordloom-v3\\backend\\scripts\\legacy\\search_outbox_worker.py)", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:08.406435+00:00", "level": "WARNING", "logger": "__main__", "message": "[LABS] OUTBOX_EXPERIMENT_PROCESS_SLEEP_SECONDS enabled: sleeping 4.000s after claim before processing", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:08.409176+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox worker metrics listening on :19148", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:08.481168+00:00", "level": "INFO", "logger": "__main__", "message": "Outbox runtime endpoints listening on :19168 (/healthz,/readyz)", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:08.522847+00:00", "level": "INFO", "logger": "__main__", "message": "[ENV_GUARD] Database environment check: OK", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:08.978392+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "db3eb88b-9997-4a4e-bc7f-461678c4eb61", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "44d77c146c3984a992e204eb08b69548", "span_id": "fe997f132eb194e7"}
{"ts": "2026-02-14T14:41:12.995121+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "db3eb88b-9997-4a4e-bc7f-461678c4eb61", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "9401536d34418d9c28d00f6bfdf9a24f", "span_id": "25951424c9da8f73"}
{"ts": "2026-02-14T14:41:13.007586+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:13.016483+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "527f5085-4bdc-47e1-9ff8-4c0e733ff102", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "1cffbc014912b4e83df1f43af8be966a", "span_id": "7268e991a4fa670e"}
{"ts": "2026-02-14T14:41:17.038523+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "527f5085-4bdc-47e1-9ff8-4c0e733ff102", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "28551282f97c45e4f2f36413b528e1ad", "span_id": "2ff1700695159291"}
{"ts": "2026-02-14T14:41:17.050669+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:17.059227+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "8225195c-0c18-461c-a8bb-bf559921d4ac", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "874a341f49545021ce4f0f54bcc7b29b", "span_id": "74646d77db73a927"}
{"ts": "2026-02-14T14:41:21.082257+00:00", "level": "INFO", "logger": "__main__", "event": "projection.process_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "8225195c-0c18-461c-a8bb-bf559921d4ac", "obs_schema": "labs-009-v2", "batch_size": 5, "entity_type": "book", "op": "upsert", "attempt": 0, "result": "retry", "reason": "lease_expired", "mode": "per_event", "message": "projection.process_batch", "taskName": "Task-1", "trace_id": "3533749a39b9bdc7f4fbf97622decb1b", "span_id": "94ee65fb8f077fa4"}
{"ts": "2026-02-14T14:41:21.097004+00:00", "level": "WARNING", "logger": "__main__", "message": "Reclaimed 5 stuck outbox events (expired lease or max processing exceeded)", "taskName": "Task-1"}
{"ts": "2026-02-14T14:41:21.106844+00:00", "level": "INFO", "logger": "__main__", "event": "outbox.claim_batch", "layer": "worker", "projection": "search_index_to_elastic", "worker_id": "labs-expF-w1", "claim_batch_id": "e88afd33-8c52-4c46-a284-63b2231264fa", "obs_schema": "labs-009-v2", "batch_size": 50, "claimed": 5, "claim_mode": "atomic", "message": "outbox.claim_batch", "taskName": "Task-1", "trace_id": "2bc7ce9540bab74d40c7a9d9c1478a14", "span_id": "aaf4b8cd0a9cc74d"}
